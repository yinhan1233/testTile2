/*! For license information please see objectdecorator.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ObjectDecoratorCreator=t():e.ObjectDecoratorCreator=t()}(self,(()=>(()=>{var __webpack_modules__={331:function(e,t){var o;!function(t,o){"use strict";"object"==typeof e.exports?e.exports=t.document?o(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return o(e)}:o(t)}("undefined"!=typeof window?window:this,(function(n,i){"use strict";var r=[],a=Object.getPrototypeOf,s=r.slice,l=r.flat?function(e){return r.flat.call(e)}:function(e){return r.concat.apply([],e)},c=r.push,u=r.indexOf,h={},p=h.toString,f=h.hasOwnProperty,d=f.toString,g=d.call(Object),m={},y=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},_=function(e){return null!=e&&e===e.window},v=n.document,T={type:!0,src:!0,nonce:!0,noModule:!0};function x(e,t,o){var n,i,r=(o=o||v).createElement("script");if(r.text=e,t)for(n in T)(i=t[n]||t.getAttribute&&t.getAttribute(n))&&r.setAttribute(n,i);o.head.appendChild(r).parentNode.removeChild(r)}function C(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[p.call(e)]||"object":typeof e}var b="3.6.1",w=function(e,t){return new w.fn.init(e,t)};function P(e){var t=!!e&&"length"in e&&e.length,o=C(e);return!y(e)&&!_(e)&&("array"===o||0===t||"number"==typeof t&&t>0&&t-1 in e)}w.fn=w.prototype={jquery:b,constructor:w,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,(function(t,o){return e.call(t,o,t)})))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(w.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(w.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,o=+e+(e<0?t:0);return this.pushStack(o>=0&&o<t?[this[o]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:r.sort,splice:r.splice},w.extend=w.fn.extend=function(){var e,t,o,n,i,r,a=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[s]||{},s++),"object"==typeof a||y(a)||(a={}),s===l&&(a=this,s--);s<l;s++)if(null!=(e=arguments[s]))for(t in e)n=e[t],"__proto__"!==t&&a!==n&&(c&&n&&(w.isPlainObject(n)||(i=Array.isArray(n)))?(o=a[t],r=i&&!Array.isArray(o)?[]:i||w.isPlainObject(o)?o:{},i=!1,a[t]=w.extend(c,r,n)):void 0!==n&&(a[t]=n));return a},w.extend({expando:"jQuery"+(b+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,o;return!(!e||"[object Object]"!==p.call(e)||(t=a(e))&&("function"!=typeof(o=f.call(t,"constructor")&&t.constructor)||d.call(o)!==g))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,o){x(e,{nonce:t&&t.nonce},o)},each:function(e,t){var o,n=0;if(P(e))for(o=e.length;n<o&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(!1===t.call(e[n],n,e[n]))break;return e},makeArray:function(e,t){var o=t||[];return null!=e&&(P(Object(e))?w.merge(o,"string"==typeof e?[e]:e):c.call(o,e)),o},inArray:function(e,t,o){return null==t?-1:u.call(t,e,o)},merge:function(e,t){for(var o=+t.length,n=0,i=e.length;n<o;n++)e[i++]=t[n];return e.length=i,e},grep:function(e,t,o){for(var n=[],i=0,r=e.length,a=!o;i<r;i++)!t(e[i],i)!==a&&n.push(e[i]);return n},map:function(e,t,o){var n,i,r=0,a=[];if(P(e))for(n=e.length;r<n;r++)null!=(i=t(e[r],r,o))&&a.push(i);else for(r in e)null!=(i=t(e[r],r,o))&&a.push(i);return l(a)},guid:1,support:m}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=r[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){h["[object "+t+"]"]=t.toLowerCase()}));var S=function(e){var t,o,n,i,r,a,s,l,c,u,h,p,f,d,g,m,y,_,v,T="sizzle"+1*new Date,x=e.document,C=0,b=0,w=le(),P=le(),S=le(),L=le(),E=function(e,t){return e===t&&(h=!0),0},I={}.hasOwnProperty,O=[],M=O.pop,N=O.push,D=O.push,A=O.slice,H=function(e,t){for(var o=0,n=e.length;o<n;o++)if(e[o]===t)return o;return-1},z="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",k="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",R="\\[[\\x20\\t\\r\\n\\f]*("+B+")(?:"+k+"*([*^$|!~]?=)"+k+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+k+"*\\]",G=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",j=new RegExp(k+"+","g"),F=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),W=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),U=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),V=new RegExp(k+"|>"),$=new RegExp(G),Z=new RegExp("^"+B+"$"),q={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+G),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+z+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},K=/HTML$/i,Y=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var o="0x"+e.slice(1)-65536;return t||(o<0?String.fromCharCode(o+65536):String.fromCharCode(o>>10|55296,1023&o|56320))},ne=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},re=function(){p()},ae=Te((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{D.apply(O=A.call(x.childNodes),x.childNodes),O[x.childNodes.length].nodeType}catch(e){D={apply:O.length?function(e,t){N.apply(e,A.call(t))}:function(e,t){for(var o=e.length,n=0;e[o++]=t[n++];);e.length=o-1}}}function se(e,t,n,i){var r,s,c,u,h,d,y,_=t&&t.ownerDocument,x=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==x&&9!==x&&11!==x)return n;if(!i&&(p(t),t=t||f,g)){if(11!==x&&(h=Q.exec(e)))if(r=h[1]){if(9===x){if(!(c=t.getElementById(r)))return n;if(c.id===r)return n.push(c),n}else if(_&&(c=_.getElementById(r))&&v(t,c)&&c.id===r)return n.push(c),n}else{if(h[2])return D.apply(n,t.getElementsByTagName(e)),n;if((r=h[3])&&o.getElementsByClassName&&t.getElementsByClassName)return D.apply(n,t.getElementsByClassName(r)),n}if(o.qsa&&!L[e+" "]&&(!m||!m.test(e))&&(1!==x||"object"!==t.nodeName.toLowerCase())){if(y=e,_=t,1===x&&(V.test(e)||U.test(e))){for((_=ee.test(e)&&ye(t.parentNode)||t)===t&&o.scope||((u=t.getAttribute("id"))?u=u.replace(ne,ie):t.setAttribute("id",u=T)),s=(d=a(e)).length;s--;)d[s]=(u?"#"+u:":scope")+" "+ve(d[s]);y=d.join(",")}try{return D.apply(n,_.querySelectorAll(y)),n}catch(t){L(e,!0)}finally{u===T&&t.removeAttribute("id")}}}return l(e.replace(F,"$1"),t,n,i)}function le(){var e=[];return function t(o,i){return e.push(o+" ")>n.cacheLength&&delete t[e.shift()],t[o+" "]=i}}function ce(e){return e[T]=!0,e}function ue(e){var t=f.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){for(var o=e.split("|"),i=o.length;i--;)n.attrHandle[o[i]]=t}function pe(e,t){var o=t&&e,n=o&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(o)for(;o=o.nextSibling;)if(o===t)return-1;return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function de(e){return function(t){var o=t.nodeName.toLowerCase();return("input"===o||"button"===o)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ae(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ce((function(t){return t=+t,ce((function(o,n){for(var i,r=e([],o.length,t),a=r.length;a--;)o[i=r[a]]&&(o[i]=!(n[i]=o[i]))}))}))}function ye(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in o=se.support={},r=se.isXML=function(e){var t=e&&e.namespaceURI,o=e&&(e.ownerDocument||e).documentElement;return!K.test(t||o&&o.nodeName||"HTML")},p=se.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:x;return a!=f&&9===a.nodeType&&a.documentElement?(d=(f=a).documentElement,g=!r(f),x!=f&&(i=f.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",re,!1):i.attachEvent&&i.attachEvent("onunload",re)),o.scope=ue((function(e){return d.appendChild(e).appendChild(f.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.attributes=ue((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=ue((function(e){return e.appendChild(f.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=J.test(f.getElementsByClassName),o.getById=ue((function(e){return d.appendChild(e).id=T,!f.getElementsByName||!f.getElementsByName(T).length})),o.getById?(n.filter.ID=function(e){var t=e.replace(te,oe);return function(e){return e.getAttribute("id")===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var o=t.getElementById(e);return o?[o]:[]}}):(n.filter.ID=function(e){var t=e.replace(te,oe);return function(e){var o=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return o&&o.value===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var o,n,i,r=t.getElementById(e);if(r){if((o=r.getAttributeNode("id"))&&o.value===e)return[r];for(i=t.getElementsByName(e),n=0;r=i[n++];)if((o=r.getAttributeNode("id"))&&o.value===e)return[r]}return[]}}),n.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var o,n=[],i=0,r=t.getElementsByTagName(e);if("*"===e){for(;o=r[i++];)1===o.nodeType&&n.push(o);return n}return r},n.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},y=[],m=[],(o.qsa=J.test(f.querySelectorAll))&&(ue((function(e){var t;d.appendChild(e).innerHTML="<a id='"+T+"'></a><select id='"+T+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+z+")"),e.querySelectorAll("[id~="+T+"-]").length||m.push("~="),(t=f.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+T+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),ue((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=f.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),d.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(o.matchesSelector=J.test(_=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ue((function(e){o.disconnectedMatch=_.call(e,"*"),_.call(e,"[s!='']:x"),y.push("!=",G)})),m=m.length&&new RegExp(m.join("|")),y=y.length&&new RegExp(y.join("|")),t=J.test(d.compareDocumentPosition),v=t||J.test(d.contains)?function(e,t){var o=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(o.contains?o.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},E=t?function(e,t){if(e===t)return h=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===n?e==f||e.ownerDocument==x&&v(x,e)?-1:t==f||t.ownerDocument==x&&v(x,t)?1:u?H(u,e)-H(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return h=!0,0;var o,n=0,i=e.parentNode,r=t.parentNode,a=[e],s=[t];if(!i||!r)return e==f?-1:t==f?1:i?-1:r?1:u?H(u,e)-H(u,t):0;if(i===r)return pe(e,t);for(o=e;o=o.parentNode;)a.unshift(o);for(o=t;o=o.parentNode;)s.unshift(o);for(;a[n]===s[n];)n++;return n?pe(a[n],s[n]):a[n]==x?-1:s[n]==x?1:0},f):f},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(p(e),o.matchesSelector&&g&&!L[t+" "]&&(!y||!y.test(t))&&(!m||!m.test(t)))try{var n=_.call(e,t);if(n||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){L(t,!0)}return se(t,f,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=f&&p(e),v(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=f&&p(e);var i=n.attrHandle[t.toLowerCase()],r=i&&I.call(n.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==r?r:o.attributes||!g?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(ne,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],i=0,r=0;if(h=!o.detectDuplicates,u=!o.sortStable&&e.slice(0),e.sort(E),h){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return u=null,e},i=se.getText=function(e){var t,o="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)o+=i(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n++];)o+=i(t);return o},n=se.selectors={cacheLength:50,createPseudo:ce,match:q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(te,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,o=!e[6]&&e[2];return q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":o&&$.test(o)&&(t=a(o,!0))&&(t=o.indexOf(")",o.length-t)-o.length)&&(e[0]=e[0].slice(0,t),e[2]=o.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=w[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"("+k+"|$)"))&&w(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,o){return function(n){var i=se.attr(n,e);return null==i?"!="===t:!t||(i+="","="===t?i===o:"!="===t?i!==o:"^="===t?o&&0===i.indexOf(o):"*="===t?o&&i.indexOf(o)>-1:"$="===t?o&&i.slice(-o.length)===o:"~="===t?(" "+i.replace(j," ")+" ").indexOf(o)>-1:"|="===t&&(i===o||i.slice(0,o.length+1)===o+"-"))}},CHILD:function(e,t,o,n,i){var r="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===n&&0===i?function(e){return!!e.parentNode}:function(t,o,l){var c,u,h,p,f,d,g=r!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),_=!l&&!s,v=!1;if(m){if(r){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;d=g="only"===e&&!d&&"nextSibling"}return!0}if(d=[a?m.firstChild:m.lastChild],a&&_){for(v=(f=(c=(u=(h=(p=m)[T]||(p[T]={}))[p.uniqueID]||(h[p.uniqueID]={}))[e]||[])[0]===C&&c[1])&&c[2],p=f&&m.childNodes[f];p=++f&&p&&p[g]||(v=f=0)||d.pop();)if(1===p.nodeType&&++v&&p===t){u[e]=[C,f,v];break}}else if(_&&(v=f=(c=(u=(h=(p=t)[T]||(p[T]={}))[p.uniqueID]||(h[p.uniqueID]={}))[e]||[])[0]===C&&c[1]),!1===v)for(;(p=++f&&p&&p[g]||(v=f=0)||d.pop())&&((s?p.nodeName.toLowerCase()!==y:1!==p.nodeType)||!++v||(_&&((u=(h=p[T]||(p[T]={}))[p.uniqueID]||(h[p.uniqueID]={}))[e]=[C,v]),p!==t)););return(v-=i)===n||v%n==0&&v/n>=0}}},PSEUDO:function(e,t){var o,i=n.pseudos[e]||n.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return i[T]?i(t):i.length>1?(o=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?ce((function(e,o){for(var n,r=i(e,t),a=r.length;a--;)e[n=H(e,r[a])]=!(o[n]=r[a])})):function(e){return i(e,0,o)}):i}},pseudos:{not:ce((function(e){var t=[],o=[],n=s(e.replace(F,"$1"));return n[T]?ce((function(e,t,o,i){for(var r,a=n(e,null,i,[]),s=e.length;s--;)(r=a[s])&&(e[s]=!(t[s]=r))})):function(e,i,r){return t[0]=e,n(t,null,r,o),t[0]=null,!o.pop()}})),has:ce((function(e){return function(t){return se(e,t).length>0}})),contains:ce((function(e){return e=e.replace(te,oe),function(t){return(t.textContent||i(t)).indexOf(e)>-1}})),lang:ce((function(e){return Z.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,oe).toLowerCase(),function(t){var o;do{if(o=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(o=o.toLowerCase())===e||0===o.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var o=e.location&&e.location.hash;return o&&o.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return X.test(e.nodeName)},input:function(e){return Y.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,o){return[o<0?o+t:o]})),even:me((function(e,t){for(var o=0;o<t;o+=2)e.push(o);return e})),odd:me((function(e,t){for(var o=1;o<t;o+=2)e.push(o);return e})),lt:me((function(e,t,o){for(var n=o<0?o+t:o>t?t:o;--n>=0;)e.push(n);return e})),gt:me((function(e,t,o){for(var n=o<0?o+t:o;++n<t;)e.push(n);return e}))}},n.pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=fe(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=de(t);function _e(){}function ve(e){for(var t=0,o=e.length,n="";t<o;t++)n+=e[t].value;return n}function Te(e,t,o){var n=t.dir,i=t.next,r=i||n,a=o&&"parentNode"===r,s=b++;return t.first?function(t,o,i){for(;t=t[n];)if(1===t.nodeType||a)return e(t,o,i);return!1}:function(t,o,l){var c,u,h,p=[C,s];if(l){for(;t=t[n];)if((1===t.nodeType||a)&&e(t,o,l))return!0}else for(;t=t[n];)if(1===t.nodeType||a)if(u=(h=t[T]||(t[T]={}))[t.uniqueID]||(h[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[n]||t;else{if((c=u[r])&&c[0]===C&&c[1]===s)return p[2]=c[2];if(u[r]=p,p[2]=e(t,o,l))return!0}return!1}}function xe(e){return e.length>1?function(t,o,n){for(var i=e.length;i--;)if(!e[i](t,o,n))return!1;return!0}:e[0]}function Ce(e,t,o,n,i){for(var r,a=[],s=0,l=e.length,c=null!=t;s<l;s++)(r=e[s])&&(o&&!o(r,n,i)||(a.push(r),c&&t.push(s)));return a}function be(e,t,o,n,i,r){return n&&!n[T]&&(n=be(n)),i&&!i[T]&&(i=be(i,r)),ce((function(r,a,s,l){var c,u,h,p=[],f=[],d=a.length,g=r||function(e,t,o){for(var n=0,i=t.length;n<i;n++)se(e,t[n],o);return o}(t||"*",s.nodeType?[s]:s,[]),m=!e||!r&&t?g:Ce(g,p,e,s,l),y=o?i||(r?e:d||n)?[]:a:m;if(o&&o(m,y,s,l),n)for(c=Ce(y,f),n(c,[],s,l),u=c.length;u--;)(h=c[u])&&(y[f[u]]=!(m[f[u]]=h));if(r){if(i||e){if(i){for(c=[],u=y.length;u--;)(h=y[u])&&c.push(m[u]=h);i(null,y=[],c,l)}for(u=y.length;u--;)(h=y[u])&&(c=i?H(r,h):p[u])>-1&&(r[c]=!(a[c]=h))}}else y=Ce(y===a?y.splice(d,y.length):y),i?i(null,a,y,l):D.apply(a,y)}))}function we(e){for(var t,o,i,r=e.length,a=n.relative[e[0].type],s=a||n.relative[" "],l=a?1:0,u=Te((function(e){return e===t}),s,!0),h=Te((function(e){return H(t,e)>-1}),s,!0),p=[function(e,o,n){var i=!a&&(n||o!==c)||((t=o).nodeType?u(e,o,n):h(e,o,n));return t=null,i}];l<r;l++)if(o=n.relative[e[l].type])p=[Te(xe(p),o)];else{if((o=n.filter[e[l].type].apply(null,e[l].matches))[T]){for(i=++l;i<r&&!n.relative[e[i].type];i++);return be(l>1&&xe(p),l>1&&ve(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(F,"$1"),o,l<i&&we(e.slice(l,i)),i<r&&we(e=e.slice(i)),i<r&&ve(e))}p.push(o)}return xe(p)}return _e.prototype=n.filters=n.pseudos,n.setFilters=new _e,a=se.tokenize=function(e,t){var o,i,r,a,s,l,c,u=P[e+" "];if(u)return t?0:u.slice(0);for(s=e,l=[],c=n.preFilter;s;){for(a in o&&!(i=W.exec(s))||(i&&(s=s.slice(i[0].length)||s),l.push(r=[])),o=!1,(i=U.exec(s))&&(o=i.shift(),r.push({value:o,type:i[0].replace(F," ")}),s=s.slice(o.length)),n.filter)!(i=q[a].exec(s))||c[a]&&!(i=c[a](i))||(o=i.shift(),r.push({value:o,type:a,matches:i}),s=s.slice(o.length));if(!o)break}return t?s.length:s?se.error(e):P(e,l).slice(0)},s=se.compile=function(e,t){var o,i=[],r=[],s=S[e+" "];if(!s){for(t||(t=a(e)),o=t.length;o--;)(s=we(t[o]))[T]?i.push(s):r.push(s);s=S(e,function(e,t){var o=t.length>0,i=e.length>0,r=function(r,a,s,l,u){var h,d,m,y=0,_="0",v=r&&[],T=[],x=c,b=r||i&&n.find.TAG("*",u),w=C+=null==x?1:Math.random()||.1,P=b.length;for(u&&(c=a==f||a||u);_!==P&&null!=(h=b[_]);_++){if(i&&h){for(d=0,a||h.ownerDocument==f||(p(h),s=!g);m=e[d++];)if(m(h,a||f,s)){l.push(h);break}u&&(C=w)}o&&((h=!m&&h)&&y--,r&&v.push(h))}if(y+=_,o&&_!==y){for(d=0;m=t[d++];)m(v,T,a,s);if(r){if(y>0)for(;_--;)v[_]||T[_]||(T[_]=M.call(l));T=Ce(T)}D.apply(l,T),u&&!r&&T.length>0&&y+t.length>1&&se.uniqueSort(l)}return u&&(C=w,c=x),v};return o?ce(r):r}(r,i)),s.selector=e}return s},l=se.select=function(e,t,o,i){var r,l,c,u,h,p="function"==typeof e&&e,f=!i&&a(e=p.selector||e);if(o=o||[],1===f.length){if((l=f[0]=f[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&g&&n.relative[l[1].type]){if(!(t=(n.find.ID(c.matches[0].replace(te,oe),t)||[])[0]))return o;p&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(r=q.needsContext.test(e)?0:l.length;r--&&(c=l[r],!n.relative[u=c.type]);)if((h=n.find[u])&&(i=h(c.matches[0].replace(te,oe),ee.test(l[0].type)&&ye(t.parentNode)||t))){if(l.splice(r,1),!(e=i.length&&ve(l)))return D.apply(o,i),o;break}}return(p||s(e,f))(i,t,!g,o,!t||ee.test(e)&&ye(t.parentNode)||t),o},o.sortStable=T.split("").sort(E).join("")===T,o.detectDuplicates=!!h,p(),o.sortDetached=ue((function(e){return 1&e.compareDocumentPosition(f.createElement("fieldset"))})),ue((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||he("type|href|height|width",(function(e,t,o){if(!o)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&ue((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||he("value",(function(e,t,o){if(!o&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ue((function(e){return null==e.getAttribute("disabled")}))||he(z,(function(e,t,o){var n;if(!o)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null})),se}(n);w.find=S,w.expr=S.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=S.uniqueSort,w.text=S.getText,w.isXMLDoc=S.isXML,w.contains=S.contains,w.escapeSelector=S.escape;var L=function(e,t,o){for(var n=[],i=void 0!==o;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&w(e).is(o))break;n.push(e)}return n},E=function(e,t){for(var o=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&o.push(e);return o},I=w.expr.match.needsContext;function O(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var M=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function N(e,t,o){return y(t)?w.grep(e,(function(e,n){return!!t.call(e,n,e)!==o})):t.nodeType?w.grep(e,(function(e){return e===t!==o})):"string"!=typeof t?w.grep(e,(function(e){return u.call(t,e)>-1!==o})):w.filter(t,e,o)}w.filter=function(e,t,o){var n=t[0];return o&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?w.find.matchesSelector(n,e)?[n]:[]:w.find.matches(e,w.grep(t,(function(e){return 1===e.nodeType})))},w.fn.extend({find:function(e){var t,o,n=this.length,i=this;if("string"!=typeof e)return this.pushStack(w(e).filter((function(){for(t=0;t<n;t++)if(w.contains(i[t],this))return!0})));for(o=this.pushStack([]),t=0;t<n;t++)w.find(e,i[t],o);return n>1?w.uniqueSort(o):o},filter:function(e){return this.pushStack(N(this,e||[],!1))},not:function(e){return this.pushStack(N(this,e||[],!0))},is:function(e){return!!N(this,"string"==typeof e&&I.test(e)?w(e):e||[],!1).length}});var D,A=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,o){var n,i;if(!e)return this;if(o=o||D,"string"==typeof e){if(!(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:A.exec(e))||!n[1]&&t)return!t||t.jquery?(t||o).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:v,!0)),M.test(n[1])&&w.isPlainObject(t))for(n in t)y(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return(i=v.getElementById(n[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):y(e)?void 0!==o.ready?o.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,D=w(v);var H=/^(?:parents|prev(?:Until|All))/,z={children:!0,contents:!0,next:!0,prev:!0};function k(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}w.fn.extend({has:function(e){var t=w(e,this),o=t.length;return this.filter((function(){for(var e=0;e<o;e++)if(w.contains(this,t[e]))return!0}))},closest:function(e,t){var o,n=0,i=this.length,r=[],a="string"!=typeof e&&w(e);if(!I.test(e))for(;n<i;n++)for(o=this[n];o&&o!==t;o=o.parentNode)if(o.nodeType<11&&(a?a.index(o)>-1:1===o.nodeType&&w.find.matchesSelector(o,e))){r.push(o);break}return this.pushStack(r.length>1?w.uniqueSort(r):r)},index:function(e){return e?"string"==typeof e?u.call(w(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return L(e,"parentNode")},parentsUntil:function(e,t,o){return L(e,"parentNode",o)},next:function(e){return k(e,"nextSibling")},prev:function(e){return k(e,"previousSibling")},nextAll:function(e){return L(e,"nextSibling")},prevAll:function(e){return L(e,"previousSibling")},nextUntil:function(e,t,o){return L(e,"nextSibling",o)},prevUntil:function(e,t,o){return L(e,"previousSibling",o)},siblings:function(e){return E((e.parentNode||{}).firstChild,e)},children:function(e){return E(e.firstChild)},contents:function(e){return null!=e.contentDocument&&a(e.contentDocument)?e.contentDocument:(O(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},(function(e,t){w.fn[e]=function(o,n){var i=w.map(this,t,o);return"Until"!==e.slice(-5)&&(n=o),n&&"string"==typeof n&&(i=w.filter(n,i)),this.length>1&&(z[e]||w.uniqueSort(i),H.test(e)&&i.reverse()),this.pushStack(i)}}));var B=/[^\x20\t\r\n\f]+/g;function R(e){return e}function G(e){throw e}function j(e,t,o,n){var i;try{e&&y(i=e.promise)?i.call(e).done(t).fail(o):e&&y(i=e.then)?i.call(e,t,o):t.apply(void 0,[e].slice(n))}catch(e){o.apply(void 0,[e])}}w.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return w.each(e.match(B)||[],(function(e,o){t[o]=!0})),t}(e):w.extend({},e);var t,o,n,i,r=[],a=[],s=-1,l=function(){for(i=i||e.once,n=t=!0;a.length;s=-1)for(o=a.shift();++s<r.length;)!1===r[s].apply(o[0],o[1])&&e.stopOnFalse&&(s=r.length,o=!1);e.memory||(o=!1),t=!1,i&&(r=o?[]:"")},c={add:function(){return r&&(o&&!t&&(s=r.length-1,a.push(o)),function t(o){w.each(o,(function(o,n){y(n)?e.unique&&c.has(n)||r.push(n):n&&n.length&&"string"!==C(n)&&t(n)}))}(arguments),o&&!t&&l()),this},remove:function(){return w.each(arguments,(function(e,t){for(var o;(o=w.inArray(t,r,o))>-1;)r.splice(o,1),o<=s&&s--})),this},has:function(e){return e?w.inArray(e,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return i=a=[],r=o="",this},disabled:function(){return!r},lock:function(){return i=a=[],o||t||(r=o=""),this},locked:function(){return!!i},fireWith:function(e,o){return i||(o=[e,(o=o||[]).slice?o.slice():o],a.push(o),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},w.extend({Deferred:function(e){var t=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],o="pending",i={state:function(){return o},always:function(){return r.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred((function(o){w.each(t,(function(t,n){var i=y(e[n[4]])&&e[n[4]];r[n[1]]((function(){var e=i&&i.apply(this,arguments);e&&y(e.promise)?e.promise().progress(o.notify).done(o.resolve).fail(o.reject):o[n[0]+"With"](this,i?[e]:arguments)}))})),e=null})).promise()},then:function(e,o,i){var r=0;function a(e,t,o,i){return function(){var s=this,l=arguments,c=function(){var n,c;if(!(e<r)){if((n=o.apply(s,l))===t.promise())throw new TypeError("Thenable self-resolution");c=n&&("object"==typeof n||"function"==typeof n)&&n.then,y(c)?i?c.call(n,a(r,t,R,i),a(r,t,G,i)):(r++,c.call(n,a(r,t,R,i),a(r,t,G,i),a(r,t,R,t.notifyWith))):(o!==R&&(s=void 0,l=[n]),(i||t.resolveWith)(s,l))}},u=i?c:function(){try{c()}catch(n){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(n,u.stackTrace),e+1>=r&&(o!==G&&(s=void 0,l=[n]),t.rejectWith(s,l))}};e?u():(w.Deferred.getStackHook&&(u.stackTrace=w.Deferred.getStackHook()),n.setTimeout(u))}}return w.Deferred((function(n){t[0][3].add(a(0,n,y(i)?i:R,n.notifyWith)),t[1][3].add(a(0,n,y(e)?e:R)),t[2][3].add(a(0,n,y(o)?o:G))})).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},r={};return w.each(t,(function(e,n){var a=n[2],s=n[5];i[n[1]]=a.add,s&&a.add((function(){o=s}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),a.add(n[3].fire),r[n[0]]=function(){return r[n[0]+"With"](this===r?void 0:this,arguments),this},r[n[0]+"With"]=a.fireWith})),i.promise(r),e&&e.call(r,r),r},when:function(e){var t=arguments.length,o=t,n=Array(o),i=s.call(arguments),r=w.Deferred(),a=function(e){return function(o){n[e]=this,i[e]=arguments.length>1?s.call(arguments):o,--t||r.resolveWith(n,i)}};if(t<=1&&(j(e,r.done(a(o)).resolve,r.reject,!t),"pending"===r.state()||y(i[o]&&i[o].then)))return r.then();for(;o--;)j(i[o],a(o),r.reject);return r.promise()}});var F=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(e,t){n.console&&n.console.warn&&e&&F.test(e.name)&&n.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},w.readyException=function(e){n.setTimeout((function(){throw e}))};var W=w.Deferred();function U(){v.removeEventListener("DOMContentLoaded",U),n.removeEventListener("load",U),w.ready()}w.fn.ready=function(e){return W.then(e).catch((function(e){w.readyException(e)})),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||W.resolveWith(v,[w]))}}),w.ready.then=W.then,"complete"===v.readyState||"loading"!==v.readyState&&!v.documentElement.doScroll?n.setTimeout(w.ready):(v.addEventListener("DOMContentLoaded",U),n.addEventListener("load",U));var V=function(e,t,o,n,i,r,a){var s=0,l=e.length,c=null==o;if("object"===C(o))for(s in i=!0,o)V(e,t,s,o[s],!0,r,a);else if(void 0!==n&&(i=!0,y(n)||(a=!0),c&&(a?(t.call(e,n),t=null):(c=t,t=function(e,t,o){return c.call(w(e),o)})),t))for(;s<l;s++)t(e[s],o,a?n:n.call(e[s],s,t(e[s],o)));return i?e:c?t.call(e):l?t(e[0],o):r},$=/^-ms-/,Z=/-([a-z])/g;function q(e,t){return t.toUpperCase()}function K(e){return e.replace($,"ms-").replace(Z,q)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function X(){this.expando=w.expando+X.uid++}X.uid=1,X.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,o){var n,i=this.cache(e);if("string"==typeof t)i[K(t)]=o;else for(n in t)i[K(n)]=t[n];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][K(t)]},access:function(e,t,o){return void 0===t||t&&"string"==typeof t&&void 0===o?this.get(e,t):(this.set(e,t,o),void 0!==o?o:t)},remove:function(e,t){var o,n=e[this.expando];if(void 0!==n){if(void 0!==t){o=(t=Array.isArray(t)?t.map(K):(t=K(t))in n?[t]:t.match(B)||[]).length;for(;o--;)delete n[t[o]]}(void 0===t||w.isEmptyObject(n))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var J=new X,Q=new X,ee=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,te=/[A-Z]/g;function oe(e,t,o){var n;if(void 0===o&&1===e.nodeType)if(n="data-"+t.replace(te,"-$&").toLowerCase(),"string"==typeof(o=e.getAttribute(n))){try{o=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ee.test(e)?JSON.parse(e):e)}(o)}catch(e){}Q.set(e,t,o)}else o=void 0;return o}w.extend({hasData:function(e){return Q.hasData(e)||J.hasData(e)},data:function(e,t,o){return Q.access(e,t,o)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,o){return J.access(e,t,o)},_removeData:function(e,t){J.remove(e,t)}}),w.fn.extend({data:function(e,t){var o,n,i,r=this[0],a=r&&r.attributes;if(void 0===e){if(this.length&&(i=Q.get(r),1===r.nodeType&&!J.get(r,"hasDataAttrs"))){for(o=a.length;o--;)a[o]&&0===(n=a[o].name).indexOf("data-")&&(n=K(n.slice(5)),oe(r,n,i[n]));J.set(r,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each((function(){Q.set(this,e)})):V(this,(function(t){var o;if(r&&void 0===t)return void 0!==(o=Q.get(r,e))||void 0!==(o=oe(r,e))?o:void 0;this.each((function(){Q.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){Q.remove(this,e)}))}}),w.extend({queue:function(e,t,o){var n;if(e)return t=(t||"fx")+"queue",n=J.get(e,t),o&&(!n||Array.isArray(o)?n=J.access(e,t,w.makeArray(o)):n.push(o)),n||[]},dequeue:function(e,t){t=t||"fx";var o=w.queue(e,t),n=o.length,i=o.shift(),r=w._queueHooks(e,t);"inprogress"===i&&(i=o.shift(),n--),i&&("fx"===t&&o.unshift("inprogress"),delete r.stop,i.call(e,(function(){w.dequeue(e,t)}),r)),!n&&r&&r.empty.fire()},_queueHooks:function(e,t){var o=t+"queueHooks";return J.get(e,o)||J.access(e,o,{empty:w.Callbacks("once memory").add((function(){J.remove(e,[t+"queue",o])}))})}}),w.fn.extend({queue:function(e,t){var o=2;return"string"!=typeof e&&(t=e,e="fx",o--),arguments.length<o?w.queue(this[0],e):void 0===t?this:this.each((function(){var o=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==o[0]&&w.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){w.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var o,n=1,i=w.Deferred(),r=this,a=this.length,s=function(){--n||i.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(o=J.get(r[a],e+"queueHooks"))&&o.empty&&(n++,o.empty.add(s));return s(),i.promise(t)}});var ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ie=new RegExp("^(?:([+-])=|)("+ne+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],ae=v.documentElement,se=function(e){return w.contains(e.ownerDocument,e)},le={composed:!0};ae.getRootNode&&(se=function(e){return w.contains(e.ownerDocument,e)||e.getRootNode(le)===e.ownerDocument});var ce=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&se(e)&&"none"===w.css(e,"display")};function ue(e,t,o,n){var i,r,a=20,s=n?function(){return n.cur()}:function(){return w.css(e,t,"")},l=s(),c=o&&o[3]||(w.cssNumber[t]?"":"px"),u=e.nodeType&&(w.cssNumber[t]||"px"!==c&&+l)&&ie.exec(w.css(e,t));if(u&&u[3]!==c){for(l/=2,c=c||u[3],u=+l||1;a--;)w.style(e,t,u+c),(1-r)*(1-(r=s()/l||.5))<=0&&(a=0),u/=r;u*=2,w.style(e,t,u+c),o=o||[]}return o&&(u=+u||+l||0,i=o[1]?u+(o[1]+1)*o[2]:+o[2],n&&(n.unit=c,n.start=u,n.end=i)),i}var he={};function pe(e){var t,o=e.ownerDocument,n=e.nodeName,i=he[n];return i||(t=o.body.appendChild(o.createElement(n)),i=w.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),he[n]=i,i)}function fe(e,t){for(var o,n,i=[],r=0,a=e.length;r<a;r++)(n=e[r]).style&&(o=n.style.display,t?("none"===o&&(i[r]=J.get(n,"display")||null,i[r]||(n.style.display="")),""===n.style.display&&ce(n)&&(i[r]=pe(n))):"none"!==o&&(i[r]="none",J.set(n,"display",o)));for(r=0;r<a;r++)null!=i[r]&&(e[r].style.display=i[r]);return e}w.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ce(this)?w(this).show():w(this).hide()}))}});var de,ge,me=/^(?:checkbox|radio)$/i,ye=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,_e=/^$|^module$|\/(?:java|ecma)script/i;de=v.createDocumentFragment().appendChild(v.createElement("div")),(ge=v.createElement("input")).setAttribute("type","radio"),ge.setAttribute("checked","checked"),ge.setAttribute("name","t"),de.appendChild(ge),m.checkClone=de.cloneNode(!0).cloneNode(!0).lastChild.checked,de.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!de.cloneNode(!0).lastChild.defaultValue,de.innerHTML="<option></option>",m.option=!!de.lastChild;var ve={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Te(e,t){var o;return o=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&O(e,t)?w.merge([e],o):o}function xe(e,t){for(var o=0,n=e.length;o<n;o++)J.set(e[o],"globalEval",!t||J.get(t[o],"globalEval"))}ve.tbody=ve.tfoot=ve.colgroup=ve.caption=ve.thead,ve.th=ve.td,m.option||(ve.optgroup=ve.option=[1,"<select multiple='multiple'>","</select>"]);var Ce=/<|&#?\w+;/;function be(e,t,o,n,i){for(var r,a,s,l,c,u,h=t.createDocumentFragment(),p=[],f=0,d=e.length;f<d;f++)if((r=e[f])||0===r)if("object"===C(r))w.merge(p,r.nodeType?[r]:r);else if(Ce.test(r)){for(a=a||h.appendChild(t.createElement("div")),s=(ye.exec(r)||["",""])[1].toLowerCase(),l=ve[s]||ve._default,a.innerHTML=l[1]+w.htmlPrefilter(r)+l[2],u=l[0];u--;)a=a.lastChild;w.merge(p,a.childNodes),(a=h.firstChild).textContent=""}else p.push(t.createTextNode(r));for(h.textContent="",f=0;r=p[f++];)if(n&&w.inArray(r,n)>-1)i&&i.push(r);else if(c=se(r),a=Te(h.appendChild(r),"script"),c&&xe(a),o)for(u=0;r=a[u++];)_e.test(r.type||"")&&o.push(r);return h}var we=/^([^.]*)(?:\.(.+)|)/;function Pe(){return!0}function Se(){return!1}function Le(e,t){return e===function(){try{return v.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,o,n,i,r){var a,s;if("object"==typeof t){for(s in"string"!=typeof o&&(n=n||o,o=void 0),t)Ee(e,s,o,n,t[s],r);return e}if(null==n&&null==i?(i=o,n=o=void 0):null==i&&("string"==typeof o?(i=n,n=void 0):(i=n,n=o,o=void 0)),!1===i)i=Se;else if(!i)return e;return 1===r&&(a=i,i=function(e){return w().off(e),a.apply(this,arguments)},i.guid=a.guid||(a.guid=w.guid++)),e.each((function(){w.event.add(this,t,i,n,o)}))}function Ie(e,t,o){o?(J.set(e,t,!1),w.event.add(e,t,{namespace:!1,handler:function(e){var n,i,r=J.get(this,t);if(1&e.isTrigger&&this[t]){if(r.length)(w.event.special[t]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),J.set(this,t,r),n=o(this,t),this[t](),r!==(i=J.get(this,t))||n?J.set(this,t,!1):i={},r!==i)return e.stopImmediatePropagation(),e.preventDefault(),i&&i.value}else r.length&&(J.set(this,t,{value:w.event.trigger(w.extend(r[0],w.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===J.get(e,t)&&w.event.add(e,t,Pe)}w.event={global:{},add:function(e,t,o,n,i){var r,a,s,l,c,u,h,p,f,d,g,m=J.get(e);if(Y(e))for(o.handler&&(o=(r=o).handler,i=r.selector),i&&w.find.matchesSelector(ae,i),o.guid||(o.guid=w.guid++),(l=m.events)||(l=m.events=Object.create(null)),(a=m.handle)||(a=m.handle=function(t){return void 0!==w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(B)||[""]).length;c--;)f=g=(s=we.exec(t[c])||[])[1],d=(s[2]||"").split(".").sort(),f&&(h=w.event.special[f]||{},f=(i?h.delegateType:h.bindType)||f,h=w.event.special[f]||{},u=w.extend({type:f,origType:g,data:n,handler:o,guid:o.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:d.join(".")},r),(p=l[f])||((p=l[f]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,n,d,a)||e.addEventListener&&e.addEventListener(f,a)),h.add&&(h.add.call(e,u),u.handler.guid||(u.handler.guid=o.guid)),i?p.splice(p.delegateCount++,0,u):p.push(u),w.event.global[f]=!0)},remove:function(e,t,o,n,i){var r,a,s,l,c,u,h,p,f,d,g,m=J.hasData(e)&&J.get(e);if(m&&(l=m.events)){for(c=(t=(t||"").match(B)||[""]).length;c--;)if(f=g=(s=we.exec(t[c])||[])[1],d=(s[2]||"").split(".").sort(),f){for(h=w.event.special[f]||{},p=l[f=(n?h.delegateType:h.bindType)||f]||[],s=s[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=r=p.length;r--;)u=p[r],!i&&g!==u.origType||o&&o.guid!==u.guid||s&&!s.test(u.namespace)||n&&n!==u.selector&&("**"!==n||!u.selector)||(p.splice(r,1),u.selector&&p.delegateCount--,h.remove&&h.remove.call(e,u));a&&!p.length&&(h.teardown&&!1!==h.teardown.call(e,d,m.handle)||w.removeEvent(e,f,m.handle),delete l[f])}else for(f in l)w.event.remove(e,f+t[c],o,n,!0);w.isEmptyObject(l)&&J.remove(e,"handle events")}},dispatch:function(e){var t,o,n,i,r,a,s=new Array(arguments.length),l=w.event.fix(e),c=(J.get(this,"events")||Object.create(null))[l.type]||[],u=w.event.special[l.type]||{};for(s[0]=l,t=1;t<arguments.length;t++)s[t]=arguments[t];if(l.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,l)){for(a=w.event.handlers.call(this,l,c),t=0;(i=a[t++])&&!l.isPropagationStopped();)for(l.currentTarget=i.elem,o=0;(r=i.handlers[o++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==r.namespace&&!l.rnamespace.test(r.namespace)||(l.handleObj=r,l.data=r.data,void 0!==(n=((w.event.special[r.origType]||{}).handle||r.handler).apply(i.elem,s))&&!1===(l.result=n)&&(l.preventDefault(),l.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,l),l.result}},handlers:function(e,t){var o,n,i,r,a,s=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(r=[],a={},o=0;o<l;o++)void 0===a[i=(n=t[o]).selector+" "]&&(a[i]=n.needsContext?w(i,this).index(c)>-1:w.find(i,this,null,[c]).length),a[i]&&r.push(n);r.length&&s.push({elem:c,handlers:r})}return c=this,l<t.length&&s.push({elem:c,handlers:t.slice(l)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:y(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return me.test(t.type)&&t.click&&O(t,"input")&&Ie(t,"click",Pe),!1},trigger:function(e){var t=this||e;return me.test(t.type)&&t.click&&O(t,"input")&&Ie(t,"click"),!0},_default:function(e){var t=e.target;return me.test(t.type)&&t.click&&O(t,"input")&&J.get(t,"click")||O(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,o){e.removeEventListener&&e.removeEventListener(t,o)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Pe:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Pe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Pe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Pe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},w.event.addProp),w.each({focus:"focusin",blur:"focusout"},(function(e,t){w.event.special[e]={setup:function(){return Ie(this,e,Le),!1},trigger:function(){return Ie(this,e),!0},_default:function(t){return J.get(t.target,e)},delegateType:t}})),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var o,n=this,i=e.relatedTarget,r=e.handleObj;return i&&(i===n||w.contains(n,i))||(e.type=r.origType,o=r.handler.apply(this,arguments),e.type=t),o}}})),w.fn.extend({on:function(e,t,o,n){return Ee(this,e,t,o,n)},one:function(e,t,o,n){return Ee(this,e,t,o,n,1)},off:function(e,t,o){var n,i;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,w(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(o=t,t=void 0),!1===o&&(o=Se),this.each((function(){w.event.remove(this,e,o,t)}))}});var Oe=/<script|<style|<link/i,Me=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function De(e,t){return O(e,"table")&&O(11!==t.nodeType?t:t.firstChild,"tr")&&w(e).children("tbody")[0]||e}function Ae(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function He(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function ze(e,t){var o,n,i,r,a,s;if(1===t.nodeType){if(J.hasData(e)&&(s=J.get(e).events))for(i in J.remove(t,"handle events"),s)for(o=0,n=s[i].length;o<n;o++)w.event.add(t,i,s[i][o]);Q.hasData(e)&&(r=Q.access(e),a=w.extend({},r),Q.set(t,a))}}function ke(e,t){var o=t.nodeName.toLowerCase();"input"===o&&me.test(e.type)?t.checked=e.checked:"input"!==o&&"textarea"!==o||(t.defaultValue=e.defaultValue)}function Be(e,t,o,n){t=l(t);var i,r,a,s,c,u,h=0,p=e.length,f=p-1,d=t[0],g=y(d);if(g||p>1&&"string"==typeof d&&!m.checkClone&&Me.test(d))return e.each((function(i){var r=e.eq(i);g&&(t[0]=d.call(this,i,r.html())),Be(r,t,o,n)}));if(p&&(r=(i=be(t,e[0].ownerDocument,!1,e,n)).firstChild,1===i.childNodes.length&&(i=r),r||n)){for(s=(a=w.map(Te(i,"script"),Ae)).length;h<p;h++)c=i,h!==f&&(c=w.clone(c,!0,!0),s&&w.merge(a,Te(c,"script"))),o.call(e[h],c,h);if(s)for(u=a[a.length-1].ownerDocument,w.map(a,He),h=0;h<s;h++)c=a[h],_e.test(c.type||"")&&!J.access(c,"globalEval")&&w.contains(u,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?w._evalUrl&&!c.noModule&&w._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},u):x(c.textContent.replace(Ne,""),c,u))}return e}function Re(e,t,o){for(var n,i=t?w.filter(t,e):e,r=0;null!=(n=i[r]);r++)o||1!==n.nodeType||w.cleanData(Te(n)),n.parentNode&&(o&&se(n)&&xe(Te(n,"script")),n.parentNode.removeChild(n));return e}w.extend({htmlPrefilter:function(e){return e},clone:function(e,t,o){var n,i,r,a,s=e.cloneNode(!0),l=se(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(a=Te(s),n=0,i=(r=Te(e)).length;n<i;n++)ke(r[n],a[n]);if(t)if(o)for(r=r||Te(e),a=a||Te(s),n=0,i=r.length;n<i;n++)ze(r[n],a[n]);else ze(e,s);return(a=Te(s,"script")).length>0&&xe(a,!l&&Te(e,"script")),s},cleanData:function(e){for(var t,o,n,i=w.event.special,r=0;void 0!==(o=e[r]);r++)if(Y(o)){if(t=o[J.expando]){if(t.events)for(n in t.events)i[n]?w.event.remove(o,n):w.removeEvent(o,n,t.handle);o[J.expando]=void 0}o[Q.expando]&&(o[Q.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Re(this,e,!0)},remove:function(e){return Re(this,e)},text:function(e){return V(this,(function(e){return void 0===e?w.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Be(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||De(this,e).appendChild(e)}))},prepend:function(){return Be(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=De(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Be(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Be(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(Te(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return w.clone(this,e,t)}))},html:function(e){return V(this,(function(e){var t=this[0]||{},o=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!ve[(ye.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;o<n;o++)1===(t=this[o]||{}).nodeType&&(w.cleanData(Te(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Be(this,arguments,(function(t){var o=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(Te(this)),o&&o.replaceChild(t,this))}),e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){w.fn[e]=function(e){for(var o,n=[],i=w(e),r=i.length-1,a=0;a<=r;a++)o=a===r?this:this.clone(!0),w(i[a])[t](o),c.apply(n,o.get());return this.pushStack(n)}}));var Ge=new RegExp("^("+ne+")(?!px)[a-z%]+$","i"),je=/^--/,Fe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=n),t.getComputedStyle(e)},We=function(e,t,o){var n,i,r={};for(i in t)r[i]=e.style[i],e.style[i]=t[i];for(i in n=o.call(e),t)e.style[i]=r[i];return n},Ue=new RegExp(re.join("|"),"i"),Ve=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g");function $e(e,t,o){var n,i,r,a,s=je.test(t),l=e.style;return(o=o||Fe(e))&&(a=o.getPropertyValue(t)||o[t],s&&(a=a.replace(Ve,"$1")),""!==a||se(e)||(a=w.style(e,t)),!m.pixelBoxStyles()&&Ge.test(a)&&Ue.test(t)&&(n=l.width,i=l.minWidth,r=l.maxWidth,l.minWidth=l.maxWidth=l.width=a,a=o.width,l.width=n,l.minWidth=i,l.maxWidth=r)),void 0!==a?a+"":a}function Ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(u){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ae.appendChild(c).appendChild(u);var e=n.getComputedStyle(u);o="1%"!==e.top,l=12===t(e.marginLeft),u.style.right="60%",a=36===t(e.right),i=36===t(e.width),u.style.position="absolute",r=12===t(u.offsetWidth/3),ae.removeChild(c),u=null}}function t(e){return Math.round(parseFloat(e))}var o,i,r,a,s,l,c=v.createElement("div"),u=v.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===u.style.backgroundClip,w.extend(m,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),o},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),r},reliableTrDimensions:function(){var e,t,o,i;return null==s&&(e=v.createElement("table"),t=v.createElement("tr"),o=v.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",o.style.height="9px",o.style.display="block",ae.appendChild(e).appendChild(t).appendChild(o),i=n.getComputedStyle(t),s=parseInt(i.height,10)+parseInt(i.borderTopWidth,10)+parseInt(i.borderBottomWidth,10)===t.offsetHeight,ae.removeChild(e)),s}}))}();var qe=["Webkit","Moz","ms"],Ke=v.createElement("div").style,Ye={};function Xe(e){return w.cssProps[e]||Ye[e]||(e in Ke?e:Ye[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),o=qe.length;o--;)if((e=qe[o]+t)in Ke)return e}(e)||e)}var Je=/^(none|table(?!-c[ea]).+)/,Qe={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,o){var n=ie.exec(t);return n?Math.max(0,n[2]-(o||0))+(n[3]||"px"):t}function ot(e,t,o,n,i,r){var a="width"===t?1:0,s=0,l=0;if(o===(n?"border":"content"))return 0;for(;a<4;a+=2)"margin"===o&&(l+=w.css(e,o+re[a],!0,i)),n?("content"===o&&(l-=w.css(e,"padding"+re[a],!0,i)),"margin"!==o&&(l-=w.css(e,"border"+re[a]+"Width",!0,i))):(l+=w.css(e,"padding"+re[a],!0,i),"padding"!==o?l+=w.css(e,"border"+re[a]+"Width",!0,i):s+=w.css(e,"border"+re[a]+"Width",!0,i));return!n&&r>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-r-l-s-.5))||0),l}function nt(e,t,o){var n=Fe(e),i=(!m.boxSizingReliable()||o)&&"border-box"===w.css(e,"boxSizing",!1,n),r=i,a=$e(e,t,n),s="offset"+t[0].toUpperCase()+t.slice(1);if(Ge.test(a)){if(!o)return a;a="auto"}return(!m.boxSizingReliable()&&i||!m.reliableTrDimensions()&&O(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===w.css(e,"display",!1,n))&&e.getClientRects().length&&(i="border-box"===w.css(e,"boxSizing",!1,n),(r=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+ot(e,t,o||(i?"border":"content"),r,n,a)+"px"}function it(e,t,o,n,i){return new it.prototype.init(e,t,o,n,i)}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var o=$e(e,"opacity");return""===o?"1":o}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,o,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,r,a,s=K(t),l=je.test(t),c=e.style;if(l||(t=Xe(s)),a=w.cssHooks[t]||w.cssHooks[s],void 0===o)return a&&"get"in a&&void 0!==(i=a.get(e,!1,n))?i:c[t];"string"==(r=typeof o)&&(i=ie.exec(o))&&i[1]&&(o=ue(e,t,i),r="number"),null!=o&&o==o&&("number"!==r||l||(o+=i&&i[3]||(w.cssNumber[s]?"":"px")),m.clearCloneStyle||""!==o||0!==t.indexOf("background")||(c[t]="inherit"),a&&"set"in a&&void 0===(o=a.set(e,o,n))||(l?c.setProperty(t,o):c[t]=o))}},css:function(e,t,o,n){var i,r,a,s=K(t);return je.test(t)||(t=Xe(s)),(a=w.cssHooks[t]||w.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,o)),void 0===i&&(i=$e(e,t,n)),"normal"===i&&t in et&&(i=et[t]),""===o||o?(r=parseFloat(i),!0===o||isFinite(r)?r||0:i):i}}),w.each(["height","width"],(function(e,t){w.cssHooks[t]={get:function(e,o,n){if(o)return!Je.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?nt(e,t,n):We(e,Qe,(function(){return nt(e,t,n)}))},set:function(e,o,n){var i,r=Fe(e),a=!m.scrollboxSize()&&"absolute"===r.position,s=(a||n)&&"border-box"===w.css(e,"boxSizing",!1,r),l=n?ot(e,t,n,s,r):0;return s&&a&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(r[t])-ot(e,t,"border",!1,r)-.5)),l&&(i=ie.exec(o))&&"px"!==(i[3]||"px")&&(e.style[t]=o,o=w.css(e,t)),tt(0,o,l)}}})),w.cssHooks.marginLeft=Ze(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat($e(e,"marginLeft"))||e.getBoundingClientRect().left-We(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),w.each({margin:"",padding:"",border:"Width"},(function(e,t){w.cssHooks[e+t]={expand:function(o){for(var n=0,i={},r="string"==typeof o?o.split(" "):[o];n<4;n++)i[e+re[n]+t]=r[n]||r[n-2]||r[0];return i}},"margin"!==e&&(w.cssHooks[e+t].set=tt)})),w.fn.extend({css:function(e,t){return V(this,(function(e,t,o){var n,i,r={},a=0;if(Array.isArray(t)){for(n=Fe(e),i=t.length;a<i;a++)r[t[a]]=w.css(e,t[a],!1,n);return r}return void 0!==o?w.style(e,t,o):w.css(e,t)}),e,t,arguments.length>1)}}),w.Tween=it,it.prototype={constructor:it,init:function(e,t,o,n,i,r){this.elem=e,this.prop=o,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=r||(w.cssNumber[o]?"":"px")},cur:function(){var e=it.propHooks[this.prop];return e&&e.get?e.get(this):it.propHooks._default.get(this)},run:function(e){var t,o=it.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),o&&o.set?o.set(this):it.propHooks._default.set(this),this}},it.prototype.init.prototype=it.prototype,it.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||!w.cssHooks[e.prop]&&null==e.elem.style[Xe(e.prop)]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},it.propHooks.scrollTop=it.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},w.fx=it.prototype.init,w.fx.step={};var rt,at,st=/^(?:toggle|show|hide)$/,lt=/queueHooks$/;function ct(){at&&(!1===v.hidden&&n.requestAnimationFrame?n.requestAnimationFrame(ct):n.setTimeout(ct,w.fx.interval),w.fx.tick())}function ut(){return n.setTimeout((function(){rt=void 0})),rt=Date.now()}function ht(e,t){var o,n=0,i={height:e};for(t=t?1:0;n<4;n+=2-t)i["margin"+(o=re[n])]=i["padding"+o]=e;return t&&(i.opacity=i.width=e),i}function pt(e,t,o){for(var n,i=(ft.tweeners[t]||[]).concat(ft.tweeners["*"]),r=0,a=i.length;r<a;r++)if(n=i[r].call(o,t,e))return n}function ft(e,t,o){var n,i,r=0,a=ft.prefilters.length,s=w.Deferred().always((function(){delete l.elem})),l=function(){if(i)return!1;for(var t=rt||ut(),o=Math.max(0,c.startTime+c.duration-t),n=1-(o/c.duration||0),r=0,a=c.tweens.length;r<a;r++)c.tweens[r].run(n);return s.notifyWith(e,[c,n,o]),n<1&&a?o:(a||s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},o),originalProperties:t,originalOptions:o,startTime:rt||ut(),duration:o.duration,tweens:[],createTween:function(t,o){var n=w.Tween(e,c.opts,t,o,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(n),n},stop:function(t){var o=0,n=t?c.tweens.length:0;if(i)return this;for(i=!0;o<n;o++)c.tweens[o].run(1);return t?(s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c,t])):s.rejectWith(e,[c,t]),this}}),u=c.props;for(function(e,t){var o,n,i,r,a;for(o in e)if(i=t[n=K(o)],r=e[o],Array.isArray(r)&&(i=r[1],r=e[o]=r[0]),o!==n&&(e[n]=r,delete e[o]),(a=w.cssHooks[n])&&"expand"in a)for(o in r=a.expand(r),delete e[n],r)o in e||(e[o]=r[o],t[o]=i);else t[n]=i}(u,c.opts.specialEasing);r<a;r++)if(n=ft.prefilters[r].call(c,e,u,c.opts))return y(n.stop)&&(w._queueHooks(c.elem,c.opts.queue).stop=n.stop.bind(n)),n;return w.map(u,pt,c),y(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),w.fx.timer(w.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}w.Animation=w.extend(ft,{tweeners:{"*":[function(e,t){var o=this.createTween(e,t);return ue(o.elem,e,ie.exec(t),o),o}]},tweener:function(e,t){y(e)?(t=e,e=["*"]):e=e.match(B);for(var o,n=0,i=e.length;n<i;n++)o=e[n],ft.tweeners[o]=ft.tweeners[o]||[],ft.tweeners[o].unshift(t)},prefilters:[function(e,t,o){var n,i,r,a,s,l,c,u,h="width"in t||"height"in t,p=this,f={},d=e.style,g=e.nodeType&&ce(e),m=J.get(e,"fxshow");for(n in o.queue||(null==(a=w._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always((function(){p.always((function(){a.unqueued--,w.queue(e,"fx").length||a.empty.fire()}))}))),t)if(i=t[n],st.test(i)){if(delete t[n],r=r||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!m||void 0===m[n])continue;g=!0}f[n]=m&&m[n]||w.style(e,n)}if((l=!w.isEmptyObject(t))||!w.isEmptyObject(f))for(n in h&&1===e.nodeType&&(o.overflow=[d.overflow,d.overflowX,d.overflowY],null==(c=m&&m.display)&&(c=J.get(e,"display")),"none"===(u=w.css(e,"display"))&&(c?u=c:(fe([e],!0),c=e.style.display||c,u=w.css(e,"display"),fe([e]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===w.css(e,"float")&&(l||(p.done((function(){d.display=c})),null==c&&(u=d.display,c="none"===u?"":u)),d.display="inline-block")),o.overflow&&(d.overflow="hidden",p.always((function(){d.overflow=o.overflow[0],d.overflowX=o.overflow[1],d.overflowY=o.overflow[2]}))),l=!1,f)l||(m?"hidden"in m&&(g=m.hidden):m=J.access(e,"fxshow",{display:c}),r&&(m.hidden=!g),g&&fe([e],!0),p.done((function(){for(n in g||fe([e]),J.remove(e,"fxshow"),f)w.style(e,n,f[n])}))),l=pt(g?m[n]:0,n,p),n in m||(m[n]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?ft.prefilters.unshift(e):ft.prefilters.push(e)}}),w.speed=function(e,t,o){var n=e&&"object"==typeof e?w.extend({},e):{complete:o||!o&&t||y(e)&&e,duration:e,easing:o&&t||t&&!y(t)&&t};return w.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in w.fx.speeds?n.duration=w.fx.speeds[n.duration]:n.duration=w.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){y(n.old)&&n.old.call(this),n.queue&&w.dequeue(this,n.queue)},n},w.fn.extend({fadeTo:function(e,t,o,n){return this.filter(ce).css("opacity",0).show().end().animate({opacity:t},e,o,n)},animate:function(e,t,o,n){var i=w.isEmptyObject(e),r=w.speed(t,o,n),a=function(){var t=ft(this,w.extend({},e),r);(i||J.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===r.queue?this.each(a):this.queue(r.queue,a)},stop:function(e,t,o){var n=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof e&&(o=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,i=null!=e&&e+"queueHooks",r=w.timers,a=J.get(this);if(i)a[i]&&a[i].stop&&n(a[i]);else for(i in a)a[i]&&a[i].stop&&lt.test(i)&&n(a[i]);for(i=r.length;i--;)r[i].elem!==this||null!=e&&r[i].queue!==e||(r[i].anim.stop(o),t=!1,r.splice(i,1));!t&&o||w.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,o=J.get(this),n=o[e+"queue"],i=o[e+"queueHooks"],r=w.timers,a=n?n.length:0;for(o.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<a;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete o.finish}))}}),w.each(["toggle","show","hide"],(function(e,t){var o=w.fn[t];w.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?o.apply(this,arguments):this.animate(ht(t,!0),e,n,i)}})),w.each({slideDown:ht("show"),slideUp:ht("hide"),slideToggle:ht("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){w.fn[e]=function(e,o,n){return this.animate(t,e,o,n)}})),w.timers=[],w.fx.tick=function(){var e,t=0,o=w.timers;for(rt=Date.now();t<o.length;t++)(e=o[t])()||o[t]!==e||o.splice(t--,1);o.length||w.fx.stop(),rt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){at||(at=!0,ct())},w.fx.stop=function(){at=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(e,t){return e=w.fx&&w.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,o){var i=n.setTimeout(t,e);o.stop=function(){n.clearTimeout(i)}}))},function(){var e=v.createElement("input"),t=v.createElement("select").appendChild(v.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=v.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var dt,gt=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return V(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){w.removeAttr(this,e)}))}}),w.extend({attr:function(e,t,o){var n,i,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===e.getAttribute?w.prop(e,t,o):(1===r&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?dt:void 0)),void 0!==o?null===o?void w.removeAttr(e,t):i&&"set"in i&&void 0!==(n=i.set(e,o,t))?n:(e.setAttribute(t,o+""),o):i&&"get"in i&&null!==(n=i.get(e,t))?n:null==(n=w.find.attr(e,t))?void 0:n)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&O(e,"input")){var o=e.value;return e.setAttribute("type",t),o&&(e.value=o),t}}}},removeAttr:function(e,t){var o,n=0,i=t&&t.match(B);if(i&&1===e.nodeType)for(;o=i[n++];)e.removeAttribute(o)}}),dt={set:function(e,t,o){return!1===t?w.removeAttr(e,o):e.setAttribute(o,o),o}},w.each(w.expr.match.bool.source.match(/\w+/g),(function(e,t){var o=gt[t]||w.find.attr;gt[t]=function(e,t,n){var i,r,a=t.toLowerCase();return n||(r=gt[a],gt[a]=i,i=null!=o(e,t,n)?a:null,gt[a]=r),i}}));var mt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;function _t(e){return(e.match(B)||[]).join(" ")}function vt(e){return e.getAttribute&&e.getAttribute("class")||""}function Tt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(B)||[]}w.fn.extend({prop:function(e,t){return V(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[w.propFix[e]||e]}))}}),w.extend({prop:function(e,t,o){var n,i,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==o?i&&"set"in i&&void 0!==(n=i.set(e,o,t))?n:e[t]=o:i&&"get"in i&&null!==(n=i.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):mt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){w.propFix[this.toLowerCase()]=this})),w.fn.extend({addClass:function(e){var t,o,n,i,r,a;return y(e)?this.each((function(t){w(this).addClass(e.call(this,t,vt(this)))})):(t=Tt(e)).length?this.each((function(){if(n=vt(this),o=1===this.nodeType&&" "+_t(n)+" "){for(r=0;r<t.length;r++)i=t[r],o.indexOf(" "+i+" ")<0&&(o+=i+" ");a=_t(o),n!==a&&this.setAttribute("class",a)}})):this},removeClass:function(e){var t,o,n,i,r,a;return y(e)?this.each((function(t){w(this).removeClass(e.call(this,t,vt(this)))})):arguments.length?(t=Tt(e)).length?this.each((function(){if(n=vt(this),o=1===this.nodeType&&" "+_t(n)+" "){for(r=0;r<t.length;r++)for(i=t[r];o.indexOf(" "+i+" ")>-1;)o=o.replace(" "+i+" "," ");a=_t(o),n!==a&&this.setAttribute("class",a)}})):this:this.attr("class","")},toggleClass:function(e,t){var o,n,i,r,a=typeof e,s="string"===a||Array.isArray(e);return y(e)?this.each((function(o){w(this).toggleClass(e.call(this,o,vt(this),t),t)})):"boolean"==typeof t&&s?t?this.addClass(e):this.removeClass(e):(o=Tt(e),this.each((function(){if(s)for(r=w(this),i=0;i<o.length;i++)n=o[i],r.hasClass(n)?r.removeClass(n):r.addClass(n);else void 0!==e&&"boolean"!==a||((n=vt(this))&&J.set(this,"__className__",n),this.setAttribute&&this.setAttribute("class",n||!1===e?"":J.get(this,"__className__")||""))})))},hasClass:function(e){var t,o,n=0;for(t=" "+e+" ";o=this[n++];)if(1===o.nodeType&&(" "+_t(vt(o))+" ").indexOf(t)>-1)return!0;return!1}});var xt=/\r/g;w.fn.extend({val:function(e){var t,o,n,i=this[0];return arguments.length?(n=y(e),this.each((function(o){var i;1===this.nodeType&&(null==(i=n?e.call(this,o,w(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=w.map(i,(function(e){return null==e?"":e+""}))),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))}))):i?(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(o=t.get(i,"value"))?o:"string"==typeof(o=i.value)?o.replace(xt,""):null==o?"":o:void 0}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:_t(w.text(e))}},select:{get:function(e){var t,o,n,i=e.options,r=e.selectedIndex,a="select-one"===e.type,s=a?null:[],l=a?r+1:i.length;for(n=r<0?l:a?r:0;n<l;n++)if(((o=i[n]).selected||n===r)&&!o.disabled&&(!o.parentNode.disabled||!O(o.parentNode,"optgroup"))){if(t=w(o).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var o,n,i=e.options,r=w.makeArray(t),a=i.length;a--;)((n=i[a]).selected=w.inArray(w.valHooks.option.get(n),r)>-1)&&(o=!0);return o||(e.selectedIndex=-1),r}}}}),w.each(["radio","checkbox"],(function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},m.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in n;var Ct=/^(?:focusinfocus|focusoutblur)$/,bt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(e,t,o,i){var r,a,s,l,c,u,h,p,d=[o||v],g=f.call(e,"type")?e.type:e,m=f.call(e,"namespace")?e.namespace.split("."):[];if(a=p=s=o=o||v,3!==o.nodeType&&8!==o.nodeType&&!Ct.test(g+w.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),c=g.indexOf(":")<0&&"on"+g,(e=e[w.expando]?e:new w.Event(g,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=o),t=null==t?[e]:w.makeArray(t,[e]),h=w.event.special[g]||{},i||!h.trigger||!1!==h.trigger.apply(o,t))){if(!i&&!h.noBubble&&!_(o)){for(l=h.delegateType||g,Ct.test(l+g)||(a=a.parentNode);a;a=a.parentNode)d.push(a),s=a;s===(o.ownerDocument||v)&&d.push(s.defaultView||s.parentWindow||n)}for(r=0;(a=d[r++])&&!e.isPropagationStopped();)p=a,e.type=r>1?l:h.bindType||g,(u=(J.get(a,"events")||Object.create(null))[e.type]&&J.get(a,"handle"))&&u.apply(a,t),(u=c&&a[c])&&u.apply&&Y(a)&&(e.result=u.apply(a,t),!1===e.result&&e.preventDefault());return e.type=g,i||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(d.pop(),t)||!Y(o)||c&&y(o[g])&&!_(o)&&((s=o[c])&&(o[c]=null),w.event.triggered=g,e.isPropagationStopped()&&p.addEventListener(g,bt),o[g](),e.isPropagationStopped()&&p.removeEventListener(g,bt),w.event.triggered=void 0,s&&(o[c]=s)),e.result}},simulate:function(e,t,o){var n=w.extend(new w.Event,o,{type:e,isSimulated:!0});w.event.trigger(n,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each((function(){w.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var o=this[0];if(o)return w.event.trigger(e,t,o,!0)}}),m.focusin||w.each({focus:"focusin",blur:"focusout"},(function(e,t){var o=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var n=this.ownerDocument||this.document||this,i=J.access(n,t);i||n.addEventListener(e,o,!0),J.access(n,t,(i||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,i=J.access(n,t)-1;i?J.access(n,t,i):(n.removeEventListener(e,o,!0),J.remove(n,t))}}}));var wt=n.location,Pt={guid:Date.now()},St=/\?/;w.parseXML=function(e){var t,o;if(!e||"string"!=typeof e)return null;try{t=(new n.DOMParser).parseFromString(e,"text/xml")}catch(e){}return o=t&&t.getElementsByTagName("parsererror")[0],t&&!o||w.error("Invalid XML: "+(o?w.map(o.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var Lt=/\[\]$/,Et=/\r?\n/g,It=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Mt(e,t,o,n){var i;if(Array.isArray(t))w.each(t,(function(t,i){o||Lt.test(e)?n(e,i):Mt(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,o,n)}));else if(o||"object"!==C(t))n(e,t);else for(i in t)Mt(e+"["+i+"]",t[i],o,n)}w.param=function(e,t){var o,n=[],i=function(e,t){var o=y(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==o?"":o)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,(function(){i(this.name,this.value)}));else for(o in e)Mt(o,e[o],t,i);return n.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&Ot.test(this.nodeName)&&!It.test(e)&&(this.checked||!me.test(e))})).map((function(e,t){var o=w(this).val();return null==o?null:Array.isArray(o)?w.map(o,(function(e){return{name:t.name,value:e.replace(Et,"\r\n")}})):{name:t.name,value:o.replace(Et,"\r\n")}})).get()}});var Nt=/%20/g,Dt=/#.*$/,At=/([?&])_=[^&]*/,Ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,zt=/^(?:GET|HEAD)$/,kt=/^\/\//,Bt={},Rt={},Gt="*/".concat("*"),jt=v.createElement("a");function Ft(e){return function(t,o){"string"!=typeof t&&(o=t,t="*");var n,i=0,r=t.toLowerCase().match(B)||[];if(y(o))for(;n=r[i++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(o)):(e[n]=e[n]||[]).push(o)}}function Wt(e,t,o,n){var i={},r=e===Rt;function a(s){var l;return i[s]=!0,w.each(e[s]||[],(function(e,s){var c=s(t,o,n);return"string"!=typeof c||r||i[c]?r?!(l=c):void 0:(t.dataTypes.unshift(c),a(c),!1)})),l}return a(t.dataTypes[0])||!i["*"]&&a("*")}function Ut(e,t){var o,n,i=w.ajaxSettings.flatOptions||{};for(o in t)void 0!==t[o]&&((i[o]?e:n||(n={}))[o]=t[o]);return n&&w.extend(!0,e,n),e}jt.href=wt.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Gt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ut(Ut(e,w.ajaxSettings),t):Ut(w.ajaxSettings,e)},ajaxPrefilter:Ft(Bt),ajaxTransport:Ft(Rt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var o,i,r,a,s,l,c,u,h,p,f=w.ajaxSetup({},t),d=f.context||f,g=f.context&&(d.nodeType||d.jquery)?w(d):w.event,m=w.Deferred(),y=w.Callbacks("once memory"),_=f.statusCode||{},T={},x={},C="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(c){if(!a)for(a={};t=Ht.exec(r);)a[t[1].toLowerCase()+" "]=(a[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=a[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return c?r:null},setRequestHeader:function(e,t){return null==c&&(e=x[e.toLowerCase()]=x[e.toLowerCase()]||e,T[e]=t),this},overrideMimeType:function(e){return null==c&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)b.always(e[b.status]);else for(t in e)_[t]=[_[t],e[t]];return this},abort:function(e){var t=e||C;return o&&o.abort(t),P(0,t),this}};if(m.promise(b),f.url=((e||f.url||wt.href)+"").replace(kt,wt.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(B)||[""],null==f.crossDomain){l=v.createElement("a");try{l.href=f.url,l.href=l.href,f.crossDomain=jt.protocol+"//"+jt.host!=l.protocol+"//"+l.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=w.param(f.data,f.traditional)),Wt(Bt,f,t,b),c)return b;for(h in(u=w.event&&f.global)&&0==w.active++&&w.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!zt.test(f.type),i=f.url.replace(Dt,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Nt,"+")):(p=f.url.slice(i.length),f.data&&(f.processData||"string"==typeof f.data)&&(i+=(St.test(i)?"&":"?")+f.data,delete f.data),!1===f.cache&&(i=i.replace(At,"$1"),p=(St.test(i)?"&":"?")+"_="+Pt.guid+++p),f.url=i+p),f.ifModified&&(w.lastModified[i]&&b.setRequestHeader("If-Modified-Since",w.lastModified[i]),w.etag[i]&&b.setRequestHeader("If-None-Match",w.etag[i])),(f.data&&f.hasContent&&!1!==f.contentType||t.contentType)&&b.setRequestHeader("Content-Type",f.contentType),b.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Gt+"; q=0.01":""):f.accepts["*"]),f.headers)b.setRequestHeader(h,f.headers[h]);if(f.beforeSend&&(!1===f.beforeSend.call(d,b,f)||c))return b.abort();if(C="abort",y.add(f.complete),b.done(f.success),b.fail(f.error),o=Wt(Rt,f,t,b)){if(b.readyState=1,u&&g.trigger("ajaxSend",[b,f]),c)return b;f.async&&f.timeout>0&&(s=n.setTimeout((function(){b.abort("timeout")}),f.timeout));try{c=!1,o.send(T,P)}catch(e){if(c)throw e;P(-1,e)}}else P(-1,"No Transport");function P(e,t,a,l){var h,p,v,T,x,C=t;c||(c=!0,s&&n.clearTimeout(s),o=void 0,r=l||"",b.readyState=e>0?4:0,h=e>=200&&e<300||304===e,a&&(T=function(e,t,o){for(var n,i,r,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(i in s)if(s[i]&&s[i].test(n)){l.unshift(i);break}if(l[0]in o)r=l[0];else{for(i in o){if(!l[0]||e.converters[i+" "+l[0]]){r=i;break}a||(a=i)}r=r||a}if(r)return r!==l[0]&&l.unshift(r),o[r]}(f,b,a)),!h&&w.inArray("script",f.dataTypes)>-1&&w.inArray("json",f.dataTypes)<0&&(f.converters["text script"]=function(){}),T=function(e,t,o,n){var i,r,a,s,l,c={},u=e.dataTypes.slice();if(u[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(r=u.shift();r;)if(e.responseFields[r]&&(o[e.responseFields[r]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=r,r=u.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(!(a=c[l+" "+r]||c["* "+r]))for(i in c)if((s=i.split(" "))[1]===r&&(a=c[l+" "+s[0]]||c["* "+s[0]])){!0===a?a=c[i]:!0!==c[i]&&(r=s[0],u.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+r}}}return{state:"success",data:t}}(f,T,b,h),h?(f.ifModified&&((x=b.getResponseHeader("Last-Modified"))&&(w.lastModified[i]=x),(x=b.getResponseHeader("etag"))&&(w.etag[i]=x)),204===e||"HEAD"===f.type?C="nocontent":304===e?C="notmodified":(C=T.state,p=T.data,h=!(v=T.error))):(v=C,!e&&C||(C="error",e<0&&(e=0))),b.status=e,b.statusText=(t||C)+"",h?m.resolveWith(d,[p,C,b]):m.rejectWith(d,[b,C,v]),b.statusCode(_),_=void 0,u&&g.trigger(h?"ajaxSuccess":"ajaxError",[b,f,h?p:v]),y.fireWith(d,[b,C]),u&&(g.trigger("ajaxComplete",[b,f]),--w.active||w.event.trigger("ajaxStop")))}return b},getJSON:function(e,t,o){return w.get(e,t,o,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],(function(e,t){w[t]=function(e,o,n,i){return y(o)&&(i=i||n,n=o,o=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:o,success:n},w.isPlainObject(e)&&e))}})),w.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),w._evalUrl=function(e,t,o){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){w.globalEval(e,t,o)}})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(y(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return y(e)?this.each((function(t){w(this).wrapInner(e.call(this,t))})):this.each((function(){var t=w(this),o=t.contents();o.length?o.wrapAll(e):t.append(e)}))},wrap:function(e){var t=y(e);return this.each((function(o){w(this).wrapAll(t?e.call(this,o):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){w(this).replaceWith(this.childNodes)})),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new n.XMLHttpRequest}catch(e){}};var Vt={0:200,1223:204},$t=w.ajaxSettings.xhr();m.cors=!!$t&&"withCredentials"in $t,m.ajax=$t=!!$t,w.ajaxTransport((function(e){var t,o;if(m.cors||$t&&!e.crossDomain)return{send:function(i,r){var a,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)s[a]=e.xhrFields[a];for(a in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(a,i[a]);t=function(e){return function(){t&&(t=o=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?r(0,"error"):r(s.status,s.statusText):r(Vt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),o=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=o:s.onreadystatechange=function(){4===s.readyState&&n.setTimeout((function(){t&&o()}))},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),w.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),w.ajaxTransport("script",(function(e){var t,o;if(e.crossDomain||e.scriptAttrs)return{send:function(n,i){t=w("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",o=function(e){t.remove(),o=null,e&&i("error"===e.type?404:200,e.type)}),v.head.appendChild(t[0])},abort:function(){o&&o()}}}));var Zt,qt=[],Kt=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=qt.pop()||w.expando+"_"+Pt.guid++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",(function(e,t,o){var i,r,a,s=!1!==e.jsonp&&(Kt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kt.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=y(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(Kt,"$1"+i):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return a||w.error(i+" was not called"),a[0]},e.dataTypes[0]="json",r=n[i],n[i]=function(){a=arguments},o.always((function(){void 0===r?w(n).removeProp(i):n[i]=r,e[i]&&(e.jsonpCallback=t.jsonpCallback,qt.push(i)),a&&y(r)&&r(a[0]),a=r=void 0})),"script"})),m.createHTMLDocument=((Zt=v.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Zt.childNodes.length),w.parseHTML=function(e,t,o){return"string"!=typeof e?[]:("boolean"==typeof t&&(o=t,t=!1),t||(m.createHTMLDocument?((n=(t=v.implementation.createHTMLDocument("")).createElement("base")).href=v.location.href,t.head.appendChild(n)):t=v),r=!o&&[],(i=M.exec(e))?[t.createElement(i[1])]:(i=be([e],t,r),r&&r.length&&w(r).remove(),w.merge([],i.childNodes)));var n,i,r},w.fn.load=function(e,t,o){var n,i,r,a=this,s=e.indexOf(" ");return s>-1&&(n=_t(e.slice(s)),e=e.slice(0,s)),y(t)?(o=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&w.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done((function(e){r=arguments,a.html(n?w("<div>").append(w.parseHTML(e)).find(n):e)})).always(o&&function(e,t){a.each((function(){o.apply(this,r||[e.responseText,t,e])}))}),this},w.expr.pseudos.animated=function(e){return w.grep(w.timers,(function(t){return e===t.elem})).length},w.offset={setOffset:function(e,t,o){var n,i,r,a,s,l,c=w.css(e,"position"),u=w(e),h={};"static"===c&&(e.style.position="relative"),s=u.offset(),r=w.css(e,"top"),l=w.css(e,"left"),("absolute"===c||"fixed"===c)&&(r+l).indexOf("auto")>-1?(a=(n=u.position()).top,i=n.left):(a=parseFloat(r)||0,i=parseFloat(l)||0),y(t)&&(t=t.call(e,o,w.extend({},s))),null!=t.top&&(h.top=t.top-s.top+a),null!=t.left&&(h.left=t.left-s.left+i),"using"in t?t.using.call(e,h):u.css(h)}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){w.offset.setOffset(this,e,t)}));var t,o,n=this[0];return n?n.getClientRects().length?(t=n.getBoundingClientRect(),o=n.ownerDocument.defaultView,{top:t.top+o.pageYOffset,left:t.left+o.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,o,n=this[0],i={top:0,left:0};if("fixed"===w.css(n,"position"))t=n.getBoundingClientRect();else{for(t=this.offset(),o=n.ownerDocument,e=n.offsetParent||o.documentElement;e&&(e===o.body||e===o.documentElement)&&"static"===w.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),i.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-w.css(n,"marginTop",!0),left:t.left-i.left-w.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===w.css(e,"position");)e=e.offsetParent;return e||ae}))}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var o="pageYOffset"===t;w.fn[e]=function(n){return V(this,(function(e,n,i){var r;if(_(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===i)return r?r[t]:e[n];r?r.scrollTo(o?r.pageXOffset:i,o?i:r.pageYOffset):e[n]=i}),e,n,arguments.length)}})),w.each(["top","left"],(function(e,t){w.cssHooks[t]=Ze(m.pixelPosition,(function(e,o){if(o)return o=$e(e,t),Ge.test(o)?w(e).position()[t]+"px":o}))})),w.each({Height:"height",Width:"width"},(function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},(function(o,n){w.fn[n]=function(i,r){var a=arguments.length&&(o||"boolean"!=typeof i),s=o||(!0===i||!0===r?"margin":"border");return V(this,(function(t,o,i){var r;return _(t)?0===n.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===i?w.css(t,o,s):w.style(t,o,i,s)}),t,a?i:void 0,a)}}))})),w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){w.fn[t]=function(e){return this.on(t,e)}})),w.fn.extend({bind:function(e,t,o){return this.on(e,null,t,o)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,o,n){return this.on(t,e,o,n)},undelegate:function(e,t,o){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",o)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){w.fn[t]=function(e,o){return arguments.length>0?this.on(t,null,e,o):this.trigger(t)}}));var Yt=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;w.proxy=function(e,t){var o,n,i;if("string"==typeof t&&(o=e[t],t=e,e=o),y(e))return n=s.call(arguments,2),i=function(){return e.apply(t||this,n.concat(s.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=O,w.isFunction=y,w.isWindow=_,w.camelCase=K,w.type=C,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},w.trim=function(e){return null==e?"":(e+"").replace(Yt,"$1")},void 0===(o=function(){return w}.apply(t,[]))||(e.exports=o);var Xt=n.jQuery,Jt=n.$;return w.noConflict=function(e){return n.$===w&&(n.$=Jt),e&&n.jQuery===w&&(n.jQuery=Xt),w},void 0===i&&(n.jQuery=n.$=w),w}))},175:(e,t,o)=>{"use strict";o.d(t,{qI:()=>w,I8:()=>S,SV:()=>P});var n=o(774),i=o(354),r=o(891);function a(e){let t=e,o=1;return e.length&&4===e.length&&(t=[e[0],e[1],e[2]],o=e[3]),`rgba(${t.map((e=>255*e)).toString()},${o})`}const s=function(e){this.name=e,this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._shadowBlur=0,this._fontShadowEnable=!1};s.DEFAULT_FONT_HEIGHT=4,s.DEFAULT_FONT_FAMILY="Arial",s.DEFAULT_FONT_SIZE=14,s.DEFAULT_FONT_STYLE="",s.ALING_H=["left","center","right"],s.ALING_V=["top","middle","alphabetic"],s.prototype.toString=function(){return this.name},s.prototype.getWidth=function(){return this._canvas.width},s.prototype.getHeight=function(){return this._canvas.height},s.prototype.setSolidPen=function(e,t){if(e instanceof Array){const t=255*e[0]||0,o=255*e[1]||0,n=255*e[2]||0;this._context.fillStyle="rgb(&r,&g,&b)".replace("&r",t).replace("&g",o).replace("&b",n)}else this._context.fillStyle=e;this._context.lineWidth=t},s.prototype.setGradientPen=function(e,t,o,n){const i=this._context.createLinearGradient(e[0],e[1],t[0],t[1]),r="rgb(&r,&g,&b)".replace("&r",o[0]).replace("&g",o[1]).replace("&b",o[2]),a="rgb(&r,&g,&b)".replace("&r",n[0]).replace("&g",n[1]).replace("&b",n[2]);i.addColorStop(0,r),i.addColorStop(1,a),this._context.strokeStyle=i},s.prototype.setStrokeColor=function(e){if(e instanceof Array){const t=255*e[0]||0,o=255*e[1]||0,n=255*e[2]||0;this._context.strokeStyle="rgb(&r,&g,&b)".replace("&r",t).replace("&g",o).replace("&b",n)}else this._context.strokeStyle=e},s.prototype.setPenWidth=function(e){this._context.lineWidth=e},s.prototype.setSolidBrush=function(e,t,o,n){1===arguments.length?this._context.fillStyle=e:(e=255*e||0,t=255*t||0,o=255*o||0,this._context.fillStyle="rgba(&r,&g,&b,&a)".replace("&r",e).replace("&g",t).replace("&b",o).replace("&a",n))},s.prototype.setGradientBrush=function(e,t,o,n){const i=this._context.createLinearGradient(e[0],e[1],t[0],t[1]),r="rgb(&r,&g,&b)".replace("&r",o[0]).replace("&g",o[1]).replace("&b",o[2]),a="rgb(&r,&g,&b)".replace("&r",n[0]).replace("&g",n[1]).replace("&b",n[2]);i.addColorStop(0,r),i.addColorStop(1,a),this._context.fillStyle=i},s.prototype.drawLine=function(e,t){this._context.moveTo(e[0],e[1]),this._context.lineTo(t[0],t[1]),this._context.stroke()},s.prototype.drawLines=function(e){if(e.length>1){this._context.moveTo(e[0][0],e[0][1]);for(let t=0;t<e.length;t+=1)this._context.lineTo(e[t][0],e[t][1]);this._context.stroke()}},s.prototype.drawRectangle=function(e,t,o,n){this._context.rect(e,t,o,n),this._context.stroke()},s.prototype.fillRectangle=function(e,t,o,n){this._context.fillRect(e,t,o,n)},s.prototype.setFont=function(...e){const t=arguments.length>0&&void 0!==e[0]?e[0]:s.DEFAULT_FONT_FAMILY,o=arguments.length>1&&void 0!==e[1]?e[1]:s.DEFAULT_FONT_SIZE;let n=arguments.length>2&&void 0!==e[2]?e[2]:"";"number"==typeof n&&(n=["Normal","Bold","Italic"][n]),this._context._fontStyle=n,this._context._fontSize=o,this._context._fontFamily=t;const i=`${n} ${o}px ${t}`;this._context.font=i},s.prototype.setFontShadow=function(e,t=0,o,n=[3,3]){this._fontShadowEnable=e,e?(this._shadowBlur=t,this._context.shadowOffsetX=n[0],this._context.shadowOffsetY=n[1],this._context.shadowColor=o||"rgba(0,0,0,0)",this._context.shadowBlur=t):(this._shadowBlur="",this._context.shadowOffsetX=0,this._context.shadowOffsetY=0,this._context.shadowColor="",this._context.shadowBlur="")},s.prototype.measureText=function(e,t,o,n){let i=0,r=0;isNaN(e)||(e+="");const a=e.split("\n");if(1===arguments.length){for(let t=0;t<a.length;t+=1)i=Math.max(this._context.measureText(e).width,i),r+=o;return i}this._context.save(),t&&o&&this.setFont(t,o,n);for(let e=0;e<a.length;e+=1)i=Math.max(this._context.measureText(a[e]).width,i),r+=o+s.DEFAULT_FONT_HEIGHT;return this._context.restore(),i+=15,r+=s.DEFAULT_FONT_HEIGHT,[i,r]},s.prototype.drawText=function(e,t,o,n=!1){if(null==e)return;"string"!=typeof e&&(e+="");const i=this._context._textH>-1?this._context._textH:1,r=this._context._textV>-1?this._context._textV:1,a=s.ALING_H[i]||s.ALING_H[1],l=s.ALING_V[r]||s.ALING_V[1];isNaN(e)||(e+="");const c=e.split("\n");if(this._context.save(),t instanceof Array){const e=255*t[0]||0,o=255*t[1]||0,n=255*t[2]||0;this._context.fillStyle="rgb(&r,&g,&b)".replace("&r",e).replace("&g",o).replace("&b",n)}else this._context.fillStyle=t;this._context.textAlign=a,this._context.textBaseline=l;for(let e=0;e<c.length;e+=1){const t=o[1]+1+e*(this._context._fontSize+s.DEFAULT_FONT_HEIGHT)-(c.length-1)*(this._context._fontSize+s.DEFAULT_FONT_HEIGHT)/2;n&&this._context.strokeText(c[e],o[0],t),this._context.fillText(c[e],o[0],t)}this._context.restore()},s.prototype.drawShadowText=function(e,t=2,o,n="#000000",i,r=!1){if("string"!=typeof e)return;const a=this._context._textH>-1?this._context._textH:1,l=this._context._textV>-1?this._context._textV:1,c=s.ALING_H[a]||s.ALING_H[1],u=s.ALING_V[l]||s.ALING_V[1];let h;if(this._context.save(),this._context.shadowBlur=t,n instanceof Array){const e=255*n[0]||0,t=255*n[1]||0,o=255*n[2]||0;h="rgb(&r,&g,&b)".replace("&r",e).replace("&g",t).replace("&b",o)}else h=n;if(this._context.shadowColor=h,o instanceof Array){const e=255*o[0]||0,t=255*o[1]||0,n=255*o[2]||0;this._context.fillStyle="rgb(&r,&g,&b)".replace("&r",e).replace("&g",t).replace("&b",n)}else this._context.fillStyle=o;this._context.textAlign=c,this._context.textBaseline=u,isNaN(e)||(e+="");const p=e.split("\n");for(let e=0;e<p.length;e+=1){const t=i[1]+e*(this._context._fontSize+s.DEFAULT_FONT_HEIGHT)-(p.length-1)*(this._context._fontSize+s.DEFAULT_FONT_HEIGHT)/2;r&&this._context.strokeText(p[e],i[0],t),this._context.fillText(p[e],i[0],t)}this._context.restore()},s.prototype.setTextAlignment=function(e,t){this._context._textH=t,this._context._textV=e},s.prototype.updateTexture=function(){},s.prototype.getTexture=function(){const e=new Image;return e.src||(e.width=this._canvas.width,e.height=this._canvas.height),e.src=this._canvas.toDataURL("image/png"),e},s.prototype.drawTexture=function(e){e.image.src=this._canvas.toDataURL("image/png"),e.needsUpdate=!0},s.prototype.clear=function(e,t,o,n){t=t||0,o=o||0,n=n||0;const i="rgba(&r,&g,&b,&a)".replace("&r",e=e||0).replace("&g",t).replace("&b",o).replace("&a",n);this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.save(),this._context.fillStyle=i,this._context.fillRect(0,0,this._canvas.width,this._canvas.height),this._context.restore()},s.prototype.destroy=function(){},s.prototype.createSymbol=function(e){const t=.1,o=void 0===e.lineWidth?20:20*e.lineWidth,n=e.width||256,i=e.height||256,r=e.color?a(e.color):"rgba(255,0,0,1)",s=e.lineColor?a(e.lineColor):"rgba(0,0,255,1)",l=e.type||"circle",c=this._canvas;c.width=n,c.height=i,c.style.position="absolute",c.style.left="0px",c.style.top="0px",this._context.clearRect(0,0,c.width,c.height),"circle"===l?this.createCircle(n,i,r,s,o,t):"rectangle"===l?this.createRectangle(n,i,r,s,o,t):"cross"===l?this.createCross(n,i,r,s,o,t):"triangle"===l&&this.createTriangle(n,i,r,s,o,t)},s.prototype.createCircle=function(e,t,o,n,i,r){const a=this._context;i=i/e>r?r*e:i,a.beginPath();const s=e/2-r*e,l=t/2-r*e,c=t/2-2*r*e;a.arc(s,l,c,0,2*Math.PI,!1),a.fillStyle=o,a.fill(),i&&(a.strokeStyle=n,a.lineWidth=i,a.stroke())},s.prototype.createRectangle=function(e,t,o,n,i,r){const a=this._context;i=i/e>r?r*e:i,a.beginPath();const s=r*e,l=r*t,c=e*(1-2*r),u=t*(1-2*r);a.rect(s,l,c,u),a.fillStyle=o,a.fill(),i&&(a.strokeStyle=n,a.lineWidth=i,a.stroke())},s.prototype.createCross=function(e,t,o,n,i,r){const a=this._context;i=i/e>r?r*e:i,a.beginPath(),a.strokeStyle=n,a.lineWidth=i,a.moveTo(e/2,t*r),a.lineTo(e/2,t-t*r),a.moveTo(e*r,t/2),a.lineTo(e-e*r,t/2),i&&a.stroke()},s.prototype.createTriangle=function(e,t,o,n,i,r){const a=this._context;i=i/e>r?r*e:i,a.beginPath(),a.fillStyle=o,a.strokeStyle=n,a.lineWidth=i,a.moveTo(e/2,t*r),a.lineTo(e*r,t-t*r),a.lineTo(e-e*r,t-t*r),a.lineTo(e/2,t*r),a.fill(),i&&a.stroke()},s.prototype.getCanvas=function(){return this._canvas},s.prototype.drawImage=function(e){if(e){const t=this._context;t.drawImage(e,0,0,t.canvas.width,t.canvas.height)}};const l={},c=(new s("measure"),function(e){return l[e]}),u=function(e,t,o){e=e||THING.Utils.generateUUID();const n=new s(e);return n._canvas.width=t,n._canvas.height=o,l[e]=n,n},h=function(e){l[e]=null,delete l[e]},p={BOTTOM:2,CENTER:1,TOP:0},f=function(e){this.name=e,this.canvas=null};f.getDefaultParam=function(){return{forceTo2N:!1,canvasWidth:256,canvasHeight:128,backgroundColor:[1,1,1,0],fontFamily:"å¾®è½¯éé»",fontSize:32,fontColor:[1,1,1],fontStyle:0,fontShadow:!0,fontShadowBlur:2,fontShadowColor:[0,0,0],fontShadowOffset:[2,2],fontOutline:!1,fontOutlineThickness:2,fontOutlineColor:[0,0,0],verticalTextAlignment:1,horizontTextAlignment:1,verticalWriterAlignment:1,horizontalWriterAlignment:p.CENTER,debug:!1}},f.prototype.init=function(e){void 0===e&&(e={});const t=f.getDefaultParam();i.Z.combineNew(e,t),this.canvas=c(this.name),this.canvas||(this.canvas=u(this.name,e.canvasWidth,e.canvasHeight)),this.canvas.propTmp||(this.canvas.propTmp={}),this.debug=e.debug,this.canvasWidth=e.canvasWidth,this.canvasHeight=e.canvasHeight,this.setTextAlignment(e.verticalTextAlignment,e.horizontTextAlignment),this.setWriterAlignment(e.verticalWriterAlignment,e.horizontalWriterAlignment),this.setFont(e),this.setFontShadow(e),this.setFontOutline(e),this.setBackgroundColor(e.backgroundColor),this.setColor(e.fontColor)},f.prototype.isForceTo2N=function(){return this.forceTo2N},f.prototype.setDimensions=function(e,t){if(e===this.canvasWidth&&t===this.canvasHeight)return;const o=`canvas_${e}_${t}`;this.canvas=c(o),this.canvas||(this.canvas=u(o,e,t)),this.canvas.propTmp||(this.canvas.propTmp={}),this.canvasWidth=e,this.canvasHeight=t,this.canvas.clear(),this.setTextAlignment(this.verticalTextAlignment,this.horizontTextAlignment),this.setFont(this.fontFamily,this.fontSize,this.fontStyle),this.setFontShadow(this.fontShadow,this.fontShadowBlur,this.fontShadowColor,this.fontShadowOffset)},f.prototype.setBackgroundColor=function(e){this.canvas&&(this.backgroundColor&&this.backgroundColor[0]===e[0]&&this.backgroundColor[1]===e[1]&&this.backgroundColor[2]===e[2]&&this.backgroundColor[3]===e[3]||(this.backgroundColor=e,this.backgroundColor.length<4&&(this.backgroundColor[3]=1)))},f.prototype.setTextAlignment=function(e,t){this.canvas&&(this.verticalTextAlignment=e,this.horizontTextAlignment=t,this.canvas.propTmp.verticalTextAlignment===e&&this.canvas.propTmp.horizontTextAlignment===t||(this.canvas.propTmp.verticalTextAlignment!==e&&(this.canvas.propTmp.verticalTextAlignment=e),this.canvas.propTmp.horizontTextAlignment!==t&&(this.canvas.propTmp.horizontTextAlignment=t),this.canvas.setTextAlignment(this.canvas.propTmp.verticalTextAlignment,this.canvas.propTmp.horizontTextAlignment)))},f.prototype.setWriterAlignment=function(e,t){this.canvas&&(this.verticalWriterAlignment===e&&this.horizontalWriterAlignment===t||(this.verticalWriterAlignment!==e&&(this.verticalWriterAlignment=e),this.horizontalWriterAlignment!==t&&(this.horizontalWriterAlignment=t)))},f.prototype.setFont=function(e,...t){if(this.canvas){if(1===arguments.length)"string"==typeof e?this.fontFamily=e:(void 0!==e.fontFamily&&(this.fontFamily=e.fontFamily),void 0!==e.fontSize&&(this.fontSize=e.fontSize),void 0!==e.fontStyle&&(this.fontStyle=e.fontStyle));else{const[o,n]=t;this.fontFamily=e,this.fontSize=o,this.fontStyle=n}if(void 0!==this.fontFamily&&this.canvas.propTmp.fontFamily!==this.fontFamily||void 0!==this.fontSize&&this.canvas.propTmp.fontSize!==this.fontSize||void 0!==this.fontStyle&&this.canvas.propTmp.fontStyle!==this.fontStyle){void 0!==this.fontFamily&&(this.canvas.propTmp.fontFamily=this.fontFamily),void 0!==this.fontSize&&(this.canvas.propTmp.fontSize=this.fontSize),void 0!==this.fontStyle&&(this.canvas.propTmp.fontStyle=this.fontStyle);let e=this.canvas.propTmp.fontSize;-1===this.canvas.propTmp.fontSize&&(e=this.canvasHeight,this.canvas.propTmp.fontSize=e,this.fontSize=e),this.canvas.setFont(this.canvas.propTmp.fontFamily,e,this.canvas.propTmp.fontStyle)}}},f.prototype.setFontShadow=function(e){this.canvas&&(void 0!==e.fontShadow&&(this.fontShadow=e.fontShadow),void 0!==e.fontShadowBlur&&(this.fontShadowBlur=e.fontShadowBlur),void 0!==e.fontShadowColor&&(this.fontShadowColor=e.fontShadowColor),void 0!==e.fontShadowOffset&&(this.fontShadowOffset=e.fontShadowOffset),(void 0!==this.fontShadow&&this.canvas.propTmp.fontShadow!==this.fontShadow||void 0!==this.fontShadowBlur&&this.canvas.propTmp.fontShadowBlur!==this.fontShadowBlur||void 0!==this.fontShadowColor&&this.canvas.propTmp.fontShadowColor!==this.fontShadowColor||void 0!==this.fontShadowOffset&&this.canvas.propTmp.fontShadowOffset!==this.fontShadowOffset)&&(void 0!==this.fontShadow&&(this.canvas.propTmp.fontShadow=this.fontShadow),void 0!==this.fontShadowBlur&&(this.canvas.propTmp.fontShadowBlur=this.fontShadowBlur),void 0!==this.fontShadowColor&&(this.canvas.propTmp.fontShadowColor=this.fontShadowColor),void 0!==this.fontShadowOffset&&(this.canvas.propTmp.fontShadowOffset=this.fontShadowOffset),this.canvas.setFontShadow(this.canvas.propTmp.fontShadow,this.canvas.propTmp.fontShadowBlur,this.canvas.propTmp.fontShadowColor,this.canvas.propTmp.fontShadowOffset)))},f.prototype.setFontOutline=function(e){this.canvas&&(void 0!==e.fontOutline&&this.fontOutline!==e.fontOutline||void 0!==e.fontOutlineThickness&&this.fontOutlineThickness!==e.fontOutlineThickness||void 0!==e.fontOutlineColor&&this.fontOutlineColor!==e.fontOutlineColor)&&(void 0!==e.fontOutline&&(this.fontOutline=e.fontOutline),void 0!==e.fontOutlineThickness&&(this.fontOutlineThickness=e.fontOutlineThickness),void 0!==e.fontOutlineColor&&(this.fontOutlineColor=e.fontOutlineColor))},f.prototype.setColor=function(e){this.canvas&&(this.fontColor&&this.fontColor[0]===e[0]&&this.fontColor[1]===e[1]&&this.fontColor[2]===e[2]||(this.fontColor=e))},f.prototype.drawText=function(e,t,o){let n,i;t||(t=[0,0]),0===this.verticalWriterAlignment&&(n=0),1===this.verticalWriterAlignment&&(n=.5),2===this.verticalWriterAlignment&&(n=1),this.horizontalWriterAlignment===p.LEFT&&(i=0),this.horizontalWriterAlignment===p.CENTER&&(i=.5),this.horizontalWriterAlignment===p.RIGHT&&(i=1);let r=t;o&&(r=[t[0]+Math.round(o[0]*n),t[1]+Math.round(o[1]*i)]),o&&(this.debug?(this.canvas.setSolidBrush(1,0,0,1),this.canvas.fillRectangle(t[0],t[1],o[0],o[1])):(this.canvas.setSolidBrush(this.backgroundColor[0],this.backgroundColor[1],this.backgroundColor[2],this.backgroundColor[3]),this.canvas.fillRectangle(t[0],t[1],o[0],o[1]))),this.fontOutline&&(this.canvas.setStrokeColor(this.fontOutlineColor),this.canvas.setPenWidth(this.fontOutlineThickness)),this.fontShadow?this.canvas.drawShadowText(e,this.fontShadowBlur+.1,this.fontColor,this.fontShadowColor,r,this.fontOutline):this.canvas.drawText(e,this.fontColor,r,this.fontOutline)},f.prototype.destroy=function(){h(this.name)};const d=f,g=function(){return n.Z.data("language")||"zh"};function m(e,t){if("objectProperty"===t.getMethod){const i=t.propertyPath;let r=e.getAttribute(i);return void 0!==t.toFixed&&Number(r)&&(o=Number(r),n=t.toFixed,o=parseFloat(o),r=(Math.round(((o+Number.EPSILON)*Math.pow(10,n)).toFixed(n))/Math.pow(10,n)).toFixed(n)),r}var o,n;if("objectPropertyMapping"===t.getMethod){const o=t.objectPropertyMapping[e.getAttribute(t.propertyPath)];if(o)return o;if(t.objectPropertyMapping._default_)return t.objectPropertyMapping._default_}else{if("presetValue"===t.getMethod)return t.presetValue;if("func"===t.getMethod)return t.getFunc.call(null,e)}return e.name}const y=function(e,t){const o=`${e.moniterObj.id}_${e.image}_${e.imageWidth}_${e.imageHeight}`;y.superclass.constructor.call(this,o),this.panelMarker=t,this.init(e)};n.Z.extend(y,d),y.prototype.init=function(e={}){i.Z.combineNew(e,{imageWidth:256,imageHeight:128,image:"",canvasScale:1,showMapping:[]}),e.canvasWidth=e.imageWidth*e.canvasScale,e.canvasHeight=e.imageHeight*e.canvasScale,d.prototype.init.call(this,e),this.canvas.clear(),e.markerImage&&(this.markerImage=e.markerImage,Array.isArray(this.markerImage)?this.markerImage.forEach((e=>{this.canvas._context.drawImage(e.img,e.drawPos[0],e.drawPos[1],e.size[0],e.size[1])})):this.canvas.drawImage(this.markerImage)),this.moniterObj=e.moniterObj;const t=e;t.showMapping=n.Z.cloneObj(e.showMapping,!1),this.showMapping=t.showMapping,this.serverFilePath=t.serverFilePath;const o=d.getDefaultParam();o.verticalTextAlignment=1,o.horizontTextAlignment=1,o.verticalWriterAlignment=1,o.horizontalWriterAlignment=1,Object.keys(this.showMapping).forEach((t=>{this.showMapping[t]=n.Z.cloneObj(this.showMapping[t]);const r=this.showMapping[t];n.Z.isFunction(r.drawPos)?r.drawPos=r.drawPos.call(null,g()):n.Z.isObject(r.drawPos)&&(r.drawPos=r.drawPos[g()]),1!==e.canvasScale&&(r.drawPos=n.Z.cloneObj(r.drawPos),r.drawSize=n.Z.cloneObj(r.drawSize),r.drawPos&&(r.drawPos[0]*=e.canvasScale,r.drawPos[1]*=e.canvasScale),r.drawSize&&(r.drawSize[0]*=e.canvasScale,r.drawSize[1]*=e.canvasScale)),"text"===r.type&&i.Z.combineNew(r,o)})),this._idleFunc=e.func},y.prototype.checkUpdateImage=function(e,t){let o=m(e,t);const n=this.serverFilePath;return o=(0,r.v)(n+o),t.imageUrl!==o},y.prototype.updateImage=function(e,t){let o=m(e,t);const n=this.serverFilePath;if(o=(0,r.v)(n+o),!o)return;const{width:i}=t,{height:a}=t,s=t.drawPos[0],l=t.drawPos[1],c=new Image(i,a);c.crossOrigin="Anonymous",c.src=o;const{canvas:u}=this,h=this;c.onload=function(){u._canvas.getContext("2d").drawImage(c,s,l,i,a);const{panelMarker:e}=h;if(e){const t=e.style.opacity;e.style.opacity=1,e.canvas=u._canvas,e.style.opacity=t}},t.imageUrl=o},y.prototype.checkUpdateText=function(e,t){let o=m(e,t);return void 0!==o&&(o&&"string"!=typeof o&&"number"!=typeof o&&(o=o.text),t.curDraw!==o)},y.prototype.updateText=function(e,t){let o=m(e,t);if(void 0===o)return;let n=null;o&&"object"==typeof o&&(n=o,o=n.text,i.Z.combine(t,n)),""===o||isNaN(o)||void 0===t.toFixed||null===t.toFixed||(o=Number(o).toFixed(t.toFixed)),t.curDraw=o,this.setTextAlignment(t.verticalTextAlignment,t.horizontTextAlignment),this.setWriterAlignment(t.verticalWriterAlignment,t.horizontalWriterAlignment),this.setFont(t),this.setFontShadow(t),this.setFontOutline(t),this.setColor(t.fontColor),t.isSubText&&(this.fontColor=t.fontColor),this.drawText(o,t.drawPos,t.drawSize),this.setFontShadow({fontShadow:!1})},y.prototype.checkUpdateProgressBar=function(e,t){const o=m(e,t);return t.val!==o},y.prototype.getColorBySteps=function(e,t=[]){let o;const n=t.length;if(0!==n){for(let i=0;i<n;i+=1){const n=t[i],{condition:r}=n,{value:a}=n,{color:s}=n;if("<"===r){if(e<a){o=s;break}}else if("<="===r){if(e<=a){o=s;break}}else if((!r||"="===r)&&e===a){o=s;break}}return o||(e<=t[0].value?o=t[0].color:e>=t[n-1].value&&(o=t[n-1].color)),o}},y.prototype.drawRectangle=function(e){const{isCorner:t}=e,{drawSize:o}=e,{drawPos:n}=e,{color:i}=e,{percent:r}=e;if(i)if(i instanceof Array?this.canvas.setSolidBrush(i[0],i[1],i[2],1):this.canvas.setSolidBrush(i),t){const e=o[1],t=n[0]+e/2,i=n[1],a=this.canvas._context;a.beginPath(),a.arc(t,i+e/2,e/2,.5*Math.PI,1.5*Math.PI),a.fill(),o[0]*r-e/2>0&&this.canvas.fillRectangle(t,i,o[0]*r-e,e),o[0]*r-e>0&&(a.beginPath(),a.arc(t+o[0]*r-e,i+e/2,e/2,1.5*Math.PI,.5*Math.PI),a.fill())}else{const e=n[0],t=n[1],i=o[0]*r,a=o[1];this.canvas.fillRectangle(e,t,i,a)}},y.prototype.updateProgressBar=function(e,t){const o=m(e,t);if(void 0===o)return;t.val=o;const{background:n}=t;let i,r=1;if(t.fillColor){const e=t.fillColor.steps||[],n=t.fillColor.min,a=t.fillColor.max;e.sort((function(e,t){return e.value-t.value})),i=this.getColorBySteps(o,e),!n&&0!==n||!a&&0!==a||(r=(o-n)/(a-n)),r<=0&&(r=0),r>1&&(r=1)}const{drawSize:a}=t,{drawPos:s}=t,{isCorner:l}=t;n&&n.show&&this.drawRectangle({color:n.color,drawPos:s,drawSize:a,isCorner:l,percent:1}),this.drawRectangle({color:i,drawPos:s,drawSize:a,isCorner:l,percent:r})},y.prototype.checkUpdateStateBar=function(e,t){const o=m(e,t);return t.val!==o},y.prototype.updateStateBar=function(e,t){const o=m(e,t);if(void 0===o)return;let n;if(t.val=o,t.fillColor){const e=t.fillColor;n=this.getColorBySteps(o,e)}const{drawSize:i}=t,{drawPos:r}=t;this.drawRectangle({color:n,drawPos:r,drawSize:i,isCorner:!1,percent:1})},y.prototype.update=function(e=!1){let t=!1;const{showMapping:o}=this,n=Object.keys(o);for(let e=0;e<n.length;e+=1){const i=o[n[e]];if("text"===i.type){if(this.checkUpdateText(this.moniterObj,i)){t=!0;break}}else if("progressBar"===i.type&&!0===i.show){if(this.checkUpdateProgressBar(this.moniterObj,i)){t=!0;break}}else if("image"===i.type){if(this.checkUpdateImage(this.moniterObj,i)){t=!0;break}}else if("stateBar"===i.type&&!0===i.show&&this.checkUpdateStateBar(this.moniterObj,i)){t=!0;break}}if(this.isUpdate=t,t||e){this.canvas.clear(),Array.isArray(this.markerImage)?this.markerImage.forEach((e=>{this.canvas._context.drawImage(e.img,e.drawPos[0],e.drawPos[1],e.size[0],e.size[1])})):this.canvas.drawImage(this.markerImage);for(let e=0;e<n.length;e+=1){const t=o[n[e]];"text"===t.type?this.updateText(this.moniterObj,t):"progressBar"===t.type&&!0===t.show?this.updateProgressBar(this.moniterObj,t):"image"===t.type?this.updateImage(this.moniterObj,t):"stateBar"===t.type&&!0===t.show&&this.updateStateBar(this.moniterObj,t)}}this._idleFunc&&this._idleFunc(this)},y.prototype.destroy=function(){y.superclass.destroy.call(this)};const _=y;var v=o(331),T=o.n(v);function x(e,t){if("objectProperty"===t.getMethod){let i;return i="string"==typeof t.propertyPath?e.getAttribute(t.propertyPath):"id"==t.propertyPath.type||"name"==t.propertyPath.type||"empty"==t.propertyPath.type?e.getAttribute(t.propertyPath.type):e.getAttribute(t.propertyPath.value),void 0!==t.toFixed&&Number(i)&&(o=Number(i),n=t.toFixed.presetValue,o=parseFloat(o),i=(Math.round(((o+Number.EPSILON)*Math.pow(10,n)).toFixed(n))/Math.pow(10,n)).toFixed(n)),i}var o,n;if("objectPropertyMapping"===t.getMethod){const o=t.objectPropertyMapping[e.getAttribute(t.propertyPath)];if(o)return o;if(t.objectPropertyMapping._default_)return t.objectPropertyMapping._default_}else{if("presetValue"===t.getMethod)return t.presetValue;if("func"===t.getMethod)return t.getFunc.call(null,e)}return e.name}class C{constructor(e){this.init(e)}}C.prototype.init=function(e){this.moniterObj=e.moniterObj;const t=e;t.showMapping=n.Z.cloneObj(t.showMapping,!1),this.showMapping=t.showMapping,this.element=e.element},C.prototype.update=function(){let e=!1;const t=this.showMapping,o=Object.keys(t);for(let n=0;n<o.length;n+=1){const i=t[o[n]];if("text"===i.type&&this.checkUpdateText(this.moniterObj,i)){e=!0;break}}if(this.isUpdate=e,e)for(let e=0;e<o.length;e+=1){const n=o[e],i=t[n];"text"===i.type&&this.updateText(this.moniterObj,i,n)}},C.prototype.checkUpdateText=function(e,t){let o=x(e,t);return o&&"string"!=typeof o&&"number"!=typeof o&&(o=o.text),t.curDraw!==o},C.prototype.updateText=function(e,t,o){let n,r=x(e,t),a=null;r&&"object"==typeof r&&(a=r,r=a.text,i.Z.combine(t,a)),t.curDraw!==r&&(isNaN(r)||void 0===t.toFixed||null===t.toFixed||(r=Number(r).toFixed(t.toFixed.presetValue)),n=this.element.id===o?this.element:T()(this.element).find(`#${o}`)[0],n?n.innerText=r:console.error(`Domä¸­æ²¡ææ¾å°è¯¥idçèç¹ ${o}`))},C.prototype.destroy=function(){};const b=C;class w extends THING.Marker{constructor(e){super(e),this.moniterPanelBGAndCanvas=null}setPanelCanvas(e,t=!1){if(this.canvas=document.createElement("canvas"),!e.images){let o=this;return new Promise((function(n,i){const r=new Image(e.imageWidth,e.imageHeight);r.setAttribute("crossOrigin","anonymous"),r.src=e.url1,r.onload=()=>{e.markerImage=r,o.moniterPanelBGAndCanvas||(o.moniterPanelBGAndCanvas=new _(e,this));const i=o.style.opacity;o.style.opacity=1,o.updateCanvas(t),o.style.opacity=i,n(r)}}))}{const o=THING.Utils.cloneObject(e.images,!1),{left:n,center:i,right:r,guide:a}=o,s=Array.isArray(n)?n[0]:n,l=Array.isArray(r)?r[0]:r,c=50,u=(isNaN(s.size[1]-0)?c:s.size[1]-0)+(isNaN(l.size[1]-0)?c:l.size[1]-0),{xMax:h,yMax:p}=e.drawPosMax;Object.keys(o).forEach((t=>{const n=o[t];let i=0,r=0;if(Array.isArray(n))n.forEach(((e,o)=>{const{size:a}=e;"auto"!=a[0]&&""!=a[0]||(e.size[0]=h),"auto"!=a[1]&&""!=a[1]||(e.size[1]=p),e.size[0]=isNaN(e.size[0]-0)?c:e.size[0]-0,e.size[1]=isNaN(e.size[1]-0)?c:e.size[1]-0;let l=[0,0];"left"===t?(o&&(r+=n[o-1].size[1]),l=[0,r]):"center"===t?(i=s.size[0],o&&(r+=n[o-1].size[1]),l=[i,r]):"right"===t&&(i=s.size[0]+h,o&&(r+=n[o-1].size[1]),l=[i,r]),e.drawPos=l}));else{const{size:o}=n;"auto"!=o[0]&&""!=o[0]||(n.size[0]=h),"auto"!=o[1]&&""!=o[1]||(n.size[1]=p),n.size[0]=isNaN(n.size[0]-0)?c:n.size[0]-0,n.size[1]=isNaN(n.size[1]-0)?c:n.size[1]-0;let l=[0,0];if("center"===t)l=[s.size[0],0];else if("right"===t)l=[s.size[0]+h,0];else if("guide"===t){const t=a.layout||["Center","Bottom"],o=a.layoutOffset||[0,0],n=t[0].toLowerCase(),s=t[1].toLowerCase();"left"===n?i=0:"center"===n?i=(e.imageWidth-a.size[0])/2:"right"===n&&(i=e.imageWidth-a.size[0]),"top"===s?r=0:"center"===s?r=e.imageHeight/2:"bottom"===s&&(r=u+p),l=[i+o[0],r+o[1]]}n.drawPos=l}}));let f=[...n,...i,...r,a].filter((e=>e)),d=0;e.markerImage=[],f.forEach((o=>{const n=new Image(o.size[0],o.size[1]);n.setAttribute("crossOrigin","anonymous");const i=(0,_util__WEBPACK_IMPORTED_MODULE_2__.getResourceUrl)(e.serverFilePath+o.url);n.src=i,n.onload=()=>{if(e.markerImage.push({url1:i,img:n,...o}),d+=1,d==f.length){this.moniterPanelBGAndCanvas||(this.moniterPanelBGAndCanvas=new _MoniterPanelBGAndCanvas__WEBPACK_IMPORTED_MODULE_0__.default(e,this));const o=this.style.opacity;this.style.opacity=1,this.updateCanvas(t),this.style.opacity=o}}}))}}updateCanvas(e=!1){if(this.moniterPanelBGAndCanvas){if(1!==this.style.opacity)return;this.moniterPanelBGAndCanvas.update(e),(this.moniterPanelBGAndCanvas.isUpdate||e)&&(this.canvas=this.moniterPanelBGAndCanvas.canvas.getCanvas())}}destroy(){this.moniterPanelBGAndCanvas&&this.moniterPanelBGAndCanvas.destroy(),super.destroy()}}class P extends THING.Marker{constructor(e){super(e),this.moniterPanelElement=null}setHtmlElement(e){e.element=this.element,this.moniterPanelElement||(this.moniterPanelElement=new b(e)),this.updateHtmlElement()}updateHtmlElement(){if(this.moniterPanelElement){if(1!==this.style.opacity)return;this.moniterPanelElement.update()}}destroy(){this.moniterPanelElement&&this.moniterPanelElement.destroy(),super.destroy()}}class S extends THING.Marker{constructor(e){super(e)}refresh(){this.datapanel.refreshCanvas()}}},563:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _common_const__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(370),_DefaultParam__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(543),_util__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(891);class CanvasPanel{constructor(e){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.propertyValue={},this.userConfig=e.userConfig,this.canvasConfig=this.userConfig.canvasConfig,this.options=this.userConfig.canvasConfig.options||{},this.showHelper=this.options.showHelper||!1,this.imgsLoaded=!1,this.app=THING.App.current,this.filePath=e.serverFilePath,this.host=e.host||e.parent.host,this.marker=null}setupCanvasParam(e){let t=function(e){let t=!!e,o=!1;return t&&(o=e.show),{has:t,show:o}},o=t(e.line);this.hasLine=o.has,this.showLine=o.show;let n=t(e.guide);this.hasGuide=n.has,this.showGuide=n.show;let i=t(e.corner);this.hasCorner=i.has,this.showCorner=i.show,this.canvasConfig=e}create(e){this.userConfig=e.userConfig,this.canvasConfig=this.userConfig.canvasConfig,this.marker||(this.userConfig.type="Marker",e.userConfig.canvas=this.canvas,this.marker=_util__WEBPACK_IMPORTED_MODULE_2__.Z.createCanvasMarker(e),this.marker.canvasObj=this,this.marker.node.traverse((function(e){e._gBufferRoughness=1,e._gBufferIgnore=!0}))),this.refresh(this.userConfig),this.userConfig.lockYAxis&&!1===this.userConfig.useSpriteMaterial&&this.marker.lookAt(THING.App.current.camera,{lockYAxis:!0});let t=this.marker;if(this.userConfig.keepSize&&!t._pivotUpdate){let o=Global.guid();t.on("update",(function(){let o=e.userConfig.pivot||[.5,1];o[0]===t.pivot[0]&&o[1]===t.pivot[1]||(t.pivot=e.userConfig.pivot||[.5,1])}),o),t._pivotUpdate=!0}return this.marker}refresh(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.setupCanvasParam(this.canvasConfig),this.imgsLoaded=!1;let e=this;this._drawCanvas((function(){const t=e.marker.style.opacity;e.marker.style.opacity=1,e.marker.canvas=e.canvas,e.marker.style.opacity=t,e.marker.height=e.userConfig.height*e.canvas.height/e.canvasConfig.contents.panel_height,e.marker.width=e.marker.height*e.canvas.width/e.canvas.height}))}_calCanvasSize(){let that=this;function resTextData(e){let t=that._getValue(that.host,e),o=e.decimalDigits,n=t;if(""!==n&&(n=isNaN(Number(t))||null==o?t:that._setFixed(Number(t),o)),n=void 0===n?"":n,e.innerText=n,e.stateText){let t=e.fontColorConfig||e.fillColorConfig;for(let o=0;o<t.length;o++)if(t[o].value===n){let n=t[o].color.substring(0,7),i="ff";e.fontOpacity&&(i=(Math.floor((e.fontOpacity-0)/100*255)||255).toString(16)),e.fontColor=n+i}}let i=getTextSize(e);e.oriSize=i;let r=e.horizontalLayout===_common_const__WEBPACK_IMPORTED_MODULE_0__.Gg.CENTER?e.paddingRight+e.paddingLeft:e[`padding${that.getAbc(e.align)}`],a=e.type===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.TEXT?i[0]+r:i[0]+e.paddingLeft+e.paddingRight,s=i[1]+e.paddingBottom||0+e.paddingTop||0;return{...e,size:[a,s]}}function resData(e){if(e.align=e.align||e.horizontalLayout,(e=THING.Utils.mergeObject(that[`def_${e.type.toUpperCase()}_param`],e,!0)).type===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.TEXT)return resTextData(e);if(e.type===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.STATE_BAR){let t,o=resTextData(e),n=e.size;if(o.innerText){let i;for(let t=0;t<e.fillColorConfig.length;t++){const n=e.fillColorConfig[t];n.value===o.innerText&&(i=n.color,i.length<=7)&&(i+=(Math.floor(n.backgroundOpacity/100*255)||255).toString(16))}t=i||that._defaultStateFillColor;let r=(e.paddingRight||0)+(e.paddingLeft||0),a=(e.paddingTop||0)+(e.paddingBottom||0);n=[o.size[0]+r,o.size[1]+a]}else t=that._defaultStateFillColor,n=e.size;return e={...o,backgroundColor:t||e.backgroundColor,size:n,oriSize:o.size},e}if(e.type===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.PROGRESS_Bar){let t=that._getValue(that.host,e);e.innerText=t;let o=e.horizontalLayout===_common_const__WEBPACK_IMPORTED_MODULE_0__.Gg.CENTER?e.paddingRight+e.paddingLeft:e[e.align]||0,n=e.size[0]+o,i=e.size[1]+ +e.paddingBottom||0+e.paddingTop||0;return{...e,size:[n,i],oriSize:e.size}}{let t=e.align===_common_const__WEBPACK_IMPORTED_MODULE_0__.Hp.CENTER?e.paddingRight+e.paddingLeft:0,o=e.size[0]+t,n=e.size[1];return{...e,size:[o,n],oriSize:e.size}}}function getTextSize(e){let t=`${e.fontSize}px ${e.fontFamily}`;that.ctx.font=t;let o=that.ctx.measureText(e.innerText);return[o.width,o.fontBoundingBoxAscent+o.fontBoundingBoxDescent]}let contents={..._DefaultParam__WEBPACK_IMPORTED_MODULE_1__.ic,...this.canvasConfig.contents},line={..._DefaultParam__WEBPACK_IMPORTED_MODULE_1__.D9,...this.canvasConfig.line},guide={..._DefaultParam__WEBPACK_IMPORTED_MODULE_1__.O3,...this.canvasConfig.guide},corner={..._DefaultParam__WEBPACK_IMPORTED_MODULE_1__.R5,...this.canvasConfig.corner};this.hasLine&&(this.linePos=guide.layout[0],line.p0=[0,0],line.p1=[0,0]);let rows=contents.rows;contents.titleWidth=0,contents.width=0,contents.height=0,contents._part_width_={left:0,right:0,center:0},contents.rowCount=Object.keys(rows).length;for(let key in rows){let row=rows[key];row._cols_={left:[],right:[],center:[]};let _leftSize=[0,0],_centerSize=[0,0],_rightSize=[0,0];for(let i=0;i<row.length;i++){const _data_=resData(row[i]);let horLayout=_data_.horizontalLayout,rowType=_data_.rowType;rowType!==_common_const__WEBPACK_IMPORTED_MODULE_0__.aC.TITLE?_data_.autoWidth||(eval(`_${horLayout}Size`)[0]+=_data_.size[0]):contents.titleWidth+=_data_.size[0],eval(`_${horLayout}Size`)[1]=this._getMaxNumber(eval(`_${horLayout}Size`)[1],_data_.size[1]+_data_.lineSpacing),_data_.row=row,row._cols_[horLayout].push(_data_)}contents._part_width_.left=this._getMaxNumber(contents._part_width_.left,_leftSize[0]),contents._part_width_.right=this._getMaxNumber(contents._part_width_.right,_rightSize[0]),contents._part_width_.center=this._getMaxNumber(contents._part_width_.center,_centerSize[0]),row.y=contents.height,row.lineHeight=this._getMaxNumber(_leftSize[1],_centerSize[1],_rightSize[1]),row.leftSize=[_leftSize[0],row.lineHeight],row.rightSize=[_rightSize[0],row.lineHeight],row.centerSize=[_centerSize[0],row.lineHeight],contents.height+=row.lineHeight,rows[key]=row}let c_width=contents._part_width_.left+contents._part_width_.right+contents._part_width_.center,imgMinWidth=contents.backgroundImage.minWidth||0;contents.oriWidth=this._getMaxNumber(c_width,contents.titleWidth,imgMinWidth),contents.oriHeight=contents.height,contents.width=contents.oriWidth+contents.paddingLeft+contents.paddingRight,contents.height=contents.oriHeight+contents.paddingTop+contents.paddingBottom;let bgImg=contents.backgroundImage,imgWidth=bgImg.left_width+bgImg.right_width,imgHeight=bgImg.top_height+bgImg.bottom_height;if(contents.panel_width=contents.width<imgWidth?imgWidth:contents.width,contents.panel_height=contents.height<imgHeight?imgHeight:contents.height,this.hasLine&&(line._panel_x=0,line._panel_y=contents.panel_height,this.showLine)){let e=contents.pivot;this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?line._panel_x=e[0]*contents.panel_width:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.RIGHT?line._panel_x=(1-e[0])*contents.panel_width:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER&&(line._panel_x=0),line._panel_y=(1-e[1])*contents.panel_height}if(this.canvasConfig.contents=contents,this.hasCorner){line._corner_x=0,line._corner_y=corner.size[1];let horLayout=corner.layout[0],verLayout=corner.layout[1];if(this.hasLine&&this.showLine){let e=corner.pivot;this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?line._corner_x=e[0]*corner.size[0]:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.RIGHT?line._corner_x=(1-e[0])*corner.size[0]:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER&&(line._corner_x=0),line._corner_y=e[1]*corner.size[1]}if(horLayout!==_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER){let _off=horLayout===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?"Right":"Left";corner.marginX=eval(`corner.margin${_off}`)+corner.size[0]}else corner.marginX=0;verLayout===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.BOTTOM?corner.marginY=corner.marginTop+corner.size[1]:corner.marginY=0,this.canvasConfig.corner=corner}if(this.hasGuide){line._guide_x=0,line._guide_y=guide.size[1];let horLayout=guide.layout[0],verLayout=guide.layout[1];if(this.hasLine&&this.showLine){let e=guide.pivot;this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?line._guide_x=(1-e[0])*guide.size[0]:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.RIGHT?line._guide_x=e[0]*guide.size[0]:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER&&(line._guide_x=0),line._guide_y=e[1]*guide.size[1]}if(horLayout!==_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER){let _off=horLayout===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?"Right":"Left";guide.marginX=eval(`guide.margin${_off}`)+guide.size[0]}else guide.marginX=0;verLayout===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.BOTTOM?guide.marginY=guide.marginTop+guide.size[1]:guide.marginY=0,this.canvasConfig.guide=guide}let lineWidth=0,lineHeight=0;this.hasLine&&(this.showLine&&(lineWidth=Math.floor((line.length||200)*Math.cos(Math.PI*(line.angle||45)/180)),lineHeight=Math.floor((line.length||200)*Math.sin(Math.PI*(line.angle||45)/180)),line.oriSize=[lineWidth,lineHeight],this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER?lineWidth=0:lineWidth-=line._corner_x+line._guide_x,lineHeight-=line._corner_y+line._guide_y,line.size=[this._getMaxNumber(0,lineWidth),this._getMaxNumber(0,lineHeight)]),this.canvasConfig.line=line),this.canvas.width=contents.panel_width+(this.hasGuide?guide.marginX:0)+(this.hasLine?line.size[0]:0)+(this.hasCorner&&corner.marginX||0),this.canvas.height=contents.panel_height+(this.hasGuide?guide.marginY:0)+(this.hasLine?line.size[1]:0)+(this.hasCorner&&corner.marginY||0);let guideLayout=guide.layout;if(this.hasGuide&&(guideLayout[0]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?guide.x=0:guideLayout[0]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.RIGHT?guide.x=this.canvas.width-guide.size[0]:guideLayout[0]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER&&(guide.x=(this.canvas.width-guide.size[0])/2),guideLayout[1]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.TOP?guide.y=0:guideLayout[1]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.BOTTOM?guide.y=this.canvas.height-guide.size[1]:guideLayout[1]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER&&(guide.y=(this.canvas.height-guide.size[1])/2)),corner.x=0,corner.y=0,this.hasCorner&&(corner.layout[0]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?corner.x=guide.x+(guide.marginX||0)+line.size[0]:corner.layout[0]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.RIGHT?corner.x=guide.x-line.size[0]-(corner.marginX||0):corner.x=(contents.panel_width-corner.size[0])/2,corner.layout[1]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.TOP?corner.y=0:corner.layout[1]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.BOTTOM&&(corner.y=contents.panel_height+(corner.marginTop||0))),this.hasLine){line.p0=[0,0],this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?line.p0[0]=guide.x+guide.size[0]-line._guide_x:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.RIGHT&&(line.p0[0]=guide.x+line._guide_x),line.p0[1]=guide.y+line._guide_y;let e=0,t=0;this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT?e=line.p0[0]+line.oriSize[0]:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.RIGHT?e=line.p0[0]-line.oriSize[0]:this.linePos===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.CENTER&&(e=line.p0[0]),t=line.p0[1]-line.oriSize[1],line.p1=[e,t]}contents.x=0,contents.y=0,this.hasGuide&&(guideLayout[0]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.LEFT&&(contents.x=guide.marginX||0,this.hasCorner&&(contents.x+=corner.marginX||0),contents.x+=lineWidth),guideLayout[1]===_common_const__WEBPACK_IMPORTED_MODULE_0__.Ar.TOP&&(contents.y=(guide.marginY||0)+(corner.marginY||0),contents.y+=lineHeight))}_handleBGImg(){let e={..._DefaultParam__WEBPACK_IMPORTED_MODULE_1__.ic.backgroundImage,...this.canvasConfig.contents.backgroundImage};e.imgs=[],this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e._imgData,0,0,e.width,e.height);let t=this.ctx.getImageData(0,0,e.width,1),o=this.ctx.getImageData(0,0,1,e.height),n=[],i=[];for(let e=0;e<t.data.length;e+=4){let o=t.data[e];n[0]||0===o||(n[0]=e/4),n[0]&&!n[1]&&e>4*n[0]&&0===o&&(n[1]=e/4)}for(let e=0;e<o.data.length;e+=4){let t=o.data[e];i[0]||0===t||(i[0]=e/4),i[0]&&!i[1]&&e>4*i[0]&&0===t&&(i[1]=e/4)}let r=n[0]-e.markPixel,a=n[1]-n[0],s=e.width-n[1],l=i[0]-e.markPixel,c=i[1]-i[0],u=e.height-i[1];for(let t=1;t<=9;t++){let o={},h=t%3;1===h?(o.x=e.markPixel,o.width=r):2===h?(o.x=n[0],o.width=a):0===h&&(o.x=n[1],o.width=s);let p=Math.floor((t-1)/3);0===p?(o.y=e.markPixel,o.height=l):1===p?(o.y=i[0],o.height=c):2===p&&(o.y=i[1],o.height=u),o.data=this.ctx.getImageData(o.x,o.y,o.width,o.height),e.imgs.push(o)}e.left_width=r,e.right_width=s,e.top_height=l,e.bottom_height=u,this.canvasConfig.contents.backgroundImage=e}_loadImgs(e){let t=this.canvasConfig.guide||{},o=this.canvasConfig.contents.backgroundImage||{},n=this.canvasConfig.corner||{},i=this;function r(e){return["url","image","wallImage","lineImage","alphaImage"].forEach((t=>{let o=e[t];o&&(o.startsWith("/")&&(o=o.substr(1)),o=!o.includes("http")&&o.indexOf(i.filePath)<0?a(i.filePath+o):a(o),e[t]=function(e){if(void 0===e||null==e)return e;let t=0,o="";for(e.startsWith("http")&&(t=e.indexOf("//")+2,o=e.slice(0,t));t<e.length;t+=1)o[o.length-1]+e[t]!=="//"&&(o+=e[t]);return o}(o))})),e}function a(e){let t=_util__WEBPACK_IMPORTED_MODULE_2__.Z.rsmPath,o=e.trim();return e.includes("http")||0===e.indexOf("./")||0===e.indexOf("/")||(t.endsWith("/")||(t+="/"),o=t+e),o}if(t.url){if(!t._imgData){let e=new Image;e.crossOrigin="Anonymous",e.src=r(t).url,e.onload=function(){t._imgData=e,t.width=e.width,t.height=e.height,t.imgCompleted=!0}}}else t.imgCompleted=!0;if(n.url){if(!n._imgData){let e=new Image;e.crossOrigin="Anonymous",e.src=r(n).url,e.onload=function(){n._imgData=e,n.width=e.width,n.height=e.height,n.imgCompleted=!0}}}else n.imgCompleted=!0;if(o.url){if(!o._imgData){let e=new Image;e.crossOrigin="Anonymous",e.src=r(o).url,e.onload=function(){o._imgData=e,o.width=e.width,o.height=e.height,o.imgCompleted=!0}}}else o.imgCompleted=!0;let s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}));this.marker.tags||(this.marker.tags=[]),this.marker.tags.push(s),this.app.on("update",(function(){i.imgsLoaded||t.imgCompleted&&o.imgCompleted&&n.imgCompleted&&(i.imgsLoaded=!0,i._drawCanvas(e),i.app.off("update","",s))}),s)}_drawCanvas(e){if(this.imgsLoaded){let o=this;this.canvasConfig=this.userConfig.canvasConfig,this._handleBGImg(),this._calCanvasSize();let n=this.canvasConfig.guide||{};this.showGuide&&(n.draw=function(){o.ctx.drawImage(n._imgData,n.x,n.y,n.width,n.height)});let i=this.canvasConfig.corner||{};this.showCorner&&(i.draw=function(){o.ctx.drawImage(i._imgData,i.x,i.y,i.width,i.height)});let r=this.canvasConfig.contents.backgroundImage,a=r.imgs;r.draw=function(){for(let e=0;e<a.length;e++){let n=a[e],i=e%3,s=Math.floor(e/3);if(1===i){if(n.width=Math.floor(o.canvasConfig.contents.panel_width-a[0].width-a[2].width),n.width<=0)continue;n.data=t(o.ctx,n.data,n.width,n.height,_common_const__WEBPACK_IMPORTED_MODULE_0__.bF.Horizontal),n.x=a[0].width}else 2===i&&(n.x=Math.floor(o.canvasConfig.contents.panel_width-a[2].width));if(1===s){if(n.height=Math.floor(o.canvasConfig.contents.panel_height-a[0].height-a[6].height),n.height<=0)continue;n.data=t(o.ctx,n.data,n.width,n.height,_common_const__WEBPACK_IMPORTED_MODULE_0__.bF.Vertical),n.y=(o.guideMarginY||0)+a[0].height}else 2===s&&(n.y=Math.floor(o.canvasConfig.contents.panel_height-a[6].height));n.x-=r.markPixel,n.y-=r.markPixel,n.x+=o.canvasConfig.contents.x,n.y+=o.canvasConfig.contents.y,o.ctx.putImageData(n.data,n.x,n.y),o.showHelper&&(o.ctx.beginPath(),o.ctx.lineWidth=1,o.ctx.strokeStyle="yellow",o.ctx.rect(n.x,n.y,n.data.width,n.data.height),o.ctx.stroke())}o._fillDatas()};let s=this.canvasConfig.line||{};this.showLine&&(s.draw=function(){o.showLine&&(o.ctx.strokeStyle=s.color||"#ff0000",o.ctx.lineWidth=s.width||2,o.ctx.moveTo(s.p0[0],s.p0[1]),o.ctx.lineTo(s.p1[0],s.p1[1]),o.ctx.stroke())});let l=[n,r,s,i];!function(e,t){for(let o=0;o<e.length-1;o++)for(let n=0;n<e.length-1-o;n++)if(e[n]&&e[n+1]&&e[n][t]>e[n+1][t]){let t=e[n];e[n]=e[n+1],e[n+1]=t}}(l,"zIndex");for(let e=0;e<l.length;e++){const t=l[e];t.draw&&t.draw()}"function"==typeof e&&e()}else this._loadImgs(e);function t(e,t,o,n,i){1==(o=Math.floor(o))&&(o=2),1==(n=Math.floor(n))&&(n=2);let r=e.createImageData(o,n);if(i===_common_const__WEBPACK_IMPORTED_MODULE_0__.bF.Horizontal){let e,i,a=0,s=0;for(let l=0;l<n;l++){s=l*t.width*4,a=4*(l*t.width+t.width-1),e=[t.data[s],t.data[s+1],t.data[s+2],t.data[s+3]],i=[t.data[a],t.data[a+1],t.data[a+2],t.data[a+3]];let n=_common_const__WEBPACK_IMPORTED_MODULE_0__.Ob.gradientColors(e,i,o,1);for(let e=0;e<o;e++){let t=4*(l*o+e);r.data[t]=n[e][0],r.data[t+1]=n[e][1],r.data[t+2]=n[e][2],r.data[t+3]=n[e][3]}}}else if(i===_common_const__WEBPACK_IMPORTED_MODULE_0__.bF.Vertical)for(let e=0;e<o;e++){let i,a,s=0,l=0;l=4*e,s=4*((t.height-1)*t.width+e),i=[t.data[l],t.data[l+1],t.data[l+2],t.data[l+3]],a=[t.data[s],t.data[s+1],t.data[s+2],t.data[s+3]];let c=_common_const__WEBPACK_IMPORTED_MODULE_0__.Ob.gradientColors(i,a,n,1);for(let t=0;t<n;t++){let n=4*(t*o+e);r.data[n]=c[t][0],r.data[n+1]=c[t][1],r.data[n+2]=c[t][2],r.data[n+3]=c[t][3]}}return r}}_fillDatas(){let contents=this.canvasConfig.contents;var orderedText=function(e){for(let o in e){let n=e[o];if(0!==n.length){let e="right"!==o;n.sort(t("order",e))}else delete e[o];e[o]=n}function t(e,t){return t=void 0===t||t?1:-1,function(o,n){return o[e]<n[e]?-1*t:1*t}}return e};for(let key in contents.rows){let row=contents.rows[key],_x_={left_x:contents.paddingLeft,right_x:contents.panel_width-contents.paddingRight,center_x:contents._part_width_.left+contents.paddingLeft};row._cols_=orderedText(row._cols_);for(let part in row._cols_){let col=row._cols_[part],startX=_x_[`${part}_x`];for(let i=0;i<col.length;i++){const data=col[i];if(part===_common_const__WEBPACK_IMPORTED_MODULE_0__.Gg.CENTER){let e=data.align||"center";e===_common_const__WEBPACK_IMPORTED_MODULE_0__.Hp.CENTER?data.x=startX:e===_common_const__WEBPACK_IMPORTED_MODULE_0__.Hp.LEFT?data.x=startX+data.paddingLeft:e===_common_const__WEBPACK_IMPORTED_MODULE_0__.Hp.RIGHT&&(data.x=startX+data.size[0])}else{data.align=part;let _part_=this.getAbc(part),_flagNum=1;_flagNum=part===_common_const__WEBPACK_IMPORTED_MODULE_0__.Gg.LEFT?1:-1,data.x=startX+_flagNum*eval(`data.padding${_part_}`),startX+=_flagNum*data.size[0]}data.y=row.y+(row.lineHeight-data.oriSize[1])/2+data.lineSpacing/2+(data.paddingTop||0)+contents.paddingTop,data.autoWidth&&(data.oriSize[0]=contents.panel_width-contents.paddingLeft-contents.paddingRight,data.x=_x_.left_x,data.size=data.oriSize,data.align=_common_const__WEBPACK_IMPORTED_MODULE_0__.Hp.LEFT),data.x+=this.canvasConfig.contents.x,data.y+=this.canvasConfig.contents.y,this._fillData(data)}}}}_fillData(e){let t=this,o=e.type;if(o===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.TEXT)n(e);else if(o===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.PROGRESS_Bar){i(e);let t=e.size[0];if(e.max=e.progressColor.max||100,e.min=e.progressColor.min||0,Number(e.innerText)>=e.min&&Number(e.innerText)<=e.max){let o=(Number(e.innerText)-e.min)/(e.max-e.min)*t;e.progressWidth=o;let n,r=e.progressColor.steps||e.progressColor.conditionOptions;for(let t=0;t<r.length;t++){let o=r[t].color,i=r[t].condition||"<",a=r[t].value||r[t].ratio;if("<"===i){if(Number(e.innerText)<a){n=o;break}}else if("<="===i){if(Number(e.innerText)<=a){n=o;break}}else if((!i||"="===i)&&Number(e.innerText)===a){n=o;break}}e.fillColor=n||"#ffffff",i(e,e.progressColor.gradient,!0)}}else if(o===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.STATE_BAR){if(!e.innerText)return;i(e),n(e)}function n(e){t.showHelper&&(t.ctx.strokeStyle="blue",t.ctx.moveTo(0,e.y),t.ctx.lineTo(1e3,e.y),t.ctx.stroke()),t.ctx.textBaseline="top",t.ctx.textAlign=e.align;let o=e.x,n=e.y;var i;e.type===_common_const__WEBPACK_IMPORTED_MODULE_0__.g.STATE_BAR&&(t.ctx.textAlign="center",t.ctx.textBaseline="top",o+=e.oriSize[0]/2,n+=e.paddingTop||0+(i=e.innerText,t.ctx.font="10px Arail",t.ctx.measureText(i).actualBoundingBoxAscent));let r=`${e.fontSize}px ${e.fontFamily}`;t.ctx.font=r,t.ctx.fillStyle=e.fontColor,t.ctx.shadowBlur=e.shadowBlur||0,t.ctx.shadowColor=e.shadowColor||"#000000",t.ctx.fillText(e.innerText,o,n)}function i(e,o=!1,n=!1){let i=e.oriSize[0]||0,r=e.oriSize[1]||0;if(n?(i=e.progressWidth||0,r=1.1*e.oriSize[1],e.y-=.1*e.oriSize[1]*.5):e.align&&(e.align===_common_const__WEBPACK_IMPORTED_MODULE_0__.Hp.CENTER?(e.x-=e.oriSize[0]/2,e.x+=e.paddingLeft||0):e.align===_common_const__WEBPACK_IMPORTED_MODULE_0__.Hp.RIGHT&&(e.x-=e.oriSize[0])),t.ctx.save(),t.ctx.translate(e.x,e.y),function(e,t,o,n){let i=t<o?t:o;2*n>i&&(n=i/2),e.beginPath(0),e.arc(t-n,o-n,n,0,Math.PI/2),e.lineTo(n,o),e.arc(n,o-n,n,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,o-n),e.closePath()}(t.ctx,i,r,e.roundRectRadius),e.showBorder){let o=e.borderColor;o||(o=e.backgroundColor.substring(0,7));let n="ff";e.borderOpacity&&(n=Math.floor((e.borderOpacity-0)/100*255).toString(16)),t.ctx.strokeStyle=o+n,t.ctx.lineWidth=e.borderWidth||0,t.ctx.stroke()}if(o){var a=t.ctx.createLinearGradient(0,0,i,0);let o=e.progressColor.stopColors,n=e.fillColor||e.progressColor.stopColors[0]||"#ffffff";if(o)for(let t=0;t<o.length;t++){let n=o[t],i=n.color||e.backgroundColor;i=i.substring(0,7);let r=Math.floor(255*n.opacity).toString(16);a.addColorStop(n.stop,i+r)}else if("object"==typeof n){let{values:e,intervals:t}=n;for(let o=0;o<e.length;o++)a.addColorStop(t[o],e[o])}else a.addColorStop(0,t.hexify(n)+"00"),a.addColorStop(1,t.hexify(n)+"ff");t.ctx.fillStyle=a}else t.ctx.fillStyle=n?e.fillColor||"#16181acc":e.backgroundColor||"#16181acc";t.ctx.fill(),t.ctx.restore()}}destroy(){this.canvas=null,super.destroy()}hexify(e){if(e.indexOf("rgb")>-1){var t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),o=parseFloat(t[3]||1),n=Math.floor(o*parseInt(t[0])+255*(1-o)),i=Math.floor(o*parseInt(t[1])+255*(1-o)),r=Math.floor(o*parseInt(t[2])+255*(1-o));return"#"+("0"+n.toString(16)).slice(-2)+("0"+i.toString(16)).slice(-2)+("0"+r.toString(16)).slice(-2)}return e.indexOf("rgb")<0&&e.length>7?e.slice(0,7):e}getAbc(e){return e.toLowerCase().replace(/( |^)[a-z]/g,(e=>e.toUpperCase()))}_getValue(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;let n="";return o&&(n=e.getAttribute(o),void 0!==t.toFixed&&Number(n)&&(n=setFixed(Number(n),t.toFixed)),this.propertyValue[o]=n),n}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):null}_setFixed(e,t){return e=parseFloat(e),(Math.round(((e+Number.EPSILON)*Math.pow(10,t)).toFixed(t))/Math.pow(10,t)).toFixed(t)}_getMaxNumber(e,t,o=0){let n=e-t>=0?e:t;return o&&(n=this._getMaxNumber(n,o)),n}get def_TEXT_param(){return JSON.parse(JSON.stringify(_DefaultParam__WEBPACK_IMPORTED_MODULE_1__.hR))}get def_BLOCK_param(){return JSON.parse(JSON.stringify(_DefaultParam__WEBPACK_IMPORTED_MODULE_1__.f_))}get def_STATEBAR_param(){return JSON.parse(JSON.stringify(_DefaultParam__WEBPACK_IMPORTED_MODULE_1__.nT))}get def_PROGRESSBAR_param(){return JSON.parse(JSON.stringify(_DefaultParam__WEBPACK_IMPORTED_MODULE_1__.sL))}}const __WEBPACK_DEFAULT_EXPORT__=CanvasPanel},635:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});var n=o(891),i=o(354);const r=class{constructor(e){this.param=e,this.userConfig=e.userConfig,this.parent=e.parent,this.hostObj=this.parent.host||this.parent,this.app=THING.App.current}create(){let e,t,o=this;if(THING.Math.getDistance([0,0,0],this.parent.position)>3e4)this.param.userConfig.pointsData.hasOwnProperty("getMethod")?void 0!==this.getValue(this.hostObj,this.param.userConfig.pointsData)&&(e=JSON.parse(this.getValue(this.hostObj,this.param.userConfig.pointsData))):e=this.hostObj.getAttribute("geojson");else{let e=this.getValue(this.hostObj,this.param.userConfig.pointsData);t=e?JSON.parse(e):[[0,0,0],[0,1,0]]}let r=this.hostObj.startLonlat,a=this.hostObj.endLonlat;if(r&&a){const e=this.param.parent,t=e.host||e,{userConfig:o}=this.param,{tag:s}=this.param,{effectName:l}=this.param,{serverFilePath:c}=this.param;o.serverFilePath=c,o.type="image",n.Z.parseUrl(o);let u={id:`${s}_${l}_${e.id}`,opacity:1,serverFilePath:c,complete(){}};o&&(u=i.Z.combine(u,o,!0));let h,p=[r,a],f=n.Z.getLinePointList(u,p),d={type:"image",lineType:"Plane",imageUrl:u.image,speed:u.speed||0,effect:u.effect||!1,width:u.width||1,blending:u.blending,useColor:u.useColor||!0,uvRatio:u.uvRatio||[1,1],textureWrap:"stretch",color:u.color||"#ff9999",opcaity:u.opacity||1,growSpeed:u.growSpeed,growLoop:u.growLoop};if("FlyLine"==o.lineType?(h=this.app.create({type:"GeoFlyLine",name:"GeoFlyLine1",id:`${u.id}_GEOODLINE`,coordinates:p,heightArray:[this.hostObj.startElevation,this.hostObj.endElevation],offsetHeight:u.offsetHeight,renderer:d,inheritVisible:!0,userData:u.userData,complete:u.complete}),h.scale=[1,u.curvature||1,1]):h=this.app.create({type:"GeoLine",name:"GeoLine1",id:`${u.id}_GEOODLINE`,coordinates:f[0],heightArray:[this.hostObj.startElevation,this.hostObj.endElevation],offsetHeight:u.offsetHeight,renderer:d,inheritVisible:!0,userData:u.userData,complete:u.complete}),h._setPostRadiusEffect(u.postRadialBlur),u.growSpeed){const e=u.growSpeed-0,t=u.growLoop;h._playLineGrow({speed:e,growLoop:t})}return h.host=t,h}if(e&&!Array.isArray(e)){if("Polygon"==this.userConfig.lineType){const t=this.param.parent,{userConfig:o}=this.param,{tag:n}=this.param,{effectName:r}=this.param,{serverFilePath:a}=this.param;o.serverFilePath=a;let s={id:`${n}_${r}_${t.id}`,opacity:1,serverFilePath:a,complete(){}};return o&&(s=i.Z.combine(s,o,!0)),this.createEarthPolygon(s,e)}if("Boundary"==this.userConfig.lineType){const t=this.param.parent,{userConfig:n}=(t.host,this.param),{tag:r}=this.param,{effectName:a}=this.param,{serverFilePath:s}=this.param;n.serverFilePath=s;let l,c={id:`${r}_${a}_${t.id}`,opacity:1,serverFilePath:s,complete(){}};n&&(c=i.Z.combine(c,n,!0));let u=this.getData(e);return l=this.createEarthBoundary(c,u),l.lineObj=o,l}if("PipeLine"==this.userConfig.lineType){const t=this.param.parent,{userConfig:o}=(t.host,this.param),{serverFilePath:n}=this.param,{tag:r}=this.param,{effectName:a}=this.param;let s,l=this,c={id:`${r}_${a}_${t.id}`,opacity:1,serverFilePath:n,complete(){}};o&&(c=i.Z.combine(c,o,!0));let u=this.getData(e);return s=this.createEarthPipeLine(c,u),s.lineObj=l,s}{const t=this.param.parent,o=t.host||t,{userConfig:n}=this.param,{tag:r}=this.param,{effectName:a}=this.param,{serverFilePath:s}=this.param;let l;n.serverFilePath=s,n.type="image";let c={id:`${r}_${a}_${t.id}`,opacity:1,serverFilePath:s,complete(){}};n&&(c=i.Z.combine(c,n,!0));let u=this.getData(e);l=this.createEarthLine(c,u);let h=this;return l.lineObj=h,l.host=o,l}}if(t){if(!Array.isArray(t[0])){const t=this.param.parent,o=t.host||t,{userConfig:n}=this.param,{tag:r}=this.param,{effectName:a}=this.param,{serverFilePath:s}=this.param;let l;n.serverFilePath=s,n.type="image";let c={id:`${r}_${a}_${t.id}`,opacity:1,serverFilePath:s,complete(){}};n&&(c=i.Z.combine(c,n,!0));const{features:u}=e;if(u.length>1){let e=[];for(let t=0;t<u.length;t++)u[t].geometry.coordinates[0]instanceof Array?u[t].geometry.coordinates.forEach((t=>{e.push(t)})):e.push(u[t].geometry.coordinates);l=this.createEarthLine(c,e)}else{let{coordinates:e}=u[0].geometry;l=this.createEarthLine(c,e[0])}return l.lineObj=this,l.host=o,l}{const e=this.param.parent,i=e.host||e,{userConfig:r}=this.param,{serverFilePath:a}=this.param;if(r.serverFilePath=a,r.type=r.type||"image",n.Z.parseUrl(r),"CampusDoubleLine"==this.userConfig.lineType){let e,a,s,l,c=[],u=[];if(c=n.Z.generateDoublelines(t,{gap:r.offsetFactor,up:i.up}),this.userConfig.points=c[0],this.userConfig.color=r.lineOneColor,this.userConfig.speed=r.lineOneSpeed-0,l=n.Z.getCampusLineStyle(r),e=this.createCampusLine(r,c[0],l),e.lineObj=o,this.points=c[1],this.userConfig.color=r.lineTwoColor,this.userConfig.speed=r.lineTwoSpeed-0,l=n.Z.getCampusLineStyle(r),a=this.createCampusLine(r,c[1],l),a.lineObj=o,r.xUnit>0){s=e.length/(r.xUnit-0),s<1?s=1:s>r.maxRepeatFactor&&(s=r.maxRepeatFactor);let t=e.width/e.length*s;e.imageRepeat=[t,1],a.imageRepeat=[t,1]}return u.push(e),u.push(a),u}if("Polygon"==this.userConfig.lineType){const e=THING.App.current,{userConfig:i}=this.param,{serverFilePath:r}=this.param,{inheritStyle:a}=i;let s;i.serverFilePath=r,n.Z.parseUrl(i);const{color:l}=i;let{opacity:c}=i;void 0===c&&(c=1);let u=i.outlineColor;void 0===u&&(u=null),s={color:l,regionColor:l,regionOpacity:c-0,lineColor:u,image:i.image,lineOpacity:i.outlineOpacity||1,alwaysOnTop:i.alwaysOnTop||!1},s.glow=i.effect,i.style&&(s=Object.assign(s,i.style));const h=e.create({type:"Shape",points:t,height:i.height,inheritStyle:a,color:l,inheritPosition:i.inheritPosition||!1,style:s,complete:function(){i.complete&&i.complete(),this.style.image="",this.style.image=s.image}});if(h.setOpacity(c),i.image){let e=h.node.getMaterials()[0];e.map.wrapS=THREE.RepeatWrapping,e.map.wrapT=THREE.RepeatWrapping,e.map.repeat.set(i.imageDensity||1/h.boundingBox.size[0],i.imageDensity||1/h.boundingBox.size[2]),h.node.getMaterials()[0]=e}let p=h.node.getMaterials()[1];if(i.wallImage){let e=(new THREE.TextureLoader).load(i.wallImage);p.map=e}else p.map=null;let f=[];0!==i.height?h._vertices.forEach((e=>{e[1]=e[1]+i.height,f.push(e)})):f=h._vertices,f.push(f[0]);let d=THING.App.current.create({type:"Line",color:u||l,points:f,inheritStyle:!1,inheritPosition:i.inheritPosition||!1,style:{opacity:s.lineOpacity}});return h.add(d),i.offsetHeight&&(h.localPosition=[h.localPosition[0],h.localPosition[1]+i.offsetHeight,h.localPosition[2]]),h.lineObj=o,h}if("PipeLine"==this.userConfig.lineType){let e;return e=this.createPipeLine(t,this.userConfig),e.lineObj=o,e}if("Boundary"==this.userConfig.lineType){let e;return e=this.createCampusBoundary(this.userConfig,t),e.lineObj=o,e}if("DoublePipeLine"==this.userConfig.lineType){let e,n,i=[];return this.userConfig.width=this.userConfig.lineOneWidth,this.userConfig.color=this.userConfig.lineOneColor,this.userConfig.speed=this.userConfig.lineOneSpeed,e=this.createPipeLine(t,this.userConfig),e.lineObj=o,this.userConfig.width=this.userConfig.lineTwoWidth,this.userConfig.color=this.userConfig.lineTwoColor,this.userConfig.speed=this.userConfig.lineTwoSpeed,n=this.createPipeLine(t,this.userConfig),n.lineObj=o,i.push(e),i.push(n),i}if("FlyLine"!=this.userConfig.lineType){let e,i=n.Z.getCampusLineStyle(r);return e=this.createCampusLine(r,t,i),e.lineObj=o,e}{let e=t;if(2==e.length){const t=this.userConfig.curvature,i=n.Z.getCampusGeoPoints(e[0],e[1],t,100);let a,s=n.Z.getCampusLineStyle(r);return a=this.createCampusLine(r,i,s),a.lineObj=o,a}console.error("æ°æ®æ ¼å¼ä¸æ­£ç¡®")}}}}refresh(e){this.parent?e?(this.parent.children[e].children.forEach((e=>{e.destroy()})),"CampusDoubleLine"==this.userConfig.lineType||"DoublePipeLine"==this.userConfig.lineType?this.create(this.param).forEach((t=>{this.parent.children[e].add(t)})):this.parent.children[e].add(this.create(this.param))):(this.parent.children[0].children.forEach((e=>{e.destroy()})),"CampusDoubleLine"==this.userConfig.lineType||"DoublePipeLine"==this.userConfig.lineType?this.create(this.param).forEach((e=>{this.parent.children[0].add(e)})):this.parent.children[0].add(this.create(this.param))):this.parent.children[0].add(this.create(this.param))}createEarthLine(e,t){n.Z.parseUrl(e);let o={type:"image",lineType:"Plane",imageUrl:e.image,speed:e.speed||0,effect:e.effect||!1,width:e.width||1,blending:e.blending,useColor:e.useColor||!0,uvRatio:e.uvRatio||[1,1],textureWrap:"stretch",color:"#ff9999",opcaity:e.opacity||1,growSpeed:e.growSpeed,growLoop:e.growLoop},i=n.Z.getLinePointList(e,t);return THING.App.current.create({type:"GeoLine",id:`${e.id}_GEOODLINE`,coordinates:i[0],offsetHeight:e.offsetHeight,renderer:o,inheritVisible:!0,userData:e.userData,complete:e.complete})}createEarthPolygon(e,t){const o=this.parent,i=THING.App.current.create({type:"BaseObject",id:e.id,parent:o,style:{opacity:e.opacity,color:e.color}});n.Z.parseUrl(e),this.setRandomOpacity(e);let r=[];t.hasOwnProperty("geometry")&&r.push(t);const a=t.hasOwnProperty("geometry")?r:t.features||[];for(let t=0;t<a.length;t+=1){let o=a[t];const{geometry:n}=o;let r={type:"FeatureCollection",features:[]};o.hasOwnProperty("features")&&!o.hasOwnProperty("geometry")||(r.features.push(o),o=r);const{coordinates:s}=n,l=this.getUVRatio(s,e.imageDensity);if(e.image){let t={type:"image",imageUrl:e.image||[0,255,0],opacity:e.opacity||.8,textureWrap:e.textureWrap||"stretch",textureSize:e.textureSize,outlineColor:e.outlineColor||[255,255,0],outlineWidth:e.outlineWidth||2,lights:!1,uvRatio:l},n=this.app.create({type:"FeatureLayer",name:"å¤è¾¹å½¢_çº¯è²",geometryType:"GeoPolygon",dataSource:o,offsetHeight:e.offsetHeight||0,extrudeHeight:e.height||100,renderer:t}),r=this;n.lineObj=r,i.add(n)}else{let t={type:"vector",color:e.color||[0,255,0],opacity:e.opacity-0||.8,outlineColor:e.outlineColor||[255,255,0],outlineWidth:e.outlineWidth||2,lights:!1},n=this.app.create({type:"FeatureLayer",name:"å¤è¾¹å½¢_çº¯è²",geometryType:"GeoPolygon",offsetHeight:e.offsetHeight||0,dataSource:o,extrudeHeight:e.height||100,renderer:t,inheritVisible:e.inheritVisible,inheritStyle:e.inheritStyle,userData:e.userData,complete:e.complete}),r=this;n.lineObj=r,i.add(n)}}return i}setRandomOpacity(e){let t=e.opacity;if("number"!=typeof t){let e=t[0],o=t[1];o>1&&(e/=100,o/=100),t=Math.round(100*(Math.random()*(o-e)+e))/100}t>1&&(t/=100),e.opacity=t.toFixed(2)-0}createEarthBoundary(e,t){n.Z.parseUrl(e);let o={color:e.style.color||[0,255,0],opacity:e.color||.7,imageUrl:e.wallImage||"./uGeo/building_top.png",blending:e.blending||!0,alphaImageUrl:e.alphaImage||"./uGeo/uvMap/uvMap20.png",speed:e.scrollSpeed||[0,1],alphaSpeed:e.alphaSpeed||[1,0],useColor:e.useColor||!0};const i=THING.App.current.create({type:"GeoBoundary",name:"å´æ ",coordinates:t,renderer:o,extrudeHeight:e.extrudeHeight||100,offsetHeight:e.offsetHeight||100});return n.Z.ModifyMaterial(i,e.blending),i}createCampusBoundary(e,t){const{parent:o}=this.param;let i=o.parent;const r=THING.App.current.create({type:"BaseObject",id:e.id,parent:o,inheritScale:!1,inheritStyle:!1});r.isBoundary=!0;let a=[];r.inheritScale=!1;for(let e=0;e<t.length;e++){let o=r.worldToSelf(t[e]);a.push(o)}const s=void 0===e.type?"vertical":e.type;if(e.autoClose&&t.length>2){let e=t[0],o=t[t.length-1];THING.Math.getDistance(e,o)>.001&&t.push(e)}e.points=t;let l=void 0===e.lineCount?5:e.lineCount;l-=0;let c=void 0===e.extrudeHeight?100:e.extrudeHeight;c-=0;const{wallImage:u}=e,{lineImage:h}=e;let p=void 0===e.scrollSpeed?[0,0]:e.scrollSpeed,f=void 0===e.alphaSpeed?0:e.alphaSpeed;f-=0;let d=THREE.ClampToEdgeWrapping;void 0===e.textureWrap&&(d=THREE.RepeatWrapping),Array.isArray(p)||(p=[p,0]);const g=THING.Math.getPerimeter(t);let m=THING.App.current.create({type:"Boundary",height:c,scroll:!0,image:u,parent:o,style:e.style,parent:e.parent});if(m.isBoundary=!0,m.lineObj=this,m.style.glow=e.glow||e.effect||!1,n.Z.ModifyMaterial(m,e.blending),m._material.depthWrite=!1,m._material.opacity=.7,m._material.map.wrapS=d,m._material.map.wrapT=d,m._material.color=new THREE.Color(e.color),m.imageRepeat=e.uvRatio,"vertical"===s&&m.setScroll(p[0],-p[1]),"horizontal"===s)for(let e=0;e<l;e+=1){let o=app.create({type:"Boundary",height:c/l,points:t,independent:!0,image:h});o._material.blending=THREE.AdditiveBlending,o._material.depthWrite=!1,o._material.map.wrapS=THREE.ClampToEdgeWrapping,o._material.map.wrapT=THREE.ClampToEdgeWrapping,o._material.map.repeat.set(o.height/g,1),m.add(o),o._material.opacity=.8-e*(.8-.1)/l,o._material=o.node.getMaterials()[0],o.translate([0,e*c/l,0])}if(e.alphaImage){const t=new THREE.TextureLoader;m.node.getMaterials()[0].alphaMap=t.load(e.alphaImage),m.node.getMaterials()[0].alphaMap.repeat.set(c/g,1),m.node.getMaterials()[0].alphaMap.wrapS=THREE.RepeatWrapping,m.node.getMaterials()[0].alphaMap.wrapT=THREE.RepeatWrapping,m.on("update",(()=>{m.node.getMaterials()[0].alphaMap&&f&&(m.node.getMaterials()[0].alphaMap.offset.x+=.001*f)}),`updateAlphaMap${m.queryID}`)}m.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},m.inheritStyle=!0,m.addPoints(t,THING.SpaceType.Self);const y=i.host||i;return m.children.forEach((e=>{e.host=y,r.add(e)})),r.add(m),r}createEarthPipeLine(e,t){let o,i;if(n.Z.parseUrl(e),i={type:"image",lineType:"Pipe",imageUrl:e.image||e.imageUrl,useColor:!0,uvRatio:e.uvRatio,textureWrap:e.textureWrap||"stretch",textureSize:e.textureSize||100,color:e.color||[255,255,255],effect:e.effect||!1,width:e.width||1,speed:e.speed||0,growSpeed:e.growSpeed||0,growLoop:e.growLoop||!1,growSpeed:e.growSpeed||0},o=this.app.create({type:"GeoLine",name:"geoLine1",id:`${e.id}_GEOODLINE`,coordinates:t,offsetHeight:e.offsetHeight||0,renderer:i,userData:{}}),o._setPostRadiusEffect(e.postRadialBlur),e.growSpeed){const t=e.growSpeed-0,n=e.growLoop;o._playLineGrow({speed:t,growLoop:n}),THING.App.current.on("GeoLineGrowEnd",(function(){ModifyMaterial(o,e.NoBlending)}))}return o}createCampusLine(e,t,o){const i=THING.App.current.create({type:"RouteLine",width:e.width-0,points:t,arrowFlag:e.arrowFlag||!1,style:o,complete:e.complete,inheritScale:!1,inheritPosition:e.inheritPosition||!1});return n.Z.setCampusLine(i,e),i}getValue(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;return e.getAttribute(o)}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name}getUVRatio(e,t){const o=CMAP.Util.getPolygonExtent(e),n=CMAP.Util.convertLonlatToWebMercator([o.minX,o.minY]),i=CMAP.Util.convertLonlatToWebMercator([o.maxX,o.maxY]),r=(i[0]-n[0])/1e4,a=(i[1]-n[1])/1e4;let s=[1,1];return r>0&&a>0&&t&&(s=[r*t,a*t]),s}createPipeLine(e,t){let o,i,r=n.Z.getCampusLineStyle(t);return t.NoBlending=void 0===t.NoBlending||t.NoBlending,e.length>1?(o=THING.App.current.create({type:"PolygonLine",width:t.width-0,points:e,style:r,complete:t.complete,inheritScale:t.inheritScale||!1,inheritPosition:t.inheritPosition||!1}),o.host=this.hostObj,o.style.color=r.color,n.Z.setCampusLine(o,t),i=this._registerLine(o,t),i):(t.lineType="Pipe",o=n.Z.createGeoLine(param),i)}_registerLine(e,t){const{userConfig:o}=t;return e.on("complete",(t=>{e.inheritStyle=!0;let o=this.userConfig.userData||{};if(void 0===o.SKIP_THEME||o.SKIP_THEME){const t=e.style.opacity;e.style.opacity=1,THREE.ShaderLib.lambert.vertexShader=THREE.ShaderLib.lambert.vertexShader.replace("#include <lights_lambert_vertex>","\n                          #include <lights_lambert_vertex>\n                          \n                          #ifdef CUSTOM_LIGHT\n                                  dotNL = dot( geometry.normal, normalize(vec3(1., 1., 1.)) );\n                                  vLightFront = saturate( dotNL ) * PI * vec3(0.5, 0.5, 0.5);\n                                  vIndirectFront = getAmbientLightIrradiance(vec3(0.4, 0.4, 0.4));\n                          #endif\n                      "),e.style._skipApplyTheme=!0,e.node.traverse((function(e){if(e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1,e._gBufferRoughness=1),e.material)if(e.material.length>1)for(let n=0;n<e.material.length;n++){const i=e.material[n];if("SpriteMaterial"!==i.type){var t=i||e.material;(o=new THREE.MeshLambertMaterial).map=t.map||null,o.alphaMap=t.alphaMap||null,o.emissiveMap=t.emissiveMap||null,o.emissiveIntensity=t.emissiveIntensity||1,t.emissiveColor&&o.emissiveColor.copy(t.emissiveColor),o.opacity=t.opacity,o.color=t.color,o.transparent=t.transparent,o.blending=t.blending,o.alphaTest=t.alphaTest,o.defines={CUSTOM_LIGHT:""},t.defines&&t.defines.USE_ALPHAINDEX&&(o.defines.USE_ALPHAINDEX=!0),e.material[n]=o}}else{var o;if("SpriteMaterial"===(t=e.material).type)return;(o=new THREE.MeshLambertMaterial).map=t.map||null,o.alphaMap=t.alphaMap||null,o.emissiveMap=t.emissiveMap||null,o.emissiveIntensity=t.emissiveIntensity||1,t.emissiveColor&&o.emissiveColor.copy(t.emissiveColor),o.opacity=t.opacity,o.color=t.color,o.transparent=t.transparent,o.blending=t.blending,o.alphaTest=t.alphaTest,o.defines={CUSTOM_LIGHT:""},t.defines&&t.defines.USE_ALPHAINDEX&&(o.defines.USE_ALPHAINDEX=!0),e.material=o}})),e.style.opacity=t}t.object.destroyed}),100),e}disposePointsData(e){console.log(e)}getData(e){let t=[];const{features:o}=e;if(o)if(o.length>1)for(let e=0;e<o.length;e++)o[e].geometry.coordinates[0]instanceof Array?o[e].geometry.coordinates.forEach((e=>{t.push(e)})):t.push(o[e].geometry.coordinates);else t=o[0].geometry.coordinates;else e.hasOwnProperty("geometry")&&(t=e.geometry.coordinates[0][0]);return t}}},543:(e,t,o)=>{"use strict";o.d(t,{D9:()=>s,O3:()=>r,R5:()=>a,VQ:()=>n,WT:()=>i,f_:()=>c,hR:()=>l,ic:()=>p,nT:()=>u,sL:()=>h});const n={show:!0,aotuShow:!1,pivot:[.5,.5],zIndex:3,layout:["Top","Center"],marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,backgroundStyle:"Default",backgroundColor:"#16181aCC",cornerRadius:0,backgroundImage:{url:"images/bg.png",markPixel:2},texts:[{getMethod:"presetValue",presetValue:"æ è®°çæå­æµè¯",fontSize:24,fontColor:"#ffffff",paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}]},i={show:!0,zIndex:2,pivot:[.5,.5],size:[0,0],marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,images:[{size:[80,80],url:"images/icon_ä¿éå®¢æ·_ç«èµ.png"}]},r={show:!0,pivot:[.5,.5],zIndex:0,marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,layout:["Left","Bottom"],size:[0,0],url:""},a={show:!0,pivot:[.5,.5],zIndex:0,marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,layout:["Left","Bottom"],size:[0,0],url:"images/image.png"},s={show:!0,length:200,zIndex:1,width:2,angle:45,color:"#ff0000"},l={paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,lineSpacing:10,order:0,horizontalLayout:"left",valign:"middle",align:"left",getMethod:"objectProperty",propertyPath:"name",fontFamily:"Arial",fontSize:24,fontColor:"#ffffff",fontStyle:"normal",shadow:!1,shadowBlur:0,shadowColor:null,shadowOffset:[0,0],outline:!1,outlineThickness:0,outlineColor:null,stateText:!1,fontColorConfig:[{value:"æ­£å¸¸",color:"#208858"},{value:"å¼å¸¸",color:"#ff0000"}]},c={size:[100,20],align:"center",rowIndex:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0},u={size:[100,40],paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,horizontalLayout:"left",valign:"middle",align:"left",roundRectRadius:5,fontFamily:"Arial",fontSize:24,fontColor:"#ffffff",textSpacing:20,textLineSpacing:10,getMethod:"objectProperty",propertyPath:"name",backgroundColor:"#ffffff32",fillColorConfig:[{value:"æ­£å¸¸",color:"#208858"},{value:"å¼å¸¸",color:"#ff0000"}]},h={size:[150,15],paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,horizontalLayout:"center",valign:"middle",align:"center",roundRectRadius:7.5,lineSpacing:16,min:0,max:100,step:1,backgroundColor:"#ffffff32",progressColor:{gradient:!1,conditionOptions:[{ratio:.3,color:"#ffff00"},{ratio:.6,color:"#00ff00"},{ratio:1,color:"#ff0000"}]}},p={backgroundImage:{url:"images/bg.png",markPixel:2},paddingBottom:0,paddingRight:0,paddingLeft:0,paddingTop:0,pivot:[0,0]}},245:(e,t,o)=>{"use strict";o.d(t,{x:()=>n});const n={setFloorsDecoraterPosition:function(e,t={}){if(!t.floorAlign)return;if(e.decoraterOffset)return;let o=e.floors.objects,n=t.targetFloor;if(!n){let e=0,t=0;o.forEach(((o,n)=>{let i=o.boundingBox.max,r=o.boundingBox.min,a=THING.Math.getDistance(i,r);a>=t&&(e=n,t=a)})),n=o[e]}let i=t.layout||[1,0,0],r=2*i[0]-1,a=2*i[2]-1;e._targetBoundingBox||(e._targetBoundingBox=n.boundingBox);let s=e._targetBoundingBox,l=THING.Math.normalizeVector(THING.Math.crossVector(e.up,e.forward)),c=THING.Math.scaleVector(l,s.size[0]/2*r),u=THING.Math.scaleVector(e.forward,s.size[2]/2*a),h=THING.Math.addVector(c,u),p=s.center,f=THING.Math.addVector(p,h);e.targetDecPos=f,e.decoraterOffset=e.worldToSelf(f),e.decoraterOffset[1]=0},_getMinNumber:function(e,t){return 0===e?t:0===t?e:e-t>=0?t:e},_getMaxNumber:function(e,t,o=0){let n=e-t>=0?e:t;return o&&this._getMaxNumber(n,o),n},getTextValue:function(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;let n="";return o&&(n=e.getAttribute(o),void 0!==t.toFixed&&Number(n)&&(n=Number(n).toFixed(t.toFixed))),n}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):null},parseUrl:function(e,t){function o(e){var t=window.document.location.href,o=window.document.location.pathname,n=t.indexOf(o);let i=t.substring(0,n),r=e.trim();return e.includes("http")||0===e.indexOf("./")||0===e.indexOf("/")||(r=i+e),r}return["url","image","wallImage","lineImage","alphaImage"].forEach((n=>{let i=e[n];i&&(i.indexOf(t)>-1&&(t=""),i.startsWith("/")&&(i=i.substr(1)),i=i.includes("http")?o(i):o(t+i),e[n]=function(e){if(void 0===e||null==e)return e;let t=0,o="";for(e.startsWith("http")&&(t=e.indexOf("//")+2,o=e.slice(0,t));t<e.length;t+=1)o[o.length-1]+e[t]!=="//"&&(o+=e[t]);return o}(i))})),e},guid:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),changeStyle(e,t){function o(){e.host.style.highlight?e.style.color=e.host.style.highlight:e.host.style.color&&(e.style.color=e.host.style.color)}t.inheritOpacity&&(e.style.opacity=e.host.style.opacity),t.inheritColor&&o(),e.onProcessStyleValue=(n,i)=>{t.inheritOpacity&&"opacity"==n&&(e.style.opacity=e.host.style.opacity),!t.inheritColor||"color"!=n&&"highlight"!=n||o()}}}},381:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _ObjectDecoratorCreator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(987);class Attachment{constructor(){this.objectDecoratorCreator=new _ObjectDecoratorCreator__WEBPACK_IMPORTED_MODULE_0__.Z}async create(e,t,o={}){let n=await this._getConfig(t,o.fileName),{businessName:i,config:r,configUI:a=[]}=n;function s(e,t){let o=t.split("/");for(let t=0;t<o.length-1;t++)e[o[t]]&&(e=e[o[t]]);return null!=e[o[o.length-1]]?e[o[o.length-1]]:null}if(o.businessName&&(i=o.businessName),this._handleOptions(o,r,a),a.length>0)for(let e=a.length-1;e>=0;e--)"block"!==a[e].type&&"valueDefault"!==a[e].type?a[e].defaultValue=s(r,a[e].src||a[e].des):a.splice(e,1);let l=[];if(e.length)e.forEach((e=>{let t=this.objectDecoratorCreator.addGroup(e,r,i);l.push(t)}));else{let t=this.objectDecoratorCreator.addGroup(e,r,i);l.push(t)}return{objects:l,configUI:a}}async getConfigUI(e,t={}){let o=await this._getConfig(e,t.fileName),{config:n,configUI:i}=o;function r(e,t){let o=t.split("/");for(let t=0;t<o.length-1;t++)e[o[t]]&&(e=e[o[t]]);return null!=e[o[o.length-1]]?e[o[o.length-1]]:null}if(i.length>0)for(let e=i.length-1;e>=0;e--)"block"!==i[e].type&&"valueDefault"!==i[e].type?i[e].defaultValue=r(n,i[e].src||i[e].des):i.splice(e,1);return i}async destroy(e,t,o={}){let n=await this._getConfig(t,o.fileName),{businessName:i}=n;o.businessName&&(i=o.businessName),e.length?e.forEach((e=>{this.objectDecoratorCreator.removeGroup(e,i)})):this.objectDecoratorCreator.removeGroup(e,i)}register(e,t){_ObjectDecoratorCreator__WEBPACK_IMPORTED_MODULE_0__.Z.regDecorator(e,t)}async _getConfig(e,t){let o={},n=[],i="_default_";if("string"==typeof e){let r=e+"/"+(t||"frame.js"),a=await this._loadFrameFile(r,e);o=a.config,o.name=a.businessName,n=JSON.parse(JSON.stringify(a.configUI)),i=a.businessName}else"object"==typeof e&&(o=e.config?this._deepCloneConfig(e.config):this._deepCloneConfig(e),n=e.configUI?JSON.parse(JSON.stringify(e.configUI)):[],i=e.name);return{config:o,businessName:i,configUI:n}}async _loadFrameFile(frameUrl,serverFilePath){function httpRequest(e){return new Promise(((t,o)=>{var n=new XMLHttpRequest;n.open("GET",e),n.send(),n.onload=function(){t(n.response)}}))}let response,jsonObj;if(window.uinv||(window.uinv={}),loadedWasm){response=await httpRequest(frameUrl);let uint8_msg=new Uint8Array(response),decodeString=String.fromCharCode.apply(null,uint8_msg);decodeString=decodeURIComponent(escape(decodeString)),jsonObj=decodeString.startsWith("uinv.iconUserConfig")?eval(decodeString):JSON.parse(decodeString)}else if(response=await fetch(frameUrl),frameUrl.endsWith(".js"))if(response.ok){let string=await response.text();jsonObj=eval(string)}else response=await fetch(frameUrl.replace("frame.js","index.json")),jsonObj=await response.json();else jsonObj=await response.json();let configUI=[];jsonObj.configUI&&(configUI=configUI.concat(jsonObj.configUI)),jsonObj.configUIpro&&(configUI=configUI.concat(jsonObj.configUIpro));const config=jsonObj.config,businessName=jsonObj.name||"_default_";config.items.forEach((e=>{e.serverFilePath=serverFilePath,e.config&&e.config.complete&&(e.config.complete=new Function(`return ${e.config.complete}`)())}));let result={config,businessName,configUI};return result}async refresh(e,t,o,n={}){let i=await this._getConfig(t,n.fileName),{businessName:r,config:a}=i;for(let e=0;e<o.length;e++){let t=o[e];s(a,t.src||t.des,t.value)}return this.destroy(e,a,{businessName:r}),await this.create(e,a,{businessName:r});function s(e,t,o){let n=t.split("/");for(let t=0;t<n.length-1;t++)e[n[t]]&&(e=e[n[t]]);null!=e[n[n.length-1]]&&(e[n[n.length-1]]=o)}}async refreshCanvas(e,t){let o=t+"/frame.js",n=await this.objectDecoratorCreator.loadFrameFile(o,t),{businessName:i}=n;e.length?e.forEach((e=>{this.updateDecorator(e,i)})):this.updateDecorator(e,i)}updateDecorator(e,t="_default_"){let o=`#${e.id}_${t}_decorateBaseObj`,n=THING.App.current.query(o).objects[0];n&&n.children&&n.children.forEach((e=>{this.objectDecoratorCreator.refresh(e)}))}_handleOptions(e,t,o){function n(e,t,o){let n=t.split("/");for(let t=0;t<n.length-1;t++)e[n[t]]&&(e=e[n[t]]);null!=e[n[n.length-1]]&&(e[n[n.length-1]]=o)}if(e.sceneType)for(let i=0;i<o.length;i++)if("åºæ¯ç±»å"==o[i].caption&&o[i].defaultValues){let{defaultValues:r}=o[i],a=r[e.sceneType];for(let e in a)n(t,e,a[e])}}_deepCloneConfig(e){var t=Array.isArray(e)?[]:{};if(e&&"object"==typeof e)for(let o in e)e.hasOwnProperty(o)&&(e[o]&&"object"==typeof e[o]?t[o]=this._deepCloneConfig(e[o]):t[o]=e[o]);return t}}window.Attachment=Attachment;const __WEBPACK_DEFAULT_EXPORT__=Attachment},971:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});const n=class{constructor(e){this.objectDecoratorCreator=e,this.groupNameList=[],this.currentGroupIndex=0,this.groupMap={},this.timer=0;let t=this;setInterval((()=>{t.update(100)}),100)}convertLODConfig(e){if((e=THING.Utils.cloneObject(e,!0)).lodGroup){let{distance:t}=e,{config:o}=e;if(o.forEach((t=>{t.forEach((t=>{t.serverFilePath=e.serverFilePath}))})),Array.isArray(t)){const o={};for(let n=0;n<t.length;n+=1){const i=t[n],r=e.config[n];o[i]=r}e.config=o}t||(t=Object.keys(e.config));const n=t.toString();e.lodGroup+=n}return e}regGroupConfig(e,t,o,n){if(this.groupMap[e]){const{distance:o}=this.groupMap[e],n=Object.keys(t);o.toString(),n.toString()}else this.groupMap[e]={distance:Object.keys(t),tag:o},this.groupNameList.push(e);const i=n;this.groupMap[e][i]||(this.groupMap[e][i]={config:t,objs:{}})}add(e,t,o="_default_"){const n=this.groupMap[t];if(n){n[o].objs[e.id]=e;const i=this.createLODBaseObject(e,n.tag);return i.lodGroup=t,i.condition=o,i}}removeLodObj(e){const{lodGroup:t}=e,{condition:o}=e;Object.keys(e.decoratorMap).forEach((t=>{this.objectDecoratorCreator.remove(e,t)})),delete this.groupMap[t][o].objs[e.parent.id]}update(e){if(-1===this.timer)return;if(this.timer+=e,this.timer<100)return;if(this.timer=0,0===this.groupNameList.length)return;const t=this.currentGroupIndex,o=this.groupNameList[t];if(o){const e=this.groupMap[o];if(0===this.getGroupAllObjs(e).length)return this.currentGroupIndex+=1,void(this.currentGroupIndex>this.groupNameList.length-1&&(this.currentGroupIndex=0));const t=this.getDistanceLevel(e.distance);let n=!1;const i=e._curDistanceLevel_;i!==t&&(n=!0,e._curDistanceLevel_=t);const r=Object.keys(e);for(let o=0;o<r.length;o+=1){const a=r[o];if("distance"!==a&&"tag"!==a&&"_curDistanceLevel_"!==a){const{objs:o}=e[a],{config:r}=e[a],{tag:s}=e,l=r[t],c=Object.values(o);for(let o=0;o<c.length;o+=1){const r=c[o];if(r.stopUpdateLOD)continue;const a=this.createLODBaseObject(r,s);for(let e=0;e<l.length;e+=1){const n=l[e],i=`${s}_${n.type}_${o}_${e}_${t}`;let r=this.objectDecoratorCreator.get(a,i);r||(r=this.objectDecoratorCreator.add(a,i,n.type,n.config,n.serverFilePath),r.distanceLevel=t,r.host=a.host,a.levelObjs[t]||(a.levelObjs[t]=[]),a.levelObjs[t].push(r))}const{levelObjs:u}=a,h=Object.keys(u);n&&THING.App.current.trigger("lodChange",{lastDistanceLevel:i,curDistanceLevel:t,lodObj:a,curGroup:e}),h.forEach((e=>{const o=e===t;u[e].forEach((e=>{const{parent:t}=a;!1===t.visible||!1===t._layerChecked?void 0!==t._layerPurpos?(e._setVisible(!1,t._layerPurpos),e._setVisible(!1,"default")):e.visible=!1:void 0!==t._layerPurpos?(e._setVisible(o,t._layerPurpos),e._setVisible(o,"default")):e.visible=o,e.inheritVisible=o}))}))}}}}this.currentGroupIndex+=1,this.currentGroupIndex>this.groupNameList.length-1&&(this.currentGroupIndex=0)}stopUpdate(){this.timer=-1}getDistanceLevel(e){let t=9999999999;const o=THING.App.current;let n;t=THING.Math.getVectorLength(THING.Math.subVector(o.camera.position,o.camera.target));for(let o=0;o<e.length;o+=1){const i=e[o];if(t<i){n=i;break}n=i}return n}getGroupAllObjs(e){let t=[];const o=Object.keys(e);for(let n=0;n<o.length;n+=1){const i=o[n];if("distance"!==i&&"tag"!==i&&"_curDistanceLevel_"!==i){const{objs:o}=e[i];t=t.concat(Object.values(o))}}return t}createLODBaseObject(e,t){if(e.host.decoratorMap||(e.host.decoratorMap={}),!e.host.decoratorMap[t]){const o=THING.App.current.create({type:"BaseObject",id:`${t}_logGroup`,parent:e,localPosition:[0,0,0]});o.isLODGroup=!0,o.levelObjs={},o.host=e.host,o.decoratorTag=t,e.host.decoratorMap[t]=o}return e.host.decoratorMap[t]}}},740:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});var n=o(354);const i=class{constructor(){this.configLib={}}regConfig(e,t){if(e=e.toLowerCase(),this.getConfig(e))return!1;this.configLib[e]=t}getConfig(e){return e=e.toLowerCase(),this.configLib[e]}modifyConfig(e,t){e=e.toLowerCase();const o=this.getConfig(e);return!!o&&(n.Z.combine(o,t),!0)}}},987:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _tools_hash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(354),_DecoratorLODManager__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(971),_lib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(824),_CanvasPanel_index__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(175),_DecoratorLib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(740),_attachments_global__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(245),_attachments_CustomLine__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(635);class ObjectDecoratorCreator{constructor(e={}){THING.factory.hasClass("BGAndCanvasPanel")||THING.factory.registerClass("BGAndCanvasPanel",_CanvasPanel_index__WEBPACK_IMPORTED_MODULE_2__.qI),THING.factory.hasClass("HtmlElementPanel")||THING.factory.registerClass("HtmlElementPanel",_CanvasPanel_index__WEBPACK_IMPORTED_MODULE_2__.SV),THING.factory.hasClass("DataPanel")||THING.factory.registerClass("DataPanel",_CanvasPanel_index__WEBPACK_IMPORTED_MODULE_2__.I8),THING.factory.hasClass("createCustomLine")||THING.factory.registerClass("createCustomLine",_attachments_CustomLine__WEBPACK_IMPORTED_MODULE_5__.Z),this.decoratorLib=new _DecoratorLib__WEBPACK_IMPORTED_MODULE_3__.Z,this.lodManager=new _DecoratorLODManager__WEBPACK_IMPORTED_MODULE_6__.Z(this),this.defaultModelList=[],this.htmlCssMap={},this.rsmPath=e.rsmPath||"",this.overrideThingJS(),(0,_lib__WEBPACK_IMPORTED_MODULE_1__.Z)(this)}overrideThingJS(){THING.Element3DObjectControl.fixCSS3DOffset=function(e,t){return[Math.round(e),Math.round(t)]}}regDecoratorDefaultConfig(e,t){this.decoratorLib.getConfig(e)?this.decoratorLib.modifyConfig(e,{defaultConfig:t}):this.decoratorLib.regConfig(e,{defaultConfig:t})}regDecorator(e,t){this.getDecorator(e)?this.decoratorLib.modifyConfig(e,{func:t}):this.decoratorLib.regConfig(e,{defaultConfig:{},func:t})}getDecorator(e){return this.decoratorLib.getConfig(e)}add(e,t,o,n,i=""){if(!e)return;if(e.businessName=n.businessName,e.decoratorName=n.decoratorName,e instanceof THING.Building){const{facade:t}=e;t&&(e=t)}e.decoratorMap||(e.decoratorMap={});const r=this.getDecorator(o);if(""===i||i.endsWith("/")||(i+="/"),r){const a=THING.Utils.cloneObject(r.defaultConfig,!0);if((n.glow||0==n.glow)&&(n.effect=n.glow),n=_tools_hash__WEBPACK_IMPORTED_MODULE_0__.Z.combine(a,n,!0,!0,!0),!e.decoratorMap[`${t}`]){const a=r.func({parent:e,userConfig:n,tag:t,effectName:o,serverFilePath:i});if(!a)return;return void 0!==n.alwaysOnTop&&(a.style.alwaysOnTop=n.alwaysOnTop),void 0!==n.pickable&&(a.pickable=n.pickable),a.isMonitor=n.isMonitor||!1,void 0!==n.skipBoundingBox&&(a._skipBoundingBox_=n.skipBoundingBox,a.style.skipBoundingBox=n.skipBoundingBox),a instanceof THING.Selector?a.forEach((e=>{e.decoratorTag=t})):a.decoratorTag=t,e.decoratorMap[`${t}`]=a,e.isPolygon=a.isPolygon,e.isBoundary=a.isBoundary,a}return e.decoratorMap[`${t}`]}console.error(`æ²¡ææ¾å°è¯¥æ ·å¼ ${o}`)}get(e,t){if(e instanceof THING.Building){const{facade:t}=e;t&&(e=t)}if(e.decoratorMap&&e.decoratorMap[t])return e.decoratorMap[t];return e.query(`[decoratorTag=${t}]`)[0]||void 0}remove(e,t){if(e){if(e instanceof THING.Building){const{facade:t}=e;t&&(e=t)}if(e.decoratorMap&&e.decoratorMap[t]){const o=e.decoratorMap[t];o.isLODGroup&&this.lodManager.removeLodObj(o),THING.INSTANCETOOL&&THING.enableInstance&&THING.instanceTool&&"function"==typeof THING.instanceTool.clearBatchObjectMap&&THING.instanceTool.clearBatchObjectMap(o),o.destroy(),delete e.decoratorMap[t]}}}sortConfigItem(e){let{items:t}=e,o=[];for(let e=t.length-1;e>=0;e--)"Icon/Model"!=t[e].type&&"ModelPoint"!=t[e].type||o.push(t.splice(e,1)[0]);e.items=o.concat(t)}handleConfig(e,t){if(1==e.keepSize||0==e.keepSize){let{items:o}=e;for(let n=0;n<o.length;n++)o[n].config.keepSize=!1,e.keepSize&&("HTMLPanelPoint"!==o[n].type&&"Panel/HTMLElement"!==o[n].type||JSON.stringify(t.scale)!==JSON.stringify([1,1,1])&&(e.inheritScale||(o[n].config.size/=t.scale[1])));e.keepSize&&(e.scale=THING.Math.scaleVector(e.scale||[1,1,1],e.scaleFactor))}}empty(e){for(let t=0,o=e.length;t<o;t++)e[t]||(e[t]=0)}canAngles(e){let{items:t}=e,o=!0;for(let e=0;e<t.length;e++)(t[e].config.useSpriteMaterial||t[e].config.lockYAxis)&&(o=!1);return o}handleBuilding(e,t){let o=!1,n=t.items;if(e instanceof THING.Building){const{facade:t}=e;t&&(e=t),o=!0}if(t.layout)void 0===t.onlySelf&&(t.onlySelf=!o);else for(let e=0;e<n.length;e++){if(void 0!==n[e].config.onlySelf){t.onlySelf=n[e].config.onlySelf;break}n[e].config.onlySelf=!o,t.onlySelf=!o}return e}handleInheritStyleConfig(e){null==e.inheritColor&&null==e.inheritOpacity||(e.inheritStyle=!1);let t=e.items;for(let o=0;o<t.length;o++)null!=t[o].config.inheritColor&&(e.inheritColor=t[o].config.inheritColor,t[o].config.inheritStyle=!0,e.inheritStyle=!1),null!=t[o].config.inheritOpacity&&(e.inheritOpacity=t[o].config.inheritOpacity,t[o].config.inheritStyle=!0,e.inheritStyle=!1)}handleInheritStyle(e,t,o){t.inheritStyle=!o.inheritStyle,o.inheritOpacity||void 0===o.inheritOpacity?"HtmlElementPanel"===t.type&&(t._element.style.opacity=e.style.opacity):(t.parent.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},t.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},"HtmlElementPanel"===t.type&&(t._element.style.opacity=1)),!1===o.inheritColor&&(t.onProcessStyleValue=function(e,t){if("color"==e)return!1},t.parent.onProcessStyleValue=function(e,t){if("color"==e)return!1})}handleInheritColorOrOpacity(e,t){function o(t,o){let n=e.children;for(let e=0;e<n.length;e++)n[e].style[t]=o}function n(){let t;e.host.style.highlight?t=e.host.style.highlight:e.host.style.color&&(t=e.host.style.color),t=t||"#FFFFFF",e.style.color=t,o("color",t)}if(t.inheritOpacity)if(THING.enableInstance&&"running"==e.host._batchState)o("opacity",e.host._batchTarget._batchObject.style.opacity);else{let t=e.host.style.opacity;e.style.opacity=t,o("opacity",t)}t.inheritColor&&n(),e.onProcessStyleValue=(i,r)=>{t.inheritOpacity&&"opacity"==i&&(e.style.opacity=e.host.style.opacity,o("opacity",e.host.style.opacity)),!t.inheritColor||"color"!=i&&"highlight"!=i||n()}}createBaseObject(e,t,o){let{isMonitor:n,inheritScale:i,inheritStyle:r,keepSize:a}=t;1===t.items.length&&(i=i||t.items[0].config.inheritScale);let s=THING.App.current.create({type:"BaseObject",id:`${e.id}_${o}_decorateBaseObj`,parent:e,inheritScale:i||!1,inheritStyle:r,keepSize:a});s.inheritOpacity=t.inheritOpacity,s.inheritColor=t.inheritColor,s.isDecorateBaseObj="yes",e instanceof THING.Facade?s.host=e.parent:s.host=e,s.isMonitor=n;let l=this;return s.updateToTop=function(){l.updateToTop(this)},s}updateToTop(e){let t=e.position,o=e.parent.children,n=[];if(o.forEach((e=>{"BaseObject"!=e.type&&"Marker"!=e.type||n.push(e)})),1!=n.length){let o,i=0;for(let r=0;r<n.length;r++)if(e.id!==n[r].id){if(n[r].position[1]>t[1]){let e=n[r].position[0],o=n[r].position[1]-(n[r].position[1]-t[1]),i=n[r].position[2];n[r].position=[e,o,i]}n[r].position[1]>i?(o=n[r],i=n[r].position[1]):n[r].position[1]===i&&n[r].size[1]>o.size[1]&&(console.log(o),o=n[r])}let r=e.position[0],a=o.position[1]+o.size[1],s=e.position[2];e.position=[r,a,s]}}addGroup(e,t={},o="_default_",n=!1){if(!o)return;if((e=this.handleBuilding(e,t)).businessName=o,e.decoratorName=t.iconName,e.decoratorMap||(e.decoratorMap={}),t.floorAlign&&e instanceof THING.Floor){let o=t.layout||t.floorAlignLayout,n=e.parent._layout_;JSON.stringify(o)!==JSON.stringify(n)&&(t.layout=o,0===o[0]&&t.items.forEach((e=>{if("SignboardPoint"===e.type){let t=e.config.canvasConfig.guide;e.config.pivot=[1,.5],t&&(t.angle=180,t.layout=["Right","Center"])}else e.floorRightCallback&&"function"==typeof e.floorRightCallback&&e.floorRightCallback()})),e.parent.decoraterOffset=null,_attachments_global__WEBPACK_IMPORTED_MODULE_4__.x.setFloorsDecoraterPosition(e.parent,t),e.parent._layout_=0===THING.Math.getDistance(o,[0,1,.5])?null:o)}const i=THING.Utils.cloneObject(t,!1);i.items.forEach((e=>{"SuperSignboard"==e.type&&(e.config.hasOwnProperty("canvasConfigTop")||e.config.hasOwnProperty("canvasConfigRight"))&&e.config.canvasConfig.hasOwnProperty("sign")&&e.config.canvasConfig.sign.hasOwnProperty("images")&&e.config.canvasConfig.sign.images.forEach((t=>{t.color instanceof Object&&(e.config.canvasConfigTop.sign.images.forEach((e=>{e.hasOwnProperty("color")||(e.color=t.color)})),e.config.canvasConfigRight.sign.images.forEach((e=>{e.hasOwnProperty("color")||(e.color=t.color)})))}))})),this.handleConfig(i,e);const r=i.items,{condition:a}=i;let{sizeInfo:s,localPosition:l,angles:c,layout:u,inheritScale:h,scaleFactor:p,keepSize:f}=i;s||null==i.totalSize||null==i.size||(s={totalSize:i.totalSize,size:i.size}),this.handleInheritStyleConfig(i);let d=e.query(`#${e.id}_${o}_decorateBaseObj`,!1)[0];d||(d=this.createBaseObject(e,i,o)),e.decoratorMap[d.id]=d;let g=1;if(s){let e=s.totalSize,t=s.size;null!=e&&null!=t&&(g=t/e)}const m=r.length;d.totalDecoratorsCnt=m,d.tempLoadedDecoratorCnt=0;let y=!1;for(let s=0;s<m;s+=1){const h=r[s],{tag:f}=h,{lodGroup:m}=h,{type:_}=h;if(h.testScale&&(y=!0),m){const e=this.lodManager.convertLODConfig(h);this.regLODConfig(m,e.config,f,a);const t=this.lodManager.add(d,m,a);t.businessName=o,t.on("complete",(e=>{e.object.parent.tempLoadedDecoratorCnt+=1,e.object.parent.tempLoadedDecoratorCnt===e.object.parent.totalDecoratorsCnt&&(e.object.parent.trigger("DecoratorsComplete",{businessName:o}),THING.App.current.trigger("DecoratorsComplete",{object:e.object.parent,businessName:o}))}))}else if(n&&"Icon/Model"===h.type)this.defaultModelList.push({obj:e,tag:`${o}_${f}`,type:_,config:h.config,serverFilePath:h.serverFilePath,baseObj:d});else{h.config.businessName=o,h.config.decoratorName=t.iconName;const n=this.add(d,`${o}_${f}`,_,h.config,h.serverFilePath);n&&!n._DecoratorsComplete_?(d.visible=!1,n.on("complete",(t=>{if(this.handleInheritColorOrOpacity(d,i),n.style._skipApplyTheme=!0,n.node.traverse((function(e){e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1)})),t.object.parent.tempLoadedDecoratorCnt+=1,t.object.parent.tempLoadedDecoratorCnt===t.object.parent.totalDecoratorsCnt){if(t.object.parent.trigger("DecoratorsComplete",{businessName:o}),THING.App.current.trigger("DecoratorsComplete",{object:t.object.parent,businessName:o}),t.object._DecoratorsComplete_=!0,d.inheritStyle=!0,u){if(this.empty(u),d.children.forEach((e=>{e.style.skipBoundingBox=!0})),!d.isBoundary&&!d.isPolygon){let t=this.getLayoutPosition(e,u,null,!0,!1,i.onlySelf);d.position=t}if(l){let e=d.parent.scale;if(this.empty(l),THING.Math.getDistance(d.parent.position,[0,0,0])>2e4){let t=[l[0]/e[0],l[1]/e[1],l[2]/e[2]];d.localPosition=THING.Math.addVector(d.localPosition,t)}else{let t=d.localPosition,o=[l[0]/e[0],l[1]/e[1],l[2]/e[2]];d.localPosition=THING.Math.addVector(o,t)}}let t=d.children;for(let e=0;e<t.length;e++)for(let o=0;o<r.length;o++){let n=t[e].decoratorTag.replace(t[e].businessName+"_","");if(r[o].tag==n)if(t[e].position=d.position,d.keepSize||THING.Math.getDistance(d.parent.position,[0,0,0])>2e4){let n=r[o].config.layoutOffset||r[o].config.localPosition||[0,0,0];"HtmlElementPanel"===t[e].type?(d.keepSize?d.inheritScale?t[e].localPosition=r[o].config.layoutOffset:t[e].localPosition=THING.Math.scaleVector(n,1/d.parent.scale[1]):t[e].localPosition=n,d.hasHTMLPanelDecorator=!0):t[e].localPosition=n}else r[o].config.localPosition?t[e].position=THING.Math.addVector(t[e].position,r[o].config.localPosition):r[o].config.layoutOffset?d.inheritScale?t[e].localPosition=r[o].config.layoutOffset:t[e].position=THING.Math.addVector(t[e].position,r[o].config.layoutOffset):t[e].localPosition=[0,0,0]}d.children.forEach((e=>{e.style.skipBoundingBox=e._skipBoundingBox_})),e instanceof THING.Floor&&e.parent.decoraterOffset&&i.floorAlign&&(d.localPosition=THING.Math.addVector(e.parent.decoraterOffset,l))}else if(e instanceof THING.Floor&&e.parent.decoraterOffset&&i.floorAlign)d.localPosition=e.parent.decoraterOffset,d.children.forEach((e=>{e.localPosition=[0,0,0]}));else{if(!d.isBoundary&&!d.isPolygon){let t=[0,0,0],o=d.children;if(THING.Math.getDistance(d.parent.position,[0,0,0])<2e4){t=this.getLayoutPosition(e,[.5,1,.5],null,!1,!1,i.onlySelf);let n=[0,0,0];for(let e=0;e<o.length;e++)n[1]=t[1]-o[e].position[1];t=THING.Math.subVector(t,n),d.position=t}else for(let e=0;e<o.length;e++)d.position=o[e].position}let t=d.children;for(let e=0;e<t.length;e++)for(let o=0;o<r.length;o++){if(!t[e].decoratorTag)continue;let n=t[e].decoratorTag.replace(t[e].businessName+"_","");if(r[o].tag==n&&"FlyLine/RouteLineImage"!==r[o].type){t[e].position=d.position;let n=r[o].config.localPosition||r[o].config.layoutOffset||[0,0,0];t[e].position=THING.Math.addVector(t[e].position,n)}}}if(g&&y&&(d.scale=[g,g,g],d.children.forEach((e=>{let t=e.localPosition;e.localPosition=[t[0],t[1]-g,t[2]]}))),null!=p&&!i.keepSize&&!i.size)if(d.inheritScale)d.scale=[p,p,p];else{d.inheritScale=!0;let e=d.parent.scale;d.scale=[p/e[0],p/e[1],p/e[2]]}if(i.size&&!i.keepSize&&void 0!==i.keepSize){if(d.children.forEach((e=>{e.inheritScale=!0})),d.inheritScale)d.scale=[i.size,i.size,i.size];else{d.inheritScale=!0;let e=d.parent.scale;d.scale=[i.size/e[0],i.size/e[1],i.size/e[2]]}d.children.forEach((e=>{e.localPosition=[e.localPosition[0]/i.size,e.localPosition[1]/i.size,e.localPosition[2]/i.size]}))}let n=i.rotation||[0,0,0];if(THING.Math.getDistance(d.host.position,[0,0,0])>2e4){let e=d.angles,t=d.host.angles;e[0]+=n[0]-t[0],e[1]+=n[1]-t[1],e[2]+=n[2]-t[2],d.angles=n}if(c&&this.canAngles(i)){this.empty(c);let e=d.angles;d.angles=[c[0]+e[0],c[1]+e[1],c[2]+e[2]]}if(i.keepSize){d._keepSize=!1;let e=d.parent.scale,t=i.size||p,o=[t,t,t];if(i.inheritScale)o=[t*e[0],t*e[1],t*e[2]];else if(JSON.stringify(e)!==JSON.stringify([1,1,1]))if(void 0===i.inheritColor&&void 0===i.inheritOpacity){let n=[e[1]/e[0],1,e[1]/e[2]];d.hasHTMLPanelDecorator||(n=THING.Math.scaleVector(n,1/e[1])),o=THING.Math.scaleVector(n,t)}else if(d.hasHTMLPanelDecorator){let n=[e[1]/e[0],1,e[1]/e[2]];d.children.forEach((e=>{"HtmlElementPanel"!==e.type&&(e.scale=[1/n[0],1,1/n[2]])})),n=THING.Math.scaleVector(n,o[1]/e[1]),o=THING.Math.scaleVector(n,t)}d._updateKeepSize(!0,d.node,o,200)}d.visible=!0}isNaN(t.object.parent.tempLoadedDecoratorCnt)&&(d.visible=!0)})),n.businessName=o):(d.tempLoadedDecoratorCnt+=1,d.tempLoadedDecoratorCnt===d.totalDecoratorsCnt&&setTimeout((()=>{d.trigger("DecoratorsComplete",{businessName:o}),THING.App.current.trigger("DecoratorsComplete",{object:d,businessName:o}),"Particle/Normal"!==i.items[0].type&&(e.style.skipBoundingBox=!0,d.style.skipBoundingBox=!1)}),0))}}return THING.Math.getDistance([0,0,0],e.position)>3e4&&d.children.forEach((t=>{let o=[0,0,0];t.style.alwaysOnTop&&t.on("update",(function(){let n=THING.App.current.camera.position,i=e.position,r=THING.Math.normalizeVector(THING.Math.subVector(n,i)),a=THING.Math.normalizeVector(THING.Math.subVector(i,o)),s=THING.Math.dotVector(r,a);d.visible?t.visible=s>0:t.visible=!1}),"alwaysOnTopUpdate")})),d}getGroup(e,t="_default_"){if(e instanceof THING.Building){const{facade:t}=e;t&&(e=t)}return e.query(`#${e.id}_${t}_decorateBaseObj`,!1)[0]}removeGroup(e,t="_default_"){const o=this.getGroup(e,t);o&&(o.children.forEach((t=>{this.remove(e,t.decoratorTag),"Marker"==t.type&&t.canvas&&(t.canvas.getContext("2d").clearRect(0,0,t.canvas.width,t.canvas.height),t.canvas.width=0,t.canvas.height=0,t.canvas.remove(),t.canvas=null),t.releaseVideo&&t.releaseVideo(),t.tags&&t.tags.map((e=>{e&&THING.App.current.off("update","",e)})),t.destroy()})),o._flyLines&&o._flyLines.length>0&&o._flyLines.forEach((e=>{e.destroy()})),o.trigger("DecoratorsDestroy",{businessName:t}),THING.App.current.trigger("DecoratorsDestroy",{object:o,businessName:t}),o.destroy())}regLODConfig(e,t,o,n="_default_"){this.lodManager.regGroupConfig(e,t,o,n)}clearHTMLCSSCach(){this._util.clearHTMLCSSCach()}refresh(e){const{type:t,dType:o}=e;if("BGAndCanvasPanel"===t)e.updateCanvas();else if("HtmlElementPanel"===t)e.updateHtmlElement();else if("DataPanel"===t)e.refresh();else if("Marker"===t&&"TextAndImage"===o){if(!n(e.TAI))return;e.TAI.updateCanvas()}else if("Marker"===t&&"DataPanel"===o){if(!n(e.datapanel))return;e.datapanel.refreshCanvas()}else if("Marker"===t&&e.canvasObj){if(!n(e.canvasObj))return;e.canvasObj.refresh()}else if("BaseObject"===t){let t=0;e.parent.children.length>1?e.parent.children.forEach((e=>{"BaseObject"==e.children[0].type?e.children[0].children[0].lineObj.refresh(t):e.children[0].lineObj.refresh(t),t++})):"BaseObject"==e.children[0].type?e.children[0].children[0].lineObj.refresh():e.children[0].lineObj.refresh()}function n(t){let{propertyValue:o}=t,n=!1;for(let t in o)e.host.getAttribute(t)!=o[t]&&(n=!0);return n}}async loadResource(rsmPath,path){window.uinv||(window.uinv={});const url=rsmPath+"/"+path+"/frame.js",response=await fetch(url),string=await response.text(),jsonObj=eval(string),config=jsonObj.config;return config.items.forEach((e=>{e.serverFilePath=path,e.config&&e.config.complete&&(e.config.complete=new Function(`return ${e.config.complete}`)())})),config}async loadFrameFile(frameUrl,serverFilePath){window.uinv||(window.uinv={});const response=await fetch(frameUrl),string=await response.text(),jsonObj=eval(string),config=jsonObj.config,businessName=jsonObj.name;config.items.forEach((e=>{e.serverFilePath=serverFilePath,e.config&&e.config.complete&&(e.config.complete=new Function(`return ${e.config.complete}`)())}));let result={config,businessName};return result}getLayoutPosition(e,t,o,n=!1,i=!1,r=!1){let a;if(e instanceof THING.Building){const{facade:s}=e;s&&(a=s.getLayoutPosition(t,o,n,i,r))}return a||(a=e.getLayoutPosition(t,o,n,i,r)),a}}const __WEBPACK_DEFAULT_EXPORT__=ObjectDecoratorCreator},370:(e,t,o)=>{"use strict";o.d(t,{$J:()=>l,Ar:()=>n,Gg:()=>s,Hp:()=>i,Ob:()=>c,aC:()=>a,bF:()=>u,g:()=>r});const n={LEFT:"Left",RIGHT:"Right",TOP:"Top",BOTTOM:"Bottom",CENTER:"Center"},i={LEFT:"left",RIGHT:"right",CENTER:"center"},r={IMAGE:"image",TEXT:"text",PROGRESS_Bar:"progressBar",STATE_BAR:"stateBar",STATE_TEXT:"stateText",BLOCK:"block"},a={TITLE:"title",NORMAL:"normal"},s={LEFT:"left",RIGHT:"right",CENTER:"center"},l={None:"None",Default:"Default",RightTrapezoid:"RightTrapezoid",Image:"Image"},c={changeOnImg:function(e,t,o){let n,i="string"!=typeof t;if(i){let e=[],n=t.values,i=t.intervals;for(let t=0;t<n.length;t++)if(t>0&&t<n.length){let r=i[t]-i[t-1],a="horizontal"==o?img.width*r:img.height*r;e=gradientColors(parseColor(n[t-1]),parseColor(n[t]),a,1)}}else if(n=parseColor(t),255==n[0]&&255==n[1]&&255==n[2])return;for(var r=function(e){return"horizontal"==o?e/4%img.width:Math.floor(e/4/img.height)},a=0;a<e.data.length;a+=4){let t=[e.data[a],e.data[a+1],e.data[a+2]],o=i?graColors[r(a)]:n,s=multiply(t,o);e.data[a]=s[0],e.data[a+1]=s[1],e.data[a+2]=s[2]}return e},multiply:function(e,t){for(var o=[],n=0;n<e.length;n++)o.push(Math.floor(e[n]*t[n]/255));return o},parseColor:function(e){return 4===e.length?e.substr(1).split("").map((function(e){return 17*parseInt(e,16)})):[e.substr(1,2),e.substr(3,2),e.substr(5,2)].map((function(e){return parseInt(e,16)}))},pad:function(e){return 1===e.length?"0"+e:e},gradientColors:function(e,t,o,n){var i,r,a,s,l=[];n=n||1;var c=function(e){return Math.pow(e/255,n)};for(e=e.map(c),t=t.map(c),i=0;i<o;i++){s=1-(a=i/(o-1));let c=[];for(r=0;r<4;r++)c[r]=this.pad(Math.round(255*Math.pow(e[r]*s+t[r]*a,1/n)));l.push(c)}return l}},u={Horizontal:"Horizontal",Vertical:"Vertical",Mix:"Mix"}},824:(e,t,o)=>{"use strict";o.d(t,{Z:()=>_});var n=o(891);class i{constructor(e){const{parent:t}=e;this.propertyValue={},this.userConfig=e.userConfig,this.host=t.host||t,this.serverFilePath=e.serverFilePath,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.maxTextHeight=0,this.sumTextWidth=0,this.offset=[0,0],this.finishCnt=0,this.textAboveImage=!1,this.leftImgSize=[0,0],this.textBgColor=this.userConfig.textBgColor||"#16181aCC",this.skipColor="#001833",this.setupParams(),this.roundRectRadius=this.userConfig.roundRectRadius||30,this.defaltShowText=e.showText,this.isFirst=!0,this.H1=0,this.H2=0,this.imagesObjectList=[],this.bgStyle=this.userConfig.bgStyle||"default"}defaultParams(){this.textDefConfig={getMethod:"objectProperty",propertyPath:"name",layout:["Center","Top"],paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,width:0,height:0,contentWidth:0,lineSpacing:50,style:{colDistance:10,fontSize:48,fontFamily:"Arail",fontColor:"rgb(255, 255, 255)"},content:"hello world"},this.imgDefConfig={layout:["Center","Center"],url:"image/icon.png",size:[10,10],style:{color:"#ffffff",zIndex:0},layoutOffset:[0,0],type:"Normal"},this.progressDefConfig={}}parseArray(e){let t=[];return isNaN(e.length)?t.push(THING.Utils.cloneObject(e,!1)):t=THING.Utils.cloneObject(e,!1),t}getMaxNumber(e,t){return e-t>=0?e:t}getMinNumber(e,t){return 0===e?t:0===t?e:e-t>=0?t:e}getValue(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;let n="";return o&&(n=e.getAttribute(o)||"",void 0!==t.toFixed&&Number(n)&&(n=this.setFixed(Number(n),t.toFixed))),this.propertyValue[o]=n,n}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name}setFixed(e,t){return e=parseFloat(e),(Math.round(((e+Number.EPSILON)*Math.pow(10,t)).toFixed(t))/Math.pow(10,t)).toFixed(t)}setupParams(){this.defaultParams();const e=this.userConfig.text||this.userConfig.texts||this.userConfig.textMap;let t=this.parseArray(e);for(let e=0;e<t.length;e++){let o=t[e];o.content=this.getValue(this.host,o);let n=THING.Utils.cloneObject(this.textDefConfig,!1),i=THING.Utils.cloneObject(o,!1),r=THING.Utils.mergeObject(n,i,!0),a=r.style,s=`${a.fontSize}px ${a.fontFamily}`;this.ctx.font=s;let l=this.ctx.measureText(o.content),c=Math.ceil(l.width);r.contentWidth=c,c>0&&(r.width=c+r.paddingLeft+r.paddingRight),this.sumTextWidth+=r.width;let u=Math.ceil(l.fontBoundingBoxAscent+l.fontBoundingBoxDescent+r.lineSpacing||0);this.maxTextHeight=this.getMaxNumber(this.maxTextHeight,u),"Bottom"!==r.layout[1]&&"Top"!==r.layout[1]||(this.textAboveImage=!0),t[e]=r}this.textConfigs=t;let o=this.userConfig.images,n=this.parseArray(o);this.imgCount=n.length;for(let e=0;e<this.imgCount;e++){let t=n[e],o=THING.Utils.cloneObject(this.imgDefConfig,!1),i=THING.Utils.cloneObject(t,!1);t=THING.Utils.mergeObject(o,i,!0),n[e]=t}this.imgConfigs=n}updateCanvas(){let e=this.showText;this.finishCnt=0;for(let e=0;e<this.textConfigs.length;e++)this.textConfigs[e].content=this.getValue(this.host,this.textConfigs[e]);let t=!0;this.textAboveImage||(t=!!(this.textConfigs[0]&&this.textConfigs[0].content||this.textConfigs[1]&&this.textConfigs[1].content)),e=e&&t,this.showText=e,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);let o=this;this.drawCanvas(e,(function(){const t=o.marker.style.opacity;if(o.marker.style.opacity=1,o.marker.canvas=o.canvas,o.marker.style.opacity=t,o.textAboveImage){let t=o.imgConfigs[0].size[1],n=o.imgConfigs[0].layoutOffset[1]+o.maxTextHeight+t;o.isFirst&&(o.H1=o.defaltShowText?o.marker.height:o.marker.height*(n/t),o.H2=o.defaltShowText?o.marker.height*(t/n):o.marker.height,o.isFirst=!1),o.marker.height=e?o.H1:o.H2}o.marker.width=o.canvas.width/o.canvas.height*o.marker.height;let n=o.userConfig.calPivotByLeft||!1,i=o.userConfig.leftPivot||[.5,1];if(o.userConfig.isTitleIcon||"Panel"==o.userConfig.type)o.marker.pivot=[.5,1];else if(n){let e=o.horWidthArr[0]*i[0]/o.canvas.width;o.marker.pivot=[e,1]}else{let e=o.leftImgSize[0]/2/o.canvas.width;o.marker.pivot=[e,1]}})),this.marker.node.renderOrder=2e6}calImgPos(e){this.showText=e,this.ctx.textBaseline="middle",this.ctx.textAlign="center";let t=[];for(let o=0;o<this.imgConfigs.length;o++){let i=THING.Utils.cloneObject(this.imgConfigs[o],!1);i.url=n.Z.getResourceUrl(this.serverFilePath+i.url);let r=i.size,a=i.layout[0],s=i.layout[1],l=i.layoutOffset[0],c=i.layoutOffset[1];e?this.textAboveImage?(l+=(this.canvas.width-i.size[0])/2,c+=this.maxTextHeight):"Corner"===i.type?("Center"===a&&(l+=(this.canvas.width-r[0])/2),"Bottom"===s?c=this.canvas.height-r[1]:"Top"===s&&(c=0)):("Center"==a?(l+=this.horWidthArr[0],r[0]=this.canvas.width-this.horWidthArr[0]-this.horWidthArr[2]-this.offset[0]):"Right"==a&&(l=this.canvas.width-i.size[0]),"Center"==s?c+=this.verHeightArr[0]:"Bottom"==s&&(c+=this.verHeightArr[0]+this.verHeightArr[1])):this.textAboveImage?(l+=(this.canvas.width-i.size[0])/2,c-=i.layoutOffset[1]):"Left"==a&&(l=0,c=0),i.x=l,i.y=c,t.push(i)}return t}calCanvasSize(e){let t=0,o=0,n=0,i=0,r=0,a=0,s=0,l=0,c=0,u=0,h=0,p=0,f=0;for(let t=0;t<this.imgConfigs.length;t++){const o=THING.Utils.cloneObject(this.imgConfigs[t],!1);let d=o.layout,g=d[0],m=d[1],y=o.layoutOffset;"Left"===g&&(n=this.getMinNumber(n,o.size[0]),c=this.getMaxNumber(c,o.size[1]),this.leftImgSize=o.size),e?"Corner"===o.type?"Center"===g&&("Bottom"!==m&&"Top"!==m||(u+=y[1],l+=o.size[1])):("Right"==g?(i=this.getMaxNumber(i,o.size[0]),p=this.getMaxNumber(p,o.size[0])):"Center"==g?(r=this.textAboveImage?this.getMaxNumber(this.sumTextWidth,o.size[0]):this.getMaxNumber(this.sumTextWidth,r),a=y[0],f=this.getMaxNumber(f,o.size[0]+y[0])):"Left"==g&&(h=this.getMaxNumber(h,o.size[0])),"Top"===m?s=this.getMaxNumber(s,o.size[1]):"Bottom"==m?l=this.getMaxNumber(l,o.size[1]):"Center"===m&&(c=this.getMaxNumber(c,o.size[1]),u=this.textAboveImage?y[1]:0,this.textBGHeight=o.size[1])):(this.textAboveImage?"Center"==g&&(r=this.getMaxNumber(r,o.size[0]),a=y[0]):"Left"==g&&(n=this.getMaxNumber(r,o.size[0])),"Center"===m&&(c=this.getMaxNumber(c,o.size[1]),this.textAboveImage&&(u=0))),this.offset=[a,u]}this.textAboveImage&&e&&(c+=this.maxTextHeight),this.horWidthArr=[n,r,i],this.verHeightArr=[s,c,l],t=r+a,o=s+l+c+u;let d=f+p,g=t<d?d:t;return this.canvas.width=g+n,this.canvas.height=o,{width:this.canvas.width,height:this.canvas.height}}drawCanvas(e,t){this.calCanvasSize(e);let o=this,n=this.calImgPos(e),i=0;return void function a(s){if(s<n.length)if(o.imagesObjectList[s]){let e=o.imagesObjectList[s];if(n[s].style.zIndex<i?o.ctx.globalCompositeOperation="destination-over":o.ctx.globalCompositeOperation="source-over",-1==e.src.indexOf("images/right.png")&&-1==e.src.indexOf("images/center.png")||void 0===o.userConfig.markDisTance||"default"!==o.bgStyle){if(o.ctx.drawImage(e,n[s].x,n[s].y,n[s].size[0],n[s].size[1]),n[s].style.monitorColor){let t=o.getValue(o.host,n[s].style.monitorColor);t&&t!==o.skipColor&&r(e,t,n[s].x,n[s].y)}else n[s].style.color!==o.skipColor&&r(e,n[s].style.color,n[s].x,n[s].y);i=n[s].style.zIndex}a(s+1)}else{var l=new Image;l.crossOrigin="Anonymous",l.src=n[s].url,l.onload=function(){if(o.imagesObjectList[s]=l,n[s].style.zIndex<i?o.ctx.globalCompositeOperation="destination-over":o.ctx.globalCompositeOperation="source-over",-1==l.src.indexOf("images/right.png")&&-1==l.src.indexOf("images/center.png")||void 0===o.userConfig.markDisTance||"default"!==o.bgStyle){if(o.ctx.drawImage(l,n[s].x,n[s].y,n[s].size[0],n[s].size[1]),n[s].style.monitorColor){let e=o.getValue(o.host,n[s].style.monitorColor);e&&e!==o.skipColor&&r(l,e,n[s].x,n[s].y)}else n[s].style.color,o.skipColor;r(l,n[s].style.color,n[s].x,n[s].y),i=n[s].style.zIndex}a(s+1)}}else o.ctx.globalCompositeOperation="source-over",e&&o.drawText(),"function"==typeof t&&t()}(0);function r(e,t,n,i){if(null==t)return;let r=THING.Utils.parseColor(t);if(1!=r.r||1!=r.g||1!=r.b){for(var a=o.ctx.getImageData(n,i,e.width,e.height),s=a.data,l=0;l<s.length;l+=4)s[l]=255*r.r,s[l+1]=255*r.g,s[l+2]=255*r.b;o.ctx.putImageData(a,n,i)}}}drawText(){let e=0,t=0,o=this.textConfigs[0];if(this.textAboveImage){e=this.canvas.width/2,t=this.maxTextHeight/2;let n=this.ctx.measureText(o.content);t=this.maxTextHeight/2+n.actualBoundingBoxAscent+o.paddingTop;let i=(this.canvas.width-this.sumTextWidth)/2;this.fillRoundRect(this.ctx,i,0,this.sumTextWidth,this.maxTextHeight,this.roundRectRadius,this.textBgColor)}else if(e=this.horWidthArr[0]+this.offset[0],t=this.userConfig.autoShowText?o.paddingTop+80:o.paddingTop+(o.lineSpacing||60),void 0!==this.userConfig.markDisTance){let o=e-140,n=t-this.maxTextHeight/2;"default"===this.bgStyle&&this.fillRoundRect(this.ctx,o,n,this.sumTextWidth+140,this.maxTextHeight,this.roundRectRadius,this.textBgColor)}for(let o=0;o<this.textConfigs.length;o++){const n=this.textConfigs[o],i=n.content||"";let r=n.style;const a=`${r.fontSize}px ${r.fontFamily}`;this.ctx.font=a,n.contentWidth&&!this.textAboveImage&&(e+=n.contentWidth/2+n.paddingLeft),this.ctx.fillStyle=r.fontColor,this.ctx.fillText(i,e,t),n.contentWidth&&(e+=n.contentWidth/2+n.paddingRight)}}drawRoundRectPath(e,t,o,n){e.beginPath(0),e.arc(t-n,o-n,n,0,Math.PI/2),e.lineTo(n,o),e.arc(n,o-n,n,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,o-n),e.closePath()}fillRoundRect(e,t,o,n,i,r,a){if(2*r>n||2*r>i)return!1;e.save(),e.translate(t,o),e.globalCompositeOperation="destination-over",this.drawRoundRectPath(e,n,i,r),e.fillStyle=a||"#000",e.fill(),e.restore()}drawRectangle(e){const{isCorner:t}=e,{drawSize:o}=e,{drawPos:n}=e,{color:i}=e,{percent:r}=e;if(i)if(i instanceof Array?this.canvas.setSolidBrush(i[0],i[1],i[2],1):this.canvas.setSolidBrush(i),t){const e=o[1],t=n[0]+e/2,i=n[1],a=this.canvas._context;a.beginPath(),a.arc(t,i+e/2,e/2,.5*Math.PI,1.5*Math.PI),a.fill(),o[0]*r-e/2>0&&this.canvas.fillRectangle(t,i,o[0]*r-e,e),o[0]*r-e>0&&(a.beginPath(),a.arc(t+o[0]*r-e,i+e/2,e/2,1.5*Math.PI,.5*Math.PI),a.fill())}else{const e=n[0],t=n[1],i=o[0]*r,a=o[1];this.canvas.fillRectangle(e,t,i,a)}}create(e){let t;e.userConfig.canvas=this.canvas;let o=e.parent.host||e.parent,i=e.userConfig.markDisTance||e.userConfig.markDistance||0,r=THING.App.current.camera,a=THING.Math.getDistance(r.position,o.position),s=a<=i,l=e.userConfig.showText,c=!0===e.userConfig.autoShowText,u=c?s&&l:l;if(t=n.Z.createCanvasMarker(e),this.marker=t,this.showText=u,t.TAI=this,t.dType="TextAndImage",this.updateCanvas(),!0===c&&l){let e=s;t.on("update",(function(){a=THING.Math.getDistance(r.position,o.position),e=a<=i,e!==s&&(t.TAI.showText=e,t.TAI.updateCanvas(),s=e)}),"æ¯ä¸å¸§æ´æ°ææ¬æ¾é")}return t.tags.push("æ¯ä¸å¸§æ´æ°ææ¬æ¾é"),t}}var r=o(354),a=o(257),s=o(563),l=o(370),c=o(543),u=o(245);const h=class{constructor(e){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.propertyValue={},this.showHelper=!1,this.imgsLoaded=!1,this.app=THING.App.current,this.filePath=e.serverFilePath,this.host=e.parent.host||e.parent,this.marker=null}setupCanvasParam(e){let t=function(e){let t=!!e,o=!1;return t&&(o=e.show),{has:t,show:o}},o=[];for(let t=0;t<e.title.texts.length;t++){let n=this._getTextValue(this.host,e.title.texts[t]);0===t&&(n=n||this.host.name),n&&o.push(n)}this.hasTitle=o.length>0,this.hasTitle?this.showTitle=e.title.show:this.showTitle=!1;let n=e.options;if(n&&n.autoDisplayTitle&&this.showTitle){let e=this.app.camera,t=THING.Math.getDistance(e.position,this.host.position),o=n.markDistance;this.showTitle=this.hasTitle=t<o}let i=t(e.line);this.hasLine=i.has,this.showLine=i.show;let r=t(e.sign);this.hasSign=r.has,this.showSign=r.show;let a=t(e.guide);this.hasGuide=a.has,this.showGuide=a.show,this.canvasConfig=e}create(e){if(this.userConfig=e.userConfig,this.canvasConfig=this.userConfig.canvasConfig,!this.marker){this.userConfig.type="Marker",e.userConfig.canvas=this.canvas,this.marker=n.Z.createCanvasMarker(e),this.marker.canvasObj=this;let t=this.canvasConfig.options;if(t&&t.autoDisplayTitle){let e=this.app.camera,o=this.showTitle,n=o,i=t.markDistance,r=this;this.marker.on("update",(function(t){let a=THING.Math.getDistance(e.position,r.host.position);n=a<=i,n!==o&&(t.object.canvasObj.showTitle=n,t.object.canvasObj.refresh(r.userConfig),o=n)}),100)}this.marker.node.renderOrder=2e6,this.marker.node.traverse((function(e){e._gBufferRoughness=1,e._gBufferIgnore=!0}))}this.refresh(this.userConfig),this.userConfig.lockYAxis&&!1===this.userConfig.useSpriteMaterial&&this.marker.lookAt(THING.App.current.camera,{lockYAxis:!0});let t=this.marker;if(this.userConfig.keepSize&&!t._pivotUpdate){let o=u.x.guid();t.on("update",(function(){let o=e.userConfig.pivot||[.5,1];o[0]===t.pivot[0]&&o[1]===t.pivot[1]||(t.pivot=e.userConfig.pivot||[.5,1])}),o),t._pivotUpdate=!0}return this.marker}_handleBGImg(e){let t={...c.VQ.backgroundImage,...this.canvasConfig.title.backgroundImage};t.images=[],this.canvas.width=t.width,this.canvas.height=t.height;let o=document.createElement("canvas");o.width=t.width,o.height=t.height;let n=o.getContext("2d");n.drawImage(t._imgData,0,0,t.width,t.height);let i=n.getImageData(0,0,t.width,1),r=[];for(let e=0;e<i.data.length;e+=4){let t=i.data[e];r[0]||0===t||(r[0]=e/4),r[0]&&!r[1]&&e>4*r[0]&&0===t&&(r[1]=e/4)}let a=r[0],s=r[1]-r[0],l=t.width-r[1];for(let e=1;e<=3;e++){let o={},n=e%3;1===n?(o.x=0,o.width=a):2===n?(o.x=r[0],o.width=s):0===n&&(o.x=r[1],o.width=l),o.y=t.markPixel,o.height=t.height-t.markPixel,t.images.push(o)}t.left_width=a,t.right_width=l;for(let e=0;e<t.images.length;e++){let o=new Image,i=t.images[e],r=n.getImageData(i.x,i.y,i.width,i.height),a=document.createElement("canvas");a.width=i.width,a.height=i.height,a.getContext("2d").putImageData(r,0,0);let s=a.toDataURL();o.src=s,o.onload=function(){i._imgData=o,i.width=o.width,i.height=o.height,e===t.images.length-1&&(t.imgCompleted=!0)}}o.remove();let h=this,p=u.x.guid();this.marker.tags||(this.marker.tags=[]),this.marker.tags.push(p),THING.App.current.on("update",(function(){t.imgCompleted&&(h.app.off("update","",p),h.canvasConfig.title.backgroundImage=t,"function"==typeof e&&e())}),p)}refresh(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);let e=this;this.setupCanvasParam(this.canvasConfig),this._drawCanvas((function(){const t=e.marker.style.opacity;e.marker.style.opacity=1,0!==e.canvas.width?(e.marker.canvas=e.canvas,e.marker.style.opacity=t,e.canvasConfig.sign&&e.showSign?e.marker.height=e.userConfig.height*e.canvas.height/e.canvasConfig.sign.size[1]:e.marker.height=e.userConfig.height,e.marker.width=e.marker.height*e.canvas.width/e.canvas.height):e.marker.destroy()}))}_loadImgs(e){let t=this.canvasConfig.guide||{},o=this.canvasConfig.sign||{},i=this.canvasConfig.title||{},r=this;function a(e){return["url","image","wallImage","lineImage","alphaImage"].forEach((t=>{let o=e[t];o&&(0==o.indexOf(r.filePath)&&(o=o.substr(r.filePath.length),o.startsWith("/")&&(o=o.substr(1))),o=!o.includes("http")&&o.indexOf(r.filePath)<0?-1!==o.indexOf("images/")||-1!==o.indexOf("image/")?s(r.filePath+o):uinv.utils.getResourceUrl(o):s(o),e[t]=function(e){if(void 0===e||null==e)return e;let t=0,o="";for(e.startsWith("http")&&(t=e.indexOf("//")+2,o=e.slice(0,t));t<e.length;t+=1)o[o.length-1]+e[t]!=="//"&&(o+=e[t]);return o}(o))})),e}function s(e){let t=n.Z.rsmPath,o=e.trim();return e.includes("http")||0===e.indexOf("./")||0===e.indexOf("/")||(t.endsWith("/")||(t+="/"),o=t+e),o}if(this.hasGuide){let e=t.images;if(e)for(let o=0;o<e.length;o++){let n=e[o],i=new Image;i.crossOrigin="Anonymous",n._imgData||(i.src=a(n,r.filePath).url,i.onload=function(){n._imgData=i,n.width=i.width,n.height=i.height,o===e.length-1&&(t.imgCompleted=!0)})}else{let e=new Image;e.crossOrigin="Anonymous",t._imgData||(e.src=a(t,r.filePath).url,e.onload=function(){t._imgData=e,t.imgCompleted=!0})}}else t.imgCompleted=!0;if(this.hasSign){let e=o.images,t=0;for(let n=0;n<e.length;n++){let i=e[n],s=new Image;s.crossOrigin="Anonymous",i._imgData||(s.src=a(i,r.filePath).url,s.onload=function(){i._imgData=s,i.width=s.width,i.height=s.height,t++,t===e.length&&(o.imgCompleted=!0)})}}else o.imgCompleted=!0;if(i&&i.backgroundImage){let e=i.backgroundImage;if(e.images&&e.images.length>0){i.backgroundImage.isMarkPixel=!1;for(let t=0;t<e.images.length;t++){let o=e.images[t];o.x=0,o.y=0;let n=new Image;n.crossOrigin="Anonymous",e._imgData||(n.src=a(o,r.filePath).url,n.onload=function(){o._imgData=n,o.width=n.width,o.height=n.height,t===e.images.length-1&&(i.imgCompleted=!0)})}i.backgroundImage.images=e.images}else if(i.backgroundImage.url){let t=new Image;t.crossOrigin="Anonymous",e._imgData||(t.src=a(e,r.filePath).url,t.onload=function(){e._imgData=t,e.width=t.width,e.height=t.height,r._handleBGImg((function(){i.imgCompleted=!0}))})}}else i.imgCompleted=!0;let l=u.x.guid();this.marker.tags||(this.marker.tags=[]),this.marker.tags.push(l),THING.App.current.on("update",(function(){r.imgsLoaded||t.imgCompleted&&o.imgCompleted&&i.imgCompleted&&(r.imgsLoaded=!0,r._drawCanvas(e),r.app.off("update","",l))}),l)}_drawCanvas(e){let t=this;if(this.imgsLoaded){this._calCanvasSize();let a=this.canvasConfig.guide||{};this.showGuide&&(a.draw=function(){if(t.showGuide){let e=a.images;if(e){p(e,"zIndex");for(let o=0;o<e.length;o++){const n=e[o];t.ctx.globalCompositeOperation=n.globalCompositeOperation||"source-over";let r=a.x,s=a.y;n.marginLeft&&(r+=n.marginLeft),n.marginTop&&(s+=n.marginTop),t.ctx.drawImage(n._imgData,r,s,n.size[0],n.size[1]),n.color&&i(n.size[0],n.size[1],n.color,r,s,n.renderType,n.exceptColor)}}else{if(a.angle){let e=a.x+a.size[0],o=a.y+a.size[1];t.ctx.translate(e,o),t.ctx.rotate(a.angle/180*Math.PI),t.ctx.drawImage(a._imgData,a.marginRight||0,a.marginTop||0,a.size[0],a.size[1]),t.ctx.rotate(-a.angle/180*Math.PI),t.ctx.translate(-e,-o)}else t.ctx.drawImage(a._imgData,a.x,a.y,a.size[0],a.size[1]);a.color&&i(a.size[0],a.size[1],a.color,a.x,a.y,a.renderType,a.exceptColor)}}});let s=this.canvasConfig.sign||{};this.showSign&&(s.draw=function(){if(t.showSign){let e=s.images;p(e,"zIndex");for(let o=0;o<e.length;o++){const n=e[o];t.ctx.globalCompositeOperation=n.globalCompositeOperation||"source-over",n._imgData&&t.ctx.drawImage(n._imgData,n.marginLeft?s.x+n.marginLeft:s.x,n.marginTop?s.y+n.marginTop:s.y,n.size[0],n.size[1]),n.color&&i(n.width||n.size[0],n.height||n.size[1],n.color,n.marginLeft?s.x+n.marginLeft:s.x,n.marginTop?s.y+n.marginTop:s.y,n.renderType,n.exceptColor)}}});let c=this.canvasConfig.line||{};this.showLine&&(c.draw=function(){t.showLine&&(t.ctx.strokeStyle=c.color||"#ff0000",t.ctx.lineWidth=c.width||2,t.ctx.beginPath(),t.ctx.moveTo(c.p0[0],c.p0[1]),t.ctx.lineTo(c.p1[0],c.p1[1]),t.ctx.stroke(),t.ctx.closePath())});let u=this.canvasConfig.title||{};this.showTitle&&(u.draw=function(){if(t.showTitle){let e=u.texts;const o=e[0];if(u.backgroundStyle==l.$J.RightTrapezoid){let r,a,s,c;n(),t.ctx.globalCompositeOperation="destination-over",(t.canvasConfig.guide.layout[0]||l.Ar.LEFT)===l.Ar.LEFT?(r=[u.x,u.y],a=[t.canvas.width-u.size[1],u.y],s=[t.canvas.width,u.y+u.size[1]],c=[u.x,u.y+u.size[1]]):(r=[u.x+u.size[1],u.y],a=[u.x,u.y+u.size[1]],s=[u.x+u.size[0],u.y+u.size[1]],c=[u.x+u.size[0],u.y]),t.ctx.beginPath(),t.ctx.moveTo(r[0],r[1]),t.ctx.lineTo(a[0],a[1]),t.ctx.lineTo(s[0],s[1]),t.ctx.lineTo(c[0],c[1]),t.ctx.closePath(),t.ctx.fillStyle=u.backgroundColor,t.ctx.fill()}else if(u.backgroundStyle==l.$J.Default){n(),t.ctx.globalCompositeOperation="destination-over";let h=u.cornerRadius,p=u.size[0],f=u.size[1];function d(e,t,o,n,i,r){e.beginPath(),e.arc(t-n,o-n,n,0,Math.PI/2),e.lineTo(n,o),e.arc(n,o-n,n,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,o-n),e.closePath(),e.translate(-u.x,-u.y)}(2*h>p||2*h>f)&&(h=f/2),t.ctx.translate(u.x,u.y),d(t.ctx,p,f,h,u.x,u.y),t.ctx.fillStyle=u.backgroundColor,t.ctx.fill(),t.ctx.restore(),t.ctx.save()}else if(u.backgroundStyle==l.$J.Image){let g=u.backgroundImage.images;for(let m=0;m<g.length;m++){let y=g[m];y.x=0,y.y=0;let _=m%3;if(1===_){if(y.width=Math.floor(t.canvasConfig.title.size[0]-g[0].width-g[2].width),y.width<=0)continue;y.x=g[0].width}else 2===_&&(y.x=Math.floor(t.canvasConfig.title.size[0]-g[2].width));u.backgroundImage.isMarkPixel&&(y.y-=u.backgroundImage.markPixel),y.x+=t.canvasConfig.title.x,y.y+=t.canvasConfig.title.y,t.ctx.drawImage(y._imgData,y.x,y.y,y.width,t.canvasConfig.title.size[1]),u.backgroundImage.color&&i(y.width,y.height,u.backgroundImage.color,y.x,y.y,y.renderType||u.backgroundImage.renderType,y.exceptColor||u.backgroundImage.exceptColor),t.showHelper&&(t.ctx.beginPath(),t.ctx.lineWidth=1,t.ctx.strokeStyle="yellow",t.ctx.rect(y.x,y.y,y.data.width,y.data.height),t.ctx.stroke())}n()}else n();function n(){t.ctx.globalCompositeOperation="source-over",function(e,t){e.textBaseline="top",e.font="10px Arail",e.measureText(t).fontBoundingBoxAscent}(t.ctx,o.innerText);for(let o=0;o<e.length;o++){let n=e[o],i=`${n.fontSize||24}px ${n.fontFamily||"Verdana"}`;t.ctx.font=i,t.ctx.fillStyle=n.fontColor||"#ffffff",t.ctx.shadowBlur=n.shadowBlur||0,t.ctx.shadowColor=n.shadowColor||"#000000",t.ctx.textAlign="left",t.ctx.textBaseline="top";let r=t.ctx.measureText(n.innerText).fontBoundingBoxAscent||0;t.ctx.fillText(n.innerText,n.x,u.y+n.paddingTop+r)}}t.ctx.globalCompositeOperation="source-over"}});let h=[a,s,c,u];function p(e,t){for(let o=0;o<e.length-1;o++)for(let n=0;n<e.length-1-o;n++)if(e[n]&&e[n+1]&&e[n][t]>e[n+1][t]){let t=e[n];e[n]=e[n+1],e[n+1]=t}}p(h,"zIndex");for(let d=0;d<h.length;d++){const g=h[d];g.draw&&g.draw()}let f=this.canvasConfig.options;if(f&&f.calPivotByCenterArea){let m=this.canvasConfig[f.centerArea],y=f.centerAreaPivot,_=m.size,v=m.x,T=m.y,x=(v+_[0]*y[0])/this.canvas.width,C=T+_[1]*y[1]/this.canvas.height;this.marker.pivot=[x,C]}"function"==typeof e&&e()}else this._loadImgs(e);function o(e){var t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),o=parseFloat(t[3]||1),n=Math.floor(o*parseInt(t[0])+255*(1-o)),i=Math.floor(o*parseInt(t[1])+255*(1-o)),r=Math.floor(o*parseInt(t[2])+255*(1-o));return"#"+("0"+n.toString(16)).slice(-2)+("0"+i.toString(16)).slice(-2)+("0"+r.toString(16)).slice(-2)}function n(e){var t=e.toLowerCase();if(t){if(4===t.length){for(var o="#",n=1;n<4;n+=1)o+=t.slice(n,n+1).concat(t.slice(n,n+1));t=o}var i=[];for(n=1;n<9;n+=2)i.push(parseInt("0x"+t.slice(n,n+2)));return isNaN(i[3])&&(i[3]=255),i}return t}function i(e,i,a,s,l,c="hue",u=""){if(null==a)return;let h="string"!=typeof a;var p=t.ctx.getImageData(s,l,e,i),f=p.data;if(h){let t=[],n=[],s=a.values,l=a.intervals,c=a.gradientType;"0"===l[0]&&"1"===l[l.length-1]||(l[0]="0",l[l.length-1]="1");var d=function(t){return"horizontal"==c?t/4%e:Math.floor(t/4/i)};for(let a=0;a<s.length;a++)if(a>0&&a<s.length){let u=l[a]-l[a-1],h="horizontal"==c?e*u:i*u,p=s[a-1];p="string"==typeof p&&p.indexOf("rgb")>-1?o(p):THING.Utils.parseColor(p.substr(0,7));let f=s[a];f="string"==typeof f&&f.indexOf("rgb")>-1?o(f):THING.Utils.parseColor(f.substr(0,7)),t=r(THING.Utils.parseColor(p),THING.Utils.parseColor(f),h,1),n=[...n,...t]}for(g=0;g<f.length;g+=4)255===f[g]&&255===f[g+1]&&255===f[g+2]&&n[d(g)]&&(f[g]=n[d(g)][0],f[g+1]=n[d(g)][1],f[g+2]=n[d(g)][2])}else{let e=n(a),t=n(u);for(var g=0;g<f.length;g+=4)if(f[g]!==t[0]||f[g+1]!==t[1]||f[g+2]!==t[2])if("hue"===c)255===f[g]&&255===f[g+1]&&255===f[g+2]&&(f[g]=e[0],f[g+1]=e[1],f[g+2]=e[2]);else if("multiply"===c){f[g]=e[0]*f[g]/255,f[g+1]=e[1]*f[g+1]/255,f[g+2]=e[2]*f[g+2]/255;let t=e[3]||255;f[g+3]=t*f[g+3]/255}}t.ctx.putImageData(p,s,l)}function r(e,t,o,n){var i,r,a,s,l=[];n=n||1;let c=function(e){if(e instanceof Array)return e;let t=[];for(let o in e)"r"!==o&&"g"!==o&&"b"!==o||t.push(e[o]);return t};var u;for(e=c(e),t=c(t),i=0;i<o;i++){s=1-(a=i/(o-1));let c=[];for(r=0;r<3;r++)c[r]=1===(u=Math.round(255*Math.pow(e[r]*s+t[r]*a,1/n))).length?"0"+u:u;l.push(c)}return l}}_calCanvasSize(){let e=this,t=function(t){let n=e._getTextValue(e.host,t),i=t.decimalDigits||0,r="";n&&(r=isNaN(Number(n))?n:i?Number(n).toFixed(i):Number(n)),t.innerText=r,t.stateText&&(t.fontColor=t.fontColorConfig[r].color);let a=o(t),s=t.paddingLeft||0,l=t.paddingRight||0,c=t.paddingTop||0,u=t.paddingBottom||0,h=a[0]+s+l,p=a[1]+c+u;return{...t,size:[h,p],oriSize:a}},o=function(t){e.ctx.textAlign="left",e.ctx.textBaseline="top";let o=`${t.fontSize||24}px ${t.fontFamily||"Verdana"}`;e.ctx.font=o;let n=e.ctx.measureText(t.innerText);return[n.width,n.fontBoundingBoxAscent+n.fontBoundingBoxDescent||t.fontSize]},n=0,i=0,r=0,a=0,s=0,h=0,p=0,f=0,d=0,g=0;this.showLine&&(this.canvasConfig.line={...c.D9,...this.canvasConfig.line},this.lineOnLeft=this.canvasConfig.guide.layout[0]===l.Ar.LEFT);let m,y=0,_=0,v=0,T=0;if(m={...c.O3,...this.canvasConfig.guide},this.hasGuide){if(this.showGuide){if(m.images){for(let e=0;e<m.images.length;e++){const t=m.images[e];v=u.x._getMaxNumber(t.size[0],v),T=u.x._getMaxNumber(t.size[1],T)}m.size=[v,T],y=v,_=T}if(this.hasLine&&this.showLine){let e=m.pivot;this.lineOnLeft?(n=(1-e[0])*m.size[0],i=e[1]*m.size[1]):(n=e[0]*m.size[0],i=e[1]*m.size[1])}d=m.layout[0]===l.Ar.LEFT?(m.marginRight||0)+m.size[0]:m.layout[0]===l.Ar.RIGHT?(m.marginLeft||0)+m.size[0]:m.size[0],m.layout[1]===l.Ar.BOTTOM&&(g=m.marginTop+m.size[1])}this.canvasConfig.guide=m}let x=0,C=0,b=0,w=0,P={...c.WT,...this.canvasConfig.sign};if(this.hasSign){if(this.showSign){for(let e=0;e<P.images.length;e++){const t=P.images[e];b=u.x._getMaxNumber(t.size[0],b),w=u.x._getMaxNumber(t.size[1],w)}if(P.size=[b,w],x=b,C=w,this.hasLine&&this.showLine){let e=P.pivot;this.lineOnLeft?(s=e[0]*P.size[0],h=(1-e[1])*P.size[1]):(s=(1-e[0])*P.size[0],h=(1-e[1])*P.size[1])}}this.canvasConfig.sign=P}let S=0,L=0,E={...c.VQ,...this.canvasConfig.title};if(this.hasTitle){if(this.showTitle){for(let e=0;e<E.texts.length;e++){const o=E.texts[e];o.size=t(o).size,(o.innerText||0===o.innerText)&&(S+=o.size[0],L=u.x._getMaxNumber(t(o).size[1],L))}if(E.oriSize=[S,L],E.backgroundStyle==l.$J.RightTrapezoid)S+=L;else if(E.backgroundStyle===l.$J.Image){let e=E.backgroundImage.images,t=0,o=0;if(e.length>1){for(let t=0;t<e.length;t++){const o=e[t];1===t&&(o.width=S-e[0].width-e[2].width),L=u.x._getMaxNumber(L,o.height)}let n=e[0].width+e[2].width;n>S&&(S=n),E._bgLeftImageWidth=t,E._bgRightImageWidth=o,E._bgCenterImageWidth=e[1].width}}if(E.size=[S,L],this.hasLine&&this.showLine){let e=E.pivot;this.lineOnLeft?(p=e[0]*E.size[0],f=(1-e[1])*E.size[1]):(p=(1-e[0])*E.size[0],f=(1-e[1])*E.size[1])}}this.canvasConfig.title=E;let e=E.layout;e[0]===l.Ar.RIGHT?(x=b+S+(this.showTitle?E.marginLeft:0),this.showLine&&(this.lineOnLeft?this.showSign?(r=s,a=h):this.showTitle&&(r=p,a=f):this.showTitle?(r=p,a=f):this.showSign&&(r=s,a=h))):e[0]===l.Ar.LEFT?(x=b+S+(this.showTitle?E.marginRight:0),this.showLine&&(this.lineOnLeft?this.showTitle?(r=p,a=f):this.showSign&&(r=s,a=h):this.showSign?(r=s,a=h):this.showTitle&&(r=p,a=f))):e[0]===l.Ar.CENTER&&(x=u.x._getMaxNumber(S,b)),e[1]===l.Ar.TOP?C=w+L+(this.showTitle?E.marginBottom:0):e[0]===l.Ar.BOTTOM?C=w+L+(this.showTitle?E.marginTop:0):e[1]===l.Ar.CENTER&&(C=u.x._getMaxNumber(w,L+(this.showTitle?E.marginTop:0)))}let I,O=0,M=0;this.hasLine&&this.showLine&&(I={...c.D9,...this.canvasConfig.line},this.showLine&&(O=Math.floor((I.length||200)*Math.cos(Math.PI*(I.angle||45)/180)),M=Math.floor((I.length||200)*Math.sin(Math.PI*(I.angle||45)/180)),I.oriSize=[O,M],O-=n+s,M-=i+h,I.size=[O,M])),this.canvasConfig.line=I;let N=0;if(N=m.layout[0]===l.Ar.CENTER?x>(this.showGuide?d:0)?x:d:x+(this.showGuide?d:0),this.canvas.width=N+(this.showLine?O:0),this.canvas.height=C+(this.showGuide?g:0)+(this.showLine?M:0),this.showLine){let e={};if(this.lineOnLeft){this.hasGuide&&(m.x=0,m.y=this.canvas.height-m.size[1]),I.p0=[m.x+m.size[0]-n,m.y+i];let t=I.p0[0]+I.oriSize[0]||0,o=I.p0[1]-I.oriSize[1]||0;I.p1=[t,o],e.x=t-r,e.y=o+a-C}else{this.hasGuide&&(m.x=this.canvas.width-m.size[0],m.y=this.canvas.height-m.size[1]),I.p0=[m.x+n,m.y+i];let t=I.p0[0]-I.oriSize[0],o=I.p0[1]-I.oriSize[1];I.p1=[t,o],e.x=0,e.y=0}this.showTitle?E.layout[0]===l.Ar.RIGHT?this.showSign?(P.x=e.x,P.y=e.y+P.marginTop,E.x=P.x+P.size[0]+E.marginLeft,E.y=e.y+E.marginTop):(E.x=e.x,E.y=e.y+E.marginTop):E.layout[0]===l.Ar.LEFT&&(this.showSign?(E.x=e.x,E.y=e.y+E.marginTop,P.x=E.x+E.size[0]+E.marginLeft,P.y=e.y+P.marginTop):(E.x=e.x,E.y=e.y+E.marginTop)):(P.x=e.x,P.y=e.y)}else if(this.showTitle?(E.layout[0]===l.Ar.RIGHT?(P.x=0,E.x=P.x+P.size[0]+E.marginLeft):E.layout[0]===l.Ar.CENTER&&(E.x=(x-E.size[0])/2,this.showSign&&(P.x=(x-P.size[0])/2)),E.layout[1]===l.Ar.TOP?(E.y=0,P.y=E.y+E.size[1]+E.marginBottom):E.layout[1]===l.Ar.CENTER&&(E.y=E.marginTop,this.showSign&&(P.y=(C-P.size[1])/2))):this.showSign&&(P.x=0,P.y=0),this.showGuide){let e=m.layout;e[0]===l.Ar.LEFT?(m.x=0,P.x=m.size[0]+m.marginRight||0,E.x=m.size[0]+m.marginRight||0):e[0]===l.Ar.RIGHT?m.x=this.canvas.width-m.size[0]+m.marginLeft||0:m.x=(this.canvas.width-m.size[0])/2,e[1]===l.Ar.BOTTOM?m.y=this.canvas.height-m.size[1]:e[1]===l.Ar.CENTER&&(m.y=(this.canvas.height-m.size[1])/2)}if(this.showTitle){let e=E.x;for(let t=0;t<E.texts.length;t++){const o=E.texts[t];(o.innerText||0===o.innerText)&&(o.x=e+o.paddingLeft,e+=o.size[0],o.y=E.y+o.paddingTop)}if(E.backgroundStyle===l.$J.Image){let e=E.backgroundImage;for(let t=0;t<e.length;t++){let e=E.backgroundImage[t];e.layout[0]===l.Ar.LEFT?e.x=0:e.layout[0]===l.Ar.CENTER?e.x=E._bgLeftImageWidth:e.layout[0]===l.Ar.RIGHT&&(e.x=E._bgLeftImageWidth+E._bgCenterImageWidth),e.x=e.x+E.x,e.y=E.y,e.height=E.size[1]}}}}_getTextValue(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;let n="";return o&&(n=e.getAttribute(o),void 0!==t.toFixed&&Number(n)&&(n=Number(n).toFixed(t.toFixed)),this.propertyValue[o]=n),n}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):null}};class p{constructor(e){this.app=THING.App.current,this.clsParam=e.userConfig,this.host=this.clsParam.parent}setupBeforeCreate(){let e=this.host.points||this.host.POINTS,t=!(e&&e.length>0),o=this.clsParam.isFlyLine;if(this.clsParam.style||(this.clsParam.style={lineType:"pixel",...this.clsParam.style}),t){if(this.clsParam.geojson=this.host.geojson,this.host.startLonlat&&this.host.endLonlat){this.clsParam.coordinates=[this.host.startLonlat,this.host.endLonlat];let e=[];for(let t=0;t<this.clsParam.coordinates.length;t++){let t=CMAP.Util.convertWorldToLonlat(this.host.position)[2];e.push(t)}this.clsParam.heightArray=e}else this.clsParam.coordinates=this.host.geojson;this.clsParam.type=o?"GeoFlyLine":"GeoLine","pixel"===this.clsParam.style.lineType&&(this.clsParam.style.lineType="line"),this.clsParam.renderer=this.clsParam.style}else{this.clsParam.points=e;let t={pixel:"Line",plane:"MeshLine",pipe:"PolygonLine",route:"RouteLine"};this.clsParam.type=t[this._lineType],this.clsParam.style.image=this.clsParam.style.url,this.clsParam.offsetHeight&&(this.clsParam.localPosition=[0,this.clsParam.offsetHeight,0]);let n=this.clsParam.points[0],i=this.clsParam.points[1],r=this.clsParam.curvature;o&&(this.clsParam.points=this._bezierCurvePoints(n,i,r,100),THING.Math.getVectorLength(THING.Math.subVector(this.clsParam.points[99],this.clsParam.points[100]))<.3&&(this.clsParam.cornerRadius=0))}}_bezierCurvePoints(e,t,o,n){let i=function(e,t,o,n){let i=1-e,r=e*e,a=i*i,s=THING.Math.scaleVector(t,a);return s=THING.Math.addVector(THING.Math.scaleVector(o,2*i*e),s),s=THING.Math.addVector(THING.Math.scaleVector(n,r),s),s},r=[],a=function(e,t,o){let n=THING.Math.subVector(t,e),i=THING.Math.crossVector([0,1,0],n),r=THING.Math.normalizeVector(THING.Math.crossVector(n,i)),a=THING.Math.scaleVector(THING.Math.addVector(e,t),.5),s=THING.Math.getVectorLength(n)/2;return THING.Math.addVector(a,THING.Math.scaleVector(r,o||s))}(e,t,o);r[0]=e;for(let o=1;o<=n;o++){let s=i(o/n,e,a,t);r.push(s)}return r}create(){return this.setupBeforeCreate(),this.atmObj=this.app.create(this.clsParam),this.atmObj}setupAfterCreate(){}}function f(e,t){var o=function(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;let i="";return o&&(i=e.getAttribute(o),void 0!==t.toFixed&&Number(i)&&(i=n(Number(i),t.toFixed))),i}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name},n=function(e,t){return e=parseFloat(e),(Math.round(((e+Number.EPSILON)*Math.pow(10,t)).toFixed(t))/Math.pow(10,t)).toFixed(t)};let i=document.createElement("canvas"),r=i.getContext("2d"),a=e.headline||{},s=!(a instanceof Array);if(s){var l=o(t.host,a);const e=`${a.fontSize||120}px ${a.fontFamily||"Arail"}`;r.font=e;let n=r.measureText(l);a.content=l,a.width=n.width,a.x=a.textSpacing||0,a.realWidth=n.width+2*(a.textSpacing||0),i.width=a.realWidth;let s=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent||a.fontSize;i.height=s+2*(a.lineSpacing||0)+(a.paddingTop||0)+(a.paddingBottom||0),a.y=a.lineSpacing+(a.paddingTop||0)}else{l="";var c=a.length;i.width=0,i.height=0;for(let e=0;e<c;e++){let n=a[e];const s=`${n.fontSize||120}px ${n.fontFamily||"Arail"}`;if(r.font=s,!(l=o(t.host,n)))continue;let c=r.measureText(l);n.content=l,n.width=c.width,n.x=e>0?(a[e-1].realWidth||0)+(n.textSpacing||0):n.textSpacing||0,n.realWidth=c.width+2*(n.textSpacing||0),i.width+=n.realWidth;let u=(c.actualBoundingBoxAscent+c.actualBoundingBoxDescent||n.fontSize)+2*(n.lineSpacing||0)+(n.paddingTop||0)+(n.paddingBottom||0);i.height=u-i.height>0?u:i.height,n.y=n.lineSpacing+(n.paddingTop||0)}}let u=s?a:a[0],h=u.roundRectRadius||0,p=u.textBgColor||u.backgroundColor||"#16181a",f=u.textBgOpacity||u.backgroundOpacity||0;f=Math.round(f/100*255).toString(16),"0"===f&&(f="00");let d=p+f;function g(e){r.textBaseline="top",r.textAlign="left";const t=`${e.fontSize||120}px ${e.fontFamily||"Arail"}`;r.font=t,r.fillStyle=e.fontColor||"#ffffff",r.fillText(e.content,e.x,e.y)}if(function(e,t,o,n,i,r,a){(2*r>n||2*r>i)&&(r=i/2),e.save(),e.translate(0,0),function(e,t,o,n){e.beginPath(0),e.arc(t-n,o-n,n,0,Math.PI/2),e.lineTo(n,o),e.arc(n,o-n,n,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,o-n),e.closePath()}(e,n,i,r),e.fillStyle=a||"#16181acc",e.fill(),e.restore()}(r,0,0,i.width,i.height,h,d),s)g(a);else for(let e=0;e<c;e++)g(a[e]);let m=THING.App.current.create({type:"Marker",parent:t,height:u.height||0,keepSize:void 0===u.keepSize||u.keepSize,useSpriteMaterial:void 0===u.useSpriteMaterial||u.useSpriteMaterial,canvas:i,inheritStyle:!0,pivot:u.pivot||[.5,1],complete:function(){let e=this,o=t.scale;t.parent.keepSize&&!t.parent.inheritScale&&(t.scale=[1,1,1]);let n=t,i=t.subNodes.query("virtual_top_point");i.length&&(n=i[0]);let r=n.getLayoutPosition(["Center","Top","Center"],null,!1,!1,!0);t.parent.keepSize&&!t.parent.inheritScale&&(t.scale=o),t.parent.keepSize&&(e.scale=THING.Math.scaleVector(e.scale,1/t.scale[1]));let a=u.layoutOffset||u.localPosition||[0,0,0];THING.Math.getDistance(t.parent.position,[0,0,0])>2e4?e.localPosition=THING.Math.scaleVector(a,6):e.position=THING.Math.addVector(r,a),!0===u.lockYAxis&&(e.lookAt(THING.App.current.camera,{lockYAxis:!0}),e.on("update",(function(){e.pivot=u.pivot||[.5,1]}))),!1!==u.lockYAxis&&!1!==u.useSpriteMaterial||e.on("update",(function(){e.pivot=u.pivot||[.5,1]}))}});m.width=i.width/i.height*m.height}class d{create(e){let t=this,o=e.host||e.parent;if(!o.geojson)return void console.error("è¯·éç½®åè½¦è·¯çº¿æ°æ®ï¼ï¼ï¼");let i=JSON.parse(JSON.stringify(e.host.geojson)).features[0].geometry.coordinates[0];for(let e=0;e<i.length;e++)i[e]=CMAP.Util.convertLonlatToWorld(i[e]);this.scurve=new sCurve({points:i});let r=e.userConfig.carriageCount||3,a=e.userConfig.trainSize||1,s=function(e,t){if(t&&"objectProperty"===t.getMethod){const i=t.propertyPath;let r=e.getAttribute(i);return void 0!==t.toFixed&&Number(r)&&(o=Number(r),n=t.toFixed,o=parseFloat(o),r=(Math.round(((o+Number.EPSILON)*Math.pow(10,n)).toFixed(n))/Math.pow(10,n)).toFixed(n)),r}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name;var o,n}(o,e.userConfig.windowColor),l=[],c=[],u=[],h=[],p=function(e){let t=0;for(let o=0;o<e+1;o++)t+=l[o];return t-=.5*l[e],t},f={head:n.Z.parseUrl(e.headUrl),tail:n.Z.parseUrl(e.tailUrl),body:n.Z.parseUrl(e.bodyUrl)},d=0;for(let e=0;e<r;e++){let n="";n=e===r-1?f.tail:0===e?f.head:f.body;let i=o.position,s=THING.App.current.create({type:"Thing",url:n,inheritScale:!1,visible:!1,scale:[a,a,a],parent:obj,complete:function(n){if(0===e?(n.object.name="è½¦å¤´",h.push(s.subNodes.query(/ç»ç/)[0])):e===r-1?(n.object.name="è½¦å°¾",h.push(s.subNodes.query(/ç»ç/)[0])):(n.object.name="è½¦èº«"+e,h.push(s.subNodes.query(/ç»ç/)[0])),u[e]=s,l[e]=s.boundingBox.initSize[0],c[e]=s.boundingBox.initSize[1],d===r-1){for(let t=0;t<r;t++){let n=p(t)*a,r=THING.Math.subVector(i,THING.Math.scaleVector(o.forward,n));r=[r[0],r[1]+c[e]/2+r[2]],u[t].position=r,u[t].visible=!0}obj.on("update",(function(){t.updateCarsTrasform()}),"updatePosition"),m(/è½¦å¤´/,THING.App.current),m(/è½¦èº«/,THING.App.current),m(/è½¦å°¾/,THING.App.current)}d++}})}obj.parent.on("update",(function(){0!=h.length&&(o.ALARM?h.forEach((e=>{e.style.color=ev.object._userData.warningColor||"#00ff00",e.style.opacity=.5+.5*Math.sin(2*THING.App.current.elapsedTime/500),e.style.glow=!0,e.visible=!1,e.visible=!0})):h.forEach((e=>{e.style.color=s||"",e.style.opacity=1,e.visible=!1,e.visible=!0})))}),"warning-color"),obj.parent.on("DecoratorsDestroy",(function(){for(let e=r-1;e>=0;e--){const t=u[e];t&&t.destroy()}window.instanceFlag=!1}))}updateCarsTrasform(){let e=this.scurve.getSegmentID(host.position);e<=0&&(e=0);let t=this.scurve.segments.get(e),o=t.sumLength-t.length+THING.Math.getDistance(host.position,t.points[0]);for(let e=0;e<carriageCount;e++){if(!carriages[e])continue;let t=o-calCarLength(e)*trainSize,n=this.scurve.getVector3ByLength(t);carriages[e].position=n.position;let i=carriages[e].forward,r=n.forward,a=THING.Math.dotVector(i,r);carriages[e].rotateY(a/Math.PI*180);let s=carriages[e].worldAngles;carriages[e].worldAngles=s}}}const g=(e,t,o)=>{THING.Utils.isArray(o[e])?o[e].push(t):o[e]=[t]},m=function(e,t){const o=t.query(e,!1),n=[];for(let e=0;e<o.objects.length;e+=1){const t=o.objects[e];THING.InstanceTool.checkBatchCondition(t)&&(t._isFilp?g(1,t,n):g(0,t,n))}for(let t=0;t<n.length;t++){const o=n[t];THING.Utils.isArray(o)&&o.length>=THING.InstanceTool.BatchNumber&&(o.forEach((e=>{THING.InstanceTool.saveOriginProperties(e)})),THING.instanceTool.makeBatch(e,o))}};var y=o(635);function _(e){const{rsmPath:t}=e;function o(e){return e.hasOwnProperty("geometry")}function l(e){const{userConfig:t}=e,i=n.Z.createModel(e);return i.on("complete",(e=>{i.inheritStyle=!0;let n=t.style||{};if(void 0!==n.SKIP_THEME&&n.SKIP_THEME){const e=i.style.opacity;i.style.opacity=1,i.node.getMeshes().every(o)&&(THREE.ShaderLib.lambert.vertexShader=THREE.ShaderLib.lambert.vertexShader.replace("#include <lights_lambert_vertex>","\n                        #include <lights_lambert_vertex>\n                        \n                        #ifdef CUSTOM_LIGHT\n                                dotNL = dot( geometry.normal, normalize(vec3(1., 1., 1.)) );\n                                vLightFront = saturate( dotNL ) * PI * vec3(0.5, 0.5, 0.5);\n                                vIndirectFront = getAmbientLightIrradiance(vec3(0.4, 0.4, 0.4));\n                        #endif\n                    "),i.style._skipApplyTheme=!0,i.node.traverse((function(e){if(e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1,e._gBufferRoughness=1),e.material)if(e.material.length>1)for(let n=0;n<e.material.length;n++){const i=e.material[n];if("SpriteMaterial"!==i.type){var t=i||e.material;(o=new THREE.MeshLambertMaterial).map=t.map||null,o.alphaMap=t.alphaMap||null,o.emissiveMap=t.emissiveMap||null,o.emissiveIntensity=t.emissiveIntensity||1,t.emissiveColor&&o.emissiveColor.copy(t.emissiveColor),o.opacity=t.opacity,o.color=t.color,o.transparent=t.transparent,o.blending=t.blending,o.side=THREE.DoubleSide,o.alphaTest=t.alphaTest,o.defines={CUSTOM_LIGHT:""},t.defines&&t.defines.USE_ALPHAINDEX&&(o.defines.USE_ALPHAINDEX=!0),e.material[n]=o}}else{var o;if("SpriteMaterial"===(t=e.material).type)return;(o=new THREE.MeshLambertMaterial).map=t.map||null,o.alphaMap=t.alphaMap||null,o.emissiveMap=t.emissiveMap||null,o.emissiveIntensity=t.emissiveIntensity||1,t.emissiveColor&&o.emissiveColor.copy(t.emissiveColor),o.opacity=t.opacity,o.color=t.color,o.side=THREE.DoubleSide,o.transparent=t.transparent,o.blending=t.blending,o.alphaTest=t.alphaTest,o.defines={CUSTOM_LIGHT:""},t.defines&&t.defines.USE_ALPHAINDEX&&(o.defines.USE_ALPHAINDEX=!0),e.material=o}})),i.style.opacity=e)}let r=e.object;if(t.playAnimation&&t.animationName){const e=r.userData.tempAnimationName;-1!=r.animationNames.indexOf("_enter_")?r.playAnimation({name:"_normal_",complete:function(o){setTimeout((function(){r.playAnimation({name:e||"_normal_",loopType:t.animationLoopType||THING.LoopType.Repeat}),t.showHeadline&&f(t,i)}),0)}}):e&&(-1!==r.animationNames.indexOf(e)&&(r.playAnimation({name:e,loopType:r.userData.tempAnimationLoopType}),delete r.userData.tempAnimationName,delete r.userData.tempAnimationLoopType),t.showHeadline&&f(t,i))}if(t.lockYAxis&&i.lookAt(THING.App.current.camera,{lockYAxis:!0}),t.lookAtCamera){let e=i.node.getMeshes().length;if(e>0)for(let t=0;t<e;t++)i.node.getMeshes()[t].material.side=THREE.DoubleSide;i.lookAt(THING.App.current.camera,{angles:t.lookAtCameraAngles||[90,0,0]})}r.destroyed||(i.style.skipOutline=void 0===t.skipOutline||t.skipOutline,THING.INSTANCETOOL&&t.doBatch&&(THING.enableInstance||(THING.enableInstance=!0,THING.INSTANCETOOL.setupInstance({app:THING.App.current,themeName:null,dynamic:!1})),THING.instanceTool.doBatchFromObject(i)))}),100),i}function c(e){const{userConfig:t}=e;t.useSpriteMaterial=!1;let{style:o}=t,i="";const r=e.parent.host||e.parent;if(t.getMethod){if("objectProperty"===t.getMethod){const l=t.propertyPath;i=r.getAttribute(l)}"presetValue"===t.getMethod&&(i=t.presetValue),"func"===t.getMethod&&(i=t.getFunc.call(null,r))}const a=n.Z.createTextCanvas(i,o);t.canvas=a;let s=n.Z.createCanvasMarker(e);if(s.canvas=a,t.lookAtCamera){const c=n.Z.createVerticalTextCanvas(i,o);let u=0;function h(){let e=p();(e<45||e>=315)&&!(u<45||u>=315)?(f(),s.angles=[-90,0,0],s.pivot=[.5,.5]):e>=45&&e<135&&!(u>=45&&u<135)?(d(c),s.angles=[-90,0,90],s.pivot=[.5,.5]):e>=135&&e<225&&!(u>=135&&u<225)?(f(),s.angles=[-90,0,180],s.pivot=[.5,.5]):e>=225&&e<315&&!(u>=225&&u<315)&&(d(c),s.angles=[-90,0,270],s.pivot=[.5,.5]),u=e}function p(){const e=r,t=e.app.camera;let o,i=(new THREE.Vector3).crossVectors(THING.Utils.parseVector3(t.direction),THING.Utils.parseVector3(t.rightDirection));i.setY(0),i=i.normalize();let{forward:a}=e;return o=THING.Utils.parseVector3(a),0==a[0]&&0==a[1]&&1==a[2]?o=THING.Utils.parseVector3(a):CMAP&&(o=THING.Utils.parseVector3(CMAP.Util._getAxis("z",e))),n.Z.angleTwoVectorsZ(o,i)}function f(){s.canvas=a,t.canvas=a;let e=t.height;s.height=e,s.width=s.height/a.height*a.width,s.rotateY(0)}function d(e){s.canvas=e,t.canvas=e;let o=t.height;s.width=o,s.height=s.width/e.width*e.height,s.rotateY(0)}THING.App.current.on("mousedown",(function(e){THING.App.current.on("mousemove",(function(e){h()}))}))}return t.rotation&&(s.rotateX(t.rotation[0]-0),s.rotateY(t.rotation[1]-0),s.rotateZ(t.rotation[2]-0)),s}function u(e){const{userConfig:t}=e,{parent:o}=e,i=o.host||o,r=THING.App.current.create({type:"BaseObject",id:`${e.tag}_${e.effectName}_${e.parent.id}`,parent:o,inheritStyle:!1});let a,s;t.lineType=t.lineType||"Plane",t.type="image",t.NoBlending=void 0===t.NoBlending||t.NoBlending;const l=n.Z.getPointsData(i);return l.length>1?(e.points=l,a=n.Z.createRouteLine(e),s=g(a,e)):s=n.Z.createGeoLine(e),s.translateY(t.offsetHeight||0),s.style.alwaysOnTop=t.alwaysOnTop,r.add(s),r}function g(e,t){const{userConfig:o}=t;return e.on("complete",(t=>{e.inheritStyle=!0;let n=o.userData||{};if(void 0===n.SKIP_THEME||n.SKIP_THEME){const t=e.style.opacity;e.style.opacity=1,THREE.ShaderLib.lambert.vertexShader=THREE.ShaderLib.lambert.vertexShader.replace("#include <lights_lambert_vertex>","\n                        #include <lights_lambert_vertex>\n                        \n                        #ifdef CUSTOM_LIGHT\n                                dotNL = dot( geometry.normal, normalize(vec3(1., 1., 1.)) );\n                                vLightFront = saturate( dotNL ) * PI * vec3(0.5, 0.5, 0.5);\n                                vIndirectFront = getAmbientLightIrradiance(vec3(0.4, 0.4, 0.4));\n                        #endif\n                    "),e.style._skipApplyTheme=!0,e.node.traverse((function(e){if(e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1,e._gBufferRoughness=1),e.material)if(e.material.length>1)for(let n=0;n<e.material.length;n++){const i=e.material[n];if("SpriteMaterial"!==i.type){var t=i||e.material;(o=new THREE.MeshLambertMaterial).map=t.map||null,o.alphaMap=t.alphaMap||null,o.emissiveMap=t.emissiveMap||null,o.emissiveIntensity=t.emissiveIntensity||1,t.emissiveColor&&o.emissiveColor.copy(t.emissiveColor),o.opacity=t.opacity,o.color=t.color,o.transparent=t.transparent,o.blending=t.blending,o.alphaTest=t.alphaTest,o.defines={CUSTOM_LIGHT:""},t.defines&&t.defines.USE_ALPHAINDEX&&(o.defines.USE_ALPHAINDEX=!0),e.material[n]=o}}else{var o;if("SpriteMaterial"===(t=e.material).type)return;(o=new THREE.MeshLambertMaterial).map=t.map||null,o.alphaMap=t.alphaMap||null,o.emissiveMap=t.emissiveMap||null,o.emissiveIntensity=t.emissiveIntensity||1,t.emissiveColor&&o.emissiveColor.copy(t.emissiveColor),o.opacity=t.opacity,o.color=t.color,o.transparent=t.transparent,o.blending=t.blending,o.alphaTest=t.alphaTest,o.defines={CUSTOM_LIGHT:""},t.defines&&t.defines.USE_ALPHAINDEX&&(o.defines.USE_ALPHAINDEX=!0),e.material=o}})),e.style.opacity=t}t.object.destroyed||THING.INSTANCETOOL&&o.doBatch&&(THING.enableInstance||(THING.enableInstance=!0,THING.INSTANCETOOL.setupInstance({app:THING.App.current,themeName:null,dynamic:!1})),THING.instanceTool.doBatchFromObject(e))}),100),e}function m(e){const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let r;const a=n.Z.getPointsData(i,t);let s=e.userConfig.opacity;if(s){if("number"!=typeof s){let e=s[0],t=s[1];t>1&&(e/=100,t/=100),s=Math.round(100*(Math.random()*(t-e)+e))/100}s>1&&(s/=100),e.userConfig.opacity=s.toFixed(2)-0}if(a.length>2)e.points=a,r=n.Z.createPolygonRegion(e);else{t.type="vector";let o=e.userConfig.outlineOpacity;o?(o>1&&(o/=100),e.userConfig.outlineOpacity=o.toFixed(2)):e.userConfig.outlineOpacity=.9,r=n.Z.createGeoPolygon(e)}return r.isPolygon=!0,r}e._util=n.Z,n.Z.rsmPath=t,n.Z.htmlCssMap=e.htmlCssMap,e.regDecoratorDefaultConfig("Icon/Point",{url:"./static/images/blueStar512.png",layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0}),e.regDecorator("Icon/Point",(e=>{const{userConfig:t}=e;t.keepSize=!1,!0===t.lockYAxis&&(t.useSpriteMaterial=!1);const o=n.Z.createMarker(e);return!0===t.lockYAxis&&o.lookAt(THING.App.current.camera,{lockYAxis:!0}),o})),e.regDecoratorDefaultConfig("Icon/Sprite",{url:"./static/images/blueStar512.png",layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0}),e.regDecorator("Icon/Sprite",(e=>{const{userConfig:t}=e;return t.keepSize=!0,t.sizeAttenuation=!1,n.Z.createMarker(e)})),e.regDecoratorDefaultConfig("Icon/Plane",{url:"./static/images/blueStar512.png",layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0,rotation:[0,0,0]}),e.regDecorator("Icon/Plane",(e=>{const{userConfig:t}=e;t.useSpriteMaterial=!1;const o=n.Z.createMarker(e);return t.rotation&&(o.rotateX(t.rotation[0]-0),o.rotateY(t.rotation[1]-0),o.rotateZ(t.rotation[2]-0)),o})),e.regDecoratorDefaultConfig("Icon/Model",{url:"http://model.3dmomoda.com/models/66b7f5979ff043afa4e79f7299853a4b/0/gltf/",layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],rotation:[0,0,0]}),e.regDecorator("Icon/Model",(e=>l(e))),e.regDecorator("ModelPoint",(e=>l(e))),e.regDecoratorDefaultConfig("Particle/Normal",{url:"./static/particle/19090416rntarw4abznppmokksofuub2/",scale:[1,1,1]}),e.regDecorator("Particle/Normal",(e=>n.Z.createParticle(e))),e.regDecorator("ParticlePoint",(e=>n.Z.createParticle(e))),e.regDecoratorDefaultConfig("Text/Point",{style:{fontColor:"#000000",fontSize:32},lockYAxis:!0}),e.regDecorator("Text/Point",(e=>{void 0===e.userConfig.lockYAxis&&(e.userConfig.lockYAxis=!0);const t=n.Z.createTextRegion(e);return t.lookAt(THING.App.current.camera,{lockYAxis:e.userConfig.lockYAxis}),t})),e.regDecoratorDefaultConfig("Text/Sprite",{style:{fontColor:"#000000",fontSize:32}}),e.regDecorator("Text/Sprite",(e=>{const t=n.Z.createTextRegion(e);return t.keepSize=!0,t})),e.regDecoratorDefaultConfig("Text/Plane",{style:{fontColor:"#000000",fontSize:16},rotation:[0,0,0]}),e.regDecorator("Text/Plane",(e=>{const{userConfig:t}=e,o=n.Z.createTextRegion(e);return t.rotation&&(o.rotateX(t.rotation[0]-0),o.rotateY(t.rotation[1]-0),o.rotateZ(t.rotation[2]-0)),o})),e.regDecoratorDefaultConfig("CanvasText/Point",{style:{fontColor:"#000000",fontSize:64},lockYAxis:!0}),e.regDecorator("CanvasText/Point",(e=>{const{userConfig:t}=e;t.keepSize=!1,!0===t.lockYAxis&&(t.useSpriteMaterial=!1);const{style:o}=t;let i="";const r=e.parent.host||e.parent;if(t.getMethod){if("objectProperty"===t.getMethod){const e=t.propertyPath;i=r.getAttribute(e)}"presetValue"===t.getMethod&&(i=t.presetValue),"func"===t.getMethod&&(i=t.getFunc.call(null,r))}const a=n.Z.createTextCanvas(i,o);t.canvas=a;const s=n.Z.createCanvasMarker(e);return!0===t.lockYAxis&&s.on("complete",(e=>{e.object.lookAt(THING.App.current.camera,{lockYAxis:!0})}),"è®¾ç½®lockYAxis"),s})),e.regDecoratorDefaultConfig("CanvasText/Sprite",{style:{fontColor:"#000000",fontSize:64}}),e.regDecorator("CanvasText/Sprite",(e=>{const{userConfig:t}=e;t.sizeAttenuation=!1;const{style:o}=t;let i="";const r=e.parent.host||e.parent,a=e.userConfig.selectType;if("Point"===a?e.userConfig.keepSize=!1:"Plane"===a?e.userConfig.useSpriteMaterial=!1:"Sprite"===a&&(e.userConfig.keepSize=!0),t.getMethod){if("objectProperty"===t.getMethod){const e=t.propertyPath;i=r.getAttribute(e)}"presetValue"===t.getMethod&&(i=t.presetValue),"func"===t.getMethod&&(i=t.getFunc.call(null,r))}const s=n.Z.createTextCanvas(i,o);return t.canvas=s,n.Z.createCanvasMarker(e)})),e.regDecoratorDefaultConfig("CanvasText/Plane",{style:{fontColor:"#000000",fontSize:64},rotation:[0,0,0]}),e.regDecorator("CanvasText/Plane",(e=>c(e))),e.regDecorator("TextPoint",(e=>c(e))),e.regDecoratorDefaultConfig("Line/SimpleColor",{color:"#ffff00",opacity:1}),e.regDecorator("Line/SimpleColor",(e=>{const{userConfig:t}=e,{parent:o}=e;let i;const r=o.host||o,a=n.Z.getPointsData(r);return t.type="vector",a.length>1?(e.points=a,i=n.Z.createLine(e)):(t.lineType="Line",i=n.Z.createGeoLine(e)),i})),e.regDecoratorDefaultConfig("Line/SimpleImage",{image:"./img/map_rode/road_line_1.png",speed:1}),e.regDecorator("Line/SimpleImage",(e=>{const{userConfig:t}=e,{parent:o}=e;let i,r;const a=o.host||o,s=n.Z.getPointsData(a);return t.type="image",s.length>1?(console.error("ThingJS Line æä¸æ¯æè´´å¾"),e.points=s,i=n.Z.createLine(e),r=g(i,e)):(t.lineType="Line",r=n.Z.createGeoLine(e)),r})),e.regDecoratorDefaultConfig("Line/RouteLineColor",{color:"#ff0000",width:4,opacity:1}),e.regDecorator("Line/RouteLineColor",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let r,a;const s=n.Z.getPointsData(i);return t.NoBlending=void 0===t.NoBlending||t.NoBlending,t.lineType=t.lineType||"Plane",t.type="vector",s.length>1?(e.points=s,r=n.Z.createRouteLine(e),a=g(r,e)):a=n.Z.createGeoLine(e),a})),e.regDecoratorDefaultConfig("Line/RouteLineImage",{width:4,speed:.5,image:"./img/map_rode/road_line_14.png"}),e.regDecorator("Line/RouteLineImage",(e=>u(e))),e.regDecorator("PathLine",(e=>u(e))),e.regDecoratorDefaultConfig("Line/PolygonLineColor",{color:"#ff0000",width:4,opacity:1}),e.regDecorator("Line/PolygonLineColor",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let r,a,s=[];if("PortLinkLineSeg"===i.type){let e=i.getAttribute("userData/DATA/POINTS")||i.getAttribute("userData/DATA/points");s=JSON.parse(e)}else s=n.Z.getPointsData(i);return t.type="vector",t.NoBlending=void 0===t.NoBlending||t.NoBlending,s.length>1?(e.points=s,r=n.Z.createPolygonLine(e),a=g(r,e)):(t.lineType="Pipe",a=n.Z.createGeoLine(e)),a})),e.regDecoratorDefaultConfig("Line/PolygonLineImage",{width:4,speed:.5,image:"./img/map_rode/road_line_14.png"}),e.regDecorator("Line/PolygonLineImage",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let r,a,s=[];if("PortLinkLineSeg"===i.type){let e=i.getAttribute("userData/DATA/POINTS")||i.getAttribute("userData/DATA/points");s=JSON.parse(e)}else s=n.Z.getPointsData(i);return t.type="image",t.NoBlending=void 0===t.NoBlending||t.NoBlending,s.length>1?(e.points=s,r=n.Z.createPolygonLine(e),a=g(r,e)):(t.lineType="Pipe",a=n.Z.createGeoLine(e)),a})),e.regDecoratorDefaultConfig("DoubleLine/PolygonLineImage",{opacity:1,image:"./img/map_rode/road_line_14.png"}),e.regDecorator("DoubleLine/PolygonLineImage",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o,r=n.Z.getPointsData(i);let a,s,l,c;return e.userConfig.speed=t.lineOneSpeed-0,e.userConfig.color=t.lineOneColor,e.userConfig.width=t.lineOneWidth,e.userConfig.opacity=t.lineOneOpacity,t.NoBlending=void 0===t.NoBlending||t.NoBlending,e.userConfig.type="vector",r.length>1?(e.points=r,a=n.Z.createPolygonLine(e),a.style.renderOrder=100002,l=g(a,e),e.userConfig.speed=t.lineTwoSpeed-1e-5,e.userConfig.color=t.lineTwoColor,e.userConfig.width=t.lineTwoWidth,e.userConfig.opacity=t.lineTwoOpacity,t.NoBlending=void 0===t.NoBlending||t.NoBlending,e.userConfig.type="image",s=n.Z.createPolygonLine(e),s.style.renderOrder=100001,c=g(s,e)):(t.lineType="Pipe",l=n.Z.createGeoLine(e),e.userConfig.speed=t.lineTwoSpeed-1e-5,e.userConfig.color=t.lineTwoColor,e.userConfig.width=t.lineTwoWidth,e.userConfig.opacity=t.lineTwoOpacity,t.NoBlending=void 0===t.NoBlending||t.NoBlending,e.userConfig.type="image",c=n.Z.createGeoLine(e)),c})),e.regDecoratorDefaultConfig("FlyLine/SimpleColor",{color:"#ffff00",opacity:1}),e.regDecorator("FlyLine/SimpleColor",(e=>{const{userConfig:t}=e;return t.type="vector",t.lineType="Line",n.Z.createGeoFlyLine(e)})),e.regDecoratorDefaultConfig("FlyLine/SimpleImage",{image:"./img/map_rode/road_line_1.png",speed:1}),e.regDecorator("FlyLine/SimpleImage",(e=>{const{userConfig:t}=e;return t.type="image",t.lineType="Line",n.Z.createGeoFlyLine(e)})),e.regDecoratorDefaultConfig("FlyLine/RouteLineColor",{color:"#ff0000",width:4,opacity:1}),e.regDecorator("FlyLine/RouteLineColor",(e=>{const{userConfig:t}=e;return t.type="vector",t.lineType="Plane",n.Z.createGeoFlyLine(e)})),e.regDecoratorDefaultConfig("FlyLine/RouteLineImage",{width:4,speed:.5,image:"./img/map_rode/road_line_14.png"}),e.regDecorator("FlyLine/RouteLineImage",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let r,a=i.startLonlat,s=i.endLonlat,l=t.curvature;t.type="image",t.lineType="Plane";const c=THING.App.current.create({type:"BaseObject",id:`${e.tag}_${e.effectName}_${o.id}`,parent:o}),u=n.Z.getPointsData(i,t);if(u&&0!==u.length||3==a.length){const t=n.Z.getCampusGeoPoints(0==u.length?a:u[0],0==u.length?s:u[1],l,100);e.points=t,r=n.Z.createRouteLine(e),c.add(r)}else r=n.Z.createGeoFlyLine(e),c.add(r);return c})),e.regDecorator("FlyLine",(e=>{const{userConfig:t}=e;return t.type="image",t.lineType="Plane",n.Z.createGeoFlyLine(e)})),e.regDecoratorDefaultConfig("FlyLine/PolygonLineColor",{color:"#ff0000",width:4,opacity:1}),e.regDecorator("FlyLine/PolygonLineColor",(e=>{const{userConfig:t}=e;return t.type="vector",t.lineType="Pipe",n.Z.createGeoFlyLine(e)})),e.regDecoratorDefaultConfig("FlyLine/PolygonLineImage",{width:4,speed:.5,image:"./img/map_rode/road_line_14.png"}),e.regDecorator("FlyLine/PolygonLineImage",(e=>{const{userConfig:t}=e;return t.type="image",t.lineType="Pipe",n.Z.createGeoFlyLine(e)})),e.regDecoratorDefaultConfig("Polygon/Color",{color:"#ff0000"}),e.regDecorator("Polygon/Color",(e=>m(e))),e.regDecorator("Polyhedron",(e=>m(e))),e.regDecoratorDefaultConfig("Polygon/Image",{image:"./static/images/blue.png"}),e.regDecorator("Polygon/Image",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let r;const a=n.Z.getPointsData(i,t);t.type="image";let s=e.userConfig.opacity;if(s){if("number"!=typeof s){let e=s[0],t=s[1];t>1&&(e/=100,t/=100),s=Math.round(100*(Math.random()*(t-e)+e))/100}s>1&&(s/=100),e.userConfig.opacity=s.toFixed(2)-0}return a.length>2?(e.points=a,r=n.Z.createPolygonRegion(e)):r=n.Z.createGeoPolygon(e),r.isPolygon=!0,r})),e.regDecorator("Polyhedron",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let a;const s=n.Z.getPointsData(i);if(t.type="vector",s.length>2)return e.points=s,a=n.Z.createPolygonRegion(e),a;{let s={id:`${e.tag}_${e.effectName}_${o.id}`,height:0,complete(){}};const l=THING.App.current.create({type:"BaseObject",id:s.id,parent:o});t&&(s=r.Z.combine(s,t,!0));let c=e.userConfig.opacity,u=!1;c&&("number"!=typeof c?(u=!0,e.userConfig.opacity=1):(c>1&&(c/=100),e.userConfig.opacity=c.toFixed(2)-0));const h=i.getAttribute("geojson");let p;"vector"===s.type&&(p={type:"vector",color:s.color,opacity:s.opacity,colorMapping:s.colorMapping,outlineColor:s.outlineColor,outlineOpacity:s.outlineOpacity});let f={imageDensity:s.imageDensity||"",height:s.height||"",layoutOffset:s.layoutOffset||"",style:s.style||"",lights:s.lights,useAoMap:n.Z.parseBoolean(s.useAoMap,!0),aoMapIntensity:s.aoMapIntensity||.85,outlineColor:s.outlineColor||[255,64,39,1],outlineWidth:s.outlineWidth,outlineImageUrl:s.outlineImageUrl||"http://192.168.21.119:90/citybuilder_console/upload/polygonIcons/systemIcons/1.png",outlineLineType:s.outlineLineType||"Plane",outlineOpacity:s.outlineOpacity-0,outlinePostRadialBlur:n.Z.parseBoolean(s.outlinePostRadialBlur,!1),outlineEffect:n.Z.parseBoolean(s.outlineEffect,!1),outlineGlowStrength:s.outlineGlowStrength,outlineType:s.outlineType||"vector",outlineBlending:n.Z.parseBoolean(s.outlineBlending,!1),outlineSizeAttenuation:s.outlineSizeAttenuation,outlineColorMapping:s.outlineColorMapping,outlineSpeed:s.outlineSpeed};p={...p,...f},a=THING.App.current.create({type:"FeatureLayer",id:`${s.id}`,height:s.height,offsetHeight:s.offsetHeight||0,dataSource:h,geometryType:"GeoPolygon",renderer:p,inheritVisible:!1,inheritStyle:s.inheritStyle,userData:s.userData,complete:s.complete}),a._setPostRadiusEffect(s.postRadialBlur),a.style.skipBoundingBox=!0,a.userData.skipBoundingBox=!0;const d=CMAP.Util.convertWorldToLonlat(i.position)[2];if(s.layoutOffset?a.translate([s.layoutOffset[0],s.layoutOffset[1]+d,s.layoutOffset[2]]):a.translate([0,d,0]),s.style&&s.style.renderOrder&&(a.style.renderOrder=s.style.renderOrder),l.add(a),a.host=i,u)for(let e=0;e<a.children.length;e++){let t=c[0],o=c[1];o>1&&(t/=100,o/=100);let n=Math.round(100*(Math.random()*(o-t)+t))/100;a.children[e].style.opacity=n}return l}})),e.regDecoratorDefaultConfig("Prefab/Default/TextBubble",{keepSize:!0,size:4,getMethod:"objectProperty",propertyPath:"name",style:{fontColor:"#ffffff"}}),e.regDecorator("Prefab/Default/TextBubble",(e=>n.Z.createTextBubble(e))),e.regDecoratorDefaultConfig("Prefab/Default/GeoBoundary",{type:"horizontal",wallImage:"./img/light_wall.png",lineImage:"./img/light_line.png",extrudeHeight:200,lineCount:6,blending:!0,scrollSpeed:[0,0],alphaSpeed:3,inheritStyle:!1,opacity:1}),e.regDecorator("Prefab/Default/GeoBoundary",(e=>{const{parent:t}=e,o=t,{userConfig:i}=e,{tag:a}=e,{effectName:s}=e,{serverFilePath:l}=e;let c={id:`${a}_${s}_${o.id}`};i&&(c=r.Z.combine(c,i));const u=THING.App.current.create({type:"BaseObject",id:c.id,parent:o,inheritScale:!1,inheritStyle:!1});u.isBoundary=!0;const h=o.host||o;u.host=h,c.serverFilePath=l,n.Z.parseUrl(c);let p=h.getAttribute("geojson")||h.getAttribute("GEOJSON");if(c.dataSource=p,p){let e={type:"FeatureCollection",features:[]};p.hasOwnProperty("features")||(e.features.push(p),p=e);let t=[];p.hasOwnProperty("geometry")&&t.push(p);const o=p.hasOwnProperty("geometry")?t:p.features||[];for(let e=0;e<o.length;e+=1){const t=o[e],{geometry:n}=t;if("Polygon"===n.type||"LineString"===n.type||"MultiPolygon"===n.type||"MultiLineString"===n.type){const{coordinates:e}=n;c.extrudeHeight-=0,c.coordinates=e;let t={color:c.style.color,opacity:c.opacity,imageUrl:c.wallImage||c.imageUrl,alphaImageUrl:c.alphaImage||c.alphaImageUrl,speed:c.scrollSpeed||c.speed,alphaSpeed:c.alphaSpeed,useColor:c.useColor||c.style.color,uvRatio:c.uvRatio};const o=THING.App.current.create({type:"GeoBoundary",coordinates:c.coordinates,renderer:t,extrudeHeight:c.extrudeHeight,offsetHeight:c.offsetHeight||0,offsetHeight:c.offsetHeight||0,inheritVisible:c.inheritVisible});let i=h.getAttribute("userData/_ELEVATION_");i&&(i-=0,c.layoutOffset?o.translate([c.layoutOffset[0],c.layoutOffset[1]+i,c.layoutOffset[2]]):o.translate([0,i,0])),o.node.getMeshes()[0].material.blending=c.blending?THREE.AdditiveBlending:THREE.NormalBlending,u.add(o),c.complete&&c.complete({object:u})}else console.error(`ä¸æ¯æç±»å ${n.type}`)}}else{let e=n.Z.getPointsData(h);if(c.autoClose&&e.length>2){let t=e[0],o=e[e.length-1];THING.Math.getDistance(t,o)>.001&&e.push(t)}let t=[];u.inheritScale=!1;for(let o=0;o<e.length;o++){let n=u.worldToSelf(e[o]);t.push(n)}if(c.wallImage instanceof Array){let e=c.wallImageIndex;c.wallImage=c.wallImage[e],c.scrollSpeed=c.scrollSpeed[e],c.uvRatio=c.uvRatio[e]}c.parent=u;const o=n.Z.createBoundary(c);o.addPoints(t,THING.SpaceType.Self),o.children.forEach((e=>{e.host=h,u.add(e)})),u.add(o)}return u})),e.regDecoratorDefaultConfig("Panel/BGAndCanvas",{moniterPanelType:"BACKGROUND_AND_CANVAS",keepSize:!1,imageWidth:246,imageHeight:138,url:"./monitorPanel/MonitorPanle_01.png",width:246,height:138,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,.5,0],showMapping:{}}),e.regDecorator("Panel/BGAndCanvas",(e=>{const t=e.userConfig.selectType;"Point"===t||("Plane"===t?e.userConfig.useSpriteMaterial=!1:"Sprite"===t&&(e.userConfig.keepSize=!0));const o=n.Z.createBGAndCanvasPanel(e);return!0===e.userConfig.lockYAxis&&!1===e.userConfig.useSpriteMaterial&&o.lookAt(THING.App.current.camera,{lockYAxis:!0}),o})),e.regDecoratorDefaultConfig("Panel/HTMLElement",{html:"",showMapping:{}}),e.regDecorator("Panel/HTMLElement",(e=>{const t=n.Z.createHtmlPanel(e);return!0===e.userConfig.lockYAxis&&!1===e.userConfig.useSpriteMaterial&&t.lookAt(THING.App.current.camera,{lockYAxis:!0}),t})),e.regDecorator("HTMLPanelPoint",(e=>{const t=n.Z.createHtmlPanel(e);!0===e.userConfig.lockYAxis&&!1===e.userConfig.useSpriteMaterial&&t.lookAt(THING.App.current.camera,{lockYAxis:!0});let o=t.element.querySelector("#title");return o&&setTimeout((()=>{let n=e.userConfig.options,i="flex"==o.style.display;if(n&&n.autoDisplayTitle&&i){let e=THING.App.current.camera,i=n.markDistance;t.on("update",(function(n){let r=THING.Math.getDistance(e.position,t.host.position);o.style.display=r<=i?"flex":"none"}),"èªå¨æ¾é"),t.tags.push("èªå¨æ¾é")}}),100),t})),e.regDecorator("Icon/MultiType",(t=>{const o=t.userConfig;let i=n.Z.convertConfigByType("Icon/MultiType",o);const a="Icon/"+i.selectType,s=e.getDecorator(a);if(s&&s.func){const e=THING.Utils.cloneObject(s.defaultConfig,!0);return i=r.Z.combine(e,i,!0),t.userConfig=i,t.effectName=a,s.func(t)}})),e.regDecorator("åå®«æ ¼",(e=>{const{userConfig:t}=e,{parent:o}=e,{serverFilePath:i}=e,r=o.host||o,a=t.text,s=a.layoutOffset||[0,0],l=function(e,t){if("objectProperty"===t.getMethod){const i=t.propertyPath;let r=e.getAttribute(i);return void 0!==t.toFixed&&Number(r)&&(o=Number(r),n=t.toFixed,o=parseFloat(o),r=(Math.round(((o+Number.EPSILON)*Math.pow(10,n)).toFixed(n))/Math.pow(10,n)).toFixed(n)),r}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name;var o,n}(r,a),c=document.createElement("canvas").getContext("2d"),u=Object.assign({fontSize:64,fontFamily:"Arial",fontColor:"rgb(255, 0, 0)"},a.style),{fontSize:h}=u,p=`${h}px ${u.fontFamily}`;c.font=p;const{width:f}=c.measureText(l),d=Math.ceil(f),g=t.images,m=Object.keys(g).length,y=g.left,_=g.guide,v=_.layout||["Center","Bottom"],T=_.layoutOffset||[0,0];t.pivotLayout||t.pivot||(t.pivotLayout=v);const x=y.size[0]+d+g.right.size[0],C=y.size[1]+_.size[1]+T[1];let b=0;const w=document.createElement("canvas");w.height=C,w.width=x;const P=w.getContext("2d");P.font=p,P.fillStyle=u.fontColor,P.textBaseline="middle",P.textAlign="center",t.canvas=w,!0===t.keepSize&&(t.sizeAttenuation=!1);let S=n.Z.createCanvasMarker(e);return Object.keys(g).forEach((e=>{const t=g[e],o=n.Z.getResourceUrl(i+t.image);let r=t.size,a=[0,0];if("center"===e)a=[y.size[0],0],r=[d,r[1]];else if("right"===e)a=[y.size[0]+d,0];else if("guide"===e){const e=v[0].toLowerCase(),t=v[1].toLowerCase();let o,n;"left"===e?o=0:"center"===e?o=(x-_.size[0])/2:"right"===e&&(o=x-_.size[0]),"top"===t?n=0:"center"===t?n=y.size[1]/2:"bottom"===t&&(n=y.size[1]),a=[o+T[0],n+T[1]]}!function(e,t,o,n){var i=new Image;function r(){P.drawImage(i,t,o,n[0],n[1]),b+=1,b===m&&(P.fillText(l,(x+s[0])/2,(y.size[1]+s[1])/2),S.canvas=w)}i.src=e,i.complete?r():i.onload=function(){r()}}(o,a[0],a[1],r)})),S})),e.regDecorator("TextAndImage",(e=>{const t=e.userConfig.selectType;"Point"===t||("Plane"===t?e.userConfig.useSpriteMaterial=!1:"Sprite"===t&&(e.userConfig.keepSize=!0));const{userConfig:o}=e;let r=!0===o.autoShowText,a=o.showText,s=o.markDisTance||o.markDistance||0;e.onlySelf=o.onlySelf||!1;let l,c=e.parent.host||e.parent,u=THING.App.current.camera,h=THING.Math.getDistance(u.position,c.position),p=h<=s,f=(o.isTitleIcon,!0);o.type&&(f=!("Panel"==o.type));let d=new i(e);o.canvas=d.canvas;let g=r?p&&a:a;if(l=n.Z.createCanvasMarker(e),d.marker=l,d.showText=g,l.TAI=d,l.dType="TextAndImage",d.updateCanvas(),f&&!0===r&&a){let e=p;l.on("update",(function(){h=THING.Math.getDistance(u.position,c.position),e=h<=s,e!==p&&(l.TAI.showText=e,l.TAI.updateCanvas(),p=e)}),"æ¯ä¸å¸§æ´æ°ææ¬æ¾é")}return l.style.alwaysOnTop=e.alwaysOnTop,l.node.renderOrder=2e6,l})),e.regDecoratorDefaultConfig("DoubleLine/FlyLineImage",{width:4,offsetFactor:20,color:"#ffffff",repeatFactor:1,glow:!1,curvature:1,lineOneSpeed:1,lineTwoSpeed:1,xUnit:0,maxRepeatFactor:10,image:"./img/map_rode/road_line_14.png"}),e.regDecorator("DoubleLine/FlyLineImage",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o,r=THING.App.current.create({type:"BaseObject",id:`${e.tag}_${e.effectName}_${e.parent.id}`,parent:o});if("GEOODLINE"===i.userData._TYPE_||i.startLonlat&&i.endLonlat){let o,a,s;return e.userConfig.type="image",e.userConfig.lineType="Plane",e.userConfig.effect=e.userConfig.glow,e.userConfig.speed=t.lineOneSpeed-0,e.userConfig.color=t.lineOneColor,o=n.Z.createGeoFlyLine(e),o.host=i,o.translateX(t.offsetFactor-0||0),e.userConfig.speed=t.lineTwoSpeed-1e-7,e.userConfig.color=t.lineTwoColor,a=n.Z.createGeoFlyLine(e),a.host=i,a.translateX(0-t.offsetFactor||0),e.userConfig.xUnit>0?(s=o.totalLengthArray[0]/(e.userConfig.xUnit-0),s<1?s=1:s>e.userConfig.maxRepeatFactor&&(s=e.userConfig.maxRepeatFactor),o.renderer.uvRatio=[s,1],a.renderer.uvRatio=[s,1]):(o.renderer.uvRatio=[t.repeatFactor-0,1],a.renderer.uvRatio=[t.repeatFactor-0,1]),o.inheritStyle=!1,a.inheritStyle=!1,o.node.getMeshes()[0].material.uniforms.color.value=new THREE.Color(t.lineOneColor),r.add(o),a.node.getMeshes()[0].material.uniforms.color.value=new THREE.Color(t.lineTwoColor),r.add(a),r}console.error(`è¯¥å¯¹è±¡ä¸æ¯å³ç³»è¿çº¿ ${opObj.id}`)})),e.regDecoratorDefaultConfig("DoubleLine/LineImage",{width:4,offsetFactor:20,color:"#ffffff",repeatFactor:1,glow:!1,lineOneSpeed:1,lineTwoSpeed:1,xUnit:0,maxRepeatFactor:10,image:"./img/map_rode/road_line_14.png",keepSize:!1}),e.regDecorator("DoubleLine/LineImage",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;t.type="image",t.lineType=t.lineType||"Plane",t.effect=t.glow;const r=THING.App.current.create({type:"BaseObject",id:`${e.tag}_${e.effectName}_${e.parent.id}`,parent:o,inheritStyle:!1});let a;if(a="PolygonLine"==i.type||"RouteLine"==i.type?i.points:n.Z.getPointsData(i),a.length>1)return n.Z.createCampusDoubleRouteLine(e,a,t,i,r),r;if(e.userConfig.keepSize){if("GEOODLINE"===i.userData._TYPE_||i.startLonlat&&i.endLonlat){let o=[];o.push(CMAP.Util.convertLonlatToWorld(i.startLonlat,i.startElevation)),o.push(CMAP.Util.convertLonlatToWorld(i.endLonlat,i.endElevation)),n.Z.createDoubleRouteLine(e,o,t,i,r)}let o=i.getAttribute("geojson")||i.getAttribute("GEOJSON");if(o){let a={type:"FeatureCollection",features:[]};o.hasOwnProperty("features")||(a.features.push(o),o=a);const s=o.features||[];let l=[],c=e.height||0;for(let e=0;e<s.length;e+=1){const t=s[e],{geometry:o}=t,{coordinates:n}=o;let i=[],r=o.type;"MultiPolygon"===o.type&&(r="MultiLineString",1===n.length?i=n[0]:n.forEach((e=>{e instanceof Array&&i.push(...e)}))),"Polygon"===o.type&&(r="MultiLineString"),0===i.length&&(i=n),"LineString"!==r&&"MultiLineString"!==r||i.forEach((e=>{e.forEach((e=>{let t=CMAP.Util.convertLonlatToWorld(e,c);l.push(t)}))}))}n.Z.createDoubleRouteLine(e,l,t,i,r)}}else{let o,a,s;if(e.userConfig.isDoubleLine=!0,e.userConfig.speed=t.lineOneSpeed-0,e.userConfig.color=t.lineOneColor,e.userConfig.NoBlending=void 0===t.NoBlending||t.NoBlending,e.userConfig.lineNum=1,o=n.Z.createGeoLine(e).children[0],e.userConfig.speed=t.lineTwoSpeed-0,e.userConfig.color=t.lineTwoColor,e.userConfig.NoBlending=void 0===t.NoBlending||t.NoBlending,e.userConfig.lineNum=2,a=n.Z.createGeoLine(e).children[0],!o||!a)return;o.host=i,a.host=i,e.userConfig.xUnit>0?(s=o.totalLengthArray[0]/(e.userConfig.xUnit-0),s<1?s=1:s>e.userConfig.maxRepeatFactor&&(s=e.userConfig.maxRepeatFactor),o.renderer.uvRatio=[s,1],a.renderer.uvRatio=[s,1]):(o.renderer.uvRatio=[t.repeatFactor-0,1],a.renderer.uvRatio=[t.repeatFactor-0,1]),o.inheritStyle=!1,a.inheritStyle=!1,o.node.getMeshes()[0].material.uniforms.color.value=new THREE.Color(t.lineOneColor),r.add(o),a.node.getMeshes()[0].material.uniforms.color.value=new THREE.Color(t.lineTwoColor),r.add(a)}return r})),e.regDecoratorDefaultConfig("DataPanel",{}),e.regDecorator("DataPanel",(e=>{let t=a.Z.createLibDataPanel();return e.userConfig.lockYAxis=!0===e.userConfig.lockYAxis&&!1===e.userConfig.useSpriteMaterial,t.createDataPanel(e)})),e.regDecorator("Datapanel_Line",(e=>new s.Z(e).create(e))),e.regDecorator("CanvasPanelPoint",(e=>new s.Z(e).create(e))),e.regDecorator("SignboardPoint",(e=>new h(e).create(e))),e.regDecorator("Line",(e=>new p(e).create(e))),e.regDecorator("SuperSignboard",(e=>{if(e.userConfig){let t=e.userConfig,o=e.userConfig.selectTitlePath,n=Object.keys(t.selectTitle)[0];function i(e,t){let o=[],n=e;o=t.split("/");for(let e=0;e<o.length;e++)o[e]=o[e].trim(),n[o[e]]&&(n=n[o[e]]);return n}return e.userConfig.selectTitle.canvasConfig==i(t,o)&&(e.userConfig[n]=e.userConfig[i(t,o)]),new h(e).create(e)}})),e.regDecorator("Carriage",(e=>(new d).create(e))),e.regDecorator("Polygon/Water",(e=>{const{userConfig:t}=e,{parent:o}=e,i=o.host||o;let r;const a=n.Z.getPointsData(i,t);return a.length>2?(e.points=a,r=n.Z.createPolygonRegionWater(e)):r=n.Z.createPolygonGeoWater(e),r.isPolygon=!0,r})),e.regDecorator("Line/CustomLine",(e=>{const{parent:t}=e;let o=new y.Z(e).create();if(o){if("BaseObject"==o.type)return o.isBoundary=!0,o;{let n=THING.App.current.create({type:"BaseObject",id:`${e.tag}_${e.effectName}_${e.parent.id}`,parent:t,inheritStyle:!1,inheritPosition:!1});return"Shape"!=o.type&&"Polygon"!=o.type&&"PolygonLine"!=o.type||(o.isPolygon=!0,n.isPolygon=!0),Array.isArray(o)?("PolygonLine"==o[0].type&&(n.isPolygon=!0),n.add(o[0]),n.add(o[1])):n.add(o),n}}}))}},354:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});var n=o(774);const i={isEmpty:function(e){return 0===Object.keys(e).length},getFirstKey:function(e){return Object.keys(e)[0]},getFirstValue:function(e){return Object.values(e)[0]},combine:function e(t,o,i=!1,r=!1,a=!1){if(r){const r=n.Z.cloneObj(t,a);return e(r,o,i,!1),r}for(const n in o)i?void 0===t[n]||null===t[n]||t[n]instanceof Array||"object"!=typeof t[n]||o[n]instanceof Array||"object"!=typeof o[n]?t[n]=o[n]:e(t[n],o[n],i,!1):t[n]=o[n];return t},combineNew:function e(t,o,i,r,a=!1){if(r){const r=n.Z.cloneObj(t,a);return e(r,o,i,!1),r}for(const n in o)i?void 0===t[n]||null===t[n]||t[n]instanceof Array||"object"!=typeof t[n]||o[n]instanceof Array||"object"!=typeof o[n]?void 0!==t[n]&&null!==t[n]||(t[n]=o[n]):e(t[n],o[n],i,!1):void 0!==t[n]&&null!==t[n]||(t[n]=o[n]);return t}}},774:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});const n={isFunction:function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)},cloneObj:function e(t,o,i){if(!t||"object"!=typeof t||n.isFunction(i)&&i(t))return t;const r=t instanceof Array?[]:{};return Object.keys(t).forEach((n=>{const a=t[n];if(o&&"object"==typeof a)if(a instanceof Array){r[n]=[];for(let t=0;t<a.length;t+=1)"object"!=typeof a[t]?r[n].push(a[t]):r[n].push(e(a[t],o,i))}else r[n]=e(a,o,i);else r[n]=a})),r},extend:function(e,t){const o=function(){},i=n.cloneObj;o.prototype=t.prototype,e.prototype=new o,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t),e.prototype.__extendList?e.prototype.__extendList=i(e.prototype.__extendList):e.prototype.__extendList=[],e.prototype.__extendList.push(t)},eval:function(e){return new Function(`return ${e}`)()},jsonParse:function(e,t){if(!e||"string"!=typeof e)return e;let o;try{o=JSON.parse(e,t)}catch(t){try{o=n.eval(`(${e})`)}catch(t){o=e}}return o},stringify:function(e,t,o){return e&&"object"==typeof e?JSON.stringify(e,t,o):e},data:function(e,t){return function(e,t,o){return void 0===t?null:void 0===o?n.jsonParse(e.getItem(t)):(null==o?e.removeItem(t):e.setItem(t,n.stringify(o)),n)}(localStorage,e,t)}},i=n},891:(e,t,o)=>{"use strict";o.d(t,{Z:()=>m,v:()=>l});var n=o(331),i=o.n(n),r=o(245),a=o(354);const s={rsmPath:""};function l(e){let t=s.rsmPath,o=e.trim();return e.includes("http")||0===e.indexOf("./")||0===e.indexOf("/")||(t.endsWith("/")||(t+="/"),o=t+e),o}function c(e,t){const o=CMAP.Util.getPolygonExtent(e),n=CMAP.Util.convertLonlatToWebMercator([o.minX,o.minY]),i=CMAP.Util.convertLonlatToWebMercator([o.maxX,o.maxY]),r=(i[0]-n[0])/1e4,a=(i[1]-n[1])/1e4;let s=[1,1];return r>0&&a>0&&t&&(s=[r*t,a*t]),s}function u(e,t){e.node.getMeshes().length&&e.node.getMeshes()[0].material&&(e.node.getMeshes()[0].material.blending=t?THREE.AdditiveBlending:THREE.NormalBlending)}function h(e){const{serverFilePath:t}=e;return["url","image","wallImage","lineImage","alphaImage","reflectionNormalUrl","refractionNormalUrl","reflectionImageUrl","refractionImageUrl"].forEach((o=>{let n=e[o];function i(e){return 0==e.indexOf(t)&&(e=e.substr(t.length)).startsWith("/")&&(e=e.substr(1)),!e.includes("http")&&e.indexOf(t)<0?t&&(e=l(t+e)):e=l(e),e}n instanceof Array&&n[0]?n.forEach(((t,n)=>{t=i(t),e[o][n]=p(t)})):n&&(n=i(n),e[o]=p(n))})),e}function p(e){if(void 0===e||null==e)return e;let t=0,o="";for(e.startsWith("http")&&(t=e.indexOf("//")+2,o=e.slice(0,t));t<e.length;t+=1)o[o.length-1]+e[t]!=="//"&&(o+=e[t]);return o}function f(e,t){if("objectProperty"===t.getMethod){const i=t.propertyPath;let r=e.getAttribute(i);return void 0!==t.toFixed&&Number(r)&&(o=Number(r),n=t.toFixed,o=parseFloat(o),r=(Math.round(((o+Number.EPSILON)*Math.pow(10,n)).toFixed(n))/Math.pow(10,n)).toFixed(n)),r}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name;var o,n}function d(e){return e.split("/").length<3}function g(e,t){return e.concat(t)}s.getResourceUrl=l,s.ModifyMaterial=u,s.parseUrl=h,s.convertUrlInHtml=function(e,t){let o=e;return[".png",".jpg",".gif"].forEach((e=>{o=function(e,o){let n=e.indexOf(o),i=[];for(;-1!==n;){let a=e.slice(0,n-1).lastIndexOf('"'),l=e.slice(0,a);i.push(l);let c=e.slice(a+1,n+o.length);c.includes("http")||(c=s.rsmPath?'"'+s.rsmPath+"/"+t+c+'"':r.x.parseUrl({serverFilePath:t,url:c},t).url),i.push(c),n=(e=e.slice(n+5)).indexOf(o)}i.push(e);let a="";return i.forEach((e=>{a+=e})),a}(o,e)})),o},s.clearHTMLCSSCach=function(){const e=i()("style");for(let t=0;t<e.length;t+=1){const o=e[t];"_decorator_"===o.name&&i()(o).remove()}this.htmlCssMap={}},s.getPointsData=function(e,t){let o,n=[];if(t&&t.hasOwnProperty("getMethod")?void 0!==f(e,t)&&Array.isArray(JSON.parse(f(e,t)))&&(o=f(e,t)):o="PolygonLine"==e.type||"RouteLine"==e.type?e.points:e.getAttribute("userData/DATA/POINTS")||e.getAttribute("userData/DATA/points"),o)if(o instanceof Array)n=JSON.parse(JSON.stringify(o));else{n=JSON.parse(o);const t=this.getCampus(e);n=this.convertPointsFromCampusToWorld(t,n)}else n=e.points;return n||[]},s.getCampusGeoPoints=function(e,t,o,n){let i=function(e,t,o,n){let i=1-e,r=e*e,a=i*i,s=THING.Math.scaleVector(t,a);return s=THING.Math.addVector(THING.Math.scaleVector(o,2*i*e),s),s=THING.Math.addVector(THING.Math.scaleVector(n,r),s),s},r=[],a=function(e,t,o){let n=THING.Math.subVector(t,e),i=THING.Math.crossVector([0,1,0],n),r=THING.Math.normalizeVector(THING.Math.crossVector(n,i)),a=THING.Math.scaleVector(THING.Math.addVector(e,t),.5),s=THING.Math.getVectorLength(n)/2;return THING.Math.addVector(a,THING.Math.scaleVector(r,o||s))}(e,t,o);r[0]=e;for(let o=1;o<=n;o++){let s=i(o/n,e,a,t);r.push(s)}return r},s.getCampus=function(e){let t;return t=e instanceof THING.Campus?e:e.parents.query(".Campus")[0],t},s.convertPointsFromCampusToWorld=function(e,t){const o=[];if(e){const n=t.length;for(let i=0;i<n;i+=1){const n=t[i],r=e.selfToWorld(n);o.push(r)}}return o},s.convertConfigByType=function(e,t){if("Icon/MultiType"===e){let{selectType:e}=t;e=e.trim();let o={...t};const n=o[e];return o=Object.assign(o,n),["Plane","Point","Sprite"].forEach((e=>{o[e]&&delete o[e]})),o}return originAllConfig},s.setLayoutPosition=function(e){e.on("complete",(e=>{if(e.object.destroyed)return;const{host:t}=e.object,{parent:o}=e.object;if(!t)return;const{tempPivotLayout:n}=e.object.userData,{tempLayoutLocalPos:i}=e.object.userData,{tempLayoutOffset:r}=e.object.userData,{tempPivot:a}=e.object.userData;if(n&&i){const t=o.selfToWorld(i);if(e.object instanceof THING.Marker){if(a)e.object.pivot=a,delete e.object.userData.tempPivot;else{const t={Left:0,left:0,Center:.5,center:.5,Right:1,right:1,Top:0,top:0,Bottom:1,bottom:1},o=n[0].toLowerCase(),i=n[1].toLowerCase();e.object.pivot=[t[o],t[i]]}e.object.position=t}else{const o=e.object.getLayoutPosition(n,t,!0);e.object.position=o}}if(r){r[0]-=0,r[1]-=0,r[2]-=0;const t=e.object.worldToSelf(e.object.position),o=THING.Math.addVector(t,r);e.object.position=e.object.selfToWorld(o,!0,!0),delete e.object.userData.tempLayoutOffset}e.object instanceof THING.Marker&&(e.object.node.visible=!0)}),"åå»ºå®æåæ ¹æ®å¸å±è®¾ç½®ä½ç½®",52)},s.getLayoutPosition=function(e,t,o,n=!1,i=!1,r=!1){let a;if(e instanceof THING.Building){const{facade:s}=e;s&&(a=s.getLayoutPosition(t,o,n,i,r))}return a||(a=e.getLayoutPosition(t,o,n,i,r)),a},CanvasRenderingContext2D.prototype.letterSpacingText=function(e,t,o,n,i){var r=e.canvas;if(!i&&r&&(i=parseFloat(window.getComputedStyle(r).letterSpacing)),!i)return this.fillText(t,o,n);var a=t.split(""),s=e.textAlign||"left",l=e.measureText(t).width+i*(a.length-1);"center"==s?o-=l/2:"right"==s&&(o-=l),e.textAlign="left",a.forEach((function(t){var r=e.measureText(t).width;e.fillText(t,o,n),o=o+r+i})),e.textAlign=s},s.createTextCanvas=function(e,t){const o=Object.assign({fontSize:64,fontFamily:"Arial",fontColor:"rgb(255, 0, 0)",dropShadow:!0,dropShadowBlur:0,dropShadowDistance:2,dropShadowAngle:45,letterSpace:3},t),n=document.createElement("canvas").getContext("2d"),{fontSize:i}=o,r=`${i}px ${o.fontFamily}`;n.font=r;let{width:a}=n.measureText(e);a+=e.length*o.letterSpace;const l=document.createElement("canvas");l.height=Math.ceil(1.2*i),l.width=Math.ceil(a);const c=l.getContext("2d");return c.font=r,c.globalAlpha=.8,c.textAlign="center",c.textBaseline="middle",s.setDropShadow(c,o),c.fillStyle=o.fontColor,c.globalAlpha=1,c.letterSpacingText(c,e,l.width/2,l.height/2,t.letterSpace),l},s.createVerticalTextCanvas=function(e,t){const o=Object.assign({fontSize:64,fontFamily:"Arial",fontColor:"rgb(255, 0, 0)",dropShadow:!0,dropShadowBlur:0,dropShadowDistance:2,dropShadowAngle:45,letterSpace:3},t),n=document.createElement("canvas").getContext("2d"),{fontSize:i}=o,r=`${i}px ${o.fontFamily}`;n.font=r;let{width:a}=n.measureText(e),l=(e.match(/[\d\w]/g)||[]).length*n.measureText("a").width;a=a+e.length*t.letterSpace+l;const c=document.createElement("canvas");c.height=Math.ceil(a),c.width=Math.ceil(1.2*i);const u=c.getContext("2d");u.font=r,u.fillStyle=o.fontColor,u.textAlign="center",u.textBaseline="top",s.setDropShadow(u,o);for(let o=0;o<e.length;o++){const n=e.slice(o,o+1).toString();let r=i*o+t.letterSpace*o+t.letterSpace/2;u.fillText(n,c.width/2,r)}return c},s.createIconCanvas=function(){},s.setDropShadow=function(e,t){if(t.dropShadow){const{dropShadowColor:o}=t,n=o,i=THING.Math.degToRad(t.dropShadowAngle),r=1*t.dropShadowDistance;e.shadowColor=n,e.shadowBlur=t.dropShadowBlur,e.shadowOffsetX=Math.cos(i)*r,e.shadowOffsetY=Math.sin(i)*r}else e.shadowColor=0,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},s.angleTwoVectorsZ=function(e,t){const o=e.angleTo(t),n=(new THREE.Vector3).crossVectors(e,t),i=THING.Math.radToDeg(o);return n.y>0?i:360-i},s.createMarker=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let l={type:"Marker",url:"./static/images/blueStar512.png",parent:t,id:`${n}_${i}_${t.id}`,ignoreParentScale:!0,inheritScale:!0,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0,userData:{SKIP_THEME:1}};o&&(o.size&&(o.width=o.size,o.height=o.size,console.warn(`è£é¥° ${l.id} size åæ° åºå¼äº è¯·ä½¿ç¨ width å  height`),delete o.size),l=a.Z.combine(l,o,!0));const c=t.host||t;if(l.layout){const e=s.getLayoutPosition(c,l.layout,null,!0,!1,l.onlySelf);l.userData.tempLayoutPos=e,l.userData.tempLayoutLocalPos=t.worldToSelf(e),l.userData.tempPivotLayout=l.pivotLayout}l.layoutOffset&&(l.userData.tempLayoutOffset=l.layoutOffset),l.pivot&&(l.userData.tempPivot=l.pivot),l.serverFilePath=r,h(l);const u=THING.App.current.create(l);return u.style.alwaysOnTop=l.alwaysOnTop,u.host=c,u.node.visible=!1,s.setLayoutPosition(u),u},s.createCanvasMarker=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e;let r={type:"Marker",parent:t,id:`${n}_${i}_${t.id}`,ignoreParentScale:!0,inheritScale:!0,inheritStyle:!1,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0,userData:{SKIP_THEME:1}};if(o){r=a.Z.combine(r,o,!0);const e=o.canvas.width,t=o.canvas.height,{height:n}=o,i=e/t*n;r.width=i}const l=t.host||t;if(r.layout){const e=s.getLayoutPosition(l,r.layout,null,!0,!1,r.onlySelf);r.userData.tempLayoutPos=e,r.userData.tempLayoutLocalPos=t.worldToSelf(e),r.userData.tempPivotLayout=r.pivotLayout}r.layoutOffset&&(r.userData.tempLayoutOffset=r.layoutOffset),r.pivot&&(r.userData.tempPivot=r.pivot);const c=THING.App.current.create(r);return c.style.alwaysOnTop=r.alwaysOnTop,c.host=l,c.node.visible=!1,s.setLayoutPosition(c),r.lockYAxis&&(c.useSpriteMaterial=!1,c.lookAt(THING.App.current.camera,{lockYAxis:!0})),c},s.createTextBubble=function(e){const t=e.parent;if(!t)return;const{userConfig:o}=e,{tag:n}=e,{effectName:i}=e;let r={type:"Marker",parent:t,size:1,id:`${n}_${i}_${t.id}`,ignoreParentScale:!0,inheritScale:!1,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!1,userData:{SKIP_THEME:1}};o&&(r=a.Z.combine(r,o,!0));const l=t.host||t;if(r.layout){const e=s.getLayoutPosition(l,r.layout,null,!0,!1,r.onlySelf);r.userData.tempLayoutPos=e,r.userData.tempLayoutLocalPos=t.worldToSelf(e),r.userData.tempPivotLayout=r.pivotLayout}r.layoutOffset&&(r.userData.tempLayoutOffset=r.layoutOffset);let c=l.name;if(r.getMethod){if("objectProperty"===r.getMethod){const e=r.propertyPath;c=l.getAttribute(e)}"presetValue"===r.getMethod&&(c=r.presetValue),"func"===r.getMethod&&(c=r.getFunc.call(null,l))}r.canvas=function(e,t){let o=document.createElement("canvas");o.width=512,o.height=64;const n=o.getContext("2d");n.font="24px Microsoft YaHei";const i=n.measureText(e).width;o=null;const r=18,a=Math.ceil(i)+32,s=document.createElement("canvas");s.width=a,s.height=64;const l=s.getContext("2d");return l.font="24px Microsoft YaHei",l.fillStyle="rgba(0,0,0,0.6)",l.fillRect((s.width-a)/2-16,0,a+32,s.height-r),l.fillStyle="rgba(0,0,0,0.6)",l.beginPath(),l.moveTo(s.width/2-r,s.height-r),l.lineTo(s.width/2,s.height),l.lineTo(s.width/2+r,s.height-r),l.closePath(),l.fill(),l.fillStyle=t.triangleColor||"rgb(4, 140, 227)",l.beginPath(),l.moveTo(s.width/2-12,s.height-r),l.lineTo(s.width/2,s.height-6),l.lineTo(s.width/2+12,s.height-r),l.closePath(),l.fill(),l.fillStyle=t.fontColor||"rgb(235, 235, 235)",l.textAlign="center",l.textBaseline="middle",l.fillText(e,s.width/2,s.height/2-9+l.lineWidth/2),s}(c,r.style);const u=THING.App.current.create(r);return u.host=l,u.node.visible=!1,s.setLayoutPosition(u),u.style.alwaysOnTop=!0,u},s.createTextRegion=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e;let r={type:"TextRegion",parent:t,id:`${n}_${i}_${t.id}`,ignoreParentScale:!0,inheritScale:!0,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0,userData:{SKIP_THEME:1}};o&&(r=a.Z.combine(r,o,!0));const l=t.host||t;let c=l.name;if(r.getMethod){if("objectProperty"===r.getMethod){const e=r.propertyPath;c=l.getAttribute(e)}"presetValue"===r.getMethod&&(c=r.presetValue),"func"===r.getMethod&&(c=r.getFunc.call(null,l))}if(r.text=c,r.layout){const e=s.getLayoutPosition(l,r.layout,null,!0,!1,r.onlySelf);r.userData.tempLayoutPos=e,r.userData.tempLayoutLocalPos=t.worldToSelf(e),r.userData.tempPivotLayout=r.pivotLayout}r.layoutOffset&&(r.userData.tempLayoutOffset=r.layoutOffset);const u=THING.App.current.create(r);return u.host=l,s.setLayoutPosition(u),u},s.createModel=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let l={type:"Thing",url:"",parent:t,scale:[1,1,1],id:`${n}_${i}_${t.id}`,ignoreParentScale:!0,lockYAxis:!1,inheritScale:!0,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0,rotation:[0,0,0],inheritTheme:!1,userData:{SKIP_THEME:1},style:{SKIP_THEME:1}};if(o){let e=o.url;e.indexOf("api")>-1&&(o.url=e.replace("api/decorator/","https://model.3dmomoda.com/models/")),l=a.Z.combine(l,o,!0)}const c=t.host||t;if(l.layout){const e=s.getLayoutPosition(c,l.layout,null,!0,!1,l.onlySelf);l.userData.tempLayoutPos=e,l.userData.tempLayoutLocalPos=t.worldToSelf(e),l.userData.tempPivotLayout=l.pivotLayout}l.layoutOffset&&(l.userData.tempLayoutOffset=l.layoutOffset),l.animationName&&(l.userData.tempAnimationName=l.animationName),l.userData.tempAnimationLoopType=l.animationLoopType||"no",l.serverFilePath=r,h(l),l.inheritStyle=!1;const u=THING.App.current.create(l);if(u.host=c,s.setLayoutPosition(u),0===u.userData.SKIP_THEME||!1===u.userData.SKIP_THEME){u.userData.SKIP_THEME=0;const{ThemeManager:e}=this;if(e&&e.themeCfg){let t=e.themeCfg.getConfig(u,"ç§å¹»ä¸»é¢",!0);t||(t=e.themeCfg.getConfig(u.host,"ç§å¹»ä¸»é¢"),e.themeCfg.regConfig(u,"ç§å¹»ä¸»é¢",t)),u.applyTheme("default",!1,!0)}}return!1===l.pickable&&(u.pickable=!1),u},s.createParticle=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let l={type:"ParticleSystem",url:"",parent:t,scale:[1,1,1],id:`${n}_${i}_${t.id}`,ignoreParentScale:!0,inheritScale:!0,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!0,userData:{SKIP_THEME:1},emissionSize:1};if(o){let e=o.url;e.indexOf("api")>-1&&(o.url=e.replace("api/decorator/","https://model.3dmomoda.com/models/")),l=a.Z.combine(l,o,!0)}const c=t.host||t;if(l.layout){const e=s.getLayoutPosition(c,l.layout,null,!0,!1,l.onlySelf);l.userData.tempLayoutPos=e,l.userData.tempLayoutLocalPos=t.worldToSelf(e),l.userData.tempPivotLayout=l.pivotLayout}var u;return l.layoutOffset&&(l.userData.tempLayoutOffset=l.layoutOffset),l.serverFilePath=r,h(l),(new THREE.FileLoader).load(l.url.concat("/index.json"),(function(e){let t=e;e=JSON.parse(t);let o=l.url;if(e.listGroups.forEach((e=>{e.texture&&d(e.texture.url)&&(e.texture.url=g(o,e.texture.url)),e.textureTrail&&d(e.textureTrail.url)&&(e.textureTrail.url=g(o,e.textureTrail.url))})),delete l.url,l.data=e,(!l.parent||!0!==l.parent.destroyed)&&l.parent)return(u=THING.App.current.create(l)).on("complete",(function(e){let t=e.object;l.emissionSize&&l.emissionSize>1&&setTimeout((function(){t.groups.forEach((e=>{e.scale=l.emissionSize}))}),100),l.rotation&&(t.rotateX(l.rotation[0]-0),t.rotateY(l.rotation[1]-0),t.rotateZ(l.rotation[2]-0))})),u.host=c,s.setLayoutPosition(u),u}),(function(e){}),(function(e){})),u},s.setCampusLine=function(e,t){if(t.offsetHeight){let o=e.position;e.position=[o[0],o[1]+t.offsetHeight,o[2]]}if(t.speed&&(e.scrollUV=!0,e.scrollSpeed=t.speed),t.uvRatio||t.repeatFactor){let o,n=e.width;"PolygonLine"===e.type&&(n=2*Math.PI*e.width),t.uvRatio?(o=n/e.length*t.uvRatio[0],e._uvRepeat=[o,1]):t.repeatFactor&&(o=n/e.length*t.repeatFactor),e._uvRepeat=[o,1]}if(t.growSpeed){const o=t.growSpeed-0;if(o>0){const t=e.length/o*1e3;e.play({time:t})}}return e.cornerRadius=.5*t.width,e.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},e.inheritStyle=!0,t.NoBlending?1===t.opacity?(e.node.getMeshes()[0].material.transparent=!1,e.node.getMeshes()[0].material.blending=2):e.node.getMeshes()[0].material.blending=2:e.node.getMeshes()[0].material.blending=1,e},s.getCampusLineStyle=function(e){let t;const{type:o,color:n}=e;if("image"===o){const{image:o}=e;t={image:o,color:n||"ffffff"}}else"vector"===o&&(t={color:n});return t.glow=e.effect,t.opacity=e.opacity,e.style&&(t=Object.assign(t,e.style)),t},s.createLine=function(e){const t=THING.App.current,o=e.parent,n=o.host||o,{userConfig:i}=e,{serverFilePath:r}=e;i.serverFilePath=r,h(i);let a=this.getCampusLineStyle(i);const s=t.create({type:"Line",parent:e.parent,points:e.points,style:a,complete:i.complete,inheritScale:!1,inheritPosition:!1});return s.host=n,this.setCampusLine(s,i),s},s.createPolygonLine=function(e){const t=THING.App.current,o=e.parent,n=o.host||o,{userConfig:i}=e,{serverFilePath:r}=e;i.serverFilePath=r,h(i);const a=THING.App.current.create({type:"BaseObject",id:`${e.tag}_${e.effectName}_${e.parent.id}`,parent:o,inheritStyle:!1});let s=this.getCampusLineStyle(i);const l=t.create({type:"PolygonLine",width:i.width-0,parent:e.parent,points:e.points,style:s,complete:i.complete,inheritScale:!1,inheritPosition:!1});return l.host=n,l.style.color=s.color,this.setCampusLine(l,i),a.add(l),l},s.createRouteLine=function(e){const t=THING.App.current,o=e.parent,n=o.host||o,{userConfig:i}=e,{serverFilePath:r}=e;i.serverFilePath=r,h(i);let a=this.getCampusLineStyle(i);const s=t.create({type:"RouteLine",width:i.width-0,parent:e.parent,points:e.points,arrowFlag:i.arrowFlag||!1,style:a,complete:i.complete,inheritScale:!1,inheritPosition:!1});return s.host=n,s.style.color=a.color,this.setCampusLine(s,i),s},s.createPolygonRegion=function(e){const t=THING.App.current,o=e.parent,n=o.host||o,{userConfig:i}=e,{serverFilePath:r}=e,{inheritStyle:a}=i;let s;i.serverFilePath=r,h(i);const{color:l}=i;let{opacity:c}=i;void 0===c&&(c=1);let u=i.outlineColor;void 0===u&&(u=null),s={color:l,regionColor:l,regionOpacity:c-0,lineColor:u,image:i.image,lineOpacity:i.outlineOpacity||1,alwaysOnTop:i.alwaysOnTop||!1},s.glow=i.effect,i.style&&(s=Object.assign(s,i.style));const p=THING.App.current.create({type:"BaseObject",parent:o});let d;d=i.hasOwnProperty("getMethod")?JSON.parse(f(n,i)):JSON.parse(n.getAttribute("userData/DATA/POINTS")||n.getAttribute("userData/DATA/points"));const g=t.create({type:"Shape",points:d,parent:this.getCampus(n),height:i.height,inheritStyle:a,color:l,style:s,local:!0,complete:function(){i.complete&&i.complete(),this.style.image="",this.style.image=s.image}});if(g.setOpacity(c),i.image){let e=g.node.getMaterials()[0];e.map.wrapS=THREE.RepeatWrapping,e.map.wrapT=THREE.RepeatWrapping,e.map.repeat.set(i.imageDensity||1/g.boundingBox.size[0],i.imageDensity||1/g.boundingBox.size[2]),g.node.getMaterials()[0]=e}let m=g.node.getMaterials()[1];if(i.wallImage){let e=(new THREE.TextureLoader).load(i.wallImage);m.map=e}else m.map=null;let y=[];0!==i.height?g._vertices.forEach((e=>{e[1]=e[1]+i.height,y.push(e)})):y=g._vertices;const _=this.getCampus(n);y=this.convertPointsFromCampusToWorld(_,y),y.push(y[0]);let v=THING.App.current.create({type:"Line",color:u||l,points:y,inheritStyle:!1,style:{opacity:s.lineOpacity}});return g.add(v),g.host=n,i.offsetHeight&&(g.localPosition=[g.localPosition[0],g.localPosition[1]+i.offsetHeight,g.localPosition[2]]),o&&o.add(g),p.add(g),p},s.getLinePointList=function(e,t){let o=[],n=[],i=[];if(i=t[0].length<3?[t]:t,e.isDoubleLine){const t=i.map((e=>e[0]instanceof Array?e.map((e=>CMAP.Util.convertLonlatToWorld(e,0))):CMAP.Util.convertLonlatToWorld(e,0)));let r=e.offsetFactor;if(o=t.map((e=>this.generateDoublelines(e,{gap:r}))),o.length>1){let e;e=o[0][1],o[0][1]=o[1][1],o[1][1]=e}for(let t=0;t<o.length;t++)if(1===e.lineNum){let e;e=o.length>1?o[0]:o[0][0],n[0]=e.map((e=>e[0]instanceof Array?e.map((e=>CMAP.Util.convertWorldToLonlat(e))):CMAP.Util.convertWorldToLonlat(e)))}else if(2===e.lineNum){let e;e=o.length>1?o[1]:o[0][1],n[0]=e.map((e=>e[0]instanceof Array?e.map((e=>CMAP.Util.convertWorldToLonlat(e))):CMAP.Util.convertWorldToLonlat(e)))}}else o.push(t);return n.length?o=n:o},s.createGeoLine=function(e,t=!1){const o=e.parent,{userConfig:n}=e,{tag:i}=e,{effectName:r}=e,{serverFilePath:s}=e;let l={id:`${i}_${r}_${o.id}`,opacity:1,serverFilePath:s,complete(){}};n&&(l=a.Z.combine(l,n,!0));const c=THING.App.current.create({type:"BaseObject",id:l.id,parent:o,inheritScale:!1,inheritPosition:!1,inheritStyle:!1}),p=o.host||o;if(l.width&&(l.width-=0),void 0===l.blending&&(l.blending=!0),l.uvRatio||(l.uvRatio=[1,1]),l.speed&&(l.speed-=0),"GEOODLINE"===p.userData._TYPE_||p.startLonlat&&p.endLonlat&&!l.useGeoJsonData){let e;"vector"===l.type?e={type:"vector",lineType:l.lineType,color:l.color,opacity:l.opacity,colorMapping:l.colorMapping}:"image"===l.type&&(l.serverFilePath=s,h(l),e={type:"image",lineType:l.lineType,color:n.color,useColor:!0,imageUrl:l.image||l.imageUrl,textureWrap:l.textureWrap||"stretch",textureSize:l.textureSize||100});let t={speed:l.speed||0,effect:l.effect||!1,width:l.width||1,blending:l.blending,uvRatio:l.uvRatio,glowStrength:l.glowStrength,offsetHeight:l.offsetHeight,growSpeed:l.growSpeed,growLoop:l.growLoop,sizeAttenuation:l.sizeAttenuation};e={...e,...t};let o=[p.startLonlat,p.endLonlat],i=this.getLinePointList(l,o),r=THING.App.current.create({type:"GeoLine",id:`${l.id}_GEOODLINE`,coordinates:i[0],heightArray:[p.startElevation,p.endElevation],offsetHeight:l.offsetHeight,renderer:e,inheritVisible:!0,userData:l.userData,complete:l.complete});if(r._setPostRadiusEffect(l.postRadialBlur),l.showHeadline&&r.on("complete",(function(){function e(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;let n=e.getAttribute(o);return void 0!==t.toFixed&&Number(n)&&(n=Number(n).toFixed(t.toFixed)),n}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name}let t=document.createElement("canvas"),o=t.getContext("2d"),n=0,i=0,a=[],s=l.headline.contents;for(let t=0;t<s.length;t++){let r=s[t];const l=`${r.fontSize||480}px ${r.fontFamily||"Verdana"} bold`;o.font=l;let c=o.measureText(e(p,r));n=c.width-n>0?c.width:n;let u=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent||r.fontSize||480;u+=2*(r.lineSpacing||50),i+=u,a.push(u)}t.width=n,t.height=i,o.textBaseline="top",o.textAlign="left";let c=0;for(let t=0;t<s.length;t++){let n=s[t];o.font="10px Arail";let i=o.measureText(e(p,n)).actualBoundingBoxAscent||0,r=`${n.fontSize||480}px ${n.fontFamily||"Verdana"} bold`;o.font=r,o.fillStyle=n.fontColor||"#ffffff";let l=n.lineSpacing+i||50;o.fillText(e(p,n),0,l+c),c+=a[t]}setTimeout((()=>{let e=THING.App.current.create({type:"Marker",parent:r,height:l.headline.height||0,useSpriteMaterial:!0,pivot:[.5,1],localPosition:[0,l.headline.offsetHeight||0,0],canvas:t});e.width=t.width/t.height*e.height}),1e3)})),l.growSpeed){const e=l.growSpeed-0,t=l.growLoop;r._playLineGrow({speed:e,growLoop:t}),THING.App.current.on("GeoLineGrowEnd",(function(){u(r,l.NoBlending)}))}u(r,l.NoBlending),r.host=p,c.add(r),r.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},r.inheritStyle=!0}let f=p.getAttribute("geojson")||p.getAttribute("GEOJSON");if(f){let e={type:"FeatureCollection",features:[]};f.hasOwnProperty("features")||(e.features.push(f),f=e);let t=[];f.hasOwnProperty("geometry")&&t.push(f);const o=f.hasOwnProperty("geometry")?t:f.features||[];for(let e=0;e<o.length;e+=1){const t=o[e],{geometry:i}=t,{coordinates:r}=i;let a=[],s=i.type;if("MultiPolygon"===i.type&&(s="MultiLineString",1===r.length?a=r[0]:r.forEach((e=>{e instanceof Array&&a.push(...e)}))),"Polygon"===i.type&&(s="MultiLineString"),0===a.length&&(a=r),"LineString"===s||"MultiLineString"===s){let e;"vector"===l.type?e={type:"vector",lineType:l.lineType,color:l.color,opacity:l.opacity,colorMapping:l.colorMapping}:"image"===l.type&&(h(l),e={type:"image",lineType:l.lineType,color:n.color,useColor:!0,imageUrl:l.image||l.imageUrl,textureWrap:l.textureWrap||"stretch",textureSize:l.textureSize||100});let t={speed:l.speed||0,effect:l.effect||!1,width:l.width||1,blending:l.blending,uvRatio:l.uvRatio,glowStrength:l.glowStrength,offsetHeight:l.offsetHeight,growSpeed:l.growSpeed,growLoop:l.growLoop,sizeAttenuation:l.sizeAttenuation};e={...e,...t};let o=this.getLinePointList(l,a);const i=THING.App.current.create({type:"GeoLine",id:`${l.id}_GEOODLINE`,coordinates:o[0],offsetHeight:l.offsetHeight,renderer:e,inheritVisible:!0,userData:l.userData,complete:l.complete});if(i._setPostRadiusEffect(l.postRadialBlur),l.growSpeed){const e=l.growSpeed-0,t=l.growLoop;i._playLineGrow({speed:e,growLoop:t}),THING.App.current.on("GeoLineGrowEnd",(function(){u(i,l.NoBlending)}))}const r=CMAP.Util.convertWorldToLonlat(p.position)[2];l.layoutOffset?i.translate([l.layoutOffset[0],l.layoutOffset[1]+r,l.layoutOffset[2]]):i.translate([0,r,0]),u(i,l.NoBlending),i.host=p,c.add(i),i.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},i.inheritStyle=!0}}}return c},s.createGeoFlyLine=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let s,l={id:`${n}_${i}_${t.id}`,opacity:1,complete(){},blending:void 0===o.NoBlending||o.NoBlending};o&&(l=a.Z.combine(l,o,!0));const c=t.host||t;if(l.width&&(l.width-=0),void 0===l.blending&&(l.blending=!0),l.uvRatio||(l.uvRatio=[1,1]),l.speed&&(l.speed-=0),"GEOODLINE"===c.userData._TYPE_||c.startLonlat&&c.endLonlat){let e;"vector"===l.type?e={type:"vector",lineType:l.lineType,color:l.color,opacity:l.opacity,colorMapping:l.colorMapping}:"image"===l.type&&(l.serverFilePath=r,h(l),e={type:"image",lineType:l.lineType,imageUrl:l.image||l.imageUrl},e.useColor=!0);let o={speed:l.speed,effect:l.effect,width:l.width,uvRatio:l.uvRatio,glowStrength:l.glowStrength,blending:l.blending,offsetHeight:l.offsetHeight,growSpeed:l.growSpeed,growLoop:l.growLoop,sizeAttenuation:l.sizeAttenuation,color:l.color};e={...e,...o},s=THING.App.current.create({type:"GeoFlyLine",id:`${l.id}_GEOODLINE`,coordinates:[c.startLonlat,c.endLonlat],renderer:e,offsetHeight:l.offsetHeight,inheritVisible:!0,userData:l.userData,inheritScale:!1,inheritPosition:!1,complete:l.complete}),s._setPostRadiusEffect(l.postRadialBlur),l.showHeadline&&s.on("complete",(function(){function e(e,t){if("objectProperty"===t.getMethod){const i=t.propertyPath;let r=e.getAttribute(i);return void 0!==t.toFixed&&Number(r)&&(o=Number(r),n=t.toFixed,o=parseFloat(o),r=(Math.round(((o+Number.EPSILON)*Math.pow(10,n)).toFixed(n))/Math.pow(10,n)).toFixed(n)),r}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name;var o,n}s.worldToSelf(s._topPos)[1];let t=document.createElement("canvas"),o=t.getContext("2d"),n=0,i=0,r=[],a=l.headline.contents;for(let t=0;t<a.length;t++){let s=a[t];const l=`${s.fontSize||480}px ${s.fontFamily||"Verdana"} bold`;o.font=l;let u=o.measureText(e(c,s));n=u.width-n>0?u.width:n;let h=u.actualBoundingBoxAscent+u.actualBoundingBoxDescent||s.fontSize||480;h+=2*(s.lineSpacing||50),i+=h,r.push(h)}t.width=n,t.height=i,o.textBaseline="top",o.textAlign="left";let u=0;for(let t=0;t<a.length;t++){let n=a[t];o.font="10px Arail";let i=o.measureText(e(c,n)).actualBoundingBoxAscent||0,s=`${n.fontSize||480}px ${n.fontFamily||"Verdana"} bold`;o.font=s,o.fillStyle=n.fontColor||"#ffffff";let l=n.lineSpacing+i||50;o.fillText(e(c,n),0,l+u),u+=r[t]}let h=THING.App.current.create({type:"Marker",parent:s,height:l.headline.height||0,useSpriteMaterial:!0,pivot:[.5,1],localPosition:[0,l.headline.offsetHeight||0,0],canvas:t});h.width=t.width/t.height*h.height})),t._flyLines||(t._flyLines=[]),t._flyLines.push(s),s.host=c,s.scale=[1,l.curvature||1,1],s.node.getMeshes()[0].material.blending=l.blending?THREE.AdditiveBlending:THREE.NormalBlending}else console.error(`è¯¥å¯¹è±¡ä¸æ¯å³ç³»è¿çº¿ ${t.id}`);return s},s.parseBoolean=function(e,t){return void 0===e?t:e},s.createGeoPolygon=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let l={id:`${n}_${i}_${t.id}`,height:0,complete(){}};o&&(l=a.Z.combine(l,o,!0));const u=THING.App.current.create({type:"BaseObject",id:l.id,parent:t,style:{opacity:o.opacity,color:o.color}}),p=t.host||t;let d;if(u.host=p,o.hasOwnProperty("getMethod")?void 0!==f(p,o)&&(d=JSON.parse(f(p,o))):d=p.getAttribute("geojson"),d){let e=[];d.hasOwnProperty("geometry")&&e.push(d);const o=d.hasOwnProperty("geometry")?e:d.features||[];for(let e=0;e<o.length;e+=1){let n=o[e];const{geometry:i}=n;let a={type:"FeatureCollection",features:[]};if(n.hasOwnProperty("features")&&!n.hasOwnProperty("geometry")||(a.features.push(n),n=a),"Polygon"===i.type||"MultiPolygon"===i.type||"MultiLineString"===i.type){const{coordinates:o}=i;let a;if("vector"===l.type)a={type:"vector",color:l.color,opacity:l.opacity-0,colorMapping:l.colorMapping||null,outlineColor:l.outlineColor,outlineOpacity:l.outlineOpacity};else if("image"===l.type)if(l.serverFilePath=r,h(l),l.imageDensity){const e=c(o,l.imageDensity);a={type:"image",opacity:l.opacity-0,imageUrl:l.image||l.imageUrl,textureWrap:l.textureWrap||"stretch",textureSize:l.textureSize,uvRatio:e}}else a={type:"image",opacity:l.opacity-0,imageUrl:l.image||l.imageUrl,textureWrap:l.textureWrap||"stretch",textureSize:l.textureSize};let f={imageDensity:l.imageDensity||"",height:l.height||"",layoutOffset:l.layoutOffset||"",style:l.style||"",lights:l.lights,useAoMap:s.parseBoolean(l.useAoMap,!0),aoMapIntensity:l.aoMapIntensity||.85,outlineColor:l.outlineColor||[255,64,39,1],outlineWidth:l.outlineWidth,outlineImageUrl:l.outlineImageUrl||"http://192.168.21.119:90/citybuilder_console/upload/polygonIcons/systemIcons/1.png",outlineLineType:l.outlineLineType||"Plane",outlineOpacity:l.outlineOpacity-0,outlinePostRadialBlur:s.parseBoolean(l.outlinePostRadialBlur,!1),outlineEffect:s.parseBoolean(l.outlineEffect,!1),outlineGlowStrength:l.outlineGlowStrength,outlineType:l.outlineType||"vector",outlineBlending:s.parseBoolean(l.outlineBlending,!1),outlineSizeAttenuation:l.outlineSizeAttenuation,outlineColorMapping:l.outlineColorMapping,outlineSpeed:l.outlineSpeed};a={...a,...f};const d=THING.App.current.create({type:"FeatureLayer",id:`${l.id}_${e}`,height:l.height,offsetHeight:l.offsetHeight||l.offsetHieght||0,dataSource:n,geometryType:"GeoPolygon",renderer:a,inheritVisible:l.inheritVisible,inheritStyle:l.inheritStyle,userData:l.userData,complete:l.complete});d._setPostRadiusEffect(l.postRadialBlur),d.style.skipBoundingBox=!0,d.userData.skipBoundingBox=!0;const g=CMAP.Util.convertWorldToLonlat(t.position)[2];if(l.layoutOffset){let e=l.layoutOffset;d.translate([e[0],e[1]+g,e[2]])}else d.translate([0,g,0]);l.style&&l.style.renderOrder&&(d.style.renderOrder=l.style.renderOrder),d.host=p,u.add(d),d.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},d.inheritStyle=!0}}}return u},s.createBGAndCanvasPanel=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let l={type:"BGAndCanvasPanel",parent:t,width:1,height:1,id:`${n}_${i}_${t.id}`,ignoreParentScale:!0,inheritScale:!0,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!1,userData:{SKIP_THEME:1}};o&&(l=a.Z.combine(l,o,!0));const c=t.host||t;if(l.layout){const e=s.getLayoutPosition(c,l.layout,null,!0,!1,l.onlySelf);l.userData.tempLayoutPos=e,l.userData.tempLayoutLocalPos=t.worldToSelf(e),l.userData.tempPivotLayout=l.pivotLayout}l.layoutOffset&&(l.userData.tempLayoutOffset=l.layoutOffset),l.pivot&&(l.userData.tempPivot=l.pivot),l.keepSize&&!0===l.keepSize&&(l.sizeAttenuation=!1),l.serverFilePath=r,l.rsmPath=s.rsmPath,h(l),l.url1=l.url,delete l.url,l.userData.config=l;const u=THING.App.current.create(l);return u.style.alwaysOnTop=l.alwaysOnTop,l.moniterObj=c,u.on("complete",(async e=>{if(e.object.destroyed)return;const t=e.object.style.opacity;e.object.style.opacity=1,await e.object.setPanelCanvas(e.object.userData.config,!0),e.object.style.opacity=t,delete e.object.userData.config})),s.setLayoutPosition(u),u.host=c,!1===l.useSpriteMaterial&&l.rotation&&(u.rotateX(l.rotation[0]-0),u.rotateY(l.rotation[1]-0),u.rotateZ(l.rotation[2]-0)),u},s.createHtmlPanel=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:r}=e,{serverFilePath:l}=e;if(o.userData&&o.userData.indexItem&&o.userData.indexItem.length){let e={};o.userData.indexItem.unshift(o.showMapping);let t=o.userData.indexItem;for(let o=0;o<t.length;o++){let n;if(t[o]instanceof Object)if(t[o].hasOwnProperty("uuid"))for(n in t[o])Array.isArray(t[o][n])||"object"!=typeof t[o][n]||(e[n+t[o].uuid]=t[o][n]);else for(n in t[o])e[n]=t[o][n]}o.showMapping=e}let c={type:"HtmlElementPanel",parent:t,size:1,id:`${n}_${r}_${t.id}`,ignoreParentScale:!0,inheritScale:!0,layout:[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],pivotLayout:[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],layoutOffset:[0,0,0],onlySelf:!1,userData:{SKIP_THEME:1}};o&&(c=a.Z.combine(c,o,!0));const u=t.host||t;if(c.layout){const e=s.getLayoutPosition(u,c.layout,null,!0,!1,c.onlySelf);c.userData.tempLayoutPos=e,c.userData.tempLayoutLocalPos=t.worldToSelf(e),c.userData.tempPivotLayout=c.pivotLayout}c.layoutOffset&&(c.userData.tempLayoutOffset=c.layoutOffset),c.pivot&&(c.userData.tempPivot=c.pivot);let h=c.html;h=s.convertUrlInHtml(h,l),c.html=h,this.htmlCssMap[h]||(this.htmlCssMap[h]=i()(h));const p=this.htmlCssMap[h].filter("style")[0];p.id=n,p.name="_decorator_";const f=this.htmlCssMap[h].filter("div")[0];let d=document.createElement("div");d.append(p),d.append(f),c.element=d;const g=THING.App.current.create(c);return g.host=u,c.moniterObj=u,g.setHtmlElement(c),s.setLayoutPosition(g),!1===c.useSpriteMaterial&&c.rotation&&(g.rotateX(c.rotation[0]-0),g.rotateY(c.rotation[1]-0),g.rotateZ(c.rotation[2]-0)),g},s.createBoundary=function(e){const t=THING.App.current,{points:o}=e,n=void 0===e.type?"vertical":e.type;let i=void 0===e.lineCount?5:e.lineCount;i-=0,void 0===e.blending||e.blending;let r=void 0===e.extrudeHeight?100:e.extrudeHeight;r-=0;const{wallImage:a}=e,{lineImage:s}=e;let l=void 0===e.scrollSpeed?[0,0]:e.scrollSpeed,c=void 0===e.alphaSpeed?0:e.alphaSpeed;c-=0;let h=THREE.ClampToEdgeWrapping;void 0===e.textureWrap&&(h=THREE.RepeatWrapping),Array.isArray(l)||(l=[l,0]);const p=THING.Math.getPerimeter(o),f=t.create({type:"BaseObject",inheritScale:!1});let d=t.create({type:"Boundary",height:r,scroll:!0,image:a,style:e.style,parent:e.parent});if(d.style.glow=e.glow||e.effect||!1,u(d,e.blending),d._material.depthWrite=!1,d._material.opacity=.7,d._material.map.wrapS=h,d._material.map.wrapT=h,d._material.color=new THREE.Color(e.color),d.imageRepeat=e.uvRatio,"vertical"===n&&d.setScroll(l[0],-l[1]),"horizontal"===n)for(let e=0;e<i;e+=1){let n=t.create({type:"Boundary",height:r/i,points:o,independent:!0,image:s});n._material.blending=THREE.AdditiveBlending,n._material.depthWrite=!1,n._material.map.wrapS=THREE.ClampToEdgeWrapping,n._material.map.wrapT=THREE.ClampToEdgeWrapping,n._material.map.repeat.set(n.height/p,1),n._material.opacity=.8-e*(.8-.1)/i,n._material=n.node.getMaterials()[0],f.add(n),n.translate([0,e*r/i,0])}if(f.add(d),e.alphaImage){const t=new THREE.TextureLoader;d.node.getMaterials()[0].alphaMap=t.load(e.alphaImage),d.node.getMaterials()[0].alphaMap.repeat.set(r/p,1),d.node.getMaterials()[0].alphaMap.wrapS=THREE.RepeatWrapping,d.node.getMaterials()[0].alphaMap.wrapT=THREE.RepeatWrapping,d.on("update",(()=>{d.node.getMaterials()[0].alphaMap&&c&&(d.node.getMaterials()[0].alphaMap.offset.x+=.001*c)}),`updateAlphaMap${d.queryID}`)}return d.onProcessStyleValue=function(e,t){if("opacity"==e)return!1},d.inheritStyle=!0,d},s.getOffsetPoints=function(e,t,o){let n=[];for(let i=0;i<e.length;i++){let r=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3;0===i?(a.subVectors(new THREE.Vector3(...e[i+1]),new THREE.Vector3(...e[i])).normalize(),s.copy(a)):i==e.length-1?(r.subVectors(new THREE.Vector3(...e[i]),new THREE.Vector3(...e[i-1])).normalize(),s.copy(r)):(r.subVectors(new THREE.Vector3(...e[i]),new THREE.Vector3(...e[i-1])).normalize(),a.subVectors(new THREE.Vector3(...e[i+1]),new THREE.Vector3(...e[i])).normalize(),s=r.add(a).normalize());let l=new THREE.Vector3(...e[i]).normalize(),c=new THREE.Vector3;c.crossVectors(s,l).normalize(),c.multiplyScalar(t);let u=o?new THREE.Vector3(...e[i]).add(c):new THREE.Vector3(...e[i]).sub(c);n.push([u.x,u.y,u.z])}return n},s.createDoubleGeoFlyLine=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let s={id:`${n}_${i}_${t.id}`,opacity:1,complete(){}};o&&(s=a.Z.combine(s,o,!0));const l=t.host||t;if("GEOODLINE"===l.userData._TYPE_||l.startLonlat&&l.endLonlat){s.serverFilePath=r;let c=this;const u=s.offsetFactor,p=f(s);function f(e,o=!1){let n,i,a;if(e.width&&(e.width-=0),void 0===e.blending&&(e.blending=!0),e.uvRatio||(e.uvRatio=[1,1]),e.speed&&(e.speed-=0),e.serverFilePath=r,h(e),n={type:"image",lineType:e.lineType,imageUrl:e.image||s.imageUrl,speed:e.speed||0,effect:e.effect||!1,width:e.width,blending:e.blending,uvRatio:e.uvRatio,glowStrength:e.glowStrength,offsetHeight:e.offsetHeight,growSpeed:e.growSpeed,growLoop:e.growLoop,sizeAttenuation:e.sizeAttenuation},a=[l.startLonlat,l.endLonlat],o){const e=a.map((e=>CMAP.Util.convertLonlatToWorld(e,0)));a=c.getOffsetPoints(e,u,!0).map((e=>CMAP.Util.convertWorldToLonlat(e)))}if(i=THING.App.current.create({type:"GeoFlyLine",id:(s.id+o?"_COPY_":"")+"_GEOODLINE",coordinates:a,renderer:n,inheritVisible:!0,userData:e.userData,inheritScale:!1,inheritPosition:!1,complete:e.complete}),i._setPostRadiusEffect(e.postRadialBlur),t.add(i),i.host=l,i.scale=[1,e.curvature||1,1],e.growSpeed){const t=e.growSpeed-0,o=e.growLoop;i._playLineGrow({speed:t,growLoop:o})}i.node.getMeshes().length&&(i.node.getMeshes()[0].material.uniforms.color.value=new THREE.Color(e.color))}return f(s.copyLine,!0),p}console.error(`è¯¥å¯¹è±¡ä¸æ¯å³ç³»è¿çº¿ ${t.id}`)},s.createDoubleGeoLine=function(e){const t=e.parent,{userConfig:o}=e,{tag:n}=e,{effectName:i}=e,{serverFilePath:r}=e;let s={id:`${n}_${i}_${t.id}`,opacity:1,complete(){}};o&&(s=a.Z.combine(s,o,!0));const l=t.host||t;if("GEOODLINE"===l.userData._TYPE_||l.startLonlat&&l.endLonlat){s.serverFilePath=r;let c=this;const u=s.offsetFactor,p=f(s);function f(e,o=!1){let n,i,a;if(e.width&&(e.width-=0),void 0===e.blending&&(e.blending=!0),e.uvRatio||(e.uvRatio=[1,1]),e.speed&&(e.speed-=0),e.serverFilePath=r,h(e),n={type:"image",lineType:e.lineType,imageUrl:e.image||s.imageUrl,speed:e.speed||0,effect:e.effect||!1,width:e.width,blending:e.blending,uvRatio:e.uvRatio,sizeAttenuation:e.sizeAttenuation},a=[l.startLonlat,l.endLonlat],o){const e=a.map((e=>CMAP.Util.convertLonlatToWorld(e,0)));a=c.getOffsetPoints(e,u,!0).map((e=>CMAP.Util.convertWorldToLonlat(e)))}if(i=THING.App.current.create({type:"GeoLine",id:(s.id+o?"_COPY_":"")+"_GEOODLINE",coordinates:a,renderer:n,inheritVisible:!0,userData:e.userData,inheritScale:!1,inheritPosition:!1,complete:e.complete}),t.add(i),i.host=l,e.growSpeed){const t=e.growSpeed-0,o=e.growLoop;i._playLineGrow({speed:t,growLoop:o})}i.node.getMeshes().length&&(i.node.getMeshes()[0].material.uniforms.color.value=new THREE.Color(e.color))}return f(s.copyLine,!0),p}console.error(`è¯¥å¯¹è±¡ä¸æ¯å³ç³»è¿çº¿ ${t.id}`)},s.createCampusDoubleRouteLine=function(e,t,o,n,i){let r,a,s,l=[];if(l=this.generateDoublelines(t,{gap:o.offsetFactor,up:n.up}),e.points=l[0],e.userConfig.color=o.lineOneColor,e.userConfig.speed=o.lineOneSpeed-0,r=this.createRouteLine(e),r.host=n,e.points=l[1],e.userConfig.color=o.lineTwoColor,e.userConfig.speed=o.lineTwoSpeed-0,a=this.createRouteLine(e),a.host=n,o.xUnit>0){s=r.length/(o.xUnit-0),s<1?s=1:s>o.maxRepeatFactor&&(s=o.maxRepeatFactor);let e=r.width/r.length*s;r.imageRepeat=[e,1],a.imageRepeat=[e,1]}i.add(r),i.add(a)},s.createDoubleRouteLine=function(e,t,o,n,i){let r,a,s;if(e.points=this.getOffsetPoints(t,o.offsetFactor-0,!0),r=this.createRouteLine(e),r.imageScrollSpeed=o.lineOneSpeed-0,r.host=n,e.points=this.getOffsetPoints(t,o.offsetFactor-0,!1),a=this.createRouteLine(e),a.imageScrollSpeed=o.lineTwoSpeed-0,a.host=n,o.xUnit>0){s=r.length/(o.xUnit-0),s<1?s=1:s>o.maxRepeatFactor&&(s=o.maxRepeatFactor);let e=r.width/r.length*s;r.imageRepeat=[e,1],a.imageRepeat=[e,1]}else r.imageRepeat=[o.repeatFactor-0,1],a.imageRepeat=[o.repeatFactor-0,1];i.add(r),i.add(a)},s.generateDoublelines=function(e,t={}){if(!THING.Utils.isArray(e)||e.length<2)return;const o=THING.Utils.parseVector3(THING.Utils.parseValue(t.up,[0,1,0])),n=THING.Utils.parseValue(t.gap,1)/2,i=[],r=[],a=THING.Utils.parseVector3([0,0,0]);if(2===e.length){const t=THING.Utils.parseVector3(e[0]),s=THING.Utils.parseVector3(e[1]),l=a.subVectors(s,t).normalize().clone(),c=a.crossVectors(l,o).normalize().setLength(n).clone();a.copy(c);const u=a.negate().clone(),h=a.addVectors(t,c).toArray();i.push(h);const p=a.addVectors(s,c).toArray();i.push(p);const f=a.addVectors(t,u).toArray();r.push(f);const d=a.addVectors(s,u).toArray();return r.push(d),[i,r]}const s=e.length;let l,c,u,h,p,f,d,g,m;const y=THING.Utils.parseVector3(e[0]),_=THING.Utils.parseVector3(e[1]);THING.Utils.parseVector3(e[2]),l=a.subVectors(_,y).normalize().clone(),u=a.crossVectors(o,l).normalize().setLength(n).clone(),a.copy(u),h=a.negate().clone(),g=a.addVectors(y,u).toArray(),i[0]=g,m=a.addVectors(y,h).toArray(),r[0]=m;const v=THING.Utils.parseVector3(e[s-1]),T=THING.Utils.parseVector3(e[s-2]);THING.Utils.parseVector3(e[s-3]),c=a.subVectors(v,T).normalize().clone(),u=a.crossVectors(o,c).normalize().setLength(n).clone(),a.copy(u),h=a.negate().clone(),g=a.addVectors(v,u).toArray(),i[s-1]=g,m=a.addVectors(v,h).toArray(),r[s-1]=m;for(let t=1;t<s-1;t++){const s=THING.Utils.parseVector3(e[t-1]),u=THING.Utils.parseVector3(e[t]),h=THING.Utils.parseVector3(e[t+1]);l=a.subVectors(u,s).normalize().clone(),c=a.subVectors(h,u).normalize().clone(),d=a.addVectors(l,c).normalize().clone(),p=a.crossVectors(o,d).normalize().setLength(n).clone(),a.copy(p),f=a.negate().clone(),g=a.addVectors(u,p).toArray(),i[t]=g,m=a.addVectors(u,f).toArray(),r[t]=m}return[i,r]},s.createPolygonRegionWater=function(e){const t=THING.App.current,o=e.parent,n=o.host||o,{userConfig:i}=e,{tag:r}=e,{effectName:l}=e;let c={id:`${r}_${l}_${o.id}`,complete(){},style:{}};const u=THING.App.current.create({type:"BaseObject",parent:o});i&&(c=a.Z.combine(c,i,!0));const h=s.getPointsData(n),p=t.create({type:"Water",parent:this.getCampus(n),points:h,style:{skipBoundingBox:!c.style.skipBoundingBox||c.style.skipBoundingBox,waterColor:c.color,waterScale:c.waterScale,flowXDirection:c.speed[0],flowYDirection:c.speed[1]}});return p.localPosition=[p.localPosition[0],p.localPosition[1]+.1,p.localPosition[2]],c.offsetHeight&&(p.localPosition=[p.localPosition[0],p.localPosition[1]+c.offsetHeight,p.localPosition[2]]),u.add(p),u},s.createPolygonGeoWater=function(e){const t=e.parent,o=t.host||t,{userConfig:n}=e,{tag:i}=e,{effectName:r}=e,{serverFilePath:s}=e;let l={id:`${i}_${r}_${t.id}`,height:0,serverFilePath:s,style:{},complete(){}};const c=THING.App.current;n&&(l=a.Z.combine(l,n,!0)),h(l);const u=THING.App.current.create({type:"BaseObject",id:l.id,parent:t,host:o,style:{skipBoundingBox:!0}});let p,d;return l.hasOwnProperty("getMethod")?void 0!==f(o,l)&&(p=JSON.parse(f(o,l))):p=o.getAttribute("geojson"),d=function(e,t){return c.create({type:"GeoWater",name:"waterSurface",offsetHeight:t.offsetHeight,coordinates:e,renderer:{reflectionNormal:t.reflectionNormalUrl,refractionNormal:t.refractionNormalUrl,reflectionImage:t.reflectionImageUrl,refractionImage:t.refractionImageUrl,color:t.color,waveLength:t.waveLength,flowSpeed:[t.speed[0],t.speed[1]]},userData:{}})}(function(){let e=[];const{features:t}=p;if(t)if(t.length>1)for(let o=0;o<t.length;o++)t[o].geometry.coordinates[0]instanceof Array?t[o].geometry.coordinates.forEach((t=>{e.push(t)})):e.push(t[o].geometry.coordinates);else e=t[0].geometry.coordinates;else p.hasOwnProperty("geometry")&&(e=p.geometry.coordinates[0][0]);return e}(),l),d.style.skipBoundingBox=!0,u.add(d),u};const m=s},257:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(331),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__),_util__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(891);let libDataPanel={createLibDataPanel:function(){let datapanel={rsmPath:"",propertyValue:{}};const _images_DefaultParams={guideSize:[24,20],guideOffset:[0,10],guideLayout:["Center","Bottom"],leftTopSize:[10,10],leftBottomSize:[10,10],rightTopSize:[10,10],rightBottomSize:[10,10]},_text_DefaultParams={left:0,right:0,lineSpacing:10,order:0,horizontalLayout:"left",valign:"middle",align:"left",getMethod:"objectProperty",propertyPath:"name",fontFamily:"Arial",fontSize:24,fontColor:"#ffffff",fontStyle:"normal",shadow:!1,shadowBlur:0,shadowColor:null,shadowOffset:[0,0],outline:!1,outlineThickness:0,outlineColor:null,stateText:!1,fontColorConfig:[{value:"æ­£å¸¸",color:"#208858"},{value:"å¼å¸¸",color:"#ff0000"}]},_block_DefaultParams={size:[100,20],align:"center",rowIndex:0,left:0,right:0},_stateBar_DefaultParams={size:[100,40],left:0,right:0,horizontalLayout:"left",valign:"middle",align:"left",roundRectRadius:5,fontFamily:"Arial",fontSize:24,fontColor:"#ffffff",textSpacing:20,textLineSpacing:10,getMethod:"objectProperty",propertyPath:"name",fillColorConfig:[{value:"æ­£å¸¸",color:"#208858"},{value:"å¼å¸¸",color:"#ff0000"}]},_progressBar_DefaultParams={size:[150,15],left:0,right:0,horizontalLayout:"center",valign:"middle",align:"center",roundRectRadius:7.5,lineSpacing:16,backgroundColor:"#ffffff32",fillColor:{min:30,max:40,steps:[{condition:"<",value:35.5,color:"rgb(255, 255, 0)"},{condition:"<",value:37.5,color:"rgb(0, 255, 0)"},{condition:"<",value:39,color:"rgb(255, 0, 0)"}]}},HorizontalLayout={LEFT:"left",RIGHT:"right",CENTER:"center"},ALIGN={LEFT:"left",RIGHT:"right",CENTER:"center"},VALIGN={TOP:"top",BOTTOM:"bottom",MIDDLE:"middle"},DataType={IMAGE:"image",TEXT:"text",PROGRESS_Bar:"progressBar",STATE_BAR:"stateBar",STATE_TEXT:"stateText",BLOCK:"block"};function _drawCanvas(e,t,o,n){let i=_calImgPos(t,o);!function r(a){if(a<i.length){let t;datapanel.imagesObjectList[a]?(t=datapanel.imagesObjectList[a],e.globalCompositeOperation="source-over",e.drawImage(t,i[a].x,i[a].y,i[a].size[0],i[a].size[1]),r(a+1)):(t=new Image,t.crossOrigin="Anonymous",t.src=i[a].url,t.onerror=()=>{console.log("å¾çå è½½å¤±è´¥"),r(a+1)},t.onload=function(){datapanel.imagesObjectList[a]=t,e.globalCompositeOperation="source-over",e.drawImage(t,i[a].x,i[a].y,i[a].size[0],i[a].size[1]),r(a+1)})}else e.globalCompositeOperation="source-over",_fillContents(e,t,o),"function"==typeof n&&n()}(0)}function _fillContents(e,t,o){let n=o.userConfig.contents,i=o.userConfig.contentsProperties,r=o.userConfig.images?{..._images_DefaultParams,...o.userConfig.images}:_images_DefaultParams;var a=function(e){for(let o in e){let n=e[o];if(0!==n.length){let e="rightText"===!o;n.sort(t("order",e))}else delete e[o];e[o]=n}function t(e,t){return t=void 0===t||t?1:-1,function(o,n){return o[e]<n[e]?-1*t:1*t}}return e},s=function(e,t){return e[t].type===DataType.TEXT?e[t]:(t+=1)<e.length-1?s(e,t):null};for(let l in n){let c=n[l],u={left:o.userConfig.paddingLeft,right:o.userConfig.paddingRight,center:0},h=0,p=0,f=0;s(c,0)&&(p=c.positionY+c.lineHeight/2+o.userConfig.paddingTop),f=c.positionY+o.userConfig.paddingTop;let d=a(c.sortDatas);for(let n in d){let a=d[n];for(let s=0;s<a.length;s++){let l=a[s];if(l._y_text=p,h=l.type===DataType.TEXT?p+l.lineSpacing/2:f+(c.lineHeight-l.oriSize[1])/2+l.lineSpacing/2,"Top"===r.guideLayout[1]&&(h+=r.guideOffset[1]+r.guideSize[1]),"left"===n)u[n]+=l.left,"Left"===r.guideLayout[0]&&(u[n]+=r.guideOffset[0]+r.guideSize[0]),CanvasExtend.fillContent(l.type,e,u[n],h,l,o);else if("right"===n){u[n]+=l.right;let i=t.width-u[n];"Right"===r.guideLayout[0]&&(i-=r.guideOffset[0]+r.guideSize[0]),CanvasExtend.fillContent(l.type,e,i,h,l,o)}else if("center"===n){let r=l.align===ALIGN.CENTER?l.left:l[l.align];u[n]+=r;let a=0;"left"===l.align?(a=i.leftWidth+o.userConfig.paddingLeft,CanvasExtend.fillContent(l.type,e,u[n]+a,h,l,o)):"center"===l.align?(a=i.leftWidth+o.userConfig.paddingLeft+l.oriSize[0]/2,CanvasExtend.fillContent(l.type,e,u[n]+a,h,l,o)):"right"===l.align&&(a=i.rightWidth+o.userConfig.paddingRight,CanvasExtend.fillContent(l.type,e,t.width-(u[n]+a),h,l,o))}u[n]+=l.oriSize[0]}}}}function _calImgPos(e,t){let o=t.userConfig.images?{..._images_DefaultParams,...t.userConfig.images}:_images_DefaultParams,n=t.serverFilePath,i=[{size:o.guideSize},{size:o.leftTopSize},{size:[10,o.leftTopSize[1]]},{size:o.rightTopSize},{size:[o.leftTopSize[0],10]},{size:[10,10]},{size:[o.rightTopSize[0],10]},{size:o.leftBottomSize},{size:[10,o.rightBottomSize[1]]},{size:o.leftBottomSize}];for(let t=0;t<10;t++){let r={};r.url=_util__WEBPACK_IMPORTED_MODULE_1__.Z.getResourceUrl(n+`images/${t}.png`);let a=0,s=0,l=i[t].size,c=o.guideLayout[0],u=o.guideLayout[1];if(0===t)"Center"===c?a=(e.width-l[0])/2:"Right"===c&&(a=e.width-l[0]),"Center"===u?s=(e.height-l[1])/2:"Bottom"===u&&(s=e.height-l[1]);else{let n=o.guideOffset[0]+o.guideSize[0],i=o.guideOffset[1]+o.guideSize[1],r=t%3;switch(r){case 0:a=e.width-o.rightTopSize[0],"Right"===c&&(a-=n);break;case 1:a=0;break;case 2:a=o.leftTopSize[0],l[0]=e.width-o.leftTopSize[0]-o.rightTopSize[0]}let h=Math.floor((t-1)/3);switch(h){case 0:s=0;break;case 1:s=o.leftTopSize[1],l[1]=e.height-o.guideSize[1]-o.leftTopSize[1]-o.leftBottomSize[1]-o.guideOffset[1];break;case 2:s=e.height-o.leftBottomSize[1],"Bottom"===u&&(s-=i)}"Left"===c&&0!==r&&(a+=n),"Top"===u&&2!==h&&(s+=i)}r.x=a,r.y=s,r.size=l,i[t]=r}return i}function _calCanvasSize(dpParam,ctx,canvas,_defaultStateFillColor="#208858",images){canvas.width=0,canvas.height=0;let contents=dpParam.userConfig.contents;var resTextData=function(e){let t=_getValue(dpParam.parent.host,e),o=e.decimalDigits,n="";if(t&&(n=isNaN(Number(t))?t:Number(t).toFixed(o)),e.innerText=n,e.stateText)for(let t=0;t<e.fontColorConfig.length;t++)e.fontColorConfig[t].value===n&&(e.fontColor=e.fontColorConfig[t].color);let i=CanvasExtend.getTextSize(ctx,e);e.oriSize=i;let r=e.horizontalLayout===HorizontalLayout.CENTER?e.right+e.left:e[e.align],a=e.type===DataType.TEXT?i[0]+r:i[0]+e.textSpacing,s=i[1]+(e.lineSpacing||e.textLineSpacing||0);return{...e,size:[a,s]}},resData=function(data){data.align=data.align||data.horizontalLayout;let _def_=THING.Utils.cloneObject(eval(`_${data.type}_DefaultParams`),!0);data=THING.Utils.mergeObject(_def_,data,!0);let oriSize=data.oriSize;if(oriSize&&oriSize.length>0&&(data.size=data.oriSize),data.type===DataType.TEXT)return resTextData(data);if(data.type===DataType.STATE_BAR){let e=resTextData(data),t,o=data.size;if(e.innerText){let n;for(let t=0;t<data.fillColorConfig.length;t++){const o=data.fillColorConfig[t];o.value===e.innerText&&(n=o.color)}t=n||_defaultStateFillColor;let i=data.horizontalLayout===HorizontalLayout.CENTER?data.right+data.left:data[data.align];o=[e.size[0]+i,e.size[1]]}else t=_defaultStateFillColor,o=data.size;return data={...e,fillColor:t,size:o,oriSize:e.size},data}if(data.type===DataType.PROGRESS_Bar){let e=_getValue(dpParam.parent.host,data);data.innerText=e;let t=data.horizontalLayout===HorizontalLayout.CENTER?data.right+data.left:data[data.align],o=data.size[0]+t,n=data.size[1]+data.lineSpacing;return{...data,size:[o,n],oriSize:data.size}}{let e=data.align===ALIGN.CENTER?data.right+data.left:data[data.align],t=data.size[0]+e,o=data.size[1];return{...data,size:[t,o],oriSize:data.size}}};let cProp={titleWidth:0,leftWidth:0,centerWidth:0,rightWidth:0,width:0,height:0,rowLength:0},_titleWidth=0;for(let e in contents){let t=contents[e],o={left:[],center:[],right:[]},n=[0,0],i=[0,0],r=[0,0];for(let a=0;a<t.length;a++){let s=resData(t[a]),l=s.horizontalLayout;l===HorizontalLayout.LEFT?("title"!==s.rowType?n[0]+=s.size[0]:(contents[e].isTitleRow=!0,_titleWidth+=s.size[0]),o.left.push(s),n[1]=_getMaxNumber(n[1],s.size[1])):l===HorizontalLayout.CENTER?("title"!==s.rowType?i[0]+=s.size[0]:_titleWidth+=s.size[0],o.center.push(s),i[1]=_getMaxNumber(s.size[1],i[1])):l==HorizontalLayout.RIGHT&&("title"!==s.rowType?r[0]+=s.size[0]:_titleWidth+=s.size[0],o.right.push(s),r[1]=_getMaxNumber(s.size[1],r[1])),t[a]=s}t.sortDatas=o;let a=_getMaxNumber(n[1],i[1],r[1]);t.lineHeight=a,t.positionY=cProp.height,cProp.height+=a,cProp.leftWidth=_getMaxNumber(cProp.leftWidth,n[0]),cProp.centerWidth=_getMaxNumber(cProp.centerWidth,i[0]),cProp.rightWidth=_getMaxNumber(cProp.rightWidth,r[0]),contents[e]=t,1===t.length&&t[0].type===DataType.PROGRESS_Bar&&(t[0].autoSize=!0)}let cWidth=cProp.leftWidth+cProp.centerWidth+cProp.rightWidth;cProp.width=_getMaxNumber(cWidth,_titleWidth),cProp.width+=dpParam.userConfig.paddingRight+dpParam.userConfig.paddingLeft,cProp.height+=dpParam.userConfig.paddingTop+dpParam.userConfig.paddingBottom,cProp.rowLength=Object.keys(contents).length;let imgWidth=images.leftTopSize[0]+images.rightTopSize[0],imgHeight=images.leftTopSize[1]+images.leftBottomSize[1];canvas.width=cProp.width<imgWidth?imgWidth:cProp.width,canvas.height=cProp.height<imgHeight?imgHeight:cProp.height,canvas.width+=images.guideOffset[0]+images.guideSize[0],canvas.height+=images.guideOffset[1]+images.guideSize[1],dpParam.userConfig.contentsProperties={...cProp,canvasWidth:canvas.width,canvasHeight:canvas.height}}function _getMaxNumber(e,t,o=0){let n=e-t>=0?e:t;return o&&_getMaxNumber(n,o),n}function _getValue(e,t){if("objectProperty"===t.getMethod){const o=t.propertyPath;let n="";return o&&(n=e.getAttribute(o),void 0!==t.toFixed&&Number(n)&&(n=setFixed(Number(n),t.toFixed))),datapanel.propertyValue[o]=n,n}return"presetValue"===t.getMethod?t.presetValue:"func"===t.getMethod?t.getFunc.call(null,e):e.name}function setFixed(e,t){return e=parseFloat(e),(Math.round(((e+Number.EPSILON)*Math.pow(10,t)).toFixed(t))/Math.pow(10,t)).toFixed(t)}function _setLayoutPosition(e){e.on("complete",(t=>{if(e.destroyed)return;const{host:o}=e,{parent:n}=e;if(!o)return;const{tempPivotLayout:i}=e.userData,{tempLayoutLocalPos:r}=e.userData,{tempLayoutOffset:a}=e.userData,{tempPivot:s}=e.userData;if(i&&r){const t=n.selfToWorld(r);if(e instanceof THING.Marker){if(s)e.pivot=s,delete e.userData.tempPivot;else{const t={Left:0,left:0,Center:.5,center:.5,Right:1,right:1,Top:0,top:0,Bottom:1,bottom:1},o=i[0].toLowerCase(),n=i[1].toLowerCase();e.pivot=[t[o],t[n]]}e.position=t}else{const o=e.getLayoutPosition(i,t,!0);e.position=o}}if(a){a[0]-=0,a[1]-=0,a[2]-=0;const t=THING.Math.addVector(e.position,a);e.position=t,delete e.userData.tempLayoutOffset}e instanceof THING.Marker&&(e.node.visible=!0)}),"åå»ºå®æåæ ¹æ®å¸å±è®¾ç½®ä½ç½®",52)}function _parseBoolean(e,t){return void 0===e?t:e}datapanel.createDataPanel=function(e){let t=document.createElement("canvas"),o=t.getContext("2d");datapanel.canvas=t,datapanel.ctx=o;let n=e.userConfig.images?{..._images_DefaultParams,...e.userConfig.images}:_images_DefaultParams;datapanel.images=n,datapanel.imagesObjectList=[],datapanel._defaultStateFillColor="#208858";let i={type:"Marker",height:e.userConfig.height||1e-6,width:e.userConfig.width||0,keepSize:_parseBoolean(e.userConfig.keepSize,!0),useSpriteMaterial:_parseBoolean(e.userConfig.useSpriteMaterial,!0),lockYAxis:_parseBoolean(e.userConfig.lockYAxis,!1),skipBoundingBox:_parseBoolean(e.userConfig.skipBoundingBox,!1),scale:[1,1,1]},r={};r.parent=e.parent,r.id=`${e.tag}_${e.effectName}_${e.parent.id}`;let a=e.userConfig.scale||[1,1,1];r.scale=a,r.inheritStyle=_parseBoolean(e.userConfig.inheritStyle,!0),r.alwaysOnTop=_parseBoolean(e.userConfig.alwaysOnTop,!1),r.onlySelf=_parseBoolean(e.userConfig.onlySelf,!0),r.skipBoundingBox=_parseBoolean(e.userConfig.skipBoundingBox,!0);let s=e.userConfig.userData||{},l=e.userConfig.layout||[THING.LayoutType.Center,THING.LayoutType.Top,THING.LayoutType.Center],c=e.userConfig.pivotLayout||[THING.LayoutType.Center,THING.LayoutType.Bottom,THING.LayoutType.Center],u=e.userConfig.layoutOffset||[0,0,0],h=e.userConfig.pivot||[.5,1];const p=_util__WEBPACK_IMPORTED_MODULE_1__.Z.getLayoutPosition(e.parent.host,l,null,!0,!1,e.userConfig.onlySelf);s.tempLayoutPos=p,s.tempLayoutLocalPos=e.parent.worldToSelf(p),s.tempPivotLayout=c,s.tempLayoutOffset=u,s.tempPivot=h,s.SKIP_THEME=1,r.pivot=h,r.userData=s,i={...i,...r};let f=e;datapanel.dpParam=e,datapanel.dpParam=f,datapanel.canvas=t,datapanel.ctx=o;let d=THING.App.current.create(i);return datapanel.accObject=d,d.datapanel=datapanel,d.dType="DataPanel",datapanel.refreshCanvas(),datapanel.setupAfterCreate(e,d),d.on("complete",(function(){e.complete&&e.complete({object:d,srcPath:filePath})})),d.width=.001,i.lockYAxis&&d.lookAt(THING.App.current.camera,{lockYAxis:!0}),d},datapanel.refreshCanvas=function(){let e=datapanel.ctx,t=datapanel.canvas,o=datapanel.accObject,n=datapanel.dpParam;e.clearRect(0,0,t.width,t.height),_calCanvasSize(n,e,t,datapanel._defaultStateFillColor,datapanel.images),o.scale=n.userConfig.scale||[1,1,1],_drawCanvas(e,t,n,(function(){const e=o.style.opacity;o.style.opacity=1,o.canvas=t,o.style.opacity=e;let i=function(e){let t=e[0],o=e[1],n=e[2];return t||o||n||1};o.scale=[i(o.scale),i(o.scale),i(o.scale)],o.height<1e-5?(o.width=t.width/100,o.height=t.height/100):o.width=t.width/t.height*o.height,o.inheritScale=_parseBoolean(n.userConfig.inheritScale,!0)})),o.node.renderOrder=2e6},datapanel.setupAfterCreate=function(e,t){_setLayoutPosition(t);let o=e.userConfig.rotation;o&&(t.rotateX(o[0]-0),t.rotateY(o[1]-0),t.rotateZ(o[2]-0)),t.pickable=_parseBoolean(e.userConfig.pickable,!0),t.host=e.parent.host||e.parent};var CanvasExtend={_fillRoundRect(e,t,o,n,i,r,a,s,l){if(0!=n){if(l.align&&(l.align===ALIGN.RIGHT?t-=n:l.align===ALIGN.CENTER&&(t-=n/2,t+=l.left)),(2*r>n||2*r>i)&&(r=i/2),e.save(),e.translate(t,o),function(e,t,o,n){e.beginPath(0),e.arc(t-n,o-n,n,0,Math.PI/2),e.lineTo(n,o),e.arc(n,o-n,n,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,o-n),e.closePath()}(e,n,i,r),s){var c=e.createLinearGradient(0,0,n,0);let t=l.progressColor.stopColors;for(let e=0;e<t.length;e++){let o=t[e],n=o.color||a;n=n.substring(0,7);let i=Math.floor(255*o.opacity).toString(16);c.addColorStop(o.stop,n+i)}e.fillStyle=c}else e.fillStyle=a||"#16181acc";e.fill(),e.restore()}},_fillText(e,t,o,n){e.textBaseline=n.valign,n.type===DataType.STATE_BAR&&(n.align===ALIGN.RIGHT?t-=n.textSpacing/2:n.align===ALIGN.LEFT&&(t+=n.textSpacing/2),o=n._y_text+this.getTextMiddleLine(e,n.innerText));let i=`${n.fontSize}px ${n.fontFamily}`;e.font=i,e.fillStyle=n.fontColor,e.textAlign=n.align,e.shadowBlur=n.shadowBlur||0,e.shadowColor=n.shadowColor||"#000000",e.fillText(n.innerText,t,o)},fillContent(e,t,o,n,i,r){if(r=r.userConfig?r.userConfig:r,e===DataType.TEXT)this._fillText(t,o,n,i);else if(e===DataType.STATE_BAR)this._fillRoundRect(t,o,n,i.oriSize[0],i.oriSize[1],i.roundRectRadius,i.fillColor,!1,i),this._fillText(t,o,n,i);else if(e===DataType.PROGRESS_Bar){let e=i.oriSize[0];i.autoSize&&(e=r.contentsProperties.canvasWidth-r.paddingLeft-r.paddingRight),this._fillRoundRect(t,o,n,e,i.oriSize[1],i.roundRectRadius,i.backgroundColor,!1,i);let a=Number(i.innerText),s=Number(i.fillColor.max),l=Number(i.fillColor.min);a>s&&(a=s),a<l&&(a=l);let c,u=(a-i.fillColor.min)/(i.fillColor.max-i.fillColor.min)*e,h=i.fillColor.steps;for(let e=0;e<h.length;e++){let t=h[e].color,o=h[e].condition,n=h[e].value;if("<"===o){if(a<n){c=t;break}}else if("<="===o){if(a<=n){c=t;break}}else if((!o||"="===o)&&a===n){c=t;break}}this._fillRoundRect(t,o,n,u,1.1*i.oriSize[1],i.roundRectRadius,c,!1,i)}},getTextSize(e,t){let o=`${t.fontSize}px ${t.fontFamily}`;e.font=o;let n=e.measureText(t.innerText);return[n.width,n.fontBoundingBoxAscent+n.fontBoundingBoxDescent]},getTextMiddleLine:(e,t)=>(e.font="10px Arail",e.measureText(t).actualBoundingBoxAscent)};return datapanel}};const __WEBPACK_DEFAULT_EXPORT__=libDataPanel}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(o.exports,o,o.exports,__webpack_require__),o.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>i});var e=__webpack_require__(987),t=__webpack_require__(381);class o{constructor(){this._app=THING.App.current}async onLoad(e,o,n,i){this.attachment||(this.attachment=new t.Z);let r=await this.attachment.create(o.object,e._url);e.root=r,e.attachment=this.attachment,n()}}window.AttachmentLoader=o;const n=o;e.Z.VERSION="1.5.54.8",e.Z.COMPILETIME="Sat Feb 18 2023 17:03:33 GMT+0800 (ä¸­å½æ åæ¶é´)",console.info("ObjectDecorator: v"+e.Z.VERSION);const i=e.Z;THING.Utils.waitAppComplete&&THING.Utils.waitAppComplete().then((e=>{e.registerBundleLoader("attachment",new n)})),window.loadedWasm=!1})(),__webpack_exports__=__webpack_exports__.default,__webpack_exports__})()));