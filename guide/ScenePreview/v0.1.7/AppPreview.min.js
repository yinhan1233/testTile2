var preUtil=null,preScenesEffectClass=null,sceneExpandFloorClass=null,infoTipsClass=null,viewAniClass=null,contextMenuClass=null,divisionFloorClass=null,moveByFpsClass=null,peopleSettingClass=null,sceneBuildTopCardClass=null,floorsTopCardClass=null;class AppPreview{constructor(e){if(null!=e&&null!=e.app){var t=this;null==e.configUrl?THING.Utils.dynamicLoad("/guide/ScenePreview/v0.1.7/PreConfig.js",(function(){t.init(e)})):THING.Utils.dynamicLoad(e.configUrl,(function(){"undefined"!=typeof PreConfig&&t.init(e)}))}}init(e){if(this.version="v0.1.7",this.app=e.app,this.loadType="scene","city"==e.type){if(this.loadType="city",null==e.map)return;this.map=e.map}this.visitType="pc",/Android|webOS|imobile|iPod|BlackBerry/i.test(navigator.userAgent)&&(this.visitType="mobile"),this.filePath=PreConfig.getFilePath(),this.fileArr=[this.filePath+"css/indexv1.0.css",this.filePath+"icon/font-awesome-4.7.0/css/font-awesome.min.css",this.filePath+"css/sweetalert2.min.css",this.filePath+"css/myAlert.css",this.filePath+"css/progressBar.css",this.filePath+"js/sweetalert2.all.min.js",this.filePath+"js/myAlert.js",this.filePath+"icon/iconfont/iconfont.css",this.filePath+"icon/seticonfont/iconfont.css",this.filePath+"js/share.js",this.filePath+"js/jquery.qrcode.min.js",this.filePath+"js/mshare.js",this.filePath+"lib/cookie/jquery.cookie.js",this.filePath+"lib/jquery-ui.min/jquery-ui.min.css",this.filePath+"lib/jquery-ui.min/jquery-ui.min.js",this.filePath+"lib/colpick/colpick.css",this.filePath+"lib/colpick/colpick.js",this.filePath+"lib/layui/css/layui.css",this.filePath+"lib/layui/layui.js",this.filePath+"css/preSceneEffect.css",this.filePath+"js/preSceneEffect.js",this.filePath+"js/viewAni.js",this.filePath+"js/moveByFps.js",this.filePath+"js/preApplyConfig.js"],"scene"==this.loadType&&(this.fileArr.push(this.filePath+"js/posTransform.js"),this.fileArr.push(this.filePath+"js/expandFloor.js"),this.fileArr.push(this.filePath+"js/preUtil.js"),this.fileArr.push(this.filePath+"lib/html2canvas/html2canvas.min.js"),this.fileArr.push(this.filePath+"js/sceneTopCard.js"),this.fileArr.push(this.filePath+"js/info_tips.js"),this.fileArr.push(this.filePath+"css/info_tips.css"),this.fileArr.push(this.filePath+"js/contextMenu.js"),this.fileArr.push(this.filePath+"css/contextMenu.css"),this.fileArr.push(this.filePath+"js/divisionFloor.js"),this.fileArr.push(this.filePath+"css/divisionFloor.css"),this.fileArr.push(this.filePath+"css/preLevelControl.css"),this.fileArr.push(this.filePath+"js/preLevelControl.js"),this.fileArr.push(this.filePath+"css/sceneBuildTopCard.css"),this.fileArr.push(this.filePath+"js/sceneBuildTopCard.js"),this.fileArr.push(this.filePath+"css/sceneCamera.css"),this.fileArr.push(this.filePath+"js/sceneCamera.js"),this.lonlat=[116.4641,39.98606]),"city"==this.loadType&&(this.fileArr.push(this.filePath+"css/map/MapInfo.css"),this.fileArr.push(this.filePath+"js/map/MapInfo.js"),this.fileArr.push(this.filePath+"css/map/poi.css"),this.fileArr.push(this.filePath+"js/map/poi.js"),this.fileArr.push(this.filePath+"js/map/turf.min.js"),this.fileArr.push(this.filePath+"css/map/tool.css"),this.fileArr.push(this.filePath+"js/map/tool.js"),this.fileArr.push(this.filePath+"js/map/preApplyMapTemplate.js"),this.fileArr.push(this.filePath+"css/drawLine.css"),this.fileArr.push(this.filePath+"js/drawLine.js")),this.mapConfig={"高德":{"影像":"https://webst0{1,2,3,4}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}","行政":"https://webst0{1,2,3,4}.is.autonavi.com/appmaptile?style=7&x={x}&y={y}&z={z}"},OSM:{"行政":"https://{a,b,c}.tile.openstreetmap.org/{z}/{x}/{y}.png"}},this.skyBoxConfig={"暗黑":"Dark","夜晚":"Night","银河":"MilkyWay","蓝天":"BlueSky"},this.shareImg=null,this.currentSkyBox="Dark",this.backGround=null,this.cameraInitPos=null,this.viewAniDataJson=[],this.createHtmlFun=null,this.rotateState=!1,this.presetLightConfig=null,this.mapBgCtrl=null,this.rotateAroundTime=null,this.switchCamera="2d",this.initEnableZoom=!0,this.rotateTimer=null,this.rotateControl=!0,this.restartTime=5e3,this.building=null,this.miniMapCtrl=null,this.themeData=null,this.tileLayer1=null,this.titleLayerUrl=null,this.attributionInit=null,this.cameraDistace=[],this.fullScreenState=!1,this.showControlTimer=null,this.hiddenControlTimer=null,this.cameraInfo={},this.baseLayersStyle=[],this.preLevelControlClass=null,this.sceneCameraClass=null,this.preApplyConfigClass=null;var t=this;$.getJSON(t.filePath+"json/template.json",(function(e){t.themeData=e})),THING.Utils.dynamicLoad(t.fileArr,(function(){"scene"==t.loadType?t.loadScene():"city"==t.loadType&&t.loadCity()}),!0,!0)}loadScene(){var e=this;e.app.on("load",(function(t){e.currentSkyBox=e.app.skyBox,t.campus.azimuth="180",e.app.camera.keyPanSpeed=0;let a=e.app.root.defaultCampus.extraData;null!=a?(a=a.coordinates,null!=a&&(a=a.split(","),e.lonlat=[parseFloat(a[0]),parseFloat(a[1])])):t.campus.extraData={coordinates:"116.4641,39.98606"},e.app.level.change(t.campus),e.cameraInitPos=[e.app.camera.position,e.app.camera.target];let i=setTimeout((function(){clearTimeout(i),e.applyConfig()}),20);e.initClass(),e.viewAniDataJson=viewAniClass.viewDataInit(e.loadType),e.initHtml(e.viewAniDataJson),e.rotateState=!0,e.viewAniState()}))}loadCity(){var e=this;e.createHtmlFun=function(){e.initHtml()},e.attributionInit=$("#dataAttribution").html();let t=setTimeout((function(){clearTimeout(t),e.applyConfig()}),200);e.initClass(),e.initMapClass(),e.viewAniDataJson=viewAniClass.viewDataInit(e.loadType);var a=e.map.mapConfig;if(a){e.cameraInfo.heading=a.cameraFlyTo.heading,e.cameraInfo.lonlat=a.cameraFlyTo.lonlat,e.cameraInfo.height=a.cameraFlyTo.height,e.cameraInfo.pitch=a.cameraFlyTo.pitch,e.cameraInfo.directFly=a.cameraFlyTo.directFly,e.cameraInfo.time=1500;var i=a.cameraFlyTo.time;if(i){var s=a.cameraFlyTo.angle;i+=s?s/60*1e3:(s=0==s?360:s)/60*1e3,e.rotateState=!0}if(e.baseLayersStyle.length<=0)for(let t=0,a=e.map.allLayers.length;t<a;t+=1){let a={id:e.map.allLayers[t].id,style:e.map.allLayers[t].style,renderer:e.map.allLayers[t].renderer};e.baseLayersStyle.push(a)}}}applyConfig(){this.preApplyConfigClass=new PreApplyConfig}initClass(){var e=this;"undefined"!=typeof PreUtil&&null==preUtil&&(preUtil=new PreUtil),"undefined"!=typeof PreSceneEffect&&null==preScenesEffectClass&&(preScenesEffectClass=new PreSceneEffect({config:e.presetLightConfig,type:e.loadType,map:e.map})),"undefined"!=typeof SceneTopCard&&new SceneTopCard,"undefined"!=typeof SceneExpandFloor&&null==sceneExpandFloorClass&&(sceneExpandFloorClass=new SceneExpandFloor),"undefined"!=typeof InfoTips&&null==infoTipsClass&&(infoTipsClass=new InfoTips),"undefined"!=typeof ViewAni&&null==viewAniClass&&(viewAniClass=new ViewAni(e.createHtmlFun)),"undefined"!=typeof ContextMenu&&null==contextMenuClass&&(contextMenuClass=new ContextMenu),"undefined"!=typeof DivisionFloor&&null==divisionFloorClass&&(divisionFloorClass=new DivisionFloor),"undefined"!=typeof MoveByFps&&null==moveByFpsClass&&(moveByFpsClass=new MoveByFps),"undefined"!=typeof PreLevelControl&&null==e.preLevelControlClass&&(e.preLevelControlClass=new PreLevelControl),"undefined"!=typeof SceneBuildTopCard&&null==sceneBuildTopCardClass&&(sceneBuildTopCardClass=new SceneBuildTopCard)}initMapClass(){var e=this;"undefined"!=typeof MapInfo&&null==e.MapInfoClass&&(e.MapInfoClass=new MapInfo({scene:e.app})),"undefined"!=typeof Poi&&null==e.poiClass&&(e.poiClass=new Poi),"undefined"!=typeof Tool&&null==e.toolClass&&(e.toolClass=new Tool({app:e.app,map:e.map})),"undefined"!=typeof PreApplyMapTemplate&&null!=PreConfig.getPreData("mapTemplate")&&(new PreApplyMapTemplate).rendererAllLayer(PreConfig.getPreData("mapTemplate").configData)}initHtml(){var e=this;let t='<div id="all-controls" style="z-index:999;';if("city"==e.loadType&&(t+="bottom:10px;"),t+='"><div class="controls">',"scene"==e.loadType&&(t+='<a id="horizontalExpansion" class="control-item">\n                    <i class="btn-horizontal"></i>\n                    <span class="tooltiptext">横向展开</span>\n                </a>\n                <a id="verticalExpansion" class="control-item">\n                    <i class="btn-vertical"></i>\n                    <span class="tooltiptext">纵向展开</span>\n                </a>'),t+='<a id="share" class="control-item">\n                    <i class="icon-share iconfont iconfont-bold icon-white"></i>\n                    <span class="tooltiptext">分享</span>\n                </a>\n                <a id="autoRotate" class="control-item">\n                    <i class="icon-autoRotate iconfont iconfont-bold icon-white"></i>\n                    <span class="tooltiptext">自动旋转</span>\n                </a>',"scene"==e.loadType&&(t+='<a id="moveByFps" class="control-item">\n                    <i class="icon-walk iconfont icon-white"></i>\n                    <span class="tooltiptext">第一人称</span>\n                    <div class="control-menu select-menu">\n                        <div class="control-menu-wrapper" style="position: relative">\n                            <div class="control-menu-pane">\n                                <ul class="setting-list">\n                                    <li class="fp-moving setting-item selected">行走</li>\n                                    <li class="fp-flying setting-item">飞行</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </a>'),t+='<a id="mapBg" class="control-item">\n                <i class="icon-earth iconfont icon-white"></i>\n                <span class="tooltiptext">地图背景</span>\n                <div class="control-menu select-menu">\n                    <div class="control-menu-wrapper" style="position: relative">\n                        <div class="control-menu-pane">\n                            <ul class="setting-list">\n                                <li class="setting-item mapbg selected">关闭地图</li>\n                                <li class="setting-item mapbg setting-item-split">高德 影像</li>\n                                <li class="setting-item mapbg">高德 行政</li>\n                                <li class="setting-item mapbg">OSM 行政</li>',"scene"==e.loadType&&(t+='<li class="setting-item miniMap setting-item-split">小地图</li>\n                    <li class="setting-item setting-item-split sky Dark selected">暗黑</li>\n                    <li class="setting-item sky BlueSky">蓝天</li>\n                    <li class="setting-item sky Night">夜晚</li>\n                    <li class="setting-item sky MilkyWay">银河</li>'),t+="</ul>\n                        </div>\n                    </div>\n                </div>\n            </a>","scene"==e.loadType){if(t+='<a id="viewAni" class="control-item">\n                <i class="icon-viewAni iconfont iconfont-bold icon-white"></i>\n                <span class="tooltiptext">视点动画</span>\n                <div class="control-menu select-menu">\n                    <div class="control-menu-wrapper" style="position: relative">\n                        <div class="control-menu-pane">\n                            <div class="setting-list-title">动画列表</div>\n                            <ul class="setting-list">',0==$.isEmptyObject(e.viewAniDataJson)){var a=1;for(let i in e.viewAniDataJson){if(a>8)break;t+='<li class="setting-item view-animate" data-name="'+i+'">'+i+"</li>",a++}}else t+='<li class="setting-item no-data">暂无可播放动画</li>';t+='\n                    <li class="play-setting setting-item">显示进度条</li>\n            </ul>\n                </div>\n                    </div>\n                </div>\n                \n            </a>'}if(t+='<a id="sceneSetting" class="control-item">\n                    <i class="icon-setting iconfont icon-white"></i>\n                    <span class="tooltiptext">设置</span>\n                    <div class="control-menu select-menu">\n                        <div class="control-menu-wrapper" style="position: relative">\n                            <div class="control-menu-pane">\n                                <ul class="setting-list">\n                                    <li class="view-change setting-item">2D视角</li>\n                                    <li class="light-change setting-item setting-item-split">调节灯光</li>',"city"==e.loadType&&(t+='<li class="poi-change setting-item">行政区划</li>'),"scene"==e.loadType&&(t+=' <li class="template template-light setting-item setting-item-split">浅色模板</li>\n                                    <li class="template template-dark setting-item">深色模板</li>'),t+='\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </a>\n                <a id="fullScreen" class="control-item">\n                    <i class="icon-fullScreen iconfont icon-white"></i>\n                    <i class="icon-narrow iconfont icon-white" style="display:none"></i>\n                    <span class="tooltiptext">全屏</span>\n                </a>\n            </div>\n        </div>',$("#div2d").append($(t)),"pc"==e.visitType){let e='<div id="popup-panel" class="popup-panel f-family">\n                <div class="popup-panel-bg"></div>\n                <div class="popup-panel-position">\n                    <div class="popup-panel-content p-relative m-auto a-move-in-top">\n                        <div class="title-ctnr p-relative">\n                            <h2 class="popup-title">分享给你的小伙伴</h2>\n                        </div>\n                        <div class="popup-content">\n                            <div class="share-ctnr">\n                                <div class="share-col share-left-part dp-i-block v-bottom">\n                                    <div class="share-icon-item dp-i-block b-circle pointer i-weixin">\n                                        <i class="icon-weixin icon-font"></i>\n                                    </div>\n                                    <div class="share-icon-item dp-i-block b-circle pointer i-weibo">\n                                        <i class="icon-weibo icon-font"></i>\n                                    </div>\n                                    <div class="share-icon-item dp-i-block b-circle pointer i-qq">\n                                        <i class="icon-qq icon-font"></i>\n                                    </div>\n                                    <div class="share-addr-ctnr">\n                                        <div class="share-addr-item">\n                                            <span class="share-addr-name dp-i-block v-middle">分享链接</span>\n                                            <input id="cpy-url" type="text" spellingcheck="false" readonly="readonly" class="cpy-input share-addr-wrapper dp-i-block v-middle border-box" value="'+window.location.href+'">\n                                            <input class="cpy" value="'+window.location.href+'">\n                                            <button class="bl-button share-copy-button v-middle bl-button--ghost bl-button--size">\n                                                <span class="txt">复制</span>\n                                            </button>\n                                        </div>\n                                        <div class="share-addr-item">\n                                            <span class="share-addr-name dp-i-block v-middle">iframe嵌入</span>\n                                            <input id="cpy-iframe" type="text" spellingcheck="false" readonly="readonly" class="cpy-input share-addr-wrapper dp-i-block v-middle border-box" value=\'<iframe src="'+window.location.href+'"></iframe>\'>\n                                            <input class="cpy" value=\'<iframe src="'+window.location.href+'"></iframe>\'>\n                                            <button class="bl-button share-copy-button v-middle bl-button--ghost bl-button--size">\n                                                <span class="txt">复制</span>\n                                            </button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="close-btn p-absolute bg-center bg-no-repeat pointer t-center">\n                            <i class="icon-close iconfont"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>';$("#div2d").append($(e));let t='<div id="qrcode" class="qrcode f-family">\n                <div class="popup-panel-bg"></div>\n                <div class="popup-panel-position">\n                    <div class="share-code-content p-relative m-auto a-move-in-top">\n                        <div class="title-ctnr p-relative">\n                            <h2 class="popup-title">微信扫一扫分享</h2>\n                        </div>\n                        <div class="popup-content">\n                            <div class="share-ctnr">\n                                <div class="share-col share-right-part dp-i-block v-bottom">\n                                    <div id="share-code" class="share-qr-ctnr"></div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="close-btn p-absolute bg-center bg-no-repeat pointer t-center">\n                            <i class="icon-close iconfont"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>';$("#div2d").append($(t));let a='<div id="alert-message" class="alert-message alert-message-hide">\n                    <div class="alert-message-notice">\n                        <div class="alert-message-notice-content">\n                            <div class="alert-message-notice-content-text">\n                                <div class="alert-message-custom-content alert-message-success">\n                                    <i class="icon-wancheng icon-font"></i>\n                                    <span>复制成功</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>';$("#div2d").append($(a))}else{let e='<div class="shareTip">\n                    <div class="share-tip"></div>\n                </div>';$("#div2d").append($(e))}$("#div2d").append($('<div id="viewHeight" class="viewHeight">\n                <div class="mbf-data">\n                    <div class="viewHeight-title">视角高度：</div>\n                    <input class="heightInput" type="text" value="1" min="0.1" style="width:57px;background-color: transparent;color: #ffffff;border: none; text-align: right;">\n                    <div class="height">m</div>\n                </div>\n                <div class="mbf-data">\n                    <div class="moveSpeed-title">移动速度：</div>\n                    <input class="speedInput" type="text" value="1" min="0.1" style="width:57px;background-color: transparent;color: #ffffff;border: none; text-align: right;">\n                    <div class="speed">km/h</div>\n                </div>  \n            </div>')),e.initEvent(),(e.loadType="scene")&&(null!=e.preLevelControlClass&&e.preLevelControlClass.init(),"undefined"!=typeof SceneCamera&&(e.sceneCameraClass=new SceneCamera))}initEvent(){var e=this;if(e.app.level.options.outlineColor=null,e.app.on(THING.EventType.MouseEnter,"*",(function(t){t.object&&null==e.app.level.options.outlineColor&&("Building"!=t.object.type&&"Floor"!=t.object.type&&"Facade"!=t.object.type||(t.object.style.outlineColor="16744448"))}),"鼠标划入建筑显示轮廓线"),e.app.on(THING.EventType.MouseLeave,"*",(function(e){e.object&&(e.object.style.outlineColor=null)}),"鼠标划出建筑隐藏轮廓线"),e.app.pauseEvent(THING.EventType.EnterLevel,".Thing",THING.EventTag.LevelFly),e.app.on(THING.EventType.EnterLevel,".Thing",(function(t){var a=t.object;e.app.camera.flyTo({object:a,radiusFactor:1.7,time:1e3,complete:function(){}})}),"customLevelFly"),e.app.on(THING.EventType.EnterLevel,".Building",(function(e){let t=e.object;if(null!=t.userData.relativeState)return;let a=t.floors;for(let e=0,t=a.length;e<t;e++){let t=a[e],i=t.userData.camInfo;null!=i&&(t.userData.camInfo2={eye:t.worldToSelf(i.eye),target:t.worldToSelf(i.target)})}t.userData.relativeState=!0}),"customBuildingLevelFly"),e.app.pauseEvent(THING.EventType.EnterLevel,".Floor",THING.EventTag.LevelFly),e.app.on(THING.EventType.EnterLevel,".Floor",(function(t){let a=t.object,i=a.userData.camInfo;null!=i&&i.eye&&i.target?e.app.camera.flyTo({position:a.selfToWorld(a.userData.camInfo2.eye),target:a.selfToWorld(a.userData.camInfo2.target),time:1e3}):e.app.camera.flyTo({object:a,radiusFactor:1,time:1e3,complete:function(){}})}),"customFloorLevelFly"),e.app.on(THING.EventType.EnterLevel,(function(t){if(e.stopRotate(),"Building"==e.app.level.current.type&&"Building"==t.object.type&&(contextMenuClass.expandState=!1,null!=t.object.facade&&(t.object.facade.fadeIn(),t.object.facade.visible=!1)),"Building"==t.object.type){let a=t.object.floors;if("Campus"==e.app.level.previous.type&&$("#expandFloorDataDetails").length>0&&$("#expandFloorDataDetails").remove(),a.length>1){e.building=t.object,sceneExpandFloorClass.addFloorPos(e.building),sceneExpandFloorClass.promptHtml(),null==e.building.getAttribute("expandState")&&e.building.setAttribute("expandState","close"),$("#horizontalExpansion").css({display:"block"}),$("#verticalExpansion").css({display:"block"}),sceneExpandFloorClass.changeVerticalOffsetDistance(e.building)}}else infoTipsClass.hiddenInfoTips("expandFloorInfoTips"),$("#expandFloorDataDetails").remove(),e.app.query(".Building").forEach((e=>{e.userData.expand="false"})),$("#horizontalExpansion").css({display:"none"}),$("#verticalExpansion").css({display:"none"}),"Campus"==t.object.type&&null!=e.building&&(sceneExpandFloorClass.exitBuildingCloseFloor(e.building),$("#horizontalExpansion").removeClass("active"),$("#verticalExpansion").removeClass("active"),e.building=null);null!=e.backGround?e.app.background=e.backGround:null!=e.currentSkyBox&&(e.app.skyBox=e.currentSkyBox),"3d"==e.switchCamera&&($(".view-change").text("2D视角"),e.switchCamera="2d",e.restarRotate()),$("#mapBg .miniMap").hasClass("selected")&&(e.destoryMiniMap(),e.createMiniMap())})),$("#horizontalExpansion").on("click",(function(){e.stopRotate(),e.checkBtnActives(["#moveByFps","#mapBg","#viewAni","#sceneSetting"]);let t=e.building.getAttribute("expandState");e.app.off(THING.EventType.KeyDown,null,"横向按下shift键"),e.app.pauseEvent(THING.EventType.KeyDown,null,"纵向按下Shift键"),$(this).hasClass("active")?($("#expandFloorDataDetails").remove(),$(".infoContainer").hasClass("moveTips")&&($(".infoContainer").removeClass("moveTips"),$(".infoContainer").addClass("resetTips")),"horizontal"==t&&($(this).removeClass("active"),sceneExpandFloorClass.horizontalExpand(e.building,"close")),e.app.resumeEvent(THING.EventType.KeyDown,null,"纵向按下Shift键")):(sceneExpandFloorClass.changeHorizontalOffsetDistance(e.building),$(".infoContainer").hasClass("resetTips")&&($(".infoContainer").removeClass("resetTips"),$(".infoContainer").addClass("moveTips")),"moving"!=t&&($(this).addClass("active"),$("#verticalExpansion").removeClass("active"),"vertical"==t?sceneExpandFloorClass.verticalToHorizontal(e.building):sceneExpandFloorClass.horizontalExpand(e.building,"horizontal"))),e.restarRotate()})),$("#verticalExpansion").on("click",(function(){e.stopRotate(),e.checkBtnActives(["#moveByFps","#mapBg","#viewAni","#sceneSetting"]);let t=e.building.getAttribute("expandState");e.app.off(THING.EventType.KeyDown,null,"横向按下shift键"),e.app.resumeEvent(THING.EventType.KeyDown,null,"纵向按下Shift键"),$("#expandFloorDataDetails").length>0?($("#expandFloorDataDetails").css("display","block"),$("#expandFloorDataDetails .tj-value").text(sceneExpandFloorClass.verticalDistance)):(sceneExpandFloorClass.floorExpandDistanceHtml(),$("#expandFloorDataDetails .tj-value").text(sceneExpandFloorClass.verticalDistance)),$(this).hasClass("active")?($("#expandFloorDataDetails").remove(),$(".infoContainer").hasClass("moveTips")&&($(".infoContainer").removeClass("moveTips"),$(".infoContainer").addClass("resetTips")),"vertical"==t&&($(this).removeClass("active"),sceneExpandFloorClass.verticalExpand(e.building,"close"))):($(".infoContainer").hasClass("resetTips")&&($(".infoContainer").removeClass("resetTips"),$(".infoContainer").addClass("moveTips")),"moving"!=t&&($(this).addClass("active"),$("#horizontalExpansion").removeClass("active"),"horizontal"==t?sceneExpandFloorClass.horizontalToVertical(e.building):sceneExpandFloorClass.verticalExpand(e.building,"vertical"))),e.restarRotate()})),"pc"==e.visitType)$("#share-code").qrcode({width:185,height:185,text:window.location.href,typeNumber:-1,background:"#ffffff",foreground:"#000000"}),$("#share").on("click",(function(t){$("#popup-panel").hasClass("p-fixed")||(e.checkBtnActives(["#moveByFps","#mapBg","#viewAni","#sceneSetting"]),$("#popup-panel").addClass("p-fixed"))})),$("#popup-panel .popup-panel-content .close-btn").on("click",(function(){$("#popup-panel").removeClass("p-fixed")})),$("#qrcode .share-code-content .close-btn").on("click",(function(){$("#qrcode").removeClass("p-fixed")})),$("#popup-panel .popup-panel-content .share-ctnr .share-col .share-icon-item").on("click",(function(t){let a={url:"",pic:null!=e.shareImg?e.shareImg:"",desc:"",summary:"面向物联网的3D可视化开发平台.基于WebGL兼容各种浏览器及移动设备.零门槛、高效率、低成本开发各类3D应用",event:t};$(this).hasClass("i-weixin")?$("#qrcode").addClass("p-fixed"):($(this).hasClass("i-weibo")?a.type="weibo":$(this).hasClass("i-qq")&&(a.type="qq"),shareInit(a))})),$("#cpy-url").on("mouseover",(function(){$(this).select()})),$("#cpy-iframe").on("mouseover",(function(){$(this).select()})),$(".cpy-input").on("mouseup",(function(){"undefined"!=$(this).val()&&($(this).select(),document.execCommand("Copy"),e.alertMessageShow())})),$("#popup-panel .popup-panel-content .share-addr-ctnr .share-addr-item .bl-button").on("click",(function(){e.copyLink(this)}));else{var t=new mShare({title:document.title,url:window.location.href,desc:"",img:null!=e.shareImg?e.shareImg:""});$("#share").on("click",(function(a){e.checkBtnActives(["#moveByFps","#mapBg","#viewAni","#sceneSetting"]);let i=navigator.userAgent.toLowerCase();i.match(/QQ\/[0-9]/i)||"micromessenger"==i.match(/MicroMessenger/i)?$(".shareTip").css("display","block"):t.init(0),$(this).removeClass("active")})),$(".shareTip").on("click",(function(){$(this).css("display","none")}))}$("#autoRotate").on("click",(function(){$(this).hasClass("active")?($(this).removeClass("active"),e.stopRotate()):($(this).addClass("active"),e.restarRotate())})),$("#sceneSetting").on("click",(function(){e.checkBtnActives(["#moveByFps","#mapBg","#viewAni"]),$(this).hasClass("active")?($(this).removeClass("active"),$(this).children(".control-menu").removeClass("actives"),$(this).find(".tooltiptext").css({visibility:"visible"})):($(this).addClass("active"),$(this).children(".control-menu").addClass("actives"),$(this).find(".tooltiptext").css({visibility:"hidden"}))})).hover((function(){$(this).hasClass("active")||$(this).find(".tooltiptext").css({visibility:"visible"})}),(function(){$(this).find(".tooltiptext").css({visibility:"hidden"})})),$("#sceneSetting .control-menu-pane li").on("click",(function(t){if(t.stopPropagation(),$(this).parents(".control-menu").removeClass("actives"),$(this).parents(".control-item").removeClass("active"),$(this).hasClass("selected"))$(this).removeClass("selected"),$(this).hasClass("template")?e.removeSceneTemplate():$(this).hasClass("light-change")?preScenesEffectClass.destroy():$(this).hasClass("poi-change")&&(e.stopRotate(),e.poiClass.init(!1),e.poiClass.offchangeLevel());else{if($(this).hasClass("template")){if(null!=e.map)return void newAlert("地图暂不支持设置模板","warning");$(this).addClass("selected"),$(this).siblings("li.template").removeClass("selected"),$(this).hasClass("template-light")?e.addSceneTemplate("template_light"):$(this).hasClass("template-dark")&&e.addSceneTemplate("template_dark")}else if($(this).hasClass("view-change")){if($("#viewAni .control-menu-pane li.view-animate").hasClass("selected"))return void newAlert("视点动画播放时本功能暂不可用。","error");e.stopRotate(),e.switchCameraLevel(),"2d"==e.switchCamera?($(this).text("3D视角"),e.switchCamera="3d"):"3d"==e.switchCamera&&($(this).text("2D视角"),e.switchCamera="2d")}else $(this).hasClass("light-change")?(preScenesEffectClass.create(),$(this).addClass("selected")):$(this).hasClass("poi-change")&&(e.stopRotate(),$(this).addClass("selected"),e.poiClass.init(!0));e.restarRotate()}})),$("#viewAni").on("click",(function(){e.checkBtnActives(["#moveByFps","#mapBg","#sceneSetting"]),$(this).hasClass("active")?($(this).removeClass("active"),$(this).children(".control-menu").removeClass("actives"),$(this).find(".tooltiptext").css({visibility:"visible"})):($(this).addClass("active"),$(this).children(".control-menu").addClass("actives"),$(this).children(".all-viewAni").removeClass("actives"),$(this).find(".tooltiptext").css({visibility:"hidden"})),0==e.viewAniDataJson.length&&($(".no-data").css("pointer-events","none"),$(".no-data").css("color","#807d7d"))})).hover((function(){$(this).hasClass("active")||$(this).find(".tooltiptext").css({visibility:"visible"})}),(function(){$(this).find(".tooltiptext").css({visibility:"hidden"})})),$("#viewAni .control-menu-pane li").on("click",(function(t){if($(this).hasClass("selected")&&!$(this).hasClass("play-setting")){if($(this).removeClass("selected"),$(".playpanelin").css("display","none"),viewAniClass.resetFunc(),$(this).hasClass("view-animate"))return $("#autoRotate").addClass("active"),viewAniClass.stopTravel(),void e.restarRotate()}else if($(this).hasClass("selected")&&$(this).hasClass("play-setting"))return $(this).removeClass("selected"),void $(".playpanelin").css("display","none");if($(this).hasClass("view-animate")){e.stopRotate(),viewAniClass.stopTravel(),$(this).siblings("li.view-animate").removeClass("selected"),$(this).addClass("selected");let t=$(this).text();$("#playBtn").children("img").attr("src",e.filePath+"img/viewAni/pause_view.png"),viewAniClass.startTravel(t)}$(this).hasClass("play-setting")&&($(this).addClass("selected"),$("#viewAni .control-menu-pane li.view-animate").hasClass("selected")&&$(".playpanelin").css("display","block"))})),$("#mapBg").on("click",(function(){e.checkBtnActives(["#moveByFps","#viewAni","#sceneSetting"]),$(this).hasClass("active")?($(this).removeClass("active"),$(this).children(".control-menu").removeClass("actives"),$(this).find(".tooltiptext").css({visibility:"visible"})):($(this).addClass("active"),$(this).children(".control-menu").addClass("actives"),$(this).find(".tooltiptext").css({visibility:"hidden"}))})).hover((function(){$(this).hasClass("active")||$(this).find(".tooltiptext").css({visibility:"visible"})}),(function(){$(this).find(".tooltiptext").css({visibility:"hidden"})})),$("#mapBg .control-menu-pane li").on("click",(function(t){if($(this).hasClass("miniMap"))return void e.miniMapInit($(this));if($(this).hasClass("sky")){$(this).siblings("li.sky").removeClass("selected"),$(this).addClass("selected");let t=$(this).text();return void(e.skyBoxConfig[t]&&(e.app.skyBox=e.skyBoxConfig[t],e.currentSkyBox=e.app.skyBox))}if($("#viewAni .control-menu-pane li.view-animate").hasClass("selected"))return void newAlert("视点动画播放时本功能暂不可用。","error");if($(this).hasClass("selected"))return;e.stopRotate();let a=$(this)[0].innerText;if("关闭地图"==a&&$("#pre-setting-list").length>0){newConfirm("关闭地图瓦片将会刷新本页面，您所做的一系列操作将不会被保存，您确定要关闭地图瓦片吗？",["确定","取消"],[function(){window.location.reload()},function(){swal_close()}])}else if($(this).siblings("li.mapbg").removeClass("selected"),$(this).addClass("selected"),"关闭地图"==a)null!=e.map?e.hiddenMapBg():window.location.reload();else{e.checkMapBgEvent();let t=a.split(" ")[0],i=a.split(" ")[1],s=e.mapConfig[t][i];if(null==e.map)if($("#all-controls").css({bottom:"10px"}),$("#dataAttribution").css({display:"block"}),null!=e.mapBgCtrl)if(e.tileLayer1.url=s,e.mapBgCtrl.attribution=t,"OSM"!=t){e.app.root.defaultCampus.position=CMAP.Util.convertLonlatToWorld(e.lonlat,.5);let t=e.app.root.defaultCampus.position;e.app.camera.position=[t[0]+e.cameraDistace[0],t[1]+e.cameraDistace[1],t[2]+e.cameraDistace[2]],e.app.camera.target=t}else{let t=e.gcj02towgs84(e.lonlat);e.app.root.defaultCampus.position=CMAP.Util.convertLonlatToWorld(t,.5);let a=e.app.root.defaultCampus.position;e.app.camera.position=[a[0]+e.cameraDistace[0],a[1]+e.cameraDistace[1],a[2]+e.cameraDistace[2]],e.app.camera.target=a}else e.showMapBg(t,s);else e.showMapBg(t,s)}})),$("#moveByFps").on("click",(function(){$("#autoRotate").hasClass("active")&&$("#autoRotate").trigger("click");var t=this;let a=function(){if(viewAniClass.resetFunc(),viewAniClass.stopTravel(),$("#viewAni .control-menu-pane li.view-animate").hasClass("selected")&&($("#viewAni .control-menu-pane li.view-animate").removeClass("selected"),$(".playpanelin").css("display","none")),$(".swal2-container.swal2-center.swal2-fade.swal2-shown.newalert").remove(),e.checkBtnActives(["#mapBg","#viewAni","#sceneSetting"]),null==e.mapBgCtrl)if($(t).hasClass("active"))$(t).removeClass("active"),$(t).children(".control-menu").removeClass("actives"),$(t).find(".tooltiptext").css({visibility:"visible"});else if($(t).hasClass("active"))$(t).removeClass("active"),$(t).children(".control-menu").removeClass("actives"),$(t).find(".tooltiptext").css({visibility:"visible"});else{if($(t).addClass("active"),$(t).children(".control-menu").addClass("actives"),$(t).find(".tooltiptext").css({visibility:"hidden"}),e.stopRotate(),viewAniClass.stopTravel(),null!=moveByFpsClass.fpsCtrl)return;e.app.pauseEvent(THING.EventType.DBLClick,"*",THING.EventTag.LevelEnterOperation),e.app.pauseEvent(THING.EventType.Click,"*",THING.EventTag.LevelBackOperation),moveByFpsClass.createBox()}else newAlert("地图背景打开时本功能暂不可用。","error")},i=function(){$(".swal2-container.swal2-center.swal2-fade.swal2-shown.newalert").remove(),viewAniClass.resumeTravel()};$("#viewAni .control-menu-pane li.view-animate").hasClass("selected")?(viewAniClass.pauseTravel(),newConfirm("第一人称模式下无法观看视点动画，您确定要切换到第一人称模式下吗？",["确定","取消"],[a,i])):a()})).hover((function(){$(this).hasClass("active")||$(this).find(".tooltiptext").css({visibility:"visible"})}),(function(){$(this).find(".tooltiptext").css({visibility:"hidden"})})),$("#moveByFps .control-menu-pane li").on("click",(function(t){if(null==e.mapBgCtrl)if($(this).hasClass("selected"))if($(this).removeClass("selected"),null!=moveByFpsClass.box&&(e.app.resumeEvent(THING.EventType.DBLClick,"*",THING.EventTag.LevelEnterOperation),e.app.resumeEvent(THING.EventType.Click,"*",THING.EventTag.LevelBackOperation),moveByFpsClass.box.destroy(),moveByFpsClass.box=null),null!=moveByFpsClass.fpsCtrl){if(moveByFpsClass.exitFps(),null==e.cameraInitPos)return;e.cameraSceneFly(e.cameraInitPos[0],e.cameraInitPos[1],1e3),"3d"==e.switchCamera&&(e.app.camera.viewMode=THING.CameraView.TopView)}else $(this).hasClass("fp-moving")&&($(this).addClass("selected"),e.stopRotate(),viewAniClass.stopTravel(),e.app.pauseEvent(THING.EventType.DBLClick,"*",THING.EventTag.LevelEnterOperation),e.app.pauseEvent(THING.EventType.Click,"*",THING.EventTag.LevelBackOperation),moveByFpsClass.createBox());else{if(e.stopRotate(),viewAniClass.stopTravel(),null!=moveByFpsClass.fpsCtrl){if(moveByFpsClass.exitFps(),null==e.cameraInitPos)return;e.cameraSceneFly(e.cameraInitPos[0],e.cameraInitPos[1],1e3),"3d"==e.switchCamera&&(e.app.camera.viewMode=THING.CameraView.TopView)}$(this).addClass("selected"),$(this).siblings("li.selected").removeClass("selected"),e.app.pauseEvent(THING.EventType.DBLClick,"*",THING.EventTag.LevelEnterOperation),e.app.pauseEvent(THING.EventType.Click,"*",THING.EventTag.LevelBackOperation),moveByFpsClass.createBox(),e.app.resumeEvent(THING.EventType.Click,null,"进入第一人称点击事件")}else newAlert("地图背景打开时本功能暂不可用。","error")})),$("#fullScreen").mouseup((function(){e.fullScreenState?($(".icon-fullScreen").css("display","block"),$(".icon-narrow").css("display","none"),$("#fullScreen span").text("全屏"),e.exitFullScreen(),e.fullScreenState=!1,$("#mapBg").hasClass("active")&&(e.destoryMiniMap(),e.createMiniMap())):($(".icon-fullScreen").css("display","none"),$(".icon-narrow").css("display","block"),$("#fullScreen span").text("退出全屏"),e.fullScreen(),e.fullScreenState=!0),e.checkBtnActives(["#mapBg","#viewAni","#sceneSetting"])})),e.app.on(THING.EventType.MouseDown,(function(){e.app.pauseEvent(THING.EventType.CameraZoom,null,"摄像机前后滚动，功能图片隐藏"),null!=e.showControlTimer&&(clearTimeout(e.showControlTimer),e.showControlTimer=null),e.stopRotate(),null==e.hiddenControlTimer&&(clearTimeout(e.showControlTimer),e.hiddenControlTimer=setTimeout((function(){$("#all-controls").css("display","none"),clearTimeout(e.hiddenControlTimer),e.hiddenControlTimer=null}),300))})),e.app.on(THING.EventType.MouseUp,(function(){e.app.resumeEvent(THING.EventType.CameraZoom,null,"摄像机前后滚动，功能图片隐藏"),null!=e.hiddenControlTimer&&(clearTimeout(e.hiddenControlTimer),e.hiddenControlTimer=null),null==e.showControlTimer&&(e.showControlTimer=setTimeout((function(){$("#all-controls").css("display","block"),clearTimeout(e.showControlTimer),e.showControlTimer=null,e.restarRotate()}),300))}));let a=0;e.app.on(THING.EventType.CameraZoom,(function(){null==e.showControlTimer?(e.stopRotate(),null==e.showControlTimer&&($("#all-controls").css("display","none"),e.showControlTimer=setInterval((function(){a++,a>=2&&($("#all-controls").css("display","block"),e.restarRotate(),clearInterval(e.showControlTimer),e.showControlTimer=null)}),300))):a=0}),"摄像机前后滚动，功能图片隐藏"),e.app.on(THING.EventType.MouseMove,(function(t){null!=moveByFpsClass.box&&(t.picked?moveByFpsClass.box.position=e.app.camera.picker.pickWorldPosition(t.clientX,t.clientY):$("#moveByFps li.fp-flying").hasClass("selected")&&(moveByFpsClass.box.position=e.app.camera.screenToWorld(t.clientX,t.clientY)))})),e.app.on(THING.EventType.CameraChangeEnd,(function(){if(e.cameraDistace.length>0){let t=e.app.camera.position,a=e.app.root.defaultCampus.position;e.cameraDistace=[t[0]-a[0],t[1]-a[1],t[2]-a[2]]}e.rotateState&&e.restarRotate()})),e.app.on(THING.EventType.SingleClick,(function(t){if(e.stopRotate(),t.picked&&0==t.button&&null!=moveByFpsClass.box){let a=moveByFpsClass.box.position;moveByFpsClass.box.destroy(),moveByFpsClass.box=null,e.cameraInitPos=[e.app.camera.position,e.app.camera.target],e.app.camera.flyTo(a),moveByFpsClass.enterFps([a[0],a[1]+3,a[2]],null,t.object)}e.checkBtnActives(["#moveByFps","#mapBg","#viewAni","#sceneSetting"])}),"进入第一人称点击事件"),e.app.on(THING.EventType.EnterLevel,(function(){if(null!=moveByFpsClass.fpsCtrl){if(moveByFpsClass.exitFps(),null==e.cameraInitPos)return;e.cameraSceneFly(e.cameraInitPos[0],e.cameraInitPos[1],1e3),"3d"==e.switchCamera&&(e.app.camera.viewMode=THING.CameraView.TopView)}})),e.app.on(THING.EventType.LeaveLevel,(function(){e.stopRotate(),e.app.off(THING.EventType.KeyDown,null,"横向按下shift键"),e.app.off(THING.EventType.KeyDown,null,"纵向按下Shift键")})),e.app.on(THING.EventType.MouseWheel,(function(){e.stopRotate()})),e.app.on(THING.EventType.KeyDown,(function(t){if("Escape"==t.code){if(null!=moveByFpsClass.box&&(e.app.resumeEvent(THING.EventType.DBLClick,"*",THING.EventTag.LevelEnterOperation),e.app.resumeEvent(THING.EventType.Click,"*",THING.EventTag.LevelBackOperation),moveByFpsClass.destroyBox(),moveByFpsClass.box=null,$("#moveByFps li.selected").removeClass("selected"),$("#moveByFps li.fp-moving").addClass("selected"),e.restarRotate()),null!=moveByFpsClass.fpsCtrl){if(moveByFpsClass.exitFps(),null==e.cameraInitPos)return;e.cameraSceneFly(e.cameraInitPos[0],e.cameraInitPos[1],1e3),"3d"==e.switchCamera&&(e.app.camera.viewMode=THING.CameraView.TopView,e.app.background="#909090"),e.restarRotate()}e.checkBtnActives(["#moveByFps","#mapBg","#viewAni","#sceneSetting"])}})),window.onresize=function(){e.checkFull()||1==e.fullScreenState&&($(".icon-fullScreen").css("display","block"),$(".icon-narrow").css("display","none"),$("#fullScreen span").text("全屏"),e.fullScreenState=!1)}}viewAniState(){var e=this;let t=window.location.href,a=window.location.search;""!=a?$.ajax({type:"get",url:"/api/parseString"+a,dataType:"json",async:!1,success:function(t){200==t.code&&t.data&&(1==t.data.viewAni?e.autoAni():e.restarRotate())}}):-1!=t.indexOf("/www.thingjs.com/pre/")?e.autoAni():e.restarRotate()}autoAni(){let e="autoexec";return;viewAniDataJson.autoexec?setTimeout((function(){viewAniClass.startTravel(e),$("#viewAni .control-menu-pane").find('li[data-name="autoexec"]').addClass("selected")}),5e3):restarRotate()}cameraSceneFly(e,t,a){this.app.camera.flyTo({position:e,target:t,time:a})}startRotate(){var e=this;if(e.app.camera.enableRotate=!1,e.app.camera.enablePan=!1,e.app.camera.enableZoom=!1,null!=e.mapBgCtrl||null!=e.map)e.app.camera.earthFlyRotateBySpeed({target:e.app.camera.target,speed:70});else{let t={target:e.app.camera.target,yRotateAngle:360,loopType:THING.LoopType.Repeat};null==e.rotateAroundTime||isNaN(parseFloat(e.rotateAroundTime))?t.speed=1:t.time=parseFloat(e.rotateAroundTime),e.app.camera.rotateAround(t)}}stopRotate(){var e=this;e.app.camera.enableRotate=!0,"3d"==e.switchCamera&&"city"==e.loadType&&(e.app.camera.enableRotate=!1),e.app.camera.enablePan=!0,e.changeEnableZoom(),1==e.initEnableZoom&&(e.app.camera.enableZoom=!0),null!=e.mapBgCtrl||null!=e.map?e.app.camera.stopEarthFly():e.app.camera.stopRotateAround(),e.rotateTimer&&(clearTimeout(e.rotateTimer),e.rotateTimer=null),"city"==e.loadType&&e.MapInfoClass&&e.MapInfoClass.show()}restarRotate(){var e=this;null==moveByFpsClass.fpsCtrl&&"3d"!=e.switchCamera&&0!=$("#autoRotate").hasClass("active")&&($("#viewAni .control-menu-pane li.view-animate").hasClass("selected")||e.rotateControl&&(null==e.rotateTimer?e.rotateTimer=setTimeout((function(){e.startRotate()}),e.restartTime):(clearTimeout(e.rotateTimer),e.rotateTimer=null,e.restarRotate())))}changeEnableZoom(){var e=this;$(document).keydown((function(t){var a=t||window.event;16==(a.keyCode||a.which)&&(e.initEnableZoom=!1,e.app.camera.enableZoom=!1)})),$(document).keyup((function(t){var a=event||window.event;(a.keyCode||a.which)&&(e.initEnableZoom=!0,e.app.camera.enableZoom=!0)}))}checkBtnActives(e){for(let t=0;t<e.length;t++){let a=e[t];$(a).hasClass("active")&&($(a).removeClass("active"),$(a).find(".control-menu").removeClass("actives"))}}miniMapInit(e){var t=this;null==t.mapBgCtrl?e.hasClass("selected")?(e.removeClass("selected"),t.destoryMiniMap()):(e.addClass("selected"),t.createMiniMap()):newAlert("地图背景打开时本功能暂不可用。","error")}createMiniMap(){var e=this;null==e.miniMapCtrl?(e.miniMapCtrl=e.app.addControl(new THING.MiniMapControl({width:200,height:200,position:THING.CornerType.LeftBottom,opacity:.8,scale:1,angle:0,mousewheel:!0,cameraViewImg:"https://www.thingjs.com/static/images/minimap1.png",cameraCenterImg:"https://www.thingjs.com/static/images/minimap0.png"})),$(".minimap").css("border","1px solid rgba(255, 255, 255, 0.8)"),$(".minimap").css("left","3px"),$(".minimap").css("bottom","3px")):(e.destoryMiniMap(),e.createMiniMap())}destoryMiniMap(){var e=this;null!=e.miniMapCtrl&&(e.app.removeControl(e.miniMapCtrl),e.miniMapCtrl=null)}showMapBg(e,t){var a=this;if(null==a.map)null==a.mapBgCtrl?THING.Utils.dynamicLoadJS(["https://www.thingjs.com/uearth/uearth.min.js"],(function(){if(a.mapBgCtrl=a.app.create({type:"Map",attribution:e,style:{night:!1,fog:!1}}),$(".template-light").hasClass("selected")||$(".template-dark").hasClass("selected")){var i={template:CMAP.TileLayerStyle.CUSTOMCOLOR,brightness:1,customColor:[255,255,255,1],grayFilterEnable:!0,grayFilterPerBar:[0,.5,1]};$(".template-light").hasClass("selected")?i.grayFilterColorBar=[[236,236,236,1],[40,40,40,1],[239,239,239,1]]:i.grayFilterColorBar=[[43,43,43,1],[251,251,251,1],[26,26,26,1]],a.tileLayer1=a.app.create({type:"TileLayer",name:"卫星影像图层",url:t,style:i,maximumLevel:18})}else a.tileLayer1=a.app.create({type:"TileLayer",name:"卫星影像图层",url:t,maximumLevel:18});if(a.mapBgCtrl.addLayer(a.tileLayer1),a.app.camera.curOrbit.leftInteractive=!1,"OSM"!=e)a.app.root.defaultCampus.position=CMAP.Util.convertLonlatToWorld(a.lonlat,0);else{let e=a.gcj02towgs84(a.lonlat);a.app.root.defaultCampus.position=CMAP.Util.convertLonlatToWorld(e,0)}var s=setTimeout((function(){clearTimeout(s);let e=a.app.camera.position,t=a.app.camera.target;a.cameraDistace=[e[0]-t[0],e[1]-t[1],e[2]-t[2]];let i=a.app.root.defaultCampus.position;a.app.camera.position=[i[0]+a.cameraDistace[0],i[1]+a.cameraDistace[1],i[2]+a.cameraDistace[2]],a.app.camera.target=i,a.restarRotate()}),500)})):(a.mapBgCtrl.baseLayers.visible=!0,a.restarRotate());else{for(let i=0,s=a.map.allLayers.length;i<s;i+=1){if("TileLayer"==a.map.allLayers[i].type){a.tileLayer1=a.map.allLayers[i],null==a.titleLayerUrl&&(a.titleLayerUrl=a.tileLayer1.url),a.tileLayer1.url=t,a.map.attribution=e;break}}a.restarRotate()}}hiddenMapBg(){var e=this;e.tileLayer1&&(e.tileLayer1.url=e.titleLayerUrl,$("#dataAttribution").html(e.attributionInit),$("#dataAttribution").css("display","block"),e.restarRotate())}checkMapBgEvent(){var e=this;if("3d"==e.switchCamera&&(e.app.camera.viewMode=THING.CameraView.Normal,$(".view-change").text("2D视角")),$("#mapBg .miniMap").hasClass("selected")&&($("#mapBg .miniMap").removeClass("selected"),e.destoryMiniMap()),$("#moveByFps li.selected").hasClass("selected")){if($("#moveByFps li.selected").removeClass("selected"),moveByFpsClass.exitFps(),null==e.cameraInitPos)return;e.cameraSceneFly(e.cameraInitPos[0],e.cameraInitPos[1],1e3),"3d"==e.switchCamera&&(e.app.camera.viewMode=THING.CameraView.TopView)}}gcj02towgs84(e){return coordtransform.gcj02towgs84(e[0],e[1])}fullScreen(){let e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen;if(void 0!==t&&t)t.call(e);else if(void 0!==window.ActiveXObject){let e=new ActiveXObject("WScript.Shell");null!=e&&e.SendKeys("{F11}")}}exitFullScreen(){let e=document,t=e.cancelFullScreen||e.webkitCancelFullScreen||e.exitFullScreen;if(void 0!==t&&t)t.call(e);else if(void 0!==window.ActiveXObject){let e=new ActiveXObject("WScript.Shell");null!=e&&e.SendKeys("{F11}")}}copyLink(e){$(e).siblings("input.cpy").select(),document.execCommand("Copy"),this.alertMessageShow()}alertMessageShow(){$("#alert-message").removeClass("alert-message-hide"),$("#alert-message").addClass("alert-message-show"),$("#alert-message").show(),setTimeout(this.alertMessageHide,1e3)}alertMessageHide(){$("#alert-message").removeClass("alert-message-show"),$("#alert-message").addClass("alert-message-hide"),setTimeout((function(){$("#alert-message").hide()}),200)}addSceneTemplate(e){var t=this,a=JSON.parse(t.themeData[e].sceneTheme);THING.ThemeManager.register("theme1",a);const i=THING.App.current;if(i&&(i.root.applyTheme(null),i.applyThemeEnvironment(null),i.root.applyTheme("theme1"),i.applyThemeEnvironment("theme1"),"undefined"!=typeof CMAP)){var s=t.themeData[e].mapTheme;s.template=CMAP.TileLayerStyle.CUSTOMCOLOR,null!=t.tileLayer1&&(t.tileLayer1.style=s)}}removeSceneTemplate(){const e=THING.App.current;e&&(e.root.applyTheme(null),e.applyThemeEnvironment(null),null!=this.tileLayer1&&(this.tileLayer1.style={template:CMAP.TileLayerStyle.CUSTOMCOLOR,grayFilterEnable:!1}))}checkFull(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;return void 0===e&&(e=!1),e}change2D0r3D(){var e=this;if("2d"==e.switchCamera){let a={time:10,pitch:89,lonlat:(t=e.app.camera.getCameInfo()).lonlat,heading:0,height:parseInt(t.height)};e.app.camera.earthFlyTo(a),e.app.camera.enableRotate=!1}else if("3d"==e.switchCamera){var t;let a={time:10,pitch:40,lonlat:(t=e.app.camera.getCameInfo()).lonlat,heading:0,height:parseInt(t.height)};e.app.camera.enableRotate=!0,e.app.camera.earthFlyTo(a),e.restarRotate()}}switchCameraLevel(){var e=this;null==e.map||"city"!=e.loadType?null!=e.map||null!=e.mapBgCtrl?e.change2D0r3D():(viewAniClass.stopTravel(),"2d"==e.switchCamera?(e.app.camera.enableRotate=!1,e.app.camera.viewMode=THING.CameraView.TopView,e.app.background="#909090"):"3d"==e.switchCamera&&(e.app.camera.viewMode=THING.CameraView.Normal,e.restarRotate())):e.change2D0r3D()}}